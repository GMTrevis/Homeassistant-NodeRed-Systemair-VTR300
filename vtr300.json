[{"id":"c1e03843.9d14a8","type":"tab","label":"VTR300 - Modbus","disabled":false,"info":""},{"id":"2d3fdce.f93d524","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":1940,"wires":[[],[]]},{"id":"b238488f.431758","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5002;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":1940,"wires":[["2d3fdce.f93d524"]]},{"id":"e8d77f2b.11788","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":1960,"wires":[["b238488f.431758"],["806531c0.8529e"]]},{"id":"806531c0.8529e","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5003;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":1980,"wires":[["4055cea4.4ee"]]},{"id":"4055cea4.4ee","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":1980,"wires":[[],[]]},{"id":"ea4bb68a.749198","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 ------------------------------------------------------ Auto schedule - Tidsskjema ------------------------------------------------------- Skriver til modbus holding registre","info":"","x":3530,"y":1860,"wires":[]},{"id":"c1354d45.b70cd","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5004;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2040,"wires":[["8e21bd75.c5b8e"]]},{"id":"e7790c1c.99fa8","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2060,"wires":[["c1354d45.b70cd"],["a0c258b.e977fa8"]]},{"id":"a0c258b.e977fa8","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5005;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2080,"wires":[["66ae848.7a8307c"]]},{"id":"1b3dcb9b.790934","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5006;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2160,"wires":[["f0e2b2f8.62bb4"]]},{"id":"b9faed7c.ae09b","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2180,"wires":[["1b3dcb9b.790934"],["4f5e944.f3ed96c"]]},{"id":"4f5e944.f3ed96c","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5007;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2200,"wires":[["50c4be55.bf02a"]]},{"id":"6c2310cc.163ae","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5008;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2260,"wires":[["6b6f1134.8d36c"]]},{"id":"ff411b1b.170a08","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2280,"wires":[["6c2310cc.163ae"],["e3d85e0.1db48a"]]},{"id":"e3d85e0.1db48a","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5009;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2300,"wires":[["f4554cfc.5a3bc"]]},{"id":"7c4c5f0f.c35de","type":"comment","z":"c1e03843.9d14a8","name":"Mandag - Set Periode 1","info":"","x":3240,"y":1920,"wires":[]},{"id":"85716c46.3590f","type":"comment","z":"c1e03843.9d14a8","name":"Mandag - Periode 2","info":"","x":3230,"y":2140,"wires":[]},{"id":"e94dd48a.bcd338","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5010;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2380,"wires":[["a2dffa7c.28f028"]]},{"id":"cad07183.619fb","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2400,"wires":[["e94dd48a.bcd338"],["fe9fe3ac.899e"]]},{"id":"fe9fe3ac.899e","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5011;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2420,"wires":[["4e0b8a5.cf69d74"]]},{"id":"f7dce2dd.5e47a","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5012;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2480,"wires":[["cf629f3f.84057"]]},{"id":"62260794.a71838","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2500,"wires":[["f7dce2dd.5e47a"],["698d0ea9.40e63"]]},{"id":"698d0ea9.40e63","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5013;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2520,"wires":[["592b7785.6b1218"]]},{"id":"9205c460.a84d48","type":"comment","z":"c1e03843.9d14a8","name":"Tirsdag - Periode 1","info":"","x":3230,"y":2360,"wires":[]},{"id":"d26e5ed8.48426","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5014;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2600,"wires":[["68fbc5fd.fbd11c"]]},{"id":"91d6eeba.f32bf","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2620,"wires":[["d26e5ed8.48426"],["915d7f3b.81927"]]},{"id":"915d7f3b.81927","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5015;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2640,"wires":[["cd6887a.ff6f578"]]},{"id":"ba3a68cf.8b1dc8","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5016;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2700,"wires":[["34774ea1.7feb12"]]},{"id":"22db3aa2.961336","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2720,"wires":[["ba3a68cf.8b1dc8"],["cf85724a.f6be7"]]},{"id":"cf85724a.f6be7","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5017;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2740,"wires":[["99d0c143.4866c"]]},{"id":"ef3d9bde.6947a8","type":"comment","z":"c1e03843.9d14a8","name":"Tirsdag - Periode 2","info":"","x":3230,"y":2580,"wires":[]},{"id":"81a53205.0c4b9","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5018;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2820,"wires":[["b04d6e3c.2520e"]]},{"id":"7da4752b.fc7e2c","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2840,"wires":[["81a53205.0c4b9"],["b563e543.420c38"]]},{"id":"b563e543.420c38","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5019;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2860,"wires":[["c3d5c4c.3592438"]]},{"id":"8322e331.9bc8c","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5020;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2920,"wires":[["56f905d5.bbda2c"]]},{"id":"20de4c71.7e4d04","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":2940,"wires":[["8322e331.9bc8c"],["7cd2d990.032aa8"]]},{"id":"7cd2d990.032aa8","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5021;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":2960,"wires":[["6e986069.4990a"]]},{"id":"69a32fdb.ab5a7","type":"comment","z":"c1e03843.9d14a8","name":"Onsdag - Periode 1","info":"","x":3230,"y":2800,"wires":[]},{"id":"63f22e85.31c9","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5022;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3040,"wires":[["f1c939c.a7e28c8"]]},{"id":"2a1c80a.647c38","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3060,"wires":[["63f22e85.31c9"],["a150f78c.817c78"]]},{"id":"a150f78c.817c78","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5023;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3080,"wires":[["b7f51229.b4856"]]},{"id":"a68efff8.60b8d","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5024;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3140,"wires":[["430f87f8.89a4a8"]]},{"id":"8e4ab0d9.dfdd1","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3160,"wires":[["a68efff8.60b8d"],["f570f47e.9ca768"]]},{"id":"f570f47e.9ca768","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5025;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3180,"wires":[["a2ebd4ac.7f8a58"]]},{"id":"735c4dbd.1d6a84","type":"comment","z":"c1e03843.9d14a8","name":"Onsdag - Periode 2","info":"","x":3230,"y":3020,"wires":[]},{"id":"bd00b852.8f78d8","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5026;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3260,"wires":[["c2a39846.ccd3e8"]]},{"id":"681f1fd1.d2d21","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3280,"wires":[["bd00b852.8f78d8"],["2cbca0f3.1558a"]]},{"id":"2cbca0f3.1558a","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5027;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3300,"wires":[["303070a1.bfe84"]]},{"id":"16f007b2.cbdd98","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5028;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3360,"wires":[["92b580c0.b96d4"]]},{"id":"c5a9586d.2a32a8","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3380,"wires":[["16f007b2.cbdd98"],["73bc4aa7.03d914"]]},{"id":"73bc4aa7.03d914","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5029;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3400,"wires":[["6b448d94.171494"]]},{"id":"d5ee08f8.29cc78","type":"comment","z":"c1e03843.9d14a8","name":"Torsdag - Periode 1","info":"","x":3230,"y":3240,"wires":[]},{"id":"5648793.dc93a88","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5030;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3480,"wires":[["37b0b19d.4bcf9e"]]},{"id":"12bdf871.ff2328","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3500,"wires":[["5648793.dc93a88"],["65624cb1.b6fe54"]]},{"id":"65624cb1.b6fe54","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5031;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3520,"wires":[["39e4b6ca.e764aa"]]},{"id":"82de12d0.cbe01","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5032;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3580,"wires":[["4f10ae83.3a4d3"]]},{"id":"c090825e.0e472","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3600,"wires":[["82de12d0.cbe01"],["fb9ec6af.539e78"]]},{"id":"fb9ec6af.539e78","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5033;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3620,"wires":[["9c34ed.cf935b1"]]},{"id":"89c81ead.c213f","type":"comment","z":"c1e03843.9d14a8","name":"Torsdag - Periode 2","info":"","x":3230,"y":3460,"wires":[]},{"id":"9116e2ca.f933b","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5034;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3700,"wires":[["4fbb2801.1f7028"]]},{"id":"f1258807.1b6b98","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3720,"wires":[["9116e2ca.f933b"],["27c8196b.893df6"]]},{"id":"27c8196b.893df6","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5035;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3740,"wires":[["d239c73a.6bbed8"]]},{"id":"47f538ed.8ff718","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5036;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3800,"wires":[["730c336.5d952cc"]]},{"id":"1a4cbe76.772572","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3820,"wires":[["47f538ed.8ff718"],["b3adbd9d.6c779"]]},{"id":"b3adbd9d.6c779","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5037;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3840,"wires":[["b10b8ac8.54bcf8"]]},{"id":"823e173b.a5c468","type":"comment","z":"c1e03843.9d14a8","name":"Fredag - Periode 1","info":"","x":3230,"y":3680,"wires":[]},{"id":"a1f0137b.d9294","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5038;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3920,"wires":[["b5d89608.1130f8"]]},{"id":"a2f35fdc.737f2","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":3940,"wires":[["a1f0137b.d9294"],["af118bc2.262f48"]]},{"id":"af118bc2.262f48","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5039;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":3960,"wires":[["2e38e0d.5e3d72"]]},{"id":"f0dba4ba.e68638","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5040;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4020,"wires":[["6d5943b5.56a6fc"]]},{"id":"181bf92.a11a007","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4040,"wires":[["f0dba4ba.e68638"],["696792a3.709f1c"]]},{"id":"696792a3.709f1c","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5041;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4060,"wires":[["e8e89d0e.bbe64"]]},{"id":"7056d15d.16ed3","type":"comment","z":"c1e03843.9d14a8","name":"Fredag - Periode 2","info":"","x":3230,"y":3900,"wires":[]},{"id":"858e0972.a8d068","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5042;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4140,"wires":[["c94869c6.38f638"]]},{"id":"d3613682.f25398","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4160,"wires":[["858e0972.a8d068"],["d2a9b0ce.cfc1e"]]},{"id":"d2a9b0ce.cfc1e","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5043;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4180,"wires":[["c5f1019c.6b352"]]},{"id":"798dbfa0.2722f","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5044;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4240,"wires":[["d180cfba.a1c24"]]},{"id":"62703a5e.214024","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4260,"wires":[["798dbfa0.2722f"],["60f73070.15bd2"]]},{"id":"60f73070.15bd2","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5045;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4280,"wires":[["ed3f65f2.b00448"]]},{"id":"43c55979.6ba1b8","type":"comment","z":"c1e03843.9d14a8","name":"LÝ�rdag - Periode 1","info":"","x":3230,"y":4120,"wires":[]},{"id":"200e16c0.ed1bda","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5046;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4360,"wires":[["d03953d9.3d969"]]},{"id":"cda53ab6.925b38","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4380,"wires":[["200e16c0.ed1bda"],["64a2903f.d53d8"]]},{"id":"64a2903f.d53d8","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5047;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4400,"wires":[["c914e3e8.5c82"]]},{"id":"cf8296d.36a0068","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5048;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4460,"wires":[["9bffa906.082b78"]]},{"id":"67c6ac1c.5f8f74","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4480,"wires":[["cf8296d.36a0068"],["9bf37736.358e28"]]},{"id":"9bf37736.358e28","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5049;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4500,"wires":[["b67be7c9.6a8cf8"]]},{"id":"ad3eff9d.4177f","type":"comment","z":"c1e03843.9d14a8","name":"Lørdag - Periode 2","info":"","x":3230,"y":4340,"wires":[]},{"id":"5dfc0fc0.23d9f","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5050;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4580,"wires":[["d5883df0.43436"]]},{"id":"6712e453.53c9ac","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4600,"wires":[["5dfc0fc0.23d9f"],["3af41e9d.6fcfe2"]]},{"id":"3af41e9d.6fcfe2","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5051;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4620,"wires":[["21837085.bfb37"]]},{"id":"19c4bec5.6c0a31","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5052;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4680,"wires":[["f3e86fc7.a5f53"]]},{"id":"6a1816a9.46f508","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4700,"wires":[["19c4bec5.6c0a31"],["71a3c679.0debd8"]]},{"id":"71a3c679.0debd8","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5053;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4720,"wires":[["7fc10f7b.9e2f4"]]},{"id":"934c13b9.979f4","type":"comment","z":"c1e03843.9d14a8","name":"Søndag - Periode 1","info":"","x":3230,"y":4560,"wires":[]},{"id":"d342951d.8a1fc8","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5054;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4800,"wires":[["a1e7fc5b.fbcdd"]]},{"id":"2cb74f0d.0ac74","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4820,"wires":[["d342951d.8a1fc8"],["3f1574d5.592d5c"]]},{"id":"3f1574d5.592d5c","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5055;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4840,"wires":[["e107be.8e56384"]]},{"id":"f7ed0060.57a61","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=5056;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4900,"wires":[["62aed387.ee42ec"]]},{"id":"27645144.662c3e","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":3560,"y":4920,"wires":[["f7ed0060.57a61"],["4327c42a.d5a0dc"]]},{"id":"4327c42a.d5a0dc","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=5057;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3720,"y":4940,"wires":[["ca2c1d50.fdc48"]]},{"id":"e4a82aa1.1c3ec8","type":"comment","z":"c1e03843.9d14a8","name":"Søndag - Periode 2","info":"","x":3230,"y":4780,"wires":[]},{"id":"1176949f.9065db","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Utekomp.VMU (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2290,"y":380,"wires":[[],[]]},{"id":"e009fde0.d5a85","type":"function","z":"c1e03843.9d14a8","name":"Set Temp","func":"var fc=6;\nvar sa=1253;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2120,"y":380,"wires":[["1176949f.9065db"]]},{"id":"8ba67ad6.1b5798","type":"range","z":"c1e03843.9d14a8","minin":"-30","maxin":"1","minout":"65236","maxout":"65546","action":"roll","round":false,"property":"payload","name":"Rescale -","x":1580,"y":380,"wires":[["346b693c.f8eac6"]],"info":"Engineering range: -30°C -> 0°C\nRaw value range:   65236 -> 65536\n\n**NB 0°C for signes INT!**\n - Ved 0°C er Raw value \"0\", derfor egen funksjon foo   negative verdier.\n\n**Bug \"Edit range node\"?**\n - Må utvide ranger til utenfor faktisk måleområde  for å kunne skrive øvre grense, derfor utvidet ranger. Korrekt arbeidsområde er gitt i \"input_number\" i HA. Derfor ranger som under:\n - Engineering range: -30�C -> 1°C\n - Raw value range:   65236 -> 65546\n\n**Slider vs box**\n - Slider for \"input_number\" er brukt pga. \"box\" er   dårlig tilpasset justering fra mobil for negative   verdier."},{"id":"e1312baa.4b4d48","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":380,"wires":[["99f980ba.26b79"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"c6f54188.23f6e","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day1.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day1_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2000,"wires":[[]]},{"id":"aab0d5cf.5ee018","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day1_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":1960,"wires":[["7bb7b362.2b45fc"]]},{"id":"785e18fd.031e48","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day1_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2060,"wires":[["f09d98a6.7914e8"]]},{"id":"4d7348c1.3fa918","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day1.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day1_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2100,"wires":[[]]},{"id":"dcdb7162.7809a","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day1_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2180,"wires":[["f6fb29d0.686478"]]},{"id":"ab5ac5ba.4d83e8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day1.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day1_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2220,"wires":[[]]},{"id":"29ea6e9b.cc3652","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5010;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2400,"wires":[["cb543c1e.92be1"]]},{"id":"cb543c1e.92be1","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2400,"wires":[["1e7fa7ac.7396a8"],["8d63d4ba.655278"]]},{"id":"914e3236.3b6e6","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day2.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day2_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2440,"wires":[[]]},{"id":"8386aeaf.7dc71","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day1.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day1_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2320,"wires":[[]]},{"id":"7d098e94.cf277","type":"comment","z":"c1e03843.9d14a8","name":"Mandag - Readback Periode 1","info":"","x":4100,"y":1920,"wires":[]},{"id":"e793e62.a89f418","type":"comment","z":"c1e03843.9d14a8","name":"Mandag - Readback Periode 2","info":"","x":4060,"y":2140,"wires":[]},{"id":"61b89648.c99eb8","type":"comment","z":"c1e03843.9d14a8","name":"Tirsdag - Readback Periode 1","info":"","x":4060,"y":2360,"wires":[]},{"id":"e76409d7.e5b1f8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5012;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2500,"wires":[["1b92569c.f15999"]]},{"id":"1b92569c.f15999","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2500,"wires":[["acb8c3d6.4e69"],["35eeeb95.a842c4"]]},{"id":"ed4e0f64.b3494","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day2.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day2_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2540,"wires":[[]]},{"id":"3f86d1fb.0794ee","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 ------------------------------- Auto schedule - Leser modbus holding registre ----------------------- Oppdaterer \"Input_Datetime\" ved endringer lokalt -------------------------","info":"","x":4430,"y":1860,"wires":[]},{"id":"af9a10b6.138b7","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5014;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2620,"wires":[["9f3d2fea.08fbc"]]},{"id":"9f3d2fea.08fbc","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2620,"wires":[["914c35f3.bbb3e8"],["e4740cc0.d0031"]]},{"id":"200d5b12.39bfc4","type":"comment","z":"c1e03843.9d14a8","name":"Tirsdag - Readback Periode 2","info":"","x":4060,"y":2580,"wires":[]},{"id":"33e167f4.9c0948","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5016;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2720,"wires":[["bcc210ca.94ac7"]]},{"id":"bcc210ca.94ac7","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2720,"wires":[["32cade9.dd32a22"],["b98a05fe.1aa4a8"]]},{"id":"3a76cfcb.9553a","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day2.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day2_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2660,"wires":[[]]},{"id":"fd310d88.d9b5","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day2.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day2_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2760,"wires":[[]]},{"id":"cc78d7ed.801a68","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5018;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2840,"wires":[["b3f56001.b353c"]]},{"id":"b3f56001.b353c","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2840,"wires":[["a506c4b6.731088"],["40b1a77d.03d6d8"]]},{"id":"5f364443.2cd8ac","type":"comment","z":"c1e03843.9d14a8","name":"Onsdag - Readback Periode 1","info":"","x":4060,"y":2800,"wires":[]},{"id":"ef6999fb.d13d68","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5020;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2940,"wires":[["d1f1e4e6.7d6458"]]},{"id":"d1f1e4e6.7d6458","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2940,"wires":[["bf109e01.9d07b"],["7d1967b.77cb498"]]},{"id":"455169dd.9a4ff8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day3.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day3_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2880,"wires":[[]]},{"id":"dddd804f.5a37c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day3.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day3_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":2980,"wires":[[]]},{"id":"a3fde984.92df78","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5022;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3060,"wires":[["93b1887.4156578"]]},{"id":"93b1887.4156578","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3060,"wires":[["2271bf2f.ef84b"],["1e50f3f2.651d6c"]]},{"id":"2271bf2f.ef84b","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3100,"wires":[]},{"id":"32fc87bd.f05718","type":"comment","z":"c1e03843.9d14a8","name":"Onsdag - Readback Periode 2","info":"","x":4060,"y":3020,"wires":[]},{"id":"ee35c15c.1a8e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5024;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3160,"wires":[["9030121a.01037"]]},{"id":"9030121a.01037","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3160,"wires":[["5cb438f5.0fa3a8"],["974a76be.9f6248"]]},{"id":"5cb438f5.0fa3a8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3200,"wires":[]},{"id":"a722a059.f3fda","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day3.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day3_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3100,"wires":[[]]},{"id":"5922d946.0f5538","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day3.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day3_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3200,"wires":[[]]},{"id":"54685c35.36b954","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5026;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3280,"wires":[["28fe9ecf.6505c2"]]},{"id":"28fe9ecf.6505c2","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3280,"wires":[["b444a665.1e2e18"],["71db4112.4f63"]]},{"id":"b444a665.1e2e18","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3320,"wires":[]},{"id":"71fb7524.d3e03c","type":"comment","z":"c1e03843.9d14a8","name":"Torsdag - Readback Periode 1","info":"","x":4060,"y":3240,"wires":[]},{"id":"fb65fbc9.6f6e98","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5028;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3380,"wires":[["922e140f.2e6df8"]]},{"id":"922e140f.2e6df8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3380,"wires":[["c5062440.089958"],["1e49a16a.33a59f"]]},{"id":"c5062440.089958","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3420,"wires":[]},{"id":"78ef6828.bfb228","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day4.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day4_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3320,"wires":[[]]},{"id":"6e129fa8.89081","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day4.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day4_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3420,"wires":[[]]},{"id":"8ff9cdd0.95282","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5030;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3500,"wires":[["aeebdad0.2cf4f8"]]},{"id":"aeebdad0.2cf4f8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3500,"wires":[["f66ca139.538ce"],["d876dbf9.2845c8"]]},{"id":"f66ca139.538ce","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3540,"wires":[]},{"id":"30471c3d.bf9c34","type":"comment","z":"c1e03843.9d14a8","name":"Torsdag - Readback Periode 2","info":"","x":4060,"y":3460,"wires":[]},{"id":"f4158be5.40b158","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5032;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3600,"wires":[["7ffbb37a.cd609c"]]},{"id":"7ffbb37a.cd609c","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3600,"wires":[["7a3f845f.1e06ac"],["7297d875.d9e888"]]},{"id":"7a3f845f.1e06ac","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3640,"wires":[]},{"id":"30ab1882.ce3a58","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day4.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day4_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3540,"wires":[[]]},{"id":"ffe6ad6a.e4433","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day4.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day4_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3640,"wires":[[]]},{"id":"a93371ad.38ad1","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5034;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3720,"wires":[["73d9bcc3.e4df54"]]},{"id":"73d9bcc3.e4df54","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3720,"wires":[["54b7cb6d.7fb3f4"],["bae6de9c.00526"]]},{"id":"54b7cb6d.7fb3f4","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3760,"wires":[]},{"id":"60daf6ce.26bc38","type":"comment","z":"c1e03843.9d14a8","name":"Fredag - Readback Periode 1","info":"","x":4060,"y":3680,"wires":[]},{"id":"b6533f15.c7939","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5036;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3820,"wires":[["203d4f95.92054"]]},{"id":"203d4f95.92054","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3820,"wires":[["964993cc.dd078"],["d694f222.8f632"]]},{"id":"964993cc.dd078","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3860,"wires":[]},{"id":"d255527.8ca55b","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day5.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day5_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3760,"wires":[[]]},{"id":"72e77bd3.a4f994","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day5.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day5_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3860,"wires":[[]]},{"id":"3657c90b.73eeb6","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5038;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3940,"wires":[["682ffb65.87c8f4"]]},{"id":"682ffb65.87c8f4","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":3940,"wires":[["a3040b0f.ff6588"],["21afcbb4.bdb134"]]},{"id":"a3040b0f.ff6588","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":3980,"wires":[]},{"id":"a57bc7f1.fac568","type":"comment","z":"c1e03843.9d14a8","name":"Fredag - Readback Periode 2","info":"","x":4060,"y":3900,"wires":[]},{"id":"cee9fbb2.6df3f8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5040;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4040,"wires":[["c1caed7b.9d185"]]},{"id":"c1caed7b.9d185","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4040,"wires":[["2ce13128.79968e"],["a71dde66.37a9d"]]},{"id":"2ce13128.79968e","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4080,"wires":[]},{"id":"6e6da8a.2ac5e58","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day5.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day5_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":3980,"wires":[[]]},{"id":"8f83e34b.78b7e","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day5.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day5_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4080,"wires":[[]]},{"id":"a723f537.276838","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5042;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4160,"wires":[["5e11eb8e.5473a4"]]},{"id":"5e11eb8e.5473a4","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4160,"wires":[["c7eff965.eca6e8"],["1925bfbd.1197a"]]},{"id":"c7eff965.eca6e8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4200,"wires":[]},{"id":"e9e306b.41f72f8","type":"comment","z":"c1e03843.9d14a8","name":"Lørdag - Readback Periode 1","info":"","x":4060,"y":4120,"wires":[]},{"id":"bf430ba8.774f48","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5044;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4260,"wires":[["ccf2442d.21d918"]]},{"id":"ccf2442d.21d918","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4260,"wires":[["5c0b3625.5ca7e8"],["8cd748fc.1f7228"]]},{"id":"5c0b3625.5ca7e8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4300,"wires":[]},{"id":"ea4b62b4.f4cfc","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day6.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day6_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4200,"wires":[[]]},{"id":"7609563.39d53a8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day6.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day6_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4300,"wires":[[]]},{"id":"6a145f37.c738d","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5046;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4380,"wires":[["edb724e2.b08bd8"]]},{"id":"edb724e2.b08bd8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4380,"wires":[["5bf75aca.0fb9a4"],["f2c43732.253a98"]]},{"id":"5bf75aca.0fb9a4","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4420,"wires":[]},{"id":"4015b32f.e2016c","type":"comment","z":"c1e03843.9d14a8","name":"Lørdag - Readback Periode 2","info":"","x":4060,"y":4340,"wires":[]},{"id":"8a17e91e.c99818","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5048;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4480,"wires":[["e507c854.9284c8"]]},{"id":"e507c854.9284c8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4480,"wires":[["5a3b7bdc.276074"],["7626f4ef.4b558c"]]},{"id":"5a3b7bdc.276074","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4520,"wires":[]},{"id":"7e21269a.acaba8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day6.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day6_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4420,"wires":[[]]},{"id":"4dc6d4d4.6b702c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day6.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day6_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4520,"wires":[[]]},{"id":"4786e63b.ff4918","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5050;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4600,"wires":[["4f12cd19.3acf24"]]},{"id":"4f12cd19.3acf24","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4600,"wires":[["21407f3e.c8f6b"],["1de9094d.99aa57"]]},{"id":"21407f3e.c8f6b","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4640,"wires":[]},{"id":"ba0778ff.79d648","type":"comment","z":"c1e03843.9d14a8","name":"Søndag - Readback Periode 1","info":"","x":4060,"y":4560,"wires":[]},{"id":"98189ca2.23ef4","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5052;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4700,"wires":[["bd0bdc3.07df32"]]},{"id":"bd0bdc3.07df32","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4700,"wires":[["e4b465f1.9b0b58"],["4eb456c6.4da888"]]},{"id":"4517a792.76e488","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day7.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day7_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4640,"wires":[[]]},{"id":"9fa4d1e8.3285c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd1.Day7.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd1_day7_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4740,"wires":[[]]},{"id":"4e5611e8.dda3","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5054;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4820,"wires":[["37f0d3b9.4cc4fc"]]},{"id":"37f0d3b9.4cc4fc","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4820,"wires":[["50dd3bc3.173a54"],["a1880b46.ec93d8"]]},{"id":"50dd3bc3.173a54","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4860,"wires":[]},{"id":"ad6cb349.74f62","type":"comment","z":"c1e03843.9d14a8","name":"Søndag - Readback Periode 2","info":"","x":4050,"y":4780,"wires":[]},{"id":"e32cb3ef.4ef","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5056;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":4920,"wires":[["9f65f98b.816158"]]},{"id":"9f65f98b.816158","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":4920,"wires":[["a519aad0.d03188"],["8df265e0.8829c8"]]},{"id":"a519aad0.d03188","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4940,"wires":[]},{"id":"6a8e3383.bd266c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day7.Start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day7_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4860,"wires":[[]]},{"id":"134327ba.966f48","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Prd2.Day7.End_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_sch_prd2_day7_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":4940,"wires":[[]]},{"id":"e4b465f1.9b0b58","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":4740,"wires":[]},{"id":"53bca0d.2d0c36","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Komp.Vinter Max Utetemp_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_vifte_hast_komp_vinter_max_temp_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1360,"y":380,"wires":[["8ba67ad6.1b5798"]]},{"id":"6acc9b25.e374d4","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3190,"y":420,"wires":[["99d907ed.40a1a8"]]},{"id":"4fb3d39e.9758dc","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Utekomp.VSU (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2290,"y":420,"wires":[[],[]]},{"id":"2691e485.4ce76c","type":"function","z":"c1e03843.9d14a8","name":"Set Temp","func":"var fc=6;\nvar sa=1255;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2120,"y":420,"wires":[["4fb3d39e.9758dc"]]},{"id":"bc0365aa.86c8e8","type":"range","z":"c1e03843.9d14a8","minin":"-30","maxin":"1","minout":"65236","maxout":"65546","action":"roll","round":false,"property":"payload","name":"Rescale -","x":1580,"y":420,"wires":[["aa14f4f8.38bc78"]],"info":"Engineering range: -30°C -> 0°C\nRaw value range:   65236 -> 65536\n\n**NB 0°C for signes INT!**\n - Ved 0°C er Raw value \"0\", derfor egen funksjon foo   negative verdier.\n\n**Bug \"Edit range node\"?**\n - Må utvide ranger til utenfor faktisk måleomrÜ��������de  for å kunne skrive øvre grense, derfor utvidet ranger. Korrekt arbeidsområde er gitt i \"input_number\" i HA. Derfor ranger som under:\n - Engineering range: -30°C -> 1°C\n - Raw value range:   65236 -> 65546\n\n**Slider vs box**\n - Slider for \"input_number\" er brukt pga. \"box\" er   dårlig tilpasset justering fra mobil for negative   verdier."},{"id":"af19686b.682ed8","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":420,"wires":[["912022c2.fd21"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"5047b287.6b260c","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Komp.Vinter Start Utetemp_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_vifte_hast_komp_vinter_start_temp_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1360,"y":420,"wires":[["bc0365aa.86c8e8"]]},{"id":"7afb1ee1.cf7fd","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Utekomp.SMU (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2150,"y":460,"wires":[[],[]]},{"id":"74032394.3c4acc","type":"function","z":"c1e03843.9d14a8","name":"Set Temp","func":"var fc=6;\nvar sa=1257;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":460,"wires":[["7afb1ee1.cf7fd"]]},{"id":"9706cac2.b62028","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":460,"wires":[["74032394.3c4acc"]],"info":"Videresender kun nye verdier/endringer for Å� hindre unødig data til modbus slave."},{"id":"ad79eb71.0ada48","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Komp.Sommer Max Utetemp_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_vifte_hast_komp_sommer_max_temp_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1370,"y":460,"wires":[["2410d29b.e911fe"]]},{"id":"29d69919.1297d6","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Utekomp.SSU (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2150,"y":500,"wires":[[],[]]},{"id":"ba943e85.d322b","type":"function","z":"c1e03843.9d14a8","name":"Set Temp","func":"var fc=6;\nvar sa=1256;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":500,"wires":[["29d69919.1297d6"]]},{"id":"9d490272.31157","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":500,"wires":[["ba943e85.d322b"]],"info":"Videresender kun nye verdier/endringer for å hindre unÓ�dig data til modbus slave."},{"id":"786abff4.bb104","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Komp.Sommer Start Utetemp_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_vifte_hast_komp_sommer_start_temp_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1370,"y":500,"wires":[["abfb46a8.4d8738"]]},{"id":"1bddc250.7cd2de","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Utekomp.V.hast (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2150,"y":540,"wires":[[],[]]},{"id":"3882b064.cf8d7","type":"function","z":"c1e03843.9d14a8","name":"Set Komp.","func":"var fc=6;\nvar sa=1251;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":540,"wires":[["1bddc250.7cd2de"]]},{"id":"bcec2c0b.27235","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":540,"wires":[["3882b064.cf8d7"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"9040755b.d0c108","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Komp.Vinter Vifte Hast_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_vifte_hast_komp_vinter_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1350,"y":540,"wires":[["8d7c1b94.09d798"]]},{"id":"fdf54208.13fa","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Utekomp.S.hast (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2150,"y":580,"wires":[[],[]]},{"id":"948af247.88174","type":"function","z":"c1e03843.9d14a8","name":"Set Komp.","func":"var fc=6;\nvar sa=1258;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":580,"wires":[["fdf54208.13fa"]]},{"id":"50401805.8bd458","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":580,"wires":[["948af247.88174"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"7686d1c1.4e112","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Komp.Sommer Vifte Hast_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_vifte_hast_komp_sommer_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1360,"y":580,"wires":[["f2f8e821.051128"]]},{"id":"346b693c.f8eac6","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1710,"y":380,"wires":[["e1312baa.4b4d48"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"aa14f4f8.38bc78","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1710,"y":420,"wires":[["af19686b.682ed8"]],"info":"Videresender siste verdi etter 5 sek. for å unngÑ� å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"2b4f17d3.50ce58","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1710,"y":460,"wires":[["9706cac2.b62028"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"6ff887dd.d65028","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1710,"y":500,"wires":[["9d490272.31157"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"8d7c1b94.09d798","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1710,"y":540,"wires":[["bcec2c0b.27235"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"f2f8e821.051128","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1710,"y":580,"wires":[["50401805.8bd458"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"2410d29b.e911fe","type":"range","z":"c1e03843.9d14a8","minin":"10","maxin":"50","minout":"100","maxout":"500","action":"roll","round":false,"property":"payload","name":"Rescale +","x":1580,"y":460,"wires":[["2b4f17d3.50ce58"]],"info":"Engineering range: 15°C -> 40°C\nRaw value range:   150 -> 400\n\n\n**Bug \"Edit range node\"?**\n - Må utvide ranger til utenfor faktisk måleområde  for å kunne skrive ù�vre grense, derfor utvidet ranger. Korrekt arbeidsomrþ�de er gitt i \"input_number\" i HA. Derfor ranger som under:\n - Engineering range: 10°C -> 50°C\n - Raw value range:   100 -> 500\n\n**Slider vs box**\n - Slider for \"input_number\" er brukt pga. \"box\" er   dårlig tilpasset justering fra mobil for negative   verdier."},{"id":"abfb46a8.4d8738","type":"range","z":"c1e03843.9d14a8","minin":"10","maxin":"50","minout":"100","maxout":"500","action":"roll","round":false,"property":"payload","name":"Rescale +","x":1580,"y":500,"wires":[["6ff887dd.d65028"]],"info":"Engineering range: 15°C -> 40°C\nRaw value range:   150 -> 400\n\n\n**Bug \"Edit range node\"?**\n - Må utvide ranger til utenfor faktisk måleområde  for å kunne skrive øvre grense, derfor utvidet ranger. Korrekt arbeidsområde er gitt i \"input_number\" i HA. Derfor ranger som under:\n - Engineering range: 10°C -> 50°C\n - Raw value range:   100 -> 500\n\n**Slider vs box**\n - Slider for \"input_number\" er brukt pga. \"box\" er   dårlig tilpasset justering fra mobil for negative   verdier."},{"id":"99f980ba.26b79","type":"function","z":"c1e03843.9d14a8","name":"Scale at 0°C","func":"if (msg.payload > 65530) {\n  msg.payload = (msg.payload - 65536);\n}\nreturn msg;\n\n//NB! Ved \"0 grader\" er råverdi også \"0\"","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1960,"y":380,"wires":[["e009fde0.d5a85"]]},{"id":"912022c2.fd21","type":"function","z":"c1e03843.9d14a8","name":"Scale at 0°C","func":"if (msg.payload > 65530) {\n  msg.payload = (msg.payload - 65536);\n}\nreturn msg;\n\n//NB! Ved \"0 grader\" er råverdi også \"0\"","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":420,"wires":[["2691e485.4ce76c"]]},{"id":"d8e7910e.41dba","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":1960,"wires":[["e8d77f2b.11788"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"b8511b4c.5230f8","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2060,"wires":[["e7790c1c.99fa8"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"6c43b41a.7dd89c","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2180,"wires":[["b9faed7c.ae09b"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"cc0cabe8.aed148","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2280,"wires":[["ff411b1b.170a08"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"860f00e.584be","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch temp offset (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2270,"y":820,"wires":[[],[]]},{"id":"47164f90.3a014","type":"function","z":"c1e03843.9d14a8","name":"Set Temp","func":"var fc=6;\nvar sa=5000;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":820,"wires":[["860f00e.584be"]]},{"id":"8283b376.f5c9","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1810,"y":820,"wires":[["59837cfc.5664d4"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"5ff50d48.5e17b4","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Sch. Active Offset Temp_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_sch_active_temp_offset_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1360,"y":820,"wires":[["898f6dff.867ee"]]},{"id":"95871272.eef75","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch(un) temp offset (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2290,"y":860,"wires":[[],[]]},{"id":"a8cb8d9.6d5257","type":"function","z":"c1e03843.9d14a8","name":"Set Temp","func":"var fc=6;\nvar sa=5001;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":860,"wires":[["95871272.eef75"]]},{"id":"30e5eaac.85ac36","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1810,"y":860,"wires":[["67015d99.7760d4"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"cf466f20.53c12","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Sch. Inactive Offset Temp_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.vtr300_sch_inactive_temp_offset_sp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1360,"y":860,"wires":[["bc44b2c4.5dda1"]]},{"id":"63c96739.717138","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1690,"y":820,"wires":[["8283b376.f5c9"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"479dfdd6.dda924","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1690,"y":860,"wires":[["30e5eaac.85ac36"]],"info":"Videresender siste verdi etter 5 sek. for å unngË� å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"59837cfc.5664d4","type":"function","z":"c1e03843.9d14a8","name":"Scale at 0°C","func":"if (msg.payload > 65533) {\n  msg.payload = (msg.payload - 65536);\n}\nreturn msg;\n\n//NB! Ved \"0 grader\" er råverdi også \"0\"","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":820,"wires":[["47164f90.3a014"]]},{"id":"898f6dff.867ee","type":"range","z":"c1e03843.9d14a8","minin":"-12","maxin":"2","minout":"65416","maxout":"65556","action":"roll","round":false,"property":"payload","name":"Rescale - ","x":1560,"y":820,"wires":[["63c96739.717138"]],"info":"Engineering range: -10°C -> 0°C\nRaw value range:   65436  -> 65536\n\n**NB 0°C for signes INT!**\n - Ved 0°C er Raw value \"0\", derfor egen funksjon foo   negative verdier.\n\n**Bug \"Edit range node\"?**\n - Må utvide ranger til utenfor faktisk måleområde  for å kunne skrive øvre grense, derfor utvidet ranger. Korrekt arbeidsområde er gitt i \"input_number\" i HA. Derfor ranger som under:\n - Engineering range: -12°C -> 2°C\n - Raw value range:   65416  -> 65556\n\n**Slider vs box**\n - Slider for \"input_number\" er brukt pga. \"box\" er   dårlig tilpasset justering fra mobil for negative   verdier.\n - \n "},{"id":"67015d99.7760d4","type":"function","z":"c1e03843.9d14a8","name":"Scale at 0°C","func":"if (msg.payload > 65533) {\n  msg.payload = (msg.payload - 65536);\n}\nreturn msg;\n\n//NB! Ved \"0 grader\" er råverdi også \"0\"","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":860,"wires":[["a8cb8d9.6d5257"]]},{"id":"bc44b2c4.5dda1","type":"range","z":"c1e03843.9d14a8","minin":"-12","maxin":"2","minout":"65416","maxout":"65556","action":"roll","round":false,"property":"payload","name":"Rescale - ","x":1560,"y":860,"wires":[["479dfdd6.dda924"]],"info":"Engineering range: -10°C -> 0°C\nRaw value range:   65436  -> 65536\n\n**NB 0¾�C for signes INT!**\n - Ved 0°C er Raw value \"0\", derfor egen funksjon foo   negative verdier.\n\n**Bug \"Edit range node\"?**\n - Må utvide ranger til utenfor faktisk måleområde  for å kunne skrive øvre grense, derfor utvidet ranger. Korrekt arbeidsområde er gitt i \"input_number\" i HA. Derfor ranger som under:\n - Engineering range: -12°C -> 2°C\n - Raw value range:   65416  -> 65556\n\n**Slider vs box**\n - Slider for \"input_number\" er brukt pga. \"box\" er   dårlig tilpasset justering fra mobil for negative   verdier.\n - \n "},{"id":"9f6d5986.403138","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Active Offset Temp_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_sch_active_temp_offset_sp","data":"{\"entity_id\":\"input_number.vtr300_sch_active_temp_offset_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3480,"y":820,"wires":[[]]},{"id":"73c3d16e.8635c","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3290,"y":820,"wires":[["9f6d5986.403138"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"97e468c.c7bbb98","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Fan Level Unscheduled_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.vtr300_fan_level_unscheduled","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1350,"y":720,"wires":[["43281063.1b39e"]]},{"id":"935d152.23474e8","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Fan Level Scheduled_sp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.vtr300_fan_level_scheduled","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1350,"y":680,"wires":[["4602d40c.daa9ac"]]},{"id":"a9be8f0d.56518","type":"catch","z":"c1e03843.9d14a8","name":"","scope":null,"x":4200,"y":60,"wires":[["edf144d2.fabe38"]]},{"id":"edf144d2.fabe38","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"complete":"false","statusVal":"","statusType":"auto","x":4370,"y":60,"wires":[]},{"id":"3a8375f8.55172a","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3160,"y":820,"wires":[["73c3d16e.8635c"]]},{"id":"c796634f.6cf4","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3060,"y":420,"wires":[["6acc9b25.e374d4"]]},{"id":"20c96185.8c060e","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Inactive Offset Temp_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_sch_inactive_temp_offset_sp","data":"{\"entity_id\":\"input_number.vtr300_sch_inactive_temp_offset_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3480,"y":860,"wires":[[]]},{"id":"fa046945.5d4538","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3290,"y":860,"wires":[["20c96185.8c060e"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"caf0dad.b821528","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3160,"y":860,"wires":[["fa046945.5d4538"]]},{"id":"bf109e01.9d07b","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2980,"wires":[]},{"id":"a506c4b6.731088","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2880,"wires":[]},{"id":"32cade9.dd32a22","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2760,"wires":[]},{"id":"914c35f3.bbb3e8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2660,"wires":[]},{"id":"acb8c3d6.4e69","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2540,"wires":[]},{"id":"1e7fa7ac.7396a8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2440,"wires":[]},{"id":"ff180d4f.72e2b","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2500,"wires":[["62260794.a71838"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"7a8f03bd.54bc3c","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2400,"wires":[["cad07183.619fb"]],"info":"Videresender siste verdi etter 5 sek. for å unngå þ� jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"9de3adc5.acbab","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2620,"wires":[["91d6eeba.f32bf"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"7c12099b.829818","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2720,"wires":[["22db3aa2.961336"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"3c6b21bb.f97ede","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2940,"wires":[["20de4c71.7e4d04"]],"info":"Videresender siste verdi etter 5 sek. for ô� unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"13c408a8.663d57","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":2840,"wires":[["7da4752b.fc7e2c"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"c2eae259.2bdd7","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3060,"wires":[["2a1c80a.647c38"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"37cebe11.c3a542","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3160,"wires":[["8e4ab0d9.dfdd1"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"96e85ac8.020fc8","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3380,"wires":[["c5a9586d.2a32a8"]],"info":"Videresender siste verdi etter 5 sek. for å unngå Û��� jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"7bd214e.2f6d2ec","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3280,"wires":[["681f1fd1.d2d21"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"b0273643.33e388","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3500,"wires":[["12bdf871.ff2328"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"5c9dc1d6.b27cb","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3600,"wires":[["c090825e.0e472"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"e2ea861c.bd24f8","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3820,"wires":[["1a4cbe76.772572"]],"info":"Videresender siste verdi etter 5 sek. for å unngé� å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"f5247096.b1ac4","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3720,"wires":[["f1258807.1b6b98"]],"info":"Videresender siste verdi etter 5 sek. for å unngå í�� jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"90610037.2b1ae","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":3940,"wires":[["a2f35fdc.737f2"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"9515a8f7.439868","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4040,"wires":[["181bf92.a11a007"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"37726264.d61e0e","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4260,"wires":[["62703a5e.214024"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"52e023e1.bc906c","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4160,"wires":[["d3613682.f25398"]],"info":"Videresender siste verdi etter 5 sek. for å unngÇ������� å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"dcf11172.e9d34","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4380,"wires":[["cda53ab6.925b38"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke gÓ�r ikke settpunkt gjennom."},{"id":"f53926f6.5b6d88","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4480,"wires":[["67c6ac1c.5f8f74"]],"info":"Videresender siste verdi etter 5 sek. for å unngå Û� jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"e9546181.4f315","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4700,"wires":[["6a1816a9.46f508"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke gðￆ��r ikke settpunkt gjennom."},{"id":"9f58a2c.279116","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4600,"wires":[["6712e453.53c9ac"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"6f515520.724c6c","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4920,"wires":[["27645144.662c3e"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"7c55d436.661abc","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3410,"y":4820,"wires":[["2cb74f0d.0ac74"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"7eae4a7c.5d4384","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5008;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2280,"wires":[["ad85298b.844dc8"]]},{"id":"ad85298b.844dc8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2280,"wires":[["7a0bfa25.448674"],["9fdbf536.cf01f8"]]},{"id":"83f789df.3df768","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5006;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2180,"wires":[["f04108f3.6dffe8"]]},{"id":"f04108f3.6dffe8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2180,"wires":[["9f8b0b9e.cc6a48"],["dcdb7162.7809a"]]},{"id":"40f97c67.5e8fd4","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2100,"wires":[]},{"id":"4d1551fc.0de4f","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":2060,"wires":[["40f97c67.5e8fd4"],["785e18fd.031e48"]]},{"id":"7bdfa6ec.eb3b78","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5004;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":2060,"wires":[["4d1551fc.0de4f"]]},{"id":"5ca77765.d6da98","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2000,"wires":[]},{"id":"178f1484.fd48fb","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Hr.& Min (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4390,"y":1960,"wires":[["5ca77765.d6da98"],["aab0d5cf.5ee018"]]},{"id":"a76155d8.eac5f8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5002;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4230,"y":1960,"wires":[["178f1484.fd48fb"]]},{"id":"9f8b0b9e.cc6a48","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2220,"wires":[]},{"id":"7a0bfa25.448674","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4570,"y":2320,"wires":[]},{"id":"228af965.d2f186","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 ------------------------------------------------------ Sensorer - Leser modbus holding registre ------------------------------------------------ Node Red produserte HA entiteter","info":"","x":540,"y":380,"wires":[]},{"id":"88f130e1.c406f","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Calendar (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":430,"y":460,"wires":[[],["3fda3951.15c7a6"]],"info":"VTR300 Intern UR"},{"id":"4af0f519.f84bdc","type":"inject","z":"c1e03843.9d14a8","name":"Poll(5m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"300","crontab":"","once":true,"onceDelay":"12","topic":"","payload":"","payloadType":"date","x":80,"y":460,"wires":[["977e8abf.3e3388"]]},{"id":"977e8abf.3e3388","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=6000;\nvar addresses=3;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":460,"wires":[["88f130e1.c406f"]]},{"id":"3fda3951.15c7a6","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Year/Md/Day","func":"var Year = msg.payload.data[0];\nvar Md = msg.payload.data[1];\nvar Day = msg.payload.data[2];\n\n// Concatenate to correct format\nvar YearMdDay = ('0' +Year).slice(-4)+'.'+('0' +Md).slice(-2)+'.'+('0' +Day).slice(-2);\n\nmsg.payload = YearMdDay;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":460,"wires":[["59aedd69.0fc2d4"]]},{"id":"4ece098d.8a0968","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Clock (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":500,"wires":[[],["d899691f.057348"]],"info":"VTR300 Intern UR"},{"id":"9fd71558.8e70e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=6003;\nvar addresses=3;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":500,"wires":[["4ece098d.8a0968"]]},{"id":"8ce2ba91.e54df8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1255;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2550,"y":420,"wires":[["a017b19f.0688f"]]},{"id":"a017b19f.0688f","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Utekomp.VSU (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2730,"y":420,"wires":[[],["8634b646.629a78"]],"info":"VTR300 Intern UR"},{"id":"8634b646.629a78","type":"function","z":"c1e03843.9d14a8","name":"-30->0[°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\n//!!!Raw verdi = \"0\" ved \"0°C\" grader (Se \"Description\")\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw);\n}\n//Skalering negativ \"-°C\" (Se \"Description\")\nelse {\n  Temp_scaled = ((Temp_raw - 65536) *0.1); \n}\n\nmsg.payload = Temp_scaled;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2910,"y":420,"wires":[["c796634f.6cf4"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"99d907ed.40a1a8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Komp.Vinter Start Utetemp_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_vifte_hast_komp_vinter_start_temp_sp","data":"{\"entity_id\":\"input_number.vtr300_vifte_hast_komp_vinter_start_temp_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3390,"y":420,"wires":[[]]},{"id":"68ebd15e.c6d8a","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3190,"y":380,"wires":[["a74f55b2.16f338"]]},{"id":"ba668670.3e0e88","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3060,"y":380,"wires":[["68ebd15e.c6d8a"]]},{"id":"fb8ce052.082f3","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":2380,"y":580,"wires":[["ba0f43f8.0ffac","8ce2ba91.e54df8","9336f24e.880a4","e0152ea9.64a36","425c1eb2.903d8","16ad7bca.f2b304"]]},{"id":"ba0f43f8.0ffac","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1253;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2550,"y":380,"wires":[["fd3229d.91707d8"]]},{"id":"fd3229d.91707d8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Utekomp.VMU (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2730,"y":380,"wires":[[],["e4f2daa2.78cf68"]],"info":"VTR300 Intern UR"},{"id":"e4f2daa2.78cf68","type":"function","z":"c1e03843.9d14a8","name":"-30->0[°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\n//!!!Raw verdi = \"0\" ved \"0°C\" grader (Se \"Description\")\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw);\n}\n//Skalering negativ \"-°C\" (Se \"Description\")\nelse {\n  Temp_scaled = ((Temp_raw - 65536) *0.1); \n}\n\nmsg.payload = Temp_scaled;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2910,"y":380,"wires":[["ba668670.3e0e88"]],"info":"# Engineering range: -30°C -> 0�C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"bb21608a.be6f9","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3190,"y":460,"wires":[["24ca1b99.0ac1a4"]]},{"id":"2e271af1.4543b6","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3060,"y":460,"wires":[["bb21608a.be6f9"]]},{"id":"9336f24e.880a4","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1257;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2550,"y":460,"wires":[["54f480bc.67d43"]]},{"id":"54f480bc.67d43","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Utekomp.SMU (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2730,"y":460,"wires":[[],["a53e0711.944e08"]],"info":"VTR300 Intern UR"},{"id":"184eb7a6.07b448","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3190,"y":500,"wires":[["f6fbcbe0.1d43e8"]]},{"id":"e29cb5f6.8ccee8","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3060,"y":500,"wires":[["184eb7a6.07b448"]]},{"id":"e0152ea9.64a36","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1256;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2550,"y":500,"wires":[["c665c6e0.eff698"]]},{"id":"c665c6e0.eff698","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Utekomp.SSU (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2730,"y":500,"wires":[[],["d57be1e6.40b96"]],"info":"VTR300 Intern UR"},{"id":"d57be1e6.40b96","type":"function","z":"c1e03843.9d14a8","name":"0->30[°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nTemp_scaled = (Temp_raw *0.1); \n\nmsg.payload = Temp_scaled;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2890,"y":500,"wires":[["e29cb5f6.8ccee8"]],"info":"Engineering range: 15°C -> 40°C\nRaw value range:   150 -> 400"},{"id":"868a492b.a244d8","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3190,"y":540,"wires":[["11ea939a.64e97c"]]},{"id":"5811b018.68505","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3060,"y":540,"wires":[["868a492b.a244d8"]]},{"id":"425c1eb2.903d8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1251;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2550,"y":540,"wires":[["74ad7ee9.36709"]]},{"id":"74ad7ee9.36709","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Utekomp.V.hast (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2730,"y":540,"wires":[[],["da924c79.119ac"]],"info":"VTR300 Intern UR"},{"id":"23384a7e.439076","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":3190,"y":580,"wires":[["65bda6c.de56d58"]]},{"id":"f643ffff.b64f2","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3060,"y":580,"wires":[["23384a7e.439076"]]},{"id":"16ad7bca.f2b304","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1258;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2550,"y":580,"wires":[["9bf08111.d38d3"]]},{"id":"9bf08111.d38d3","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Utekomp.S.hast (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2730,"y":580,"wires":[[],["6aed38a3.936b68"]],"info":"VTR300 Intern UR"},{"id":"c65a5a65.72f3b8","type":"inject","z":"c1e03843.9d14a8","name":"Poll(10s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":true,"onceDelay":"6","topic":"","payload":"","payloadType":"date","x":80,"y":500,"wires":[["68a6b029.eb563","705bcad4.194ec4","80d78914.de5d38","1aedba91.04b3f5","b5d6e697.144ba8","f8e6582c.4ec7e8","3a7de46.32ee01c","5ea6e1d2.0b447","219b6a9a.0ed5e6","e6d9f4c7.a48278","9fd71558.8e70e8","49ace7b8.015128","56f0e1f5.2181f","cc8541f1.ac166"]]},{"id":"68a6b029.eb563","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1254;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":580,"wires":[["84937855.5af778"]]},{"id":"84937855.5af778","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":580,"wires":[[],["7bd64506.de398c"]],"info":"VTR300 Intern UR"},{"id":"7bd64506.de398c","type":"function","z":"c1e03843.9d14a8","name":"0-5000rpm","func":"var Rpm = msg.payload.data[0];\n\nmsg.payload = Rpm;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":580,"wires":[["c640e76a.c67878"]]},{"id":"e310653.30ff398","type":"ha-entity","z":"c1e03843.9d14a8","name":"Vifte Komp. [rpm]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_vifte_hast_komp_rpm"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"rpm"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":930,"y":580,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"11ea939a.64e97c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Komp.Vinter Vifte hast_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_vifte_hast_komp_vinter_sp","data":"{\"entity_id\":\"input_number.vtr300_vifte_hast_komp_vinter_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3370,"y":540,"wires":[[]]},{"id":"65bda6c.de56d58","type":"api-call-service","z":"c1e03843.9d14a8","name":"Komp.Sommer Vifte hast_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_vifte_hast_komp_sommer_sp","data":"{\"entity_id\":\"input_number.vtr300_vifte_hast_komp_sommer_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3380,"y":580,"wires":[[]]},{"id":"6aed38a3.936b68","type":"function","z":"c1e03843.9d14a8","name":"Fan comp.","func":"var Comp = msg.payload.data[0];\n\nmsg.payload = Comp;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2910,"y":580,"wires":[["f643ffff.b64f2"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"f6fbcbe0.1d43e8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Komp.Sommer Start Utetemp_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_vifte_hast_komp_sommer_start_temp_sp","data":"{\"entity_id\":\"input_number.vtr300_vifte_hast_komp_sommer_start_temp_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3400,"y":500,"wires":[[]]},{"id":"24ca1b99.0ac1a4","type":"api-call-service","z":"c1e03843.9d14a8","name":"Komp.Sommer Max Utetemp_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_vifte_hast_komp_sommer_max_temp_sp","data":"{\"entity_id\":\"input_number.vtr300_vifte_hast_komp_sommer_max_temp_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3390,"y":460,"wires":[[]]},{"id":"a74f55b2.16f338","type":"api-call-service","z":"c1e03843.9d14a8","name":"Komp.Vinter Max Utetemp_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_vifte_hast_komp_vinter_max_temp_sp","data":"{\"entity_id\":\"input_number.vtr300_vifte_hast_komp_vinter_max_temp_sp\",\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3390,"y":380,"wires":[[]]},{"id":"da924c79.119ac","type":"function","z":"c1e03843.9d14a8","name":"Fan comp.","func":"var Comp = msg.payload.data[0];\n\nmsg.payload = Comp;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2910,"y":540,"wires":[["5811b018.68505"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1¨��C"},{"id":"a53e0711.944e08","type":"function","z":"c1e03843.9d14a8","name":"0->30[°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nTemp_scaled = (Temp_raw *0.1); \n\nmsg.payload = Temp_scaled;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2900,"y":460,"wires":[["2e271af1.4543b6"]],"info":"Engineering range: 15°C -> 40°C\nRaw value range:   150 -> 400"},{"id":"59aedd69.0fc2d4","type":"ha-entity","z":"c1e03843.9d14a8","name":"Intern kalender","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_intern_kalender"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:calendar-month-outline"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":940,"y":460,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"5ed4d952.b444d8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Intern klokke","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_intern_klokke"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:clock-time-four-outline"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"Avvik min (vises ikke ved adj. \"false\")","value":"vtr300_intern_ur_abs_value_min","valueType":"flow"},{"property":"Avvik time (vises ikke ved adj. \"false\")","value":"vtr300_intern_ur_abs_value_hour","valueType":"flow"}],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":950,"y":500,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"9f3636c0.6ab728","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5000;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2630,"y":820,"wires":[["f8113cb6.9323b"]]},{"id":"f8113cb6.9323b","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sch temp offset (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2810,"y":820,"wires":[[],["8c158127.6a489"]],"info":"VTR300 Intern UR"},{"id":"47ce99a1.6c96e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5001;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2630,"y":860,"wires":[["3935d35c.7612ac"]]},{"id":"3935d35c.7612ac","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sch(un) temp offset (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2820,"y":860,"wires":[[],["5b7e2eb0.c0e15"]],"info":"VTR300 Intern UR"},{"id":"8c158127.6a489","type":"function","z":"c1e03843.9d14a8","name":"-10->0[°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\n//!!!Raw verdi = \"0\" ved \"0°C\" grader (Se \"Description\")\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw);\n}\n//Skalering negativ \"-°C\" (Se \"Description\")\nelse {\n  Temp_scaled = ((Temp_raw - 65536) *0.1); \n}\n\nmsg.payload = Temp_scaled;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3010,"y":820,"wires":[["3a8375f8.55172a"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"5b7e2eb0.c0e15","type":"function","z":"c1e03843.9d14a8","name":"-10->0[°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\n//!!!Raw verdi = \"0\" ved \"0°C\" grader (Se \"Description\")\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw);\n}\n//Skalering negativ \"-°C\" (Se \"Description\")\nelse {\n  Temp_scaled = ((Temp_raw - 65536) *0.1); \n}\n\nmsg.payload = Temp_scaled;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3010,"y":860,"wires":[["caf0dad.b821528"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"1409d1cd.549d5e","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2480,"y":820,"wires":[["9f3636c0.6ab728"]]},{"id":"70c6cac1.2bce24","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2480,"y":860,"wires":[["47ce99a1.6c96e8"]]},{"id":"705bcad4.194ec4","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12102;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":620,"wires":[["79fc3ca2.89c304"]]},{"id":"79fc3ca2.89c304","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":620,"wires":[[],["5627d7d5.1ce3e8"]],"info":"VTR300 Intern UR"},{"id":"5627d7d5.1ce3e8","type":"function","z":"c1e03843.9d14a8","name":"-40->80 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":620,"wires":[["418a3eaf.4e965"]],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"1aedba91.04b3f5","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12101;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":700,"wires":[["8d6ef3f4.328dc"]]},{"id":"8d6ef3f4.328dc","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":700,"wires":[[],["87791222.6ca83"]],"info":"VTR300 Intern UR"},{"id":"87791222.6ca83","type":"function","z":"c1e03843.9d14a8","name":"-40->80 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":700,"wires":[["a8aebd76.47dd7"]],"info":"# Engineering range: -40°C -> 50°C"},{"id":"24aa165e.573b2a","type":"ha-entity","z":"c1e03843.9d14a8","name":"Inntakstemp. [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_inntaks_temperatur"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":930,"y":700,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"8e139b51.6e3fe8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilluftstemp. [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tillufts_temperatur"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":940,"y":620,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"b5d6e697.144ba8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12543;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":740,"wires":[["c6d50893.ed54c8"]],"info":"# 2050   NB!EAT/RAT used for extract air controller, benyttes pga. avtrekk AI er \"ekstrautstyr\""},{"id":"c6d50893.ed54c8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":740,"wires":[[],["573f9e49.21545"]],"info":"VTR300 Intern UR"},{"id":"573f9e49.21545","type":"function","z":"c1e03843.9d14a8","name":"-40->80 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":740,"wires":[["147981f3.7e567e"]],"info":"# Engineering range: -40°C -> 50°C"},{"id":"8caa3e3a.f515c","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekkstemp. [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avtrekks_temperatur"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":930,"y":740,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"f8e6582c.4ec7e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12106;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":780,"wires":[["b57a685.8871a98"]],"info":"# 2050   NB!EAT/RAT used for extract air controller, benyttes pga. avtrekk AI er \"ekstrautstyr\""},{"id":"b57a685.8871a98","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":780,"wires":[[],["bfa61c98.6f91b"]],"info":"VTR300 Intern UR"},{"id":"bfa61c98.6f91b","type":"function","z":"c1e03843.9d14a8","name":"-40->80 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":780,"wires":[["cacb727b.c531d"]],"info":"# Engineering range: -40°C -> 50°C"},{"id":"8fd00e76.b40c6","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avkasttemp. [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avkast_temperatur"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":930,"y":780,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"80d78914.de5d38","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12107;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":660,"wires":[["28f35935.b68ff6"]],"info":"# 2050   NB!EAT/RAT used for extract air controller, benyttes pga. avtrekk AI er \"ekstrautstyr\""},{"id":"28f35935.b68ff6","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":660,"wires":[[],["de46baec.e636e8"]],"info":"VTR300 Intern UR"},{"id":"de46baec.e636e8","type":"function","z":"c1e03843.9d14a8","name":"-40->80 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":660,"wires":[["17f5ddc3.689502"]],"info":"# Engineering range: -40°C -> 50°C"},{"id":"17f5ddc3.689502","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilluftstemp. Overhetn. [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_overhetingstemperatur_tilluft"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":900,"y":660,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"3a7de46.32ee01c","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12135;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":820,"wires":[["e727d79.15bb628"]],"info":"# 2050   NB!EAT/RAT used for extract air controller, benyttes pga. avtrekk AI er \"ekstrautstyr\""},{"id":"e727d79.15bb628","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":820,"wires":[[],["d82e3757.22fc48"]],"info":"VTR300 Intern UR"},{"id":"d82e3757.22fc48","type":"function","z":"c1e03843.9d14a8","name":"0-100[%RF]","func":"var RF = msg.payload.data[0];\n\nmsg.payload = RF;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":820,"wires":[["2ce6a3c1.d3f42c"]],"info":"# Engineering range: 0%RF -> 100%RF"},{"id":"3a6169d9.403066","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekk relativfukt [%RF]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_relativ_fukt_avtrekk"},{"property":"device_class","value":"humidity"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%RF"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":910,"y":820,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"5ea6e1d2.0b447","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=14000;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":880,"wires":[["e4e246c7.fe1258"]],"info":"# 2050   NB!EAT/RAT used for extract air controller, benyttes pga. avtrekk AI er \"ekstrautstyr\""},{"id":"e4e246c7.fe1258","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":880,"wires":[[],["7a6e488d.80eef8"]],"info":"VTR300 Intern UR"},{"id":"69459036.f9ddd","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilluftsvifte pådrag [%]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilluftsvifte "},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":920,"y":860,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"7ab81779.c197a8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekksvifte pådrag [%]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avtrekksvifte  "},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":910,"y":900,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"ef52c414.db19d8","type":"inject","z":"c1e03843.9d14a8","name":"Poll(1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":80,"y":1180,"wires":[["beb4ebba.4d3f98"]]},{"id":"49ace7b8.015128","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2148;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1060,"wires":[["cd6cd6d7.57df58"]],"info":"# 2050   NB!EAT/RAT used for extract air controller, benyttes pga. avtrekk AI er \"ekstrautstyr\""},{"id":"cd6cd6d7.57df58","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":1060,"wires":[[],["99817c3a.e89c9"]],"info":"VTR300 Intern UR"},{"id":"99817c3a.e89c9","type":"function","z":"c1e03843.9d14a8","name":"0-100[%]","func":"var Pwr = msg.payload.data[0];\n\nmsg.payload = Pwr;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1060,"wires":[["3c0143145f2a9927"]],"info":"# Engineering range: 0% -> 100%"},{"id":"e110a96c.1942f8","type":"ha-entity","z":"c1e03843.9d14a8","name":"El. Heater [%]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_el_kolbe_padrag"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":940,"y":1060,"wires":[[]],"info":"# TRIAC pådrag"},{"id":"56f0e1f5.2181f","type":"function","z":"c1e03843.9d14a8","d":true,"name":"Modbus read","func":"var fc=3;\nvar sa=14380;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1100,"wires":[["cbebd298.be8d5"]]},{"id":"cbebd298.be8d5","type":"modbus-flex-getter","z":"c1e03843.9d14a8","d":true,"name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":1100,"wires":[[],["d6b3f697.7a6288"]]},{"id":"d6b3f697.7a6288","type":"function","z":"c1e03843.9d14a8","d":true,"name":"0->1","func":"var State = msg.payload.data[0];\n\nmsg.payload = State;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1100,"wires":[["a1070876.b62118"]],"info":"# Engineering range: 0 -> 1"},{"id":"1acd4610.100bea","type":"ha-entity","z":"c1e03843.9d14a8","d":true,"name":"El. Heater [Av/På]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_el_kolbe_av_pa"},{"property":"device_class","value":"power"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":930,"y":1100,"wires":[[]]},{"id":"219b6a9a.0ed5e6","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=14102;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1020,"wires":[["b7c1c168.6d653"]],"info":"# 2050   NB!EAT/RAT used for extract air controller, benyttes pga. avtrekk AI er \"ekstrautstyr\""},{"id":"b7c1c168.6d653","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":1020,"wires":[[],["20b8cf6e.a3a66"]]},{"id":"20b8cf6e.a3a66","type":"function","z":"c1e03843.9d14a8","name":"0-100[%]","func":"var ExchangeHeaterSpeed = msg.payload.data[0];\n\nmsg.payload = ExchangeHeaterSpeed;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1020,"wires":[["8fcfb8f.52b2b48"]],"info":"# Engineering range: 0% -> 100%"},{"id":"e536cce4.b9dbd","type":"ha-entity","z":"c1e03843.9d14a8","name":"Gjenvinner pådrag [%]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_varmegjenvinner"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":920,"y":1020,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"9d0112f0.7145b","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 --------------GJENNOMGÅES SENERE----- Sensorer - Leser modbus holding registre ------------------------------------------------ Node Red produserte HA entiteter","info":"","x":1780,"y":1220,"wires":[]},{"id":"55369c0a.d34dd4","type":"function","z":"c1e03843.9d14a8","d":true,"name":"Modbus read","func":"var fc=3;\nvar sa=2203;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1280,"wires":[["d4504d74.a0eaa"]]},{"id":"d4504d74.a0eaa","type":"modbus-flex-getter","z":"c1e03843.9d14a8","d":true,"name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1280,"wires":[[],["a73f917.205dd7"]]},{"id":"a73f917.205dd7","type":"function","z":"c1e03843.9d14a8","d":true,"name":"0->1","func":"var State = msg.payload.data[0];\n\nmsg.payload = State;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1810,"y":1280,"wires":[["19818d90.2b2c62"]],"info":"# Engineering range: 0 -> 1"},{"id":"19818d90.2b2c62","type":"ha-entity","z":"c1e03843.9d14a8","d":true,"name":"Gjenvinner redusert drift","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_varmegjenvinner_red_drift_rf"},{"property":"device_class","value":"humidity"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":2130,"y":1280,"wires":[[]]},{"id":"b62b2b4b.fc8128","type":"comment","z":"c1e03843.9d14a8","name":"Gjelder også varmgjenvinning?","info":"","x":2390,"y":1280,"wires":[]},{"id":"6c6d5b88.22e814","type":"inject","z":"c1e03843.9d14a8","name":"Poll(2m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"120","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":1320,"y":1540,"wires":[["55369c0a.d34dd4","af2002b1.1da8d","4ee92761.d4d068","1e5614fe.4ead1b","2f357e5b.513532"]]},{"id":"a45ecba8.be6f58","type":"function","z":"c1e03843.9d14a8","name":"3-15md","func":"var Md = msg.payload.data[0];\n\nmsg.payload = Md;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":1320,"wires":[["4afd5ff8.34e81"]]},{"id":"4afd5ff8.34e81","type":"ha-entity","z":"c1e03843.9d14a8","name":"Filterbytte intervall [md]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_filterbytte_md_intervall"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"md"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":2130,"y":1320,"wires":[[]],"info":"# Filter replacement time in months\n# 3-15md"},{"id":"1b9a07ad.a69778","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1320,"wires":[[],["a45ecba8.be6f58"]]},{"id":"bdbbe1d9.fb668","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=7000;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1320,"wires":[["1b9a07ad.a69778"]]},{"id":"c5103bb6.dddc98","type":"ha-entity","z":"c1e03843.9d14a8","name":"Filterbytte neste + Attr. Hist.","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tid_til_filterbytte"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:air-filter"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"siste_filterskift","value":"#:(storeInFile)::vtr300_siste_filterskift","valueType":"flow"},{"property":"filterskift_0","value":"#:(storeInFile)::vtr300_forrige_filterskift_0","valueType":"flow"},{"property":"filterskift_1","value":"#:(storeInFile)::vtr300_forrige_filterskift_1","valueType":"flow"},{"property":"filterskift_2","value":"#:(storeInFile)::vtr300_forrige_filterskift_2","valueType":"flow"},{"property":"filterskift_3","value":"#:(storeInFile)::vtr300_forrige_filterskift_3","valueType":"flow"},{"property":"filterskift_4","value":"#:(storeInFile)::vtr300_forrige_filterskift_4","valueType":"flow"},{"property":"filterskift_5","value":"#:(storeInFile)::vtr300_forrige_filterskift_5","valueType":"flow"},{"property":"filterskift_6","value":"#:(storeInFile)::vtr300_forrige_filterskift_6","valueType":"flow"},{"property":"filterskift_7","value":"#:(storeInFile)::vtr300_forrige_filterskift_7","valueType":"flow"},{"property":"filterskift_8","value":"#:(storeInFile)::vtr300_forrige_filterskift_8","valueType":"flow"},{"property":"filterskift_9","value":"#:(storeInFile)::vtr300_forrige_filterskift_9","valueType":"flow"},{"property":"filterskift_10","value":"#:(storeInFile)::vtr300_forrige_filterskift_10","valueType":"flow"}],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":2140,"y":1360,"wires":[[]]},{"id":"7f03b584.16fa5c","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1360,"wires":[["265b3575.6ceb3a"],[]]},{"id":"a112e436.615b38","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=7004;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1360,"wires":[["7f03b584.16fa5c"]]},{"id":"932c446e.5a7268","type":"function","z":"c1e03843.9d14a8","name":"Aktuell modus","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":1400,"wires":[[]]},{"id":"3558a8e4.fb9248","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Main mode (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1660,"y":1400,"wires":[[],["932c446e.5a7268","56710c4c.cb5304"]]},{"id":"3d0cbf37.b2f45","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1160;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1400,"wires":[["3558a8e4.fb9248"]]},{"id":"b26d2676.fd9038","type":"function","z":"c1e03843.9d14a8","name":"Aktuell Man. modus","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1850,"y":1440,"wires":[[]]},{"id":"d4cff05.b4b781","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Man mode (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1660,"y":1440,"wires":[[],["b26d2676.fd9038","a9427683.c17b08"]]},{"id":"7ba45d89.901274","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1130;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1440,"wires":[["d4cff05.b4b781"]]},{"id":"bf2c451.ec930b8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekksluft_sp [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avtrekksluft_sp"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":2110,"y":1480,"wires":[[]]},{"id":"fcb4d913.54dfb8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1480,"wires":[[],["3ce3cb75.57da04"]]},{"id":"af2002b1.1da8d","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2012;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1480,"wires":[["fcb4d913.54dfb8"]]},{"id":"8aa61a53.886578","type":"comment","z":"c1e03843.9d14a8","name":"Settpunkt, i bruk?","info":"","x":2320,"y":1480,"wires":[]},{"id":"3ce3cb75.57da04","type":"function","z":"c1e03843.9d14a8","name":"12->40 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1800,"y":1480,"wires":[["bf2c451.ec930b8"]],"info":"# Engineering range: 12°C -> 40°C"},{"id":"d3b107e3.96f948","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekksluft_min_sp [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avtrekksluft_min_sp"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":2130,"y":1520,"wires":[[]]},{"id":"2dc9837f.dcdd1c","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1520,"wires":[[],["b2d609f7.351f08"]]},{"id":"4ee92761.d4d068","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2020;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1520,"wires":[["2dc9837f.dcdd1c"]]},{"id":"b2d609f7.351f08","type":"function","z":"c1e03843.9d14a8","name":"12->40 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1830,"y":1520,"wires":[["d3b107e3.96f948"]],"info":"# Engineering range: 12°C -> 40°C\n# Avlesning Ønsket min settpunkt avtrekksluft ved sommer/kaskade reg."},{"id":"e8964422.e29d08","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekksluft_max_sp [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avtrekksluft_max_sp"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":2130,"y":1560,"wires":[[]]},{"id":"8e9b950a.72ecf8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1560,"wires":[[],["4d15a5cc.b51d8c"]]},{"id":"1e5614fe.4ead1b","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2021;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1560,"wires":[["8e9b950a.72ecf8"]]},{"id":"4d15a5cc.b51d8c","type":"function","z":"c1e03843.9d14a8","name":"12->40 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1830,"y":1560,"wires":[["e8964422.e29d08"]],"info":"# Engineering range: 12³�C -> 40°C\n# Avlesning Ønsket max settpunkt avtrekksluft ved sommer/kaskade reg."},{"id":"15be4d9f.00e182","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Eco offset (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2610,"y":80,"wires":[[],["a65c1d85.33255"]]},{"id":"35c7fe38.e1e7e2","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2503;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2450,"y":80,"wires":[["15be4d9f.00e182"]]},{"id":"a65c1d85.33255","type":"function","z":"c1e03843.9d14a8","name":"0->10 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":80,"wires":[["e71b844.48a9578"]],"info":"# Engineering range: 0°C -> 10°C\n"},{"id":"a7172ed8.a2ccc","type":"ha-entity","z":"c1e03843.9d14a8","name":"Eco_offset_sp [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_eco_varme_offset"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":3290,"y":40,"wires":[[]],"info":"# Ønsket offset ved Eco drift"},{"id":"5b2b5533.7c2c9c","type":"function","z":"c1e03843.9d14a8","name":"CTD sek.","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":1640,"wires":[["161b541f.088a7c"]]},{"id":"97d18c08.010be","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1640,"wires":[[],["5b2b5533.7c2c9c"]]},{"id":"a4e990d0.8175e","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1110;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1640,"wires":[["97d18c08.010be"]]},{"id":"2f357e5b.513532","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2202;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1600,"wires":[["9fe24a60.d7b178"]]},{"id":"9fe24a60.d7b178","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1640,"y":1600,"wires":[[],["ea89763a.1d0bc8"]]},{"id":"bcf1a70a.fb79c8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Fukt Avtrekk_sp [%RF]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_fukt_avtrekk_sp"},{"property":"device_class","value":"humidity"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%RF"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":2120,"y":1600,"wires":[[]]},{"id":"ea89763a.1d0bc8","type":"function","z":"c1e03843.9d14a8","name":"1-100%RH","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1830,"y":1600,"wires":[["bcf1a70a.fb79c8"]]},{"id":"4de37f34.3314c","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 ------------------------------------------------------ Alarmer - Leser modbus holding registre ------------------------------------------------ Node Red produserte HA entiteter","info":"","x":530,"y":4560,"wires":[]},{"id":"17499c7d.e9e594","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=15900;\nvar addresses=3;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":4640,"wires":[["37ca7530.bf5a3a"]]},{"id":"37ca7530.bf5a3a","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"ALM 1 (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":400,"y":4640,"wires":[[],["c108b5c3.5590f8"]],"info":"VTR300 Intern UR"},{"id":"c108b5c3.5590f8","type":"function","z":"c1e03843.9d14a8","name":"A/B/C - Alm","func":"var Alm_A = {payload:msg.payload.data[0]};\nvar Alm_B = {payload:msg.payload.data[1]};\nvar Alm_C = {payload:msg.payload.data[2]};\nreturn [Alm_A,Alm_B,Alm_C];\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":590,"y":4640,"wires":[["bf8d6f03.7cf55"],["a0a25d3c.7b3fe"],["8c6aa61b.47f0d8"]]},{"id":"be4f6259.e8724","type":"function","z":"c1e03843.9d14a8","name":"Filter - Alm","func":"var Alm = {payload:msg.payload.data[0]};\nreturn [Alm];\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":4720,"wires":[["a9244122.314f6","dcc610c.d4a33f"]]},{"id":"f72157a.2edcea8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"ALM 2 (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":400,"y":4720,"wires":[[],["be4f6259.e8724"]],"info":"VTR300 Intern UR"},{"id":"29120531.35430a","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=15141;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":4720,"wires":[["f72157a.2edcea8"]]},{"id":"36aefeb1.00dcf2","type":"function","z":"c1e03843.9d14a8","name":"Filter Wrn. - Alm","func":"var Alm = {payload:msg.payload.data[0]};\nreturn [Alm];\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":4800,"wires":[["ce3f979b.5fdad8"]]},{"id":"f5e1b9fd.f6dbf8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"ALM 3 (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":400,"y":4800,"wires":[[],["36aefeb1.00dcf2"]],"info":"VTR300 Intern UR"},{"id":"42d73f03.ed5c6","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=15543;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":4800,"wires":[["f5e1b9fd.f6dbf8"]]},{"id":"a28309d8.682728","type":"function","z":"c1e03843.9d14a8","name":"Temp. - Alm","func":"var Alm = {payload:msg.payload.data[0]};\nreturn [Alm];\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":4840,"wires":[["d292408a.63de2"]]},{"id":"2cffb7f4.e0df08","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"ALM 4 (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":400,"y":4840,"wires":[[],["a28309d8.682728"]],"info":"VTR300 Intern UR"},{"id":"69ecf3cf.b628ac","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=15176;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":4840,"wires":[["2cffb7f4.e0df08"]]},{"id":"beb4ebba.4d3f98","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1038;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1180,"wires":[["b37cf163.09dd3"]]},{"id":"b37cf163.09dd3","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":1180,"wires":[[],["b66a1177.8db0b"]]},{"id":"b66a1177.8db0b","type":"function","z":"c1e03843.9d14a8","name":"0->1","func":"var State = msg.payload.data[0];\n\nmsg.payload = State;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1180,"wires":[["5a28cf84.9dbbf"]],"info":"# Engineering range: 0 -> 1"},{"id":"10e2ec2c.d73a44","type":"ha-entity","z":"c1e03843.9d14a8","name":"Sommer/Vinterdrift","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_sommer_vinter_driftstatus"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":930,"y":1180,"wires":[[]],"info":"# 0=sommerdrift\n# 1=Vinterdrift (status basert på fukt i inntak)"},{"id":"ceb110e.c693ff","type":"ha-entity","z":"c1e03843.9d14a8","name":"Trykkvakt [Av/På]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_komfyravtrekk_trykkvakt_av_pa"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":930,"y":1140,"wires":[[]]},{"id":"c111a05a.5c4ec","type":"function","z":"c1e03843.9d14a8","name":"0->1","func":"var State = msg.payload.data[0];\n\nmsg.payload = State;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":1140,"wires":[["f2e60920.2cb8c8"]],"info":"# Engineering range: 0 -> 1"},{"id":"e42dcd04.cdec5","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":1140,"wires":[[],["c111a05a.5c4ec"]]},{"id":"cc8541f1.ac166","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12020;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":1140,"wires":[["e42dcd04.cdec5"]]},{"id":"58b9cfce.49cf4","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"15","crontab":"","once":true,"onceDelay":"30","topic":"","payload":"","payloadType":"date","x":80,"y":4640,"wires":[["17499c7d.e9e594","29120531.35430a","42d73f03.ed5c6","69ecf3cf.b628ac"]]},{"id":"86ca1a2.88536e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=2030;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":3700,"wires":[["97efde47.d54c2"]]},{"id":"ee8c3d89.8e3c6","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Tilluftsreg.","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Avtrekksreg.","fromt":"str","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":3700,"wires":[["86ca1a2.88536e8"]]},{"id":"d68b313e.361ed","type":"comment","z":"c1e03843.9d14a8","name":"Input Select --------------------------------------------------------------------------------------------------------------------------------------------------- Node Red produserte HA entiteter","info":"","x":520,"y":3660,"wires":[]},{"id":"f09d1064.281cc","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":120,"y":3760,"wires":[["93a24873.ae3878"]]},{"id":"93a24873.ae3878","type":"function","z":"c1e03843.9d14a8","name":"Read","func":"var fc=3;\nvar sa=2030;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":3760,"wires":[["76cf3a2c.69d7c4"]]},{"id":"76cf3a2c.69d7c4","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Reg.type.state (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":410,"y":3760,"wires":[[],["ff7628e.3e265d8"]],"info":"VTR300 Intern UR"},{"id":"ff7628e.3e265d8","type":"function","z":"c1e03843.9d14a8","name":"Reg. metode","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":3760,"wires":[["c9949944.031e98"]]},{"id":"39958fdb.4785a","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Tilluft/Avtrekks reg.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_reg_metode","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1140,"y":3760,"wires":[[]]},{"id":"c9949944.031e98","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Tilluftsreg.","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Rom reg.","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"2","fromt":"num","to":"Avtrekksreg.","tot":"str"},{"t":"set","p":"vtr300_reg_metode_modbus_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":3760,"wires":[["2b3417c1.cf4998"]]},{"id":"97efde47.d54c2","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Reg.type.state (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":650,"y":3700,"wires":[["3d7a7378.75266c"],[]]},{"id":"a7726c0b.46e3","type":"comment","z":"c1e03843.9d14a8","name":"Climate --------------------------------------------------------------------------------------------------------------------------------------------------- Node Red produserte HA entiteter","info":"","x":510,"y":20,"wires":[]},{"id":"69132afc.12bab4","type":"function","z":"c1e03843.9d14a8","name":"12->30 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nTemp_scaled = (Temp_raw *0.1); \n\nmsg.payload = Temp_scaled;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":200,"wires":[["2abfd68d.e6225a"]],"info":"# Engineering range: 12°C -> 30°C"},{"id":"83de003b.19515","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Tilluft_sp (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":390,"y":200,"wires":[[],["69132afc.12bab4"]]},{"id":"73550f33.bd4c5","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2000;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":200,"wires":[["83de003b.19515"]]},{"id":"fff9f455.cffaf8","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":850,"y":200,"wires":[["b9675741.c025f8"]]},{"id":"12b1db42.fc5c35","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":80,"y":200,"wires":[["73550f33.bd4c5"]]},{"id":"30649048.acff4","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Tilluft_sp (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":870,"y":140,"wires":[["df8227e7.a72c48"],[]]},{"id":"916d0290.dc68c","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=2000;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":140,"wires":[["30649048.acff4"]]},{"id":"6ac59c59.c6ecd4","type":"trigger","z":"c1e03843.9d14a8","name":"Wait 5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":560,"y":140,"wires":[["916d0290.dc68c","7f1acdbf.c838d4"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"b9675741.c025f8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Climate ønsket tilluftstemp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"climate","service":"set_temperature","entityId":"climate.vtr300_tilluft_sp","data":"{\"temperature\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1050,"y":200,"wires":[[]]},{"id":"9b361adf.590d98","type":"comment","z":"c1e03843.9d14a8","name":"Template Sensor --------------------------------------------------------------------------------------------------------------------------------------------------- Node Red produserte HA entiteter","info":"","x":530,"y":1260,"wires":[]},{"id":"3f578038.ff988","type":"ha-entity","z":"c1e03843.9d14a8","name":"Gjenvinningsgrad - 1 [%]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_gjenvinningsgrad"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":"mdi:leaf"},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":1480,"wires":[[]]},{"id":"d1d0a4f3.fe7218","type":"ha-entity","z":"c1e03843.9d14a8","name":"Borte Modus CTD [t]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_borte_nedtelling_tid_t"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":1680,"wires":[[]]},{"id":"9c67d91c.4e45f8","type":"inject","z":"c1e03843.9d14a8","name":"Poll(5s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":100,"y":1320,"wires":[["6c501a0d.53d184","14419122.25104f","53b30720.1db418","c8847484.b90e28","abec1520.fb9838","edc910f5.4dbd6","2e143fb.55e32c","f0de389b.c57ef8","373dc51f.827aea","7626e293.82c05c","eba2f59f.e7d6a8","50e87aaf.45e894","63a14069.e1f43"]]},{"id":"ef116106.b54f8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5100;\nvar addresses=14;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4210,"y":1300,"wires":[["48923478.d5f6bc"]]},{"id":"48923478.d5f6bc","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sch.1-->7 (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":4170,"y":1340,"wires":[["117c5f6e.ed3721"],["38713fae.433af"]]},{"id":"117c5f6e.ed3721","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":4190,"y":1380,"wires":[]},{"id":"514e6811.ef1178","type":"inject","z":"c1e03843.9d14a8","name":"Poll (100s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"100","crontab":"","once":true,"onceDelay":"17","topic":"","payload":"","payloadType":"date","x":4050,"y":1300,"wires":[["ef116106.b54f8"]]},{"id":"4f8f29da.cd99c8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Ønsket Tilluftstemp. [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"climate_vtr300_tilluft_sp"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer-lines"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":530,"y":1440,"wires":[[]]},{"id":"6c501a0d.53d184","type":"api-render-template","z":"c1e03843.9d14a8","name":"Climate attr.","server":"2c4e313e.d0fc5e","version":0,"template":"{{ (states.climate.vtr300_tilluft_sp.attributes[\"temperature\"] | float) | round(1) }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":290,"y":1440,"wires":[["4f8f29da.cd99c8"]],"info":"# Climate Sensor tilluft (attributes)\n# Avlest attribute for climate, skriver til modbus"},{"id":"894a523d.74629","type":"ha-entity","z":"c1e03843.9d14a8","name":"Ferie Modus CTD [d]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_ferie_nedtelling_tid_d"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":1800,"wires":[[]]},{"id":"f384e54.4fdc018","type":"ha-entity","z":"c1e03843.9d14a8","name":"Ildsted Modus CTD [t]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_ildsted_nedtelling_tid_min"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":1860,"wires":[[]]},{"id":"658fef1.5c67e1","type":"ha-entity","z":"c1e03843.9d14a8","name":"Party Modus CTD [t]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_party_nedtelling_tid_t"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":1920,"wires":[[]]},{"id":"d4993675.a728d8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Boost Modus CTD [t]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_boost_nedtelling_tid_min"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":1740,"wires":[[]]},{"id":"e6d9f4c7.a48278","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=12400;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":270,"y":980,"wires":[["f7af1f2d.d9943"]]},{"id":"f7af1f2d.d9943","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sensor (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":420,"y":980,"wires":[[],["668542f.37062bc"]],"info":"VTR300 Intern UR"},{"id":"668542f.37062bc","type":"function","z":"c1e03843.9d14a8","name":"0-5000[rpm]","func":"var Fan_supply = {payload:msg.payload.data[0]};\nvar Fan_extract = {payload:msg.payload.data[1]};\n\nreturn [Fan_supply,Fan_extract];\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":570,"y":980,"wires":[["1270e2b2.14939d"],["22ebdf8c.2be69"]]},{"id":"344460eb.f61ab","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilluftsvifte pådrag [rpm]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilluftsvifte_rpm "},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":910,"y":940,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"22ebdf8c.2be69","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekksvifte pådrag [rpm]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avtrekksvifte_rpm "},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":910,"y":980,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"7a6e488d.80eef8","type":"function","z":"c1e03843.9d14a8","name":"0-100[%]","func":"var Fan_supply = {payload:msg.payload.data[0]};\nvar Fan_extract = {payload:msg.payload.data[1]};\n\nvar Fan_spd_avg = (Fan_supply + Fan_extract)/2;\n\nreturn [Fan_supply,Fan_extract,Fan_spd_avg];\n\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":880,"wires":[["a5229e35.1e678"],["52a7f6e3.cb4618"],["b6b0ae4a.1d6a2"]]},{"id":"ddb55761.c9d7b8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Vifte Komp. [%]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_vifte_hast_komp_pv"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":500,"y":1560,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"3aa44cda.5f5d94","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilluft [m3/t]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilluft_rf"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:weather-windy"},{"property":"unit_of_measurement","value":"m³/t"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":490,"y":1600,"wires":[[]]},{"id":"8ad972c5.d1f58","type":"ha-entity","z":"c1e03843.9d14a8","name":"Avtrekk [m3/t]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_avtrekk_rf"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:weather-windy"},{"property":"unit_of_measurement","value":"m³/t"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":500,"y":1640,"wires":[[]]},{"id":"49a8120a.72133c","type":"ha-entity","z":"c1e03843.9d14a8","name":"Main Modus State","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_modus_status"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:state-machine"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":510,"y":1320,"wires":[["aa087797.818ef8"]]},{"id":"5a28cf84.9dbbf","type":"change","z":"c1e03843.9d14a8","name":"Int->Str.","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Sommerdrift","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Vinterdrift","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1180,"wires":[["10e2ec2c.d73a44"]]},{"id":"a1070876.b62118","type":"change","z":"c1e03843.9d14a8","d":true,"name":"Int->Str.","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"På","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1100,"wires":[["1acd4610.100bea"]]},{"id":"f2e60920.2cb8c8","type":"change","z":"c1e03843.9d14a8","name":"Int->Str.","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"På","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1140,"wires":[["ceb110e.c693ff"]]},{"id":"1fb9a854.6bbb98","type":"ha-entity","z":"c1e03843.9d14a8","name":"PPM Modus State","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_ppm_modus_status"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":510,"y":1400,"wires":[[]]},{"id":"451d83dc.dc179c","type":"ha-entity","z":"c1e03843.9d14a8","name":"Button Modus State","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_manuell_button_modus_status"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":510,"y":1360,"wires":[[]]},{"id":"96dc47ed.c77558","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4600,"wires":[["d2498c0c.d6159"]]},{"id":"f6a318c5.0b7d78","type":"function","z":"c1e03843.9d14a8","name":"A-Alm Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"A-Alarm!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":4600,"wires":[["96dc47ed.c77558"]]},{"id":"24b3c98b.ea6c16","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1090,"y":4600,"wires":[["f6a318c5.0b7d78"]]},{"id":"c429756.72e1988","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4640,"wires":[["3c6615c.b51ebea"]]},{"id":"ec0ebf2c.3eccc","type":"function","z":"c1e03843.9d14a8","name":"B-Alm Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"B-Alarm!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":4640,"wires":[["c429756.72e1988"]]},{"id":"41aba944.8e3698","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1090,"y":4640,"wires":[["ec0ebf2c.3eccc"]]},{"id":"b9250229.476","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4680,"wires":[["e8b9ef2e.7038e"]]},{"id":"f791841e.4714a8","type":"function","z":"c1e03843.9d14a8","name":"C-Alm Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"C-Alarm!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":4680,"wires":[["b9250229.476"]]},{"id":"7ab15468.91391c","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1090,"y":4680,"wires":[["f791841e.4714a8"]]},{"id":"bf2ca464.593888","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4720,"wires":[[]]},{"id":"854b7a82.288558","type":"function","z":"c1e03843.9d14a8","name":"Filter Alm - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Filterbytte - Alarm!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1240,"y":4720,"wires":[["bf2ca464.593888"]]},{"id":"f1174b96.eff978","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1090,"y":4720,"wires":[["854b7a82.288558"]]},{"id":"48fae2a3.83530c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4800,"wires":[[]]},{"id":"8a86f52.aa15508","type":"function","z":"c1e03843.9d14a8","name":"Filter Pre. Alm - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Filterbytte forvarsel - Alarm!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":4800,"wires":[["48fae2a3.83530c"]]},{"id":"55d2ee2b.aab4f","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1090,"y":4800,"wires":[["8a86f52.aa15508"]]},{"id":"3b1c35f2.c17a7a","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4840,"wires":[[]]},{"id":"9d2f1082.19c72","type":"function","z":"c1e03843.9d14a8","name":"Temp Lav ALM - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Tilluftstemperatur Lav!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":4840,"wires":[["3b1c35f2.c17a7a"]]},{"id":"7d08b7b6.fa7b38","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1090,"y":4840,"wires":[["9d2f1082.19c72"]]},{"id":"bf8d6f03.7cf55","type":"ha-entity","z":"c1e03843.9d14a8","name":"A-Alm","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_a_alm"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:alert"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":790,"y":4600,"wires":[["30918852.057cf8"]]},{"id":"a0a25d3c.7b3fe","type":"ha-entity","z":"c1e03843.9d14a8","name":"B-Alm","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_b_alm"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:alert"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":790,"y":4640,"wires":[["eeabb88e.f9ff58"]]},{"id":"8c6aa61b.47f0d8","type":"ha-entity","z":"c1e03843.9d14a8","name":"C-Alm","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_c_alm"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:alert"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":790,"y":4680,"wires":[["c49fee73.c426d"]]},{"id":"ce3f979b.5fdad8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Filter Pre. Alm","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_filter_wrn_alm"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:alert"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":820,"y":4800,"wires":[["ec454ff6.a0f48"]]},{"id":"a9244122.314f6","type":"ha-entity","z":"c1e03843.9d14a8","name":"Filter Alm","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_filter_alm"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:alert"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":800,"y":4720,"wires":[["9e0f7d68.d86df"]]},{"id":"30918852.057cf8","type":"switch","z":"c1e03843.9d14a8","name":"==1","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":4600,"wires":[["24b3c98b.ea6c16"]]},{"id":"eeabb88e.f9ff58","type":"switch","z":"c1e03843.9d14a8","name":"==1","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":4640,"wires":[["41aba944.8e3698"]]},{"id":"c49fee73.c426d","type":"switch","z":"c1e03843.9d14a8","name":"==1","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":4680,"wires":[["7ab15468.91391c"]]},{"id":"9e0f7d68.d86df","type":"switch","z":"c1e03843.9d14a8","name":"==1","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":4720,"wires":[["f1174b96.eff978"]]},{"id":"ec454ff6.a0f48","type":"switch","z":"c1e03843.9d14a8","name":"==1","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":4800,"wires":[["55d2ee2b.aab4f"]]},{"id":"d292408a.63de2","type":"switch","z":"c1e03843.9d14a8","name":"==1","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":970,"y":4840,"wires":[["7d08b7b6.fa7b38"]]},{"id":"d2498c0c.d6159","type":"api-call-service","z":"c1e03843.9d14a8","name":"Notify GM Mobile App","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"notify","service":"mobile_app_gm_mob","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1720,"y":4600,"wires":[[]]},{"id":"3c6615c.b51ebea","type":"api-call-service","z":"c1e03843.9d14a8","name":"Notify GM Mobile App","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"notify","service":"mobile_app_gm_mob","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1720,"y":4640,"wires":[[]]},{"id":"e8b9ef2e.7038e","type":"api-call-service","z":"c1e03843.9d14a8","name":"Notify GM Mobile App","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"notify","service":"mobile_app_gm_mob","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1720,"y":4680,"wires":[[]]},{"id":"3695421e.6bf6fe","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Climate \"Off/Heat\" state","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"climate","service":"set_hvac_mode","entityId":"climate.vtr300_tilluft_sp","data":"{\"hvac_mode\":\"{{payload}}\"}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1020,"y":240,"wires":[[]]},{"id":"55b5d86a.96e438","type":"change","z":"c1e03843.9d14a8","name":"Auto = Int (1)","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":2240,"wires":[["da83e6e0.47f7f8","4dc5c0cb.62c46"]]},{"id":"3a6fabd2.1d7b34","type":"change","z":"c1e03843.9d14a8","name":"Party = Int (3)","rules":[{"t":"set","p":"payload","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2280,"wires":[["da32c3f3.549c9","4dc5c0cb.62c46"]]},{"id":"63a50e24.5864b","type":"change","z":"c1e03843.9d14a8","name":"Boost = Int (4)","rules":[{"t":"set","p":"payload","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2320,"wires":[["d5581e37.24f62","4dc5c0cb.62c46"]]},{"id":"cd5cdfbc.12c6c","type":"change","z":"c1e03843.9d14a8","name":"Ildsted = Int (5)","rules":[{"t":"set","p":"payload","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2360,"wires":[["218988e3.92a7c8","4dc5c0cb.62c46"]]},{"id":"7532b55f.86c27c","type":"change","z":"c1e03843.9d14a8","name":"Borte = Int (6)","rules":[{"t":"set","p":"payload","pt":"msg","to":"6","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2400,"wires":[["cffba8d7.5ce518","4dc5c0cb.62c46"]]},{"id":"411f390f.aa68b8","type":"change","z":"c1e03843.9d14a8","name":"Ferie = Int (7)","rules":[{"t":"set","p":"payload","pt":"msg","to":"7","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2440,"wires":[["83ae5ba2.e7f098","4dc5c0cb.62c46"]]},{"id":"db2734ad.c40af8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Main mode (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1060,"y":2520,"wires":[["76bef04b.2106f","194659c1.0dc5b6"],[]]},{"id":"da83e6e0.47f7f8","type":"function","z":"c1e03843.9d14a8","name":"Auto On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus, switch.vtr300_ppm_mode_auto_enable\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2240,"wires":[["74565103.5bfb4"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"8b298495.209b28","type":"api-call-service","z":"c1e03843.9d14a8","name":"Other mode switches Off","server":"2c4e313e.d0fc5e","version":3,"debugenabled":true,"service_domain":"switch","service":"turn_off","entityId":"","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1230,"y":2240,"wires":[[]]},{"id":"7fd11e6.70465e","type":"comment","z":"c1e03843.9d14a8","name":"Trigger: \"Bruker input_boolean\" som trigges av script via switch i HA pga. det er eneste løsing for å visualisere faktisk status på bryter med tilbakemelding","info":"","x":490,"y":2080,"wires":[]},{"id":"da32c3f3.549c9","type":"function","z":"c1e03843.9d14a8","name":"Party On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_man_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus\"\n   }\n}\n\nreturn msg;    ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2280,"wires":[["74565103.5bfb4"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"d5581e37.24f62","type":"function","z":"c1e03843.9d14a8","name":"Boost On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2320,"wires":[["74565103.5bfb4"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"218988e3.92a7c8","type":"function","z":"c1e03843.9d14a8","name":"Ildsted On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2360,"wires":[["74565103.5bfb4"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"cffba8d7.5ce518","type":"function","z":"c1e03843.9d14a8","name":"Borte On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2400,"wires":[["74565103.5bfb4"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"83ae5ba2.e7f098","type":"function","z":"c1e03843.9d14a8","name":"Ferie On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2440,"wires":[["74565103.5bfb4"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"fa7dadb2.2a93d","type":"function","z":"c1e03843.9d14a8","name":"Man Stopp On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus, switch.vtr300_ppm_mode_auto_enable\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":2740,"wires":[["c665c830.982258"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"403b502.1fcbfb","type":"function","z":"c1e03843.9d14a8","name":"Man Lav On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_normal_modus, switch.vtr300_man_hoy_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":2780,"wires":[["c665c830.982258"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"17e93692.f69d89","type":"function","z":"c1e03843.9d14a8","name":"Man Normal On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_hoy_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":2820,"wires":[["c665c830.982258"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"abefad13.8b548","type":"function","z":"c1e03843.9d14a8","name":"Man Høy On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus, switch.vtr300_man_stopp_modus, switch.vtr300_man_lav_modus, switch.vtr300_man_normal_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":2860,"wires":[["c665c830.982258"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"fc484102.591ab","type":"api-call-service","z":"c1e03843.9d14a8","name":"Other mode switches Off","server":"2c4e313e.d0fc5e","version":3,"debugenabled":true,"service_domain":"switch","service":"turn_off","entityId":"","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":2740,"wires":[[]]},{"id":"d95e2b7f.209e48","type":"api-render-template","z":"c1e03843.9d14a8","name":"PPM Fan speed","server":"2c4e313e.d0fc5e","version":0,"template":"{% if states('sensor.ppm_sensor_selected')|int < states('input_number.vtr300_ppm_auto_ppm_lav_sp')|int and is_state('switch.vtr300_man_lav_modus', 'off') %}\n  Request_low_speed\n{% elif states('sensor.ppm_sensor_selected')|int >= states('input_number.vtr300_ppm_auto_ppm_lav_sp')|int and states('sensor.ppm_sensor_selected')|int < states('input_number.vtr300_ppm_auto_ppm_normal_sp')|int and is_state('switch.vtr300_man_normal_modus', 'off') %}\n  Request_normal_speed\n{% elif states('sensor.ppm_sensor_selected')|int >= states('input_number.vtr300_ppm_auto_ppm_normal_sp')|int and states('sensor.ppm_sensor_selected')|int < states('input_number.vtr300_ppm_auto_ppm_hoy_sp')|int and is_state('switch.vtr300_man_hoy_modus', 'off') %}\n  Request_hoy_speed  \n{% elif states('sensor.ppm_sensor_selected')|int >= states('input_number.vtr300_ppm_auto_ppm_hoy_sp')|int %}\n  Request_boost_speed\n{% else %}\n  ppm_speed_standby\n{% endif %}\n\n\n\n","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":360,"y":3380,"wires":[["a962ac46.5a891","274466b38137c030"]],"info":"# Tilluft - Avtrekk gir ugyldig verdi når \"0\"\n# Gjenvinningsgrad kalkuleres kun når varmegjenvinner er i drift"},{"id":"5456573a.0bb4e8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Request Man Lo speed","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_man_lav_modus","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":810,"y":3220,"wires":[[]]},{"id":"a0209443.d8c188","type":"comment","z":"c1e03843.9d14a8","name":"Manual Mode selection -------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":470,"y":2580,"wires":[]},{"id":"a962ac46.5a891","type":"switch","z":"c1e03843.9d14a8","name":"PPM modes","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Request_low_speed","vt":"str"},{"t":"eq","v":"Request_normal_speed","vt":"str"},{"t":"eq","v":"Request_hoy_speed","vt":"str"},{"t":"eq","v":"Request_boost_speed","vt":"str"},{"t":"eq","v":"ppm_speed_standby","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":530,"y":3360,"wires":[["5456573a.0bb4e8"],["2566b195.7d251e"],["ecbe67b9.2e1ba8"],["92f97ad6.928bb8"],[]]},{"id":"2566b195.7d251e","type":"api-call-service","z":"c1e03843.9d14a8","name":"Request Man Normal speed","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_man_normal_modus","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":3260,"wires":[[]]},{"id":"ecbe67b9.2e1ba8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Request Man Hi speed","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_man_hoy_modus","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":3300,"wires":[[]]},{"id":"92f97ad6.928bb8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Request Boost speed","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_boost_modus","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":3340,"wires":[["17da82d.c72da7d"]]},{"id":"2d79b8a7.4fbbd8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Request Recovery to Auto Sch.","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_auto_modus","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":3400,"wires":[["10e27382.aea96c"]]},{"id":"762d7a11.f6d0d4","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":1510,"y":2940,"wires":[]},{"id":"76bef04b.2106f","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":1250,"y":2560,"wires":[]},{"id":"90fab127.9d4a","type":"function","z":"c1e03843.9d14a8","name":"Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"PPM = \" + msg.payload + \": Boost aktivert!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1130,"y":3340,"wires":[["93e3eef.a8dc21"]]},{"id":"93e3eef.a8dc21","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1320,"y":3340,"wires":[[]]},{"id":"10e27382.aea96c","type":"function","z":"c1e03843.9d14a8","name":"Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Recovery PPM Auto --> Auto Sch. - ppm sensor feil\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1130,"y":3380,"wires":[["fe1f9cb9.1763e"]]},{"id":"fe1f9cb9.1763e","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1320,"y":3380,"wires":[[]]},{"id":"17da82d.c72da7d","type":"api-current-state","z":"c1e03843.9d14a8","name":"Actual PPM","server":"2c4e313e.d0fc5e","version":2,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.ppm_sensor_selected","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":990,"y":3340,"wires":[["90fab127.9d4a"]]},{"id":"926286a5.a898e8","type":"api-current-state","z":"c1e03843.9d14a8","name":"Intern klokke","server":"2c4e313e.d0fc5e","version":2,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.vtr300_intern_klokke","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":310,"y":4900,"wires":[["3cde4801.ff1958"]]},{"id":"b36e239a.6766","type":"inject","z":"c1e03843.9d14a8","name":"Check clock (60min)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":4880,"wires":[["926286a5.a898e8"]]},{"id":"3cde4801.ff1958","type":"function","z":"c1e03843.9d14a8","name":"Split H/M/S.","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\nvar sec = parseInt(output[2]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\nvar msg3 = {payload:sec};\n\nreturn [msg1,msg2,msg3];\n\n\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":470,"y":4900,"wires":[["bbdbc920.6c98e8"],["faf97cc7.2afe"],[]]},{"id":"faf97cc7.2afe","type":"function","z":"c1e03843.9d14a8","name":"Min.Abs.value","func":"var vtr300_min = msg.payload;\nvar system_min =global.get (\"TimeNow_Min\");\nvar absolute_value = Math.abs(system_min - vtr300_min);\n\nmsg.payload = absolute_value;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":4920,"wires":[["da8027c4.0e19b8"]]},{"id":"bbdbc920.6c98e8","type":"function","z":"c1e03843.9d14a8","name":"Hour.Abs.value","func":"var vtr300_hour = msg.payload;\nvar system_hour =global.get (\"TimeNow_Hour\");\nvar absolute_value = Math.abs(system_hour - vtr300_hour);\n\nmsg.payload = absolute_value;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":4880,"wires":[["204ce384.333f6c"]]},{"id":"da8027c4.0e19b8","type":"switch","z":"c1e03843.9d14a8","name":"> 5min off","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":820,"y":4920,"wires":[["56811f72.1643f"]]},{"id":"31f8afbf.7e68d","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4920,"wires":[[]]},{"id":"b309793a.025738","type":"function","z":"c1e03843.9d14a8","name":"Untern UR min != - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n     \"title\": \"Intern ur != \"  + msg.payload + \"min, juster klokke!\",\n  }\n}\nreturn msg;\n\n ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":4920,"wires":[["31f8afbf.7e68d"]]},{"id":"7063d0e7.4d6dc","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":4880,"wires":[[]]},{"id":"292f4659.b8b7fa","type":"function","z":"c1e03843.9d14a8","name":"Untern UR hour != - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n     \"title\": \"Intern ur != \"  + msg.payload + \"t, juster klokke!\",\n  }\n}\nreturn msg;\n\n ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":4880,"wires":[["7063d0e7.4d6dc"]]},{"id":"204ce384.333f6c","type":"switch","z":"c1e03843.9d14a8","name":">= 1t off","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":820,"y":4880,"wires":[["d25cc0fb.5d79f"]]},{"id":"d25cc0fb.5d79f","type":"delay","z":"c1e03843.9d14a8","name":"10min","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":950,"y":4880,"wires":[["8c91146.0c0ede8"]]},{"id":"f73c159b.4f24b8","type":"server-state-changed","z":"c1e03843.9d14a8","name":"New time set","server":"2c4e313e.d0fc5e","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.vtr300_set_system_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"10","forType":"num","forUnits":"seconds","ignorePrevStateNull":true,"ignorePrevStateUnknown":true,"ignorePrevStateUnavailable":true,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":4920,"wires":[["926286a5.a898e8"],[]]},{"id":"e8ea2a56.15bb78","type":"function","z":"c1e03843.9d14a8","name":"3-15Md","func":"var sec = msg.payload.sec;\n\n//Calc.\nMonths = (sec /2.628e+6); //Months, gir ca. resultat (Max 15Md!)\nWeeks = (sec % 2.592e+6/604800);    //Weeks, gir ca. resultat\nDays = (sec % 604800/86400);        //Days\nHours = (sec % 86400/3600);         //Hours\nMin = (sec % 3600/60);              //Minutes\nvar msgOut;\n\n//Fjerne desimaler & legger til benevnelse\n//Viser Måneder når (>= 1Md):\nif (sec >= 2.592e+6) {\n  msgOut = Months.toFixed(1) +' måneder';  \n}\n//Viser Uker når (< 1Md & > 1Uke):\nelse if ((sec < 2.592e+6) && (sec >= 604800)) {\n  msgOut = Weeks.toFixed(1) +' uker';\n}\n//Viser Dager når (< 1Uke & > 1Dag):\nelse if ((sec < 604800) && (sec >= 86400)) {\n  msgOut = Days.toFixed(1) +' dager';\n}\n// Viser Timer og Min. når (< 1Dag & >= 1t):\nelse if ((sec < 86400) && (sec >= 3600)) {\n  msgOut = Hours.toFixed(1) +' timer';  \n}\n// Viser Min. når (<= 1t & < 0sec):\nelse if ((sec < 3600) && (sec > 0)) {\n  msgOut = Min.toFixed(0) +' min';    \n}\n//Bytt Filter!:\nelse if (sec == 0) {\n  msgOut = 'Bytt Filter!';  \n}\nelse {\n    return null;\n}\n\nmsg.payload = msgOut;\nreturn msg;\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1920,"y":1360,"wires":[["c5103bb6.dddc98"]],"inputLabels":["Sek."],"outputLabels":["Md"]},{"id":"265b3575.6ceb3a","type":"buffer-parser","z":"c1e03843.9d14a8","name":"Byteswap","data":"payload","dataType":"msg","specification":"spec","specificationType":"ui","items":[{"type":"uint32le","name":"sec","offset":0,"length":1,"offsetbit":0,"scale":"1","mask":""}],"swap1":"swap16","swap2":"","swap3":"","swap1Type":"swap","swap2Type":"swap","swap3Type":"swap","msgProperty":"payload","msgPropertyType":"str","resultType":"keyvalue","resultTypeType":"output","multipleResult":false,"fanOutMultipleResult":false,"setTopic":true,"outputs":1,"x":1780,"y":1360,"wires":[["e8ea2a56.15bb78"]]},{"id":"dcc610c.d4a33f","type":"falling-edge","z":"c1e03843.9d14a8","name":"","threshold":"0.5","x":810,"y":4760,"wires":[["4f1d4b95.503e74"]]},{"id":"e7ab4543.a79ad8","type":"inject","z":"c1e03843.9d14a8","name":"Test (1)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":570,"y":4760,"wires":[["dcc610c.d4a33f"]]},{"id":"e5cbeaec.95dd18","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1310,"y":4760,"wires":[]},{"id":"4f1d4b95.503e74","type":"function","z":"c1e03843.9d14a8","name":"Get glob.time/Set filter change context","func":"var Recent_change = global.get (\"TimeNow_YearDateHour\");\n\n//Flytter siste filterskift til forrige filterskifte\nvar Previous_change_1 = flow.get (\"vtr300_forrige_filterskift_0\",\"storeInFile\");\nvar Previous_change_2 = flow.get (\"vtr300_forrige_filterskift_1\",\"storeInFile\");\nvar Previous_change_3 = flow.get (\"vtr300_forrige_filterskift_2\",\"storeInFile\");\nvar Previous_change_4 = flow.get (\"vtr300_forrige_filterskift_3\",\"storeInFile\");\nvar Previous_change_5 = flow.get (\"vtr300_forrige_filterskift_4\",\"storeInFile\");\nvar Previous_change_6 = flow.get (\"vtr300_forrige_filterskift_5\",\"storeInFile\");\nvar Previous_change_7 = flow.get (\"vtr300_forrige_filterskift_6\",\"storeInFile\");\nvar Previous_change_8 = flow.get (\"vtr300_forrige_filterskift_7\",\"storeInFile\");\nvar Previous_change_9 = flow.get (\"vtr300_forrige_filterskift_8\",\"storeInFile\");\nvar Previous_change_10 = flow.get (\"vtr300_forrige_filterskift_9\",\"storeInFile\");\nvar Previous_change_0 = flow.get (\"vtr300_siste_filterskift\",\"storeInFile\");\n\n//Initilialiser verdi dersom udefinert\nif (typeof Previous_change_0 == \"undefined\") //Forrige_0\nPrevious_change_0 = 'Not set';\nif (typeof Previous_change_1 == \"undefined\") //Forrige_1\nPrevious_change_1 = 'Not set';\nif (typeof Previous_change_2 == \"undefined\") //Forrige_2\nPrevious_change_2 = 'Not set';\nif (typeof Previous_change_3 == \"undefined\") //Forrige_3\nPrevious_change_3 = 'Not set';\nif (typeof Previous_change_4 == \"undefined\") //Forrige_4\nPrevious_change_4 = 'Not set';\nif (typeof Previous_change_5 == \"undefined\") //Forrige_5\nPrevious_change_5 = 'Not set';\nif (typeof Previous_change_6 == \"undefined\") //Forrige_6\nPrevious_change_6 = 'Not set';\nif (typeof Previous_change_7 == \"undefined\") //Forrige_7\nPrevious_change_7 = 'Not set';\nif (typeof Previous_change_8 == \"undefined\") //Forrige_8\nPrevious_change_8 = 'Not set';\nif (typeof Previous_change_9 == \"undefined\") //Forrige_9\nPrevious_change_9 = 'Not set';\nif (typeof Previous_change_10 == \"undefined\") //Forrige_10\nPrevious_change_10 = 'Not set';\n\n//Lagrer status til fil for å beholde status \"permanent\"\nflow.set(\"vtr300_forrige_filterskift_0\", Previous_change_0,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_1\", Previous_change_1,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_2\", Previous_change_2,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_3\", Previous_change_3,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_4\", Previous_change_4,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_5\", Previous_change_5,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_6\", Previous_change_6,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_7\", Previous_change_7,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_8\", Previous_change_8,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_9\", Previous_change_9,\"storeInFile\");\nflow.set(\"vtr300_forrige_filterskift_10\", Previous_change_10,\"storeInFile\");\nflow.set(\"vtr300_siste_filterskift\", Recent_change,\"storeInFile\");\n\nmsg.payload = Previous_change_0;\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":4760,"wires":[["e5cbeaec.95dd18"]],"inputLabels":["Falling egde"],"outputLabels":["Recent filter change"]},{"id":"944cde9b.9f0c5","type":"comment","z":"c1e03843.9d14a8","name":"Kun for visning","info":"","x":2320,"y":1520,"wires":[]},{"id":"29b4d262.de61de","type":"comment","z":"c1e03843.9d14a8","name":"Kun for visning","info":"","x":2320,"y":1560,"wires":[]},{"id":"25b99a21.012456","type":"comment","z":"c1e03843.9d14a8","name":"Kun for visning","info":"","x":2320,"y":1600,"wires":[]},{"id":"5cc948ca.69e458","type":"comment","z":"c1e03843.9d14a8","name":"Eco. Mode -------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":430,"y":3460,"wires":[]},{"id":"430e9621.1ecf28","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 - Utekompensering ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":2100,"y":340,"wires":[]},{"id":"ca82fbae.f2a328","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 Leser modbus holding registre og oppdaterer \"Input_number\" ved endringer lokalt fra SaveCair HMI panel","info":"","x":2920,"y":340,"wires":[]},{"id":"8641c4a1.9664b8","type":"comment","z":"c1e03843.9d14a8","name":"Utekompensert vifte hastighet - Modbus write","info":"","x":1410,"y":340,"wires":[]},{"id":"674654f8.efe1dc","type":"comment","z":"c1e03843.9d14a8","name":"-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":2080,"y":780,"wires":[]},{"id":"d06f7e20.f5d16","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 Auto schedule - Offset temp. - Skriver til modbus holding registre","info":"","x":1500,"y":780,"wires":[]},{"id":"787d5dfc.79cf54","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 Leser modbus holding registre og oppdaterer \"Input_number\" ved endringer lokalt fra SaveCair HMI panel","info":"","x":2780,"y":780,"wires":[]},{"id":"e417a964.44d248","type":"comment","z":"c1e03843.9d14a8","name":"-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":2280,"y":640,"wires":[]},{"id":"8da85486.440708","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 Auto schedule - Fan Level - Skriver til modbus holding registre","info":"","x":1490,"y":640,"wires":[]},{"id":"c0564efd.67acc","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 Leser modbus holding registre og oppdaterer \"Input_number\" ved endringer lokalt fra SaveCair HMI panel","info":"","x":2780,"y":640,"wires":[]},{"id":"22b16986.7ec886","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3220,"y":680,"wires":[["374264bf.c4aa2c"]]},{"id":"847e560.4f3aca8","type":"delay","z":"c1e03843.9d14a8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3220,"y":720,"wires":[["d2f16967.f551b8"]]},{"id":"d6264abc.39bba8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=5059;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2510,"y":680,"wires":[["1083419e.b47fae"]]},{"id":"1083419e.b47fae","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Sch fan spd (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2680,"y":680,"wires":[["e086ccef.b9b95"],["ca3ab120.728a7"]],"info":"VTR300 Intern UR"},{"id":"ca3ab120.728a7","type":"function","z":"c1e03843.9d14a8","name":"0->6","func":"var FanLevel_Scheduled = {payload:msg.payload.data[0]};\nvar FanLevel_Un_Scheduled = {payload:msg.payload.data[1]};\n\nreturn [FanLevel_Scheduled,FanLevel_Un_Scheduled];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":2830,"y":680,"wires":[["f5ebe59a.7db948"],["93af1d85.e545f"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"c5451582.c1c248","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2360,"y":680,"wires":[["d6264abc.39bba8"]]},{"id":"e086ccef.b9b95","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2690,"y":720,"wires":[]},{"id":"6c9d9004.05549","type":"change","z":"c1e03843.9d14a8","name":"Int-->Str.","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Minimum","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"2","fromt":"num","to":"Lav","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"3","fromt":"num","to":"Normal","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"4","fromt":"num","to":"Høy","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3080,"y":680,"wires":[["22b16986.7ec886"]]},{"id":"f5ebe59a.7db948","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":2950,"y":680,"wires":[["6c9d9004.05549"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"93af1d85.e545f","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":2950,"y":720,"wires":[["2249ef56.c1594"]],"info":"Videresender kun nye verdier/endringer for å hindre unødig data til modbus slave."},{"id":"4602d40c.daa9ac","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Minimum","fromt":"str","to":"1","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Lav","fromt":"str","to":"2","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Normal","fromt":"str","to":"3","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Høy","fromt":"str","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1540,"y":680,"wires":[["9cd818eb.d70cf8"]]},{"id":"9cd818eb.d70cf8","type":"function","z":"c1e03843.9d14a8","name":"Fan speed","func":"var fc=6;\nvar sa=5059;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":680,"wires":[["2658c9af.281946"]]},{"id":"f66b08c0.386098","type":"function","z":"c1e03843.9d14a8","name":"Fan speed","func":"var fc=6;\nvar sa=5060;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":720,"wires":[["71480dc.48369f4"]]},{"id":"71480dc.48369f4","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch fan spd (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1860,"y":720,"wires":[["c37074c5.b8bdb8"],[]]},{"id":"2658c9af.281946","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch(un) fan spd (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1870,"y":680,"wires":[["243c269f.759c6a"],[]]},{"id":"243c269f.759c6a","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2090,"y":680,"wires":[]},{"id":"c37074c5.b8bdb8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2090,"y":720,"wires":[]},{"id":"2249ef56.c1594","type":"change","z":"c1e03843.9d14a8","name":"Int-->Str.","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Minimum","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"2","fromt":"num","to":"Lav","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"3","fromt":"num","to":"Normal","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"4","fromt":"num","to":"Høy","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3080,"y":720,"wires":[["847e560.4f3aca8"]]},{"id":"43281063.1b39e","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Minimum","fromt":"str","to":"1","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Lav","fromt":"str","to":"2","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Normal","fromt":"str","to":"3","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Høy","fromt":"str","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1540,"y":720,"wires":[["f66b08c0.386098"]]},{"id":"374264bf.c4aa2c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Fan Level Scheduled_sp","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_fan_level_scheduled","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3410,"y":680,"wires":[[]]},{"id":"d2f16967.f551b8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Fan Level Unscheduled_sp","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_fan_level_unscheduled","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3420,"y":720,"wires":[[]]},{"id":"bfd665c8.80fd38","type":"api-current-state","z":"c1e03843.9d14a8","name":"Presence?","server":"2c4e313e.d0fc5e","version":2,"outputs":2,"halt_if":"Ingen hjemme","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.personer_i_hus","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":130,"y":3320,"wires":[["71ba9c41.875dc4"],["86223ac6.8f0d88"]]},{"id":"7a377eb1.d69ba","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Eco offset (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2080,"y":80,"wires":[[],[]]},{"id":"666f4382.784e8c","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=2503;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1910,"y":80,"wires":[["7a377eb1.d69ba"]]},{"id":"35f46a17.9a4fd6","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"11","topic":"","payload":"","payloadType":"date","x":2280,"y":80,"wires":[["35c7fe38.e1e7e2","3813298c.f1a366","415df61c.9e7758","9a4791c7.c054c","afc406e0.afbf68","71416c65.0c5064"]]},{"id":"a75d0d13.075a5","type":"function","z":"c1e03843.9d14a8","name":"0->10 [°C]","func":"var Temp_scaled = msg.payload;\nvar Temp_raw;\n\nTemp_raw = (Temp_scaled *10); \n\nmsg.payload = Temp_raw;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1750,"y":80,"wires":[["666f4382.784e8c"]],"info":"# Engineering range: 12°C -> 30°C"},{"id":"3813298c.f1a366","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1100;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2450,"y":120,"wires":[["c609efd2.51f3a"]]},{"id":"c609efd2.51f3a","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Ferie varighet (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2620,"y":120,"wires":[[],["2eba39a2.124746"]]},{"id":"2eba39a2.124746","type":"function","z":"c1e03843.9d14a8","name":"1-365d","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2800,"y":120,"wires":[["2a696d9c.f5f0b2"]]},{"id":"409c5351.1f468c","type":"ha-entity","z":"c1e03843.9d14a8","name":"Ferie Modus Varighet [d]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_ferie_modus_varighet"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"d"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":3310,"y":120,"wires":[[]]},{"id":"cd948d07.70bdf","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1730,"y":120,"wires":[["19e072b6.82da8d"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"19e072b6.82da8d","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=1100;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1890,"y":120,"wires":[["ceea66b3.92cde8"]]},{"id":"ceea66b3.92cde8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Ferie varighet (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2070,"y":120,"wires":[[],[]]},{"id":"7fb0a201.4d983c","type":"ha-entity","z":"c1e03843.9d14a8","name":"Borte Modus Varighet_sp (t)","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_borte_modus_varighet"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"t"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":3320,"y":160,"wires":[[]]},{"id":"17a5629e.55db8d","type":"function","z":"c1e03843.9d14a8","name":"1-72t","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2790,"y":160,"wires":[["e1fbba0e.f65968"]]},{"id":"5b175866.aa4288","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Borte varighet (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2630,"y":160,"wires":[[],["17a5629e.55db8d"]]},{"id":"415df61c.9e7758","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1101;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2450,"y":160,"wires":[["5b175866.aa4288"]]},{"id":"d692e1cd.96998","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1730,"y":160,"wires":[["7c8dc155.a5353"]],"info":"Videresender siste verdi etter 5 sek. for å unngå Â� jamme ned modbus slave, om ikke gÊ￫��r ikke settpunkt gjennom."},{"id":"7c8dc155.a5353","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=1101;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1890,"y":160,"wires":[["103a6cd9.603883"]]},{"id":"103a6cd9.603883","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Borte varighet (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2070,"y":160,"wires":[[],[]]},{"id":"9a4791c7.c054c","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1102;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2450,"y":200,"wires":[["21bffb02.b380a4"]]},{"id":"21bffb02.b380a4","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Ildsted varighet (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2630,"y":200,"wires":[[],["f3646a91.4556d8"]]},{"id":"f3646a91.4556d8","type":"function","z":"c1e03843.9d14a8","name":"1-60min","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2800,"y":200,"wires":[["57217d7f.fd4734"]]},{"id":"d9b9b816.eac7e8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Ildsted Modus Varighet [min]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_ildsted_modus_varighet"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"min"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":3320,"y":200,"wires":[[]]},{"id":"e5794fc2.0a76b","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1730,"y":200,"wires":[["ac5e6c7d.d802f"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"ac5e6c7d.d802f","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=1102;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1890,"y":200,"wires":[["70b68356.aafa7c"]]},{"id":"70b68356.aafa7c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Ildsted varighet (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2070,"y":200,"wires":[[],[]]},{"id":"afc406e0.afbf68","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1103;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2450,"y":240,"wires":[["9aa0ea55.521f88"]]},{"id":"9aa0ea55.521f88","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Boost varighet (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2630,"y":240,"wires":[[],["4c9582f4.96541c"]]},{"id":"4c9582f4.96541c","type":"function","z":"c1e03843.9d14a8","name":"1-240min","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2800,"y":240,"wires":[["45697b4.a5a8484"]]},{"id":"8db2ccb7.81eb6","type":"ha-entity","z":"c1e03843.9d14a8","name":"Boost Modus Varighet [min]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_boost_modus_varighet"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"min"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":3320,"y":240,"wires":[[]]},{"id":"53d0de6b.379f5","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1730,"y":240,"wires":[["48a0f191.94cf6"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"48a0f191.94cf6","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=1103;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1890,"y":240,"wires":[["8c478e30.67845"]]},{"id":"8c478e30.67845","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Boost varighet (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2070,"y":240,"wires":[[],[]]},{"id":"71416c65.0c5064","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=1104;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2450,"y":280,"wires":[["d32b2e41.f4233"]]},{"id":"d32b2e41.f4233","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Party varighet (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":2630,"y":280,"wires":[[],["b5b6d030.03cf4"]]},{"id":"b5b6d030.03cf4","type":"function","z":"c1e03843.9d14a8","name":"1-8t","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2790,"y":280,"wires":[["b0c9590e.3ffc48"]]},{"id":"4078b04e.8a81d","type":"ha-entity","z":"c1e03843.9d14a8","name":"Party Modus Varighet [t]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_party_modus_varighet"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"min"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":3310,"y":280,"wires":[[]]},{"id":"114aa8ba.346257","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1730,"y":280,"wires":[["d0f14b18.f51cc8"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"d0f14b18.f51cc8","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=1104;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1890,"y":280,"wires":[["711bf35.69cf30c"]]},{"id":"711bf35.69cf30c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Party varighet (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2070,"y":280,"wires":[[],[]]},{"id":"38713fae.433af","type":"function","z":"c1e03843.9d14a8","name":"Sch. Day&Prd. state","func":"var Sch_day1_Prd1 = {payload:msg.payload.data[0]};\nvar Sch_day1_Prd2 = {payload:msg.payload.data[1]};\n\nvar Sch_day2_Prd1 = {payload:msg.payload.data[2]};\nvar Sch_day2_Prd2 = {payload:msg.payload.data[3]};\n\nvar Sch_day3_Prd1 = {payload:msg.payload.data[4]};\nvar Sch_day3_Prd2 = {payload:msg.payload.data[5]};\n\nvar Sch_day4_Prd1 = {payload:msg.payload.data[6]};\nvar Sch_day4_Prd2 = {payload:msg.payload.data[7]};\n\nvar Sch_day5_Prd1 = {payload:msg.payload.data[8]};\nvar Sch_day5_Prd2 = {payload:msg.payload.data[9]};\n\nvar Sch_day6_Prd1 = {payload:msg.payload.data[10]};\nvar Sch_day6_Prd2 = {payload:msg.payload.data[11]};\n\nvar Sch_day7_Prd1 = {payload:msg.payload.data[12]};\nvar Sch_day7_Prd2 = {payload:msg.payload.data[13]};\n\nreturn [Sch_day1_Prd1,Sch_day1_Prd2,Sch_day2_Prd1,Sch_day2_Prd2,Sch_day3_Prd1,Sch_day3_Prd2,Sch_day4_Prd1,Sch_day4_Prd2,Sch_day5_Prd1,Sch_day5_Prd2,Sch_day6_Prd1,Sch_day6_Prd2,Sch_day7_Prd1,Sch_day7_Prd2];\n\n","outputs":14,"noerr":0,"initialize":"","finalize":"","x":4180,"y":1540,"wires":[["60aae2bd.c8e2dc"],["8e1a58d1.f69438"],["9f16d636.f3e978"],["66a1becb.ab88d"],["d14892e3.62d71"],["416597f9.f792c8"],["abd5dd1.a84932"],["e94846fd.346a08"],["b2dc3815.26cbe8"],["dea8f7bb.aaa898"],["d96605eb.0502e8"],["b3e5a6b7.ee3168"],["efb72ece.eb54"],["b509cc29.09b97"]]},{"id":"71ba9c41.875dc4","type":"api-render-template","z":"c1e03843.9d14a8","name":"Away speed","server":"2c4e313e.d0fc5e","version":0,"template":"{% if is_state('switch.vtr300_man_lav_modus', 'off') and states('sensor.ppm_sensor_selected')|int <= states('input_number.vtr300_ppm_auto_ppm_normal_sp')|int %}\n  Away_request_low_speed\n{% else %}\n  Away_speed_standby\n{% endif %}\n\n\n\n\n","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":350,"y":3320,"wires":[["ee408656.d831a8","379c14416f400a04"]],"info":"# Tilluft - Avtrekk gir ugyldig verdi når \"0\"\n# Gjenvinningsgrad kalkuleres kun når varmegjenvinner er i drift"},{"id":"ea4832a9.c1c51","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1300,"wires":[["8b06f4e6.09a738"]]},{"id":"8b06f4e6.09a738","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5100;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1300,"wires":[["f09bdd09.dc2fc"]]},{"id":"f09bdd09.dc2fc","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.1_1 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1300,"wires":[[],[]]},{"id":"3b38eb33.e1b2b4","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1340,"wires":[["2990eebb.08e542"]]},{"id":"2990eebb.08e542","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5101;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1340,"wires":[["f0820d3.44eb3f"]]},{"id":"f0820d3.44eb3f","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.1_2 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1340,"wires":[[],[]]},{"id":"a2edb490.4ffce8","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1380,"wires":[["3cff1714.e804a8"]]},{"id":"3cff1714.e804a8","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5102;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1380,"wires":[["478804df.a7755c"]]},{"id":"478804df.a7755c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.2_1 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1380,"wires":[[],[]]},{"id":"9aafa8e6.8b3278","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1420,"wires":[["bf5c27ff.15de08"]]},{"id":"bf5c27ff.15de08","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5103;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1420,"wires":[["35780aa2.44e366"]]},{"id":"35780aa2.44e366","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.2_2 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1420,"wires":[[],[]]},{"id":"e4b8d51c.b24618","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1460,"wires":[["3a6935d6.a4c45a"]]},{"id":"3a6935d6.a4c45a","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5104;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1460,"wires":[["16021e31.9462f2"]]},{"id":"16021e31.9462f2","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.3_1 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1460,"wires":[[],[]]},{"id":"89409e74.2e992","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1500,"wires":[["199cb48b.fa5e1b"]]},{"id":"199cb48b.fa5e1b","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5105;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1500,"wires":[["7adbc76c.aafc88"]]},{"id":"7adbc76c.aafc88","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.3_2 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1500,"wires":[[],[]]},{"id":"5ab1e77f.0768f8","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1540,"wires":[["1a2e1460.44702c"]]},{"id":"1a2e1460.44702c","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5106;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1540,"wires":[["90154fca.877a3"]]},{"id":"90154fca.877a3","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.4_1 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1540,"wires":[[],[]]},{"id":"80326369.7247d","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1580,"wires":[["2a88e24e.e75fee"]]},{"id":"2a88e24e.e75fee","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5107;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1580,"wires":[["468df9c4.27e968"]]},{"id":"468df9c4.27e968","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.4_2 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1580,"wires":[[],[]]},{"id":"2d37d3a7.435c1c","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1620,"wires":[["10f1d88e.b813c7"]]},{"id":"10f1d88e.b813c7","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5108;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1620,"wires":[["be955daa.cd8ee"]]},{"id":"be955daa.cd8ee","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.5_1 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1620,"wires":[[],[]]},{"id":"5521c465.b1378c","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1660,"wires":[["375c4adb.1e2936"]]},{"id":"375c4adb.1e2936","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5109;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1660,"wires":[["ecf11daa.07635"]]},{"id":"ecf11daa.07635","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.5_2 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1660,"wires":[[],[]]},{"id":"668184dc.ed982c","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1700,"wires":[["9a8f323.a97f0d"]]},{"id":"9a8f323.a97f0d","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5110;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1700,"wires":[["1ec835d3.015d0a"]]},{"id":"1ec835d3.015d0a","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.6_1 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1700,"wires":[[],[]]},{"id":"276a25df.0e763a","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1740,"wires":[["56fc45d3.cc210c"]]},{"id":"56fc45d3.cc210c","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5111;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1740,"wires":[["ec052046.11627"]]},{"id":"ec052046.11627","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.6_2 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1740,"wires":[[],[]]},{"id":"ca558b0.e8fb378","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1780,"wires":[["e28a22bb.4bf93"]]},{"id":"e28a22bb.4bf93","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5112;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1780,"wires":[["ffef335d.bacb8"]]},{"id":"ffef335d.bacb8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.7_1 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1780,"wires":[[],[]]},{"id":"ea4fca21.fdffc8","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Av","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Aktiv","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":1820,"wires":[["4aae8aef.a7d324"]]},{"id":"4aae8aef.a7d324","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=5113;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":1820,"wires":[["7515c9d0.d11128"]]},{"id":"7515c9d0.d11128","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch.7_2 (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3890,"y":1820,"wires":[[],[]]},{"id":"104da278.05809e","type":"change","z":"c1e03843.9d14a8","name":"Man Stopp = Int (0)","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":2740,"wires":[["fa7dadb2.2a93d","ea171195.c21f5","3d60abc8.cd3da4"]]},{"id":"9d542ba9.a969d8","type":"change","z":"c1e03843.9d14a8","name":"Man Lav = Int (2)","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":2780,"wires":[["403b502.1fcbfb","ea171195.c21f5","3d60abc8.cd3da4"]]},{"id":"223d2f5f.27832","type":"change","z":"c1e03843.9d14a8","name":"Man Normal = Int (3)","rules":[{"t":"set","p":"payload","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":2820,"wires":[["17e93692.f69d89","ea171195.c21f5","3d60abc8.cd3da4"]]},{"id":"1d951346.dafafd","type":"change","z":"c1e03843.9d14a8","name":"Man Høy = Int (4)","rules":[{"t":"set","p":"payload","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":2860,"wires":[["abefad13.8b548","ea171195.c21f5","3d60abc8.cd3da4"]]},{"id":"9a2cde4.3b4f82","type":"api-render-template","z":"c1e03843.9d14a8","name":"Set manual modes","server":"2c4e313e.d0fc5e","version":0,"template":"{% if is_state('input_boolean.vtr300_man_stopp_modus_status_dummy', 'on') and is_state('switch.vtr300_man_stopp_modus', 'off') %}\n  Set_man_stop_speed\n\n{% elif  is_state('input_boolean.vtr300_man_lav_modus_status_dummy', 'on') and is_state('switch.vtr300_man_lav_modus', 'off') and is_state('switch.vtr300_boost_modus', 'off') %}\n  Set_man_low_speed\n  \n{% elif  is_state('input_boolean.vtr300_man_normal_modus_status_dummy', 'on') and is_state('switch.vtr300_man_normal_modus', 'off') and is_state('switch.vtr300_boost_modus', 'off') %}\n  Set_man_normal_speed\n  \n{% elif  is_state('input_boolean.vtr300_man_hoy_modus_status_dummy', 'on') and is_state('switch.vtr300_man_hoy_modus', 'off') and is_state('switch.vtr300_boost_modus', 'off') %}\n  Set_man_hi_speed\n  \n{% else %}\n  Set_man_speed_standby\n{% endif %}\n\n\n\n","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":130,"y":2840,"wires":[["cdc95a3e.357258","da25847e.38dfe8"]],"info":"# Tilluft - Avtrekk gir ugyldig verdi når \"0\"\n# Gjenvinningsgrad kalkuleres kun når varmegjenvinner er i drift"},{"id":"62216b1c.c9f534","type":"inject","z":"c1e03843.9d14a8","name":"Poll(5s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":"9","topic":"","payload":"","payloadType":"date","x":120,"y":2700,"wires":[["cd2fb013.90126"]]},{"id":"cdc95a3e.357258","type":"switch","z":"c1e03843.9d14a8","name":"split modes","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Set_man_stop_speed","vt":"str"},{"t":"eq","v":"Set_man_low_speed","vt":"str"},{"t":"eq","v":"Set_man_normal_speed","vt":"str"},{"t":"eq","v":"Set_man_hi_speed","vt":"str"},{"t":"eq","v":"Set_man_speed_standby","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":310,"y":2840,"wires":[["104da278.05809e"],["9d542ba9.a969d8"],["223d2f5f.27832"],["1d951346.dafafd"],[]]},{"id":"ee408656.d831a8","type":"switch","z":"c1e03843.9d14a8","name":"Away modes","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Away_request_low_speed","vt":"str"},{"t":"eq","v":"Away_speed_standby","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":3300,"wires":[["5456573a.0bb4e8"],[]]},{"id":"a34a6d01.ef062","type":"api-current-state","z":"c1e03843.9d14a8","name":"RF% > RF_sp?","server":"2c4e313e.d0fc5e","version":2,"outputs":2,"halt_if":"vtr300_fukt_avtrekk","halt_if_type":"flow","halt_if_compare":"lt","entity_id":"input_number.vtr300_ppm_auto_moist_normal_sp","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":140,"y":3240,"wires":[["42838a41.62a5b4","208bed5c.8c18b2"],["bfd665c8.80fd38","f075cc6f.464e8"]]},{"id":"42838a41.62a5b4","type":"api-render-template","z":"c1e03843.9d14a8","name":"Moist. speed","server":"2c4e313e.d0fc5e","version":0,"template":"{% if states('sensor.vtr300_relativ_fukt_avtrekk')|int >= states('input_number.vtr300_ppm_auto_moist_normal_sp')|int and states('sensor.vtr300_relativ_fukt_avtrekk')|int < states('input_number.vtr300_ppm_auto_moist_hoy_sp')|int and is_state('switch.vtr300_man_normal_modus', 'off') %}\n  Moist_request_normal_speed\n{% elif states('sensor.vtr300_relativ_fukt_avtrekk')|int >= states('input_number.vtr300_ppm_auto_moist_hoy_sp')|int and is_state('switch.vtr300_man_hoy_modus', 'off') %}\n  Moist_request_hoy_speed\n{% else %}\n  Moist_speed_standby\n{% endif %}\n","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":350,"y":3220,"wires":[["4e88c34f.5a9a4c"]],"info":"# Tilluft - Avtrekk gir ugyldig verdi når \"0\"\n# Gjenvinningsgrad kalkuleres kun når varmegjenvinner er i drift"},{"id":"4e88c34f.5a9a4c","type":"switch","z":"c1e03843.9d14a8","name":"Moist. modes","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Moist_request_normal_speed","vt":"str"},{"t":"eq","v":"Moist_request_hoy_speed","vt":"str"},{"t":"eq","v":"Moist_speed_standby","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":530,"y":3220,"wires":[["2566b195.7d251e"],["ecbe67b9.2e1ba8"],[]]},{"id":"8b255ec.dce94a","type":"api-render-template","z":"c1e03843.9d14a8","name":"Set main modes","server":"2c4e313e.d0fc5e","version":0,"template":"{% if is_state('input_boolean.vtr300_auto_modus_status_dummy', 'on') and is_state('switch.vtr300_auto_modus', 'off') %}\n  Set_auto_schedule_mode\n\n{% elif  is_state('input_boolean.vtr300_party_modus_status_dummy', 'on') and is_state('switch.vtr300_party_modus', 'off') %}\n  Set_party_mode\n  \n{% elif  is_state('input_boolean.vtr300_boost_modus_status_dummy', 'on') and is_state('switch.vtr300_boost_modus', 'off') %}\n  Set_boost_mode\n  \n{% elif  is_state('input_boolean.vtr300_ildsted_modus_status_dummy', 'on') and is_state('switch.vtr300_ildsted_modus', 'off') %}\n  Set_ildsted_mode\n  \n{% elif  is_state('input_boolean.vtr300_borte_modus_status_dummy', 'on') and is_state('switch.vtr300_borte_modus', 'off') %}\n  Set_borte_mode\n  \n{% elif  is_state('input_boolean.vtr300_ferie_modus_status_dummy', 'on') and is_state('switch.vtr300_ferie_modus', 'off') %}\n  Set_ferie_mode\n  \n{% elif  is_state('input_boolean.vtr300_man_lav_modus_status_dummy', 'on') and is_state('switch.vtr300_man_lav_modus', 'off') %}\n  Set_man_mode  \n\n{% elif  is_state('input_boolean.vtr300_man_normal_modus_status_dummy', 'on') and is_state('vtr300_man_normal_modus', 'off') %}\n  Set_man_mode  \n  \n{% elif  is_state('input_boolean.vtr300_man_hoy_modus_status_dummy', 'on') and is_state('switch.vtr300_man_hoy_modus', 'off') %}\n  Set_man_mode    \n  \n{% else %}\n  Set_main_mode_standby\n\n{% endif %}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":120,"y":2340,"wires":[["4349ac3.6895154","9a9b18d.4e8e9e8","dcf0d347.7ce4c"]],"info":"# Tilluft - Avtrekk gir ugyldig verdi når \"0\"\n# Gjenvinningsgrad kalkuleres kun når varmegjenvinner er i drift"},{"id":"9a9b18d.4e8e9e8","type":"switch","z":"c1e03843.9d14a8","name":"split modes","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Set_auto_schedule_mode","vt":"str"},{"t":"eq","v":"Set_party_mode","vt":"str"},{"t":"eq","v":"Set_boost_mode","vt":"str"},{"t":"eq","v":"Set_ildsted_mode","vt":"str"},{"t":"eq","v":"Set_borte_mode","vt":"str"},{"t":"eq","v":"Set_ferie_mode","vt":"str"},{"t":"eq","v":"Set_main_mode_standby","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":330,"y":2340,"wires":[["55b5d86a.96e438"],["3a6fabd2.1d7b34"],["63a50e24.5864b"],["cd5cdfbc.12c6c"],["7532b55f.86c27c"],["411f390f.aa68b8"],[]]},{"id":"e05f35eb.4a0918","type":"inject","z":"c1e03843.9d14a8","name":"Poll(5s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":120,"y":2220,"wires":[["41cfffc3.62587"]]},{"id":"ea171195.c21f5","type":"change","z":"c1e03843.9d14a8","name":"Manuell = Int (2)","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":2680,"wires":[["2432b020.e46eb"]]},{"id":"2ce6a3c1.d3f42c","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_fukt_avtrekk","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":820,"wires":[["3a6169d9.403066"]]},{"id":"41cfffc3.62587","type":"api-current-state","z":"c1e03843.9d14a8","name":"Trykkvakt aktiv?","server":"2c4e313e.d0fc5e","version":2,"outputs":2,"halt_if":"Komfyravtrekk","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.vtr300_modus_status","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"x":120,"y":2280,"wires":[[],["8b255ec.dce94a"]]},{"id":"2c929688.f0038a","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day7.Prd2_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day7_prd2_set","state_type":"str","halt_if":"vtr300_sch_day7_prd2_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1820,"wires":[["ea4fca21.fdffc8"],[]]},{"id":"5f014b3c.0a5b74","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day7.Prd2_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day7_prd2_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1820,"wires":[[]]},{"id":"bc523636.f96ed8","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day7.Prd1_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day7_prd1_set","state_type":"str","halt_if":"vtr300_sch_day7_prd1_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1780,"wires":[["ca558b0.e8fb378"],[]]},{"id":"17a1e517.d0339b","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1300,"wires":[["ff11a292.597cc"]]},{"id":"60aae2bd.c8e2dc","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day1_prd1_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1300,"wires":[["17a1e517.d0339b"]]},{"id":"ff11a292.597cc","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day1.Prd1_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day1_prd1_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1300,"wires":[[]]},{"id":"26bed5d4.03654a","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day1.Prd1_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day1_prd1_set","state_type":"str","halt_if":"vtr300_sch_day1_prd1_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1300,"wires":[["ea4832a9.c1c51"],[]]},{"id":"cdc90ead.78313","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day1.Prd2_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day1_prd2_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1340,"wires":[[]]},{"id":"2b117256.e7b50e","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1340,"wires":[["cdc90ead.78313"]]},{"id":"8e1a58d1.f69438","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day1_prd2_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1340,"wires":[["2b117256.e7b50e"]]},{"id":"47fd941.4d81b6c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day2.Prd1_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day2_prd1_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1380,"wires":[[]]},{"id":"8020cd51.221c6","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1380,"wires":[["47fd941.4d81b6c"]]},{"id":"9f16d636.f3e978","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day2_prd1_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1380,"wires":[["8020cd51.221c6"]]},{"id":"66a1becb.ab88d","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day2_prd2_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1420,"wires":[["d46738a3.5f0918"]]},{"id":"d46738a3.5f0918","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1420,"wires":[["ddda5ade.5b3168"]]},{"id":"ddda5ade.5b3168","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day2.Prd2_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day2_prd2_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1420,"wires":[[]]},{"id":"d14892e3.62d71","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day3_prd1_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1460,"wires":[["9979dafc.854cb8"]]},{"id":"9979dafc.854cb8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1460,"wires":[["829bb395.d323b"]]},{"id":"829bb395.d323b","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day3.Prd1_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day3_prd1_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1460,"wires":[[]]},{"id":"434582c4.a2822c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day3.Prd2_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day3_prd2_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1500,"wires":[[]]},{"id":"febc37ce.789908","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1500,"wires":[["434582c4.a2822c"]]},{"id":"416597f9.f792c8","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day3_prd2_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1500,"wires":[["febc37ce.789908"]]},{"id":"d0f56875.2d60d8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day4.Prd1_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day4_prd1_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1540,"wires":[[]]},{"id":"3211c792.725b18","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1540,"wires":[["d0f56875.2d60d8"]]},{"id":"abd5dd1.a84932","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day4_prd1_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1540,"wires":[["3211c792.725b18"]]},{"id":"e94846fd.346a08","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day4_prd2_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1580,"wires":[["e527cadf.001788"]]},{"id":"e527cadf.001788","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1580,"wires":[["58b57eaa.5d338"]]},{"id":"58b57eaa.5d338","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day4.Prd2_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day4_prd2_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1580,"wires":[[]]},{"id":"b2dc3815.26cbe8","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day5_prd1_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1620,"wires":[["f07e3253.cbbbb"]]},{"id":"f07e3253.cbbbb","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1620,"wires":[["ccb7ef1c.5ed07"]]},{"id":"ccb7ef1c.5ed07","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day5.Prd1_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day5_prd1_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1620,"wires":[[]]},{"id":"dea8f7bb.aaa898","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day5_prd2_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1660,"wires":[["1fbc64f7.bf429b"]]},{"id":"1fbc64f7.bf429b","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1660,"wires":[["d17c9820.ff5b28"]]},{"id":"d17c9820.ff5b28","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day5.Prd2_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day5_prd2_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1660,"wires":[[]]},{"id":"d96605eb.0502e8","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day6_prd1_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1700,"wires":[["e8a158fe.449038"]]},{"id":"e8a158fe.449038","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1700,"wires":[["ace4f13a.9a84f"]]},{"id":"ace4f13a.9a84f","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day6.Prd1_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day6_prd1_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1700,"wires":[[]]},{"id":"b3e5a6b7.ee3168","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day6_prd2_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1740,"wires":[["1712bb7a.470465"]]},{"id":"1712bb7a.470465","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1740,"wires":[["d4a474e0.d1d228"]]},{"id":"d4a474e0.d1d228","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day6.Prd2set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day6_prd2_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1740,"wires":[[]]},{"id":"447afe01.ee115","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day6.Prd2_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day6_prd2_set","state_type":"str","halt_if":"vtr300_sch_day6_prd2_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1740,"wires":[["276a25df.0e763a"],[]]},{"id":"54414b0d.7aba44","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day6.Prd1_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day6_prd1_set","state_type":"str","halt_if":"vtr300_sch_day6_prd1_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1700,"wires":[["668184dc.ed982c"],[]]},{"id":"74120587.4c855c","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day5.Prd2_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day5_prd2_set","state_type":"str","halt_if":"vtr300_sch_day5_prd2_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1660,"wires":[["5521c465.b1378c"],[]]},{"id":"5189515c.023ac","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day5.Prd1_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day5_prd1_set","state_type":"str","halt_if":"vtr300_sch_day5_prd1_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1620,"wires":[["2d37d3a7.435c1c"],[]]},{"id":"481d1516.e0ccac","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day4.Prd2_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day4_prd2_set","state_type":"str","halt_if":"vtr300_sch_day4_prd2_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1580,"wires":[["80326369.7247d"],[]]},{"id":"a7f6d33f.e1bf9","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day4.Prd1_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day4_prd1_set","state_type":"str","halt_if":"vtr300_sch_day4_prd1_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1540,"wires":[["5ab1e77f.0768f8"],[]]},{"id":"d5fec7e.5ba2438","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day3.Prd2_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day3_prd2_set","state_type":"str","halt_if":"vtr300_sch_day3_prd2_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1500,"wires":[["89409e74.2e992"],[]]},{"id":"c2eaa00b.a162f","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day3.Prd1_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day3_prd1_set","state_type":"str","halt_if":"vtr300_sch_day3_prd1_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1460,"wires":[["e4b8d51c.b24618"],[]]},{"id":"4c90cf5e.3ebf6","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day2.Prd2_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day2_prd2_set","state_type":"str","halt_if":"vtr300_sch_day2_prd2_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1420,"wires":[["9aafa8e6.8b3278"],[]]},{"id":"e63b4963.6491f8","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day2.Prd1_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day2_prd1_set","state_type":"str","halt_if":"vtr300_sch_day2_prd1_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1380,"wires":[["a2edb490.4ffce8"],[]]},{"id":"195fffd8.bd7bd","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Day1.Prd2_set","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_sch_day1_prd2_set","state_type":"str","halt_if":"vtr300_sch_day1_prd2_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3410,"y":1340,"wires":[["3b38eb33.e1b2b4"],[]]},{"id":"efa0e1ca.b703e","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set: Sch. Day7.Prd1_set","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_sch_day7_prd1_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4810,"y":1780,"wires":[[]]},{"id":"efb72ece.eb54","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day7_prd1_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1780,"wires":[["54b89ca3.35f0c4"]]},{"id":"54b89ca3.35f0c4","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1780,"wires":[["efa0e1ca.b703e"]]},{"id":"b509cc29.09b97","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Av","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Aktiv","tot":"str"},{"t":"set","p":"vtr300_sch_day7_prd2_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4440,"y":1820,"wires":[["b7091927.8907a8"]]},{"id":"b7091927.8907a8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4620,"y":1820,"wires":[["5f014b3c.0a5b74"]]},{"id":"10baf127.96ff5f","type":"comment","z":"c1e03843.9d14a8","name":"Poll 30s: Skriver dersom \"Input_select != flow context state\"","info":"","x":3530,"y":1260,"wires":[]},{"id":"c3d7a657.21cde8","type":"comment","z":"c1e03843.9d14a8","name":"\"Prd. enable\" ser ikke ut til å virke fra HMI panelet, panel bug? Mer modbus testing!","info":"","x":4110,"y":1260,"wires":[]},{"id":"6712c7dc.8cc1f8","type":"comment","z":"c1e03843.9d14a8","name":"Skriver til \"input_select\" ved lokal/panel endring eller om modbus write feiler","info":"","x":4680,"y":1260,"wires":[]},{"id":"741d95f7.5187bc","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 - Auto Schedule - Prd. enable -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":4090,"y":1140,"wires":[]},{"id":"34fa31b5.f3217e","type":"comment","z":"c1e03843.9d14a8","name":"-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":2080,"y":920,"wires":[]},{"id":"45928568.bdba8c","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 Utekompensert tillufts regulering","info":"","x":1400,"y":920,"wires":[]},{"id":"a8aebd76.47dd7","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_inntak_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":700,"wires":[["24aa165e.573b2a"]]},{"id":"e71b844.48a9578","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_eco_offset_temp_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":80,"wires":[["98d20961.f25508","a7172ed8.a2ccc"]]},{"id":"98d20961.f25508","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":3100,"y":80,"wires":[["5c6020d0.1916f"]]},{"id":"dfe04409.76d478","type":"poll-state","z":"c1e03843.9d14a8","name":"Ønsket Eco offset","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_eco_offset_temp_sp","state_type":"num","halt_if":"vtr300_eco_offset_temp_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":1460,"y":80,"wires":[["6ba7d4a2.65fbbc"],[]]},{"id":"5c6020d0.1916f","type":"api-call-service","z":"c1e03843.9d14a8","name":"Ønsket Eco offset","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_eco_offset_temp_sp","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3290,"y":80,"wires":[[]]},{"id":"230a5ce9.04e174","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 - Settpunkter -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":2000,"y":20,"wires":[]},{"id":"f08558c0.d7bd78","type":"comment","z":"c1e03843.9d14a8","name":"Skriver til \"input_number\" ved lokal/panel endring eller om modbus write feiler","info":"","x":2470,"y":40,"wires":[]},{"id":"67b902c2.8ee1ac","type":"comment","z":"c1e03843.9d14a8","name":"Poll 30s: Skriver dersom \"Input_number != flow context state\"","info":"","x":1720,"y":40,"wires":[]},{"id":"210d89c2.f42156","type":"ha-entity","z":"c1e03843.9d14a8","name":"Utekomp: Kalkulert tilluftstemp [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_utekomp_temp_calc"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer-lines"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[{"property":"Tilluftstemperatur","value":"vtr300_tillufts_temperatur","valueType":"flow"},{"property":"Aktiv utetemp.","value":"Glob_autovalgt_utetemp","valueType":"global"},{"property":"Netatmo utetemp.","value":"Netatmo_outdoor_temp","valueType":"flow"},{"property":"VTR300 inntakstemp.","value":"vtr300_inntak_temp","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2160,"y":1060,"wires":[[]]},{"id":"e4eb9b30.dd0088","type":"trigger","z":"c1e03843.9d14a8","name":"Rate 30s","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"30","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":960,"y":2900,"wires":[["3eb6a89d.bc64c8"]]},{"id":"4dc5c0cb.62c46","type":"trigger","z":"c1e03843.9d14a8","name":"Rate 30s","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"30","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":720,"y":2520,"wires":[["ee01aff1.248ed"]]},{"id":"860c7670.14a608","type":"change","z":"c1e03843.9d14a8","name":"Manuell = Int (2)","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2480,"wires":[["4dc5c0cb.62c46","86bedd6.cbc552"]]},{"id":"74565103.5bfb4","type":"trigger","z":"c1e03843.9d14a8","name":"Rate 30s","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"30","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1040,"y":2240,"wires":[["8b298495.209b28"]]},{"id":"c665c830.982258","type":"trigger","z":"c1e03843.9d14a8","name":"Rate 30s","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"30","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1080,"y":2740,"wires":[["fc484102.591ab"]]},{"id":"418a3eaf.4e965","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_tillufts_temperatur","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":620,"wires":[["8e139b51.6e3fe8"]]},{"id":"a5229e35.1e678","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_tilluftsvifte_pv","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":860,"wires":[["69459036.f9ddd"]]},{"id":"ff513c4f.08af","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 Beregner produsert effekt, energi og kostnad (Estimat!) --------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":2160,"y":3480,"wires":[]},{"id":"7d56dbd.98b0b24","type":"inject","z":"c1e03843.9d14a8","name":"Poll 10s","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1680,"y":3580,"wires":[["d74766ef.151988","2148a16.512935e"]]},{"id":"bd4d6a75.e2da28","type":"function","z":"c1e03843.9d14a8","name":"Lagrer kWt+Kr tellere til fil","func":"// ---------------------------------------------------------------------------------------------------------\n//---------------------- kWh - Tilført ---------------------------------------------------------------------\n// ---------------------------------------------------------------------------------------------------------\n//Flytter siste kWh tellere fra memory til temp. variable\nvar kWh_total = flow.get (\"vtr300_tilfort_kWh_total\",\"default\");     // Total eneregiteller.\nvar kWh_daily = flow.get (\"vtr300_tilfort_kWh_daily\",\"default\");     // Daglig energi.\nvar kWh_weekly = flow.get (\"vtr300_tilfort_kWh_weekly\",\"default\");   // Ukentlig energi.\nvar kWh_monthly = flow.get (\"vtr300_tilfort_kWh_monthly\",\"default\"); // Månedlig energi.\nvar kWh_yearly = flow.get (\"vtr300_tilfort_kWh_yearly\",\"default\");   // Årlig energi.\n\n//Flytter siste kWh tellere fra temp. variable til fil for permanent lagring. Restores fra fil red restart for å unngå å miste verdier.\nflow.set(\"vtr300_tilfort_kWh_total\", kWh_total,\"storeInFile\");     // Total eneregiteller.\nflow.set(\"vtr300_tilfort_kWh_daily\", kWh_daily,\"storeInFile\");     // Daglig energi.\nflow.set(\"vtr300_tilfort_kWh_weekly\", kWh_weekly,\"storeInFile\");   // Ukentlig energi.\nflow.set(\"vtr300_tilfort_kWh_monthly\", kWh_monthly,\"storeInFile\"); // Månedlig energi.\nflow.set(\"vtr300_tilfort_kWh_yearly\", kWh_yearly,\"storeInFile\");   // ô�rlig energi.\n\n// ---------------------------------------------------------------------------------------------------------\n//---------------------- kWh - Kr --------------------------------------------------------------------------\n// ---------------------------------------------------------------------------------------------------------\n//Flytter siste Kr/kWh tellere fra memory til temp. variable\nvar Kr_kWh_daily = flow.get (\"vtr300_tilfort_kWh_daily_Kr\",\"default\");     // Daglig tilført energi i Kr.\nvar Kr_kWh_weekly = flow.get (\"vtr300_tilfort_kWh_weekly_Kr\",\"default\");   // Ukentlig tilført energi i Kr.\nvar Kr_kWh_monthly = flow.get (\"vtr300_tilfort_kWh_monthly_Kr\",\"default\"); // Månedlig tilført energi i Kr.\nvar Kr_kWh_yearly = flow.get (\"vtr300_tilfort_kWh_yearly_Kr\",\"default\");   // Årlig tilført energi i Kr.\nvar Kr_kWh_total = flow.get (\"vtr300_tilfort_kWh_total_Kr\",\"default\");         // Total tilført energi i Kr. \n\n//Flytter siste Kr/kWh tellere fra temp. variable til fil for permanent lagring. Restores fra fil red restart for å unngå å miste verdier.\nflow.set(\"vtr300_tilfort_kWh_daily_Kr\", Kr_kWh_daily,\"storeInFile\");     // Daglig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_weekly_Kr\", Kr_kWh_weekly,\"storeInFile\");   // Ukentlig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_monthly_Kr\", Kr_kWh_monthly,\"storeInFile\"); // Månedlig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_yearly_Kr\", Kr_kWh_yearly,\"storeInFile\");   // Ö�rlig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_total_Kr\", Kr_kWh_total,\"storeInFile\");     // Total tilført energi i Kr. \n\n// ---------------------------------------------------------------------------------------------------------\n//---------------------- kWh - Forbruk kWh & Kr ------------------------------------------------------------\n// ---------------------------------------------------------------------------------------------------------\n//Flytter siste kWh tellere fra memory til temp. variable\nvar kWh_forbruk_daily = flow.get (\"vtr300_forbruk_kWh_daily\",\"default\")           // Daglig energiforbruk i kWh.\nvar kWh_forbruk_daily_Kr = flow.get (\"vtr300_forbruk_kWh_daily_Kr\",\"default\")     // Daglig energiforbruk i Kr.\nvar kWh_forbruk_weekly = flow.get (\"vtr300_forbruk_kWh_weekly\",\"default\")         // Ukentlig energiforbruk i kWh.\nvar kWh_forbruk_weekly_Kr = flow.get (\"vtr300_forbruk_kWh_weekly_Kr\",\"default\")   // Ukentlig energiforbruk i Kr.\nvar kWh_forbruk_monthly = flow.get (\"vtr300_forbruk_kWh_monthly\",\"default\")       // Månedlig energiforbruk i kWh.\nvar kWh_forbruk_monthly_Kr = flow.get (\"vtr300_forbruk_kWh_monthly_Kr\",\"default\") // Månedlig energiforbruk i Kr.\nvar kWh_forbruk_yearly = flow.get (\"vtr300_forbruk_kWh_yearly\",\"default\")         // Årlig energiforbruk i kWh.\nvar kWh_forbruk_yearly_Kr = flow.get (\"vtr300_forbruk_kWh_yearly_Kr\",\"default\")   // Årlig energiforbruk i Kr.\nvar kWh_forbruk_total = flow.get (\"vtr300_forbruk_kWh_total\",\"default\")           // Total energiforbruk i kWh.\nvar kWh_forbruk_total_Kr = flow.get (\"vtr300_forbruk_kWh_total_Kr\",\"default\")     // Total energiforbruk i Kr.\n\n//Flytter siste kWh tellere fra temp. variable til fil for permanent lagring. Restores fra fil red restart for å unngå å miste verdier.\nflow.set(\"vtr300_forbruk_kWh_daily\", kWh_forbruk_daily,\"storeInFile\");           // Daglig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_daily_Kr\", kWh_forbruk_daily_Kr,\"storeInFile\");     // Daglig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_weekly\", kWh_forbruk_weekly,\"storeInFile\");         // Ukentlig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_weekly_Kr\", kWh_forbruk_weekly_Kr,\"storeInFile\");   // Ukentlig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_monthly\", kWh_forbruk_monthly,\"storeInFile\");       // Månedlig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_monthly_Kr\", kWh_forbruk_monthly_Kr,\"storeInFile\"); // Mã�nedlig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_yearly\", kWh_forbruk_yearly,\"storeInFile\");         // Årlig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_yearly_Kr\", kWh_forbruk_yearly_Kr,\"storeInFile\");   // ù�rlig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_total\", kWh_forbruk_total,\"storeInFile\");           // Total energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_total_Kr\", kWh_forbruk_total_Kr,\"storeInFile\");     // Total energiforbruk i Kr.\n","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2310,"y":3520,"wires":[]},{"id":"ec438a5f.ad4618","type":"inject","z":"c1e03843.9d14a8","name":"Poll 30s","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2120,"y":3520,"wires":[["bd4d6a75.e2da28"]]},{"id":"a13e50be.66fea","type":"function","z":"c1e03843.9d14a8","name":"Restore kWt+Kr tellere mem.","func":"// ---------------------------------------------------------------------------------------------------------\n//---------------------- kWh - Tilført ---------------------------------------------------------------------\n// ---------------------------------------------------------------------------------------------------------\n//Restorer siste verdi for kWh tellere fra fil til temp. variable (Skjer ved restart av Node Red eller host).\nvar kWh_total = flow.get (\"vtr300_tilfort_kWh_total\",\"storeInFile\");     // Total eneregiteller.\nvar kWh_daily = flow.get (\"vtr300_tilfort_kWh_daily\",\"storeInFile\");     // Daglig energi.\nvar kWh_weekly = flow.get (\"vtr300_tilfort_kWh_weekly\",\"storeInFile\");   // Ukentlig energi.\nvar kWh_monthly = flow.get (\"vtr300_tilfort_kWh_monthly\",\"storeInFile\"); // Månedlig energi.\nvar kWh_yearly = flow.get (\"vtr300_tilfort_kWh_yearly\",\"storeInFile\");   // Årlig energi.\n\n//Flytter siste verdi for kWh tellere fra temp. variable til memory, kalkulasjon fortsetter med siste lagrede verdi.\nflow.set(\"vtr300_tilfort_kWh_total\", kWh_total,\"default\");     // Total eneregiteller.\nflow.set(\"vtr300_tilfort_kWh_daily\", kWh_daily,\"default\");     // Daglig energi.\nflow.set(\"vtr300_tilfort_kWh_weekly\", kWh_weekly,\"default\");   // Ukentlig energi.\nflow.set(\"vtr300_tilfort_kWh_monthly\", kWh_monthly,\"default\"); // Månedlig energi.\nflow.set(\"vtr300_tilfort_kWh_yearly\", kWh_yearly,\"default\");   // Årlig energi.\n\n// ---------------------------------------------------------------------------------------------------------\n//---------------------- kWh - Kr --------------------------------------------------------------------------\n// ---------------------------------------------------------------------------------------------------------\n//Restorer siste verdi for Kr/kWh tellere fra fil til temp. variable (Skjer ved restart av Node Red eller host).\nvar Kr_kWh_daily = flow.get (\"vtr300_tilfort_kWh_daily_Kr\",\"storeInFile\");     // Daglig tilført energi i Kr.\nvar Kr_kWh_weekly = flow.get (\"vtr300_tilfort_kWh_weekly_Kr\",\"storeInFile\");   // Ukentlig tilført energi i Kr.\nvar Kr_kWh_monthly = flow.get (\"vtr300_tilfort_kWh_monthly_Kr\",\"storeInFile\"); // Månedlig tilført energi i Kr.\nvar Kr_kWh_yearly = flow.get (\"vtr300_tilfort_kWh_yearly_Kr\",\"storeInFile\");   // Årlig tilført energi i Kr.\nvar Kr_kWh_total = flow.get (\"vtr300_tilfort_kWh_total_Kr\",\"storeInFile\");     // Total tilført energi i Kr.\n\n//Flytter siste verdi for Kr/kWh tellere fra temp. variable til memory, kalkulasjon fortsetter med siste lagrede verdi.\nflow.set(\"vtr300_tilfort_kWh_daily_Kr\", Kr_kWh_daily,\"default\");     // Daglig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_weekly_Kr\", Kr_kWh_weekly,\"default\");   // Ukentlig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_monthly_Kr\", Kr_kWh_monthly,\"default\"); // Månedlig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_yearly_Kr\", Kr_kWh_yearly,\"default\");   // Årlig tilført energi i Kr.\nflow.set(\"vtr300_tilfort_kWh_total_Kr\", Kr_kWh_total,\"default\");     // Total tilført energi i Kr.\n\n// ---------------------------------------------------------------------------------------------------------\n//---------------------- kWh - Forbruk ---------------------------------------------------------------------\n// ---------------------------------------------------------------------------------------------------------\n//Restorer siste verdi for kWh tellere fra fil til temp. variable (Skjer ved restart av Node Red eller host).\nvar kWh_forbruk_daily = flow.get (\"vtr300_forbruk_kWh_daily\",\"storeInFile\")           // Daglig energiforbruk i kWh.\nvar kWh_forbruk_daily_Kr = flow.get (\"vtr300_forbruk_kWh_daily_Kr\",\"storeInFile\")     // Daglig energiforbruk i Kr.\nvar kWh_forbruk_weekly = flow.get (\"vtr300_forbruk_kWh_weekly\",\"storeInFile\")         // Ukentlig energiforbruk i kWh.\nvar kWh_forbruk_weekly_Kr = flow.get (\"vtr300_forbruk_kWh_weekly_Kr\",\"storeInFile\")   // Ukentlig energiforbruk i Kr.\nvar kWh_forbruk_monthly = flow.get (\"vtr300_forbruk_kWh_monthly\",\"storeInFile\")       // Månedlig energiforbruk i kWh.\nvar kWh_forbruk_monthly_Kr = flow.get (\"vtr300_forbruk_kWh_monthly_Kr\",\"storeInFile\") // Månedlig energiforbruk i Kr.\nvar kWh_forbruk_yearly = flow.get (\"vtr300_forbruk_kWh_yearly\",\"storeInFile\")         // Årlig energiforbruk i kWh.\nvar kWh_forbruk_yearly_Kr = flow.get (\"vtr300_forbruk_kWh_yearly_Kr\",\"storeInFile\")   // Årlig energiforbruk i Kr.\nvar kWh_forbruk_total = flow.get (\"vtr300_forbruk_kWh_total\",\"storeInFile\")           // Total energiforbruk i kWh.\nvar kWh_forbruk_total_Kr = flow.get (\"vtr300_forbruk_kWh_total_Kr\",\"storeInFile\")     // Total energiforbruk i Kr.\n\n//Flytter siste verdi for kWh tellere fra temp. variable til memory, kalkulasjon fortsetter med siste lagrede verdi.\nflow.set(\"vtr300_forbruk_kWh_daily\", kWh_forbruk_daily,\"default\");           // Daglig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_daily_Kr\", kWh_forbruk_daily_Kr,\"default\"); // Daglig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_weekly\", kWh_forbruk_weekly,\"default\");         // Ukentlig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_weekly_Kr\", kWh_forbruk_weekly_Kr,\"default\");   // Ukentlig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_monthly\", kWh_forbruk_monthly,\"default\");       // Månedlig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_monthly_Kr\", kWh_forbruk_monthly_Kr,\"default\"); // Månedlig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_yearly\", kWh_forbruk_yearly,\"default\");         // Årlig energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_yearly_Kr\", kWh_forbruk_yearly_Kr,\"default\");   // Årlig energiforbruk i Kr.\nflow.set(\"vtr300_forbruk_kWh_total\", kWh_forbruk_total,\"default\");           // Total energiforbruk i kWh.\nflow.set(\"vtr300_forbruk_kWh_total_Kr\", kWh_forbruk_total_Kr,\"default\");     // Total energiforbruk i Kr.\n\n\n//msg.payload = kWh_total;\n//return msg;","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1900,"y":3520,"wires":[]},{"id":"3a467785.109448","type":"inject","z":"c1e03843.9d14a8","name":"Restart Poll","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"2","topic":"","payload":"","payloadType":"date","x":1690,"y":3520,"wires":[["a13e50be.66fea"]]},{"id":"a65fa074.2503e","type":"cronplus","z":"c1e03843.9d14a8","name":"Day, Week, Md, Year shift","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"fanOut","outputs":6,"options":[{"name":"schedule daily","topic":"Daily trigger","payloadType":"global","payload":"Day_shift","expressionType":"cron","expression":"0 0 0 * * ? *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"},{"name":"schedule weekly","topic":"Weekly trigger","payloadType":"global","payload":"Week_shift","expressionType":"cron","expression":"0 59 23 ? * SUN *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"},{"name":"schedule monthly","topic":"Monthly trigger","payloadType":"global","payload":"Month_shift","expressionType":"cron","expression":"0 0 0 1 * ? *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"},{"name":"schedule yearly","topic":"Yearly trigger","payloadType":"global","payload":"Year_shift","expressionType":"cron","expression":"0 0 0 1 1 ? *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":1950,"y":4360,"wires":[["263c47fc.4d2ef8"],["bab332ac.0320a"],["932e3af7.dbd2e8"],["86bcd183c012ac47"],[],[]]},{"id":"bd4e4e37.d39f2","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført effekt [kW]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kw"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":"mdi:lightning-bolt-circle"},{"property":"unit_of_measurement","value":"kW"}],"state":"payload","stateType":"msg","attributes":[{"property":"Tilført effekt - Estimert","value":"vtr300_tilført_kWatt_formated","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2370,"y":3700,"wires":[[]]},{"id":"8394587.fcfb7a8","type":"function","z":"c1e03843.9d14a8","name":"Kalk.: Faktisk tilført [W,kW]","func":"\nvar watts_consumption = msg.payload;\nvar Watt_delivered = flow.get (\"vtr300_tilfort_Watt\",\"default\");   // Tilført effekt Watt estimert.\nvar kWatt_delivered = flow.get (\"vtr300_tilfort_kWatt\",\"default\"); // Tilført effekt kW estimert.\n\n// Faktisk effekt produsert (produsert - levert)\nvar true_produced_Watts = Watt_delivered - watts_consumption;\nvar true_produced_kW = kWatt_delivered - (watts_consumption/1000);\n\n// Faktisk effekt produsert, tilpasse data ut\nvar true_produced_Watts_out = {payload:(true_produced_Watts).toFixed(0)};\nvar true_produced_kW_out = {payload:(true_produced_kW).toFixed(2)};\n\nreturn [true_produced_Watts_out,true_produced_kW_out];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1960,"y":3700,"wires":[["40bd7b43.553104"],["38a3c7ad.ec8a68"]],"inputLabels":["Watt - Forbruk fra TP link"],"outputLabels":["Faktisk tilført watt - Estimert (Levert - Forbruk)","Faktisk tilført kW - Estimert (Levert - Forbruk)"],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"df1cf085.1899c","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført effekt [W]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_watt"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":"mdi:lightning-bolt-circle"},{"property":"unit_of_measurement","value":"W"}],"state":"payload","stateType":"msg","attributes":[{"property":"Tilført effekt - Estimert","value":"vtr300_tilført_Watt_formated","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2360,"y":3660,"wires":[[]]},{"id":"6ec7c6c.8a2e638","type":"function","z":"c1e03843.9d14a8","name":"Kalk. dag [kWt & Kr]","func":"\nvar Watt_forbruk = msg.payload;\nvar Strompris_tot_kr_kWt = global.get (\"Strompris_tot_kr_kWt\",\"default\");         // Nordpool summert timespris.\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (Kom. feil/sensor feil etc.) tidlig \"exit\" (prøv igjen).\n  if (isNaN(Watt_forbruk) || isNaN(Strompris_tot_kr_kWt)) {\n    return;\n  }\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh --------------------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_forbruk_daily_10s = (Watt_forbruk/1000)/360;                       // Watt --> kW, må polles hvert 10s pga. kW/10s.\nvar kWh_tilfort_daily = flow.get (\"vtr300_tilfort_kWh_daily\",\"default\");   // Daglig tilført energi, opprettet i node \"Kalk.: Tilført Kr kW/10s\".\nvar Previous_forbruk_kWh = flow.get (\"vtr300_forbruk_kWh_daily\",\"default\") // Daglig energiforbruk.\nvar kWh_forbruk_daily;  \n\n// Energiforbruk - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh == undefined) { \n  kWh_forbruk_daily = 0;\n}\n// Energiforbruk - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_daily = Previous_forbruk_kWh + kWh_forbruk_daily_10s; \n}\n\nflow.set(\"vtr300_forbruk_kWh_daily\", kWh_forbruk_daily, \"default\"); // Enegiforbruk kWh - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh daily ------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_faktisk_tilfort_daily = kWh_tilfort_daily - kWh_forbruk_daily; \nflow.set(\"vtr300_fakt_tilfort_kWh_daily\", kWh_faktisk_tilfort_daily, \"default\");\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh daily i Kr ---------------------------------\n//-------------------------------------------------------------------------------\nvar Previous_forbruk_kWh_Kr = flow.get (\"vtr300_forbruk_kWh_daily_Kr\",\"default\"); // Daglig energiforbruk i Kr.\nvar forbruk_daily_Kr_kW_10s = kWh_forbruk_daily_10s * Strompris_tot_kr_kWt;       // kWh forbruk i Kr/10s.\nvar kWh_forbruk_daily_Kr;\n\n// Energiforbruk i Kr - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh_Kr == undefined) { \n  kWh_forbruk_daily_Kr = 0;\n}\n// Energiforbruk i Kr - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_daily_Kr = Previous_forbruk_kWh_Kr + forbruk_daily_Kr_kW_10s; // Akkumulerer forrige verdi med ny verdi \n}\n\nflow.set(\"vtr300_forbruk_kWh_daily_Kr\", kWh_forbruk_daily_Kr, \"default\");   // Energiforbruk i Kr - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh daily i Kr ------------------------- (forbr. kWh i Kr - Tilført kWh i Kr).\n//-------------------------------------------------------------------------------\nvar kWh_tilfort_daily_Kr = flow.get (\"vtr300_tilfort_kWh_daily_Kr\",\"default\");   // Tilført kWh daily i Kr.\nvar kWh_faktisk_tilfort_daily_Kr = kWh_tilfort_daily_Kr - kWh_forbruk_daily_Kr; \nflow.set(\"vtr300_fakt_tilfort_kr_daily\", kWh_faktisk_tilfort_daily_Kr, \"default\");\n\n//-------------------------------------------------------------------------------\n//---------------------- Pday --------------------------------------------------- (Data forrige dag).\n//-------------------------------------------------------------------------------\n// Get Pday\n// Forbruk day & Pday avleses fra TP-link, derfor ikke her.\nvar tilfort_kWh_pday= flow.get (\"vtr300_tilfort_kWh_pday\",\"storeInFile\");            // GET - Pday - Tilfort kWt \nvar fakt_tilfort_kWh_pday = flow.get (\"vtr300_fakt_tilfort_kWh_pday\",\"storeInFile\"); // GET - Pday - Faktisk tilfort kWt\nvar forbruk_kr_pday = flow.get (\"vtr300_forbruk_kr_pday\",\"storeInFile\");             // GET - Pday - Forbruk Kr\nvar tilfort_kr_pday = flow.get (\"vtr300_tilfort_kr_pday\",\"storeInFile\");             // GET - Pday - Tilfort Kr\nvar fakt_tilfort_kr_pday= flow.get (\"vtr300_fakt_tilfort_kr_pday\",\"storeInFile\");    // GET - Pday - Faktisk tilfort Kr\nvar daily_rst_time= flow.get (\"vtr300_daily_rst_time\",\"storeInFile\");                // GET - Pday - Siste tidspunkt for reset\n\n//Initilialiser Pday dersom udefinert.\nif (typeof tilfort_kWh_pday == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kWh_pday\", 'Not set',\"storeInFile\");      // Initialize - Pday - Tilfort kWt \nif (typeof fakt_tilfort_kWh_pday == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kWh_pday\", 'Not set',\"storeInFile\"); // Initialize - Pday - Faktisk tilfort kWt\nif (typeof forbruk_kr_pday == \"undefined\") //Forrige_0\nflow.set(\"vtr300_forbruk_kr_pday\", 'Not set',\"storeInFile\");       // Initialize - Pday - Forbruk Kr\nif (typeof tilfort_kr_pday == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kr_pday\", 'Not set',\"storeInFile\");       // Initialize - Pday - Tilfort Kr\nif (typeof fakt_tilfort_kr_pday == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kr_pday\", 'Not set',\"storeInFile\");  // Initialize - Pday - Faktisk tilfort Kr\nif (typeof daily_rst_time == \"undefined\") //Forrige_0\nflow.set(\"vtr300_daily_rst_time\", 'Not reset',\"storeInFile\");      // Initialize - Pday - Siste tidspunkt for reset\n\n//-------------------------------------------------------------------------------\n//---------------------- Utgangs verdier ---------------------------------------- \n//-------------------------------------------------------------------------------\n\n// Energi forbruk, tilført og kostnads beregninger\nvar msg1 = {payload:parseFloat((kWh_forbruk_daily_Kr).toFixed(1))};         // Daglig energiforbruk i Kr.\nvar msg2 = {payload:parseFloat((kWh_tilfort_daily_Kr).toFixed(1))};         // Tilført energi i Kr.\nvar msg3 = {payload:parseFloat((kWh_tilfort_daily).toFixed(1))};            // Tilført energi.i kWh.\nvar msg4 = {payload:parseFloat((kWh_faktisk_tilfort_daily_Kr).toFixed(1))}; // Daglig faktisk tilført energi i Kr.\nvar msg5 = {payload:parseFloat((kWh_faktisk_tilfort_daily).toFixed(1))};    // Daglig faktisk tilført energi i kWh.\nvar msg6 = {payload:parseFloat((kWh_forbruk_daily).toFixed(3))};            // TEST FORBRUK DAGLIG\n\nreturn [msg1,msg2,msg3,msg4,msg5,msg6];","outputs":6,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1940,"y":3760,"wires":[["4ba91728.44a578"],["687d5b6b.008b54"],["8a04455f.07fdb8"],["7a7722e2.62a61c"],["4f0c40fe.a1e5f"],["25ac3c03.d7e744"]],"outputLabels":["Kr - Forbruk daily","Kr - Tilført daily ","KWh - Tilført daily ","Kr - Faktisk tilført daily (Tilført - Forbruk)","kWh - Faktisk tilført daily (Tilført - Forbruk)",""],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"8a04455f.07fdb8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført i dag [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_daily"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige dag","value":"#:(storeInFile)::vtr300_tilfort_kWh_pday","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_daily_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2530,"y":3820,"wires":[[]]},{"id":"acc7fc7.7d032","type":"function","z":"c1e03843.9d14a8","name":"kWt tellere","func":"// Polles hvert 10s pga. payload = \"kW/10s\".\n\nvar kW_10s = msg.payload;\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (opretting av kom./feil sensor data) tidlig \"exit\" (prøv igjen).\n  if (isNaN(kW_10s)) {\n    return;\n  }\n  \nvar Previous_kWh_total = flow.get (\"vtr300_tilfort_kWh_total\",\"default\");     // Total eneregiteller - Flytter siste akkumulerte verdi til forrige verdi.\nvar Previous_kWh_daily = flow.get (\"vtr300_tilfort_kWh_daily\",\"default\");     // Daglig energi.\nvar Previous_kWh_weekly = flow.get (\"vtr300_tilfort_kWh_weekly\",\"default\");   // Ukentlig energi.\nvar Previous_kWh_monthly = flow.get (\"vtr300_tilfort_kWh_monthly\",\"default\"); // Månedlig energi.\nvar Previous_kWh_yearly = flow.get (\"vtr300_tilfort_kWh_yearly\",\"default\");   // Årlig energi.\n\nvar kWh_total;\nvar kWh_daily;\nvar kWh_weekly;\nvar kWh_monthly;\nvar kWh_yearly;\n\nflow.set(\"vtr300_tilfort_kW_10s\", kW_10s,\"default\");   // Energi levert/produsert i kW/10s, lagres i mem. for videre energi kosntads beregninger.\n\n// Totalteller energi - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_kWh_total == undefined) { \n  kWh_total = 0;\n}\n// Totalteller energi - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_total = Previous_kWh_total + kW_10s;\n}\n\n// Daglig energi - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_kWh_daily == undefined) { \n  kWh_daily = 0;\n}\n// Daglig energi - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_daily = Previous_kWh_daily + kW_10s;\n}\n\n// Ukentlig energi - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_kWh_weekly == undefined) { \n  kWh_weekly = 0;\n}\n// Ukentlig energi - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_weekly = Previous_kWh_weekly + kW_10s;\n}\n\n// Månedlig energi - Initilialiser verdi dersom udefinert/fã�rste gang verdi settes.\nif (Previous_kWh_monthly == undefined) { \n  kWh_monthly = 0;\n}\n// Månedlig energi - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_monthly = Previous_kWh_monthly + kW_10s;\n}\n\n// Årlig energi - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_kWh_yearly == undefined) { \n  kWh_yearly = 0;\n}\n// Årlig energi - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_yearly = Previous_kWh_yearly + kW_10s;\n}\n\n//Oppdaterer med nyeste akkumulerte verdi (Scantid må være 10s pga. mottatt verdi er kW/10s).\nflow.set(\"vtr300_tilfort_kWh_total\", kWh_total,\"default\");     // Total eneregiteller - Akkumulering i \"memory/default\", restore fra \"file\".\nflow.set(\"vtr300_tilfort_kWh_daily\", kWh_daily,\"default\");     // Daglig energi - Akkumulert.\nflow.set(\"vtr300_tilfort_kWh_weekly\", kWh_weekly,\"default\");   // Ukentlig energi - Akkumulert.\nflow.set(\"vtr300_tilfort_kWh_monthly\", kWh_monthly,\"default\"); // Månedlig energi - Akkumulert.\nflow.set(\"vtr300_tilfort_kWh_yearly\", kWh_yearly,\"default\");   // Årlig energi - Akkumulert.\n\n//var kW_10s_out = {payload:kW_10s};\n//var kWh_daily_out = {payload:kWh_daily};\n//var kWh_weekly_out = {payload:kWh_weekly};\n//var kWh_monthly_out = {payload:kWh_monthly};\n//var kWh_yearly_out = {payload:kWh_yearly};\n//var kWh_total_out = {payload:kWh_total};\n\n// Tilpasser desimaler og benevnelse for attribute visning i HA\nflow.set(\"vtr300_tilfort_kWh_total_formated\", (kWh_total).toFixed(2) +' kWh',\"default\");     // Lagrer tilført kW til \"memory/default\".\nflow.set(\"vtr300_tilfort_kWh_daily_formated\", (kWh_daily).toFixed(2) +' kWh',\"default\");     // Lagrer tilført kW til \"memory/default\".\nflow.set(\"vtr300_tilfort_kWh_weekly_formated\", (kWh_weekly).toFixed(2) +' kWh',\"default\");   // Lagrer tilført kW til \"memory/default\".\nflow.set(\"vtr300_tilfort_kWh_monthly_formated\", (kWh_monthly).toFixed(2) +' kWh',\"default\"); // Lagrer tilført kW til \"memory/default\".\nflow.set(\"vtr300_tilfort_kWh_yearly_formated\", (kWh_yearly).toFixed(2) +' kWh',\"default\");   // Lagrer tilført kW til \"memory/default\".\n\n//return [kW_10s_out,kWh_daily_out,kWh_weekly_out,kWh_monthly_out,kWh_yearly_out,kWh_total_out];\n","outputs":0,"noerr":0,"initialize":"","finalize":"","x":2110,"y":3600,"wires":[]},{"id":"10434896.ee7627","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført effekt [W]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_watt"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":"mdi:lightning-bolt-circle"},{"property":"unit_of_measurement","value":"W"}],"state":"payload","stateType":"msg","attributes":[{"property":"","value":"","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2280,"y":3560,"wires":[[]]},{"id":"d74766ef.151988","type":"function","z":"c1e03843.9d14a8","name":"Kalk.: Tilført [W,kW,kW/10s]","func":"// hs := cp*ρ*q*dt   \n// Eks.= (1.006 kJ/kg°C) (1.202 kg/m3) (1 m3/s) ((20°C) - (0°C)) \n\n//hs := sensible heat (kW)\n//cp := specific heat of air (1.006 kJ/kg°C)\n//p  := density of air (1.202 kg/m3)  or \"press/(Rspecific*t)\"\n//q  := air volume flow (m3/s)\n//dt := delta temperature delta [°C]\n//press  := absolute pressure (Pa)\n//t  := absolute temperature (kelvin)\n//Rspecific := specific gas constant for dry air (J/(kg'K)) [Rspec]\n\n\nvar q_pv = flow.get (\"vtr300_tilluftsvifte_pv\",\"default\");\nvar t_supply = flow.get (\"vtr300_tillufts_temperatur\",\"default\");\nvar t_inlet = flow.get (\"vtr300_inntak_temp\",\"default\");\nvar press = 101325;\nvar t = t_inlet + 273.15;\nvar Rspec = 287;\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (opretting av Modbus kom./feil sensor data) tidlig \"exit\" (prÝ��v igjen).\n  if (isNaN(q_pv) || isNaN(t_supply) || isNaN(t_inlet) || isNaN(t)) {\n    return;\n  }\n\nvar cp = 1.006;\n//var p = 1.202; \nvar p = press/(Rspec*t);\nvar q = (q_pv * 3)/3600;  \nvar dt = t_supply - t_inlet;\nvar hs = cp*p*q*dt;\n\n// Lagrer watt og kW til memory for videreberegning av faktisk levert estimert effekt\nflow.set(\"vtr300_tilfort_Watt\", hs*1000,\"default\");  // Lagrer tilført kW til \"memory/default\"\nflow.set(\"vtr300_tilfort_kWatt\", hs,\"default\");  // Lagrer tilført kW til \"memory/default\"\n\n// Estimert levert effekt & energi total\nvar watt = {payload:(hs*1000).toFixed(0)};\nvar kW = {payload:(hs).toFixed(2)};\nvar kW_10s = {payload:(hs/360)}; // kW/10s\n\n// Tilpasser desimaler for attribute visning i HA\nflow.set(\"vtr300_tilfort_Watt_formated\", (hs*1000).toFixed(0) +' Watt',\"default\");  // Lagrer tilført kW til \"memory/default\"\nflow.set(\"vtr300_tilfort_kWatt_formated\", (hs).toFixed(2) +' kW',\"default\");  // Lagrer tilført kW til \"memory/default\"\n\nreturn [watt,kW,kW_10s];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":1900,"y":3580,"wires":[["5e4c0ffa.22bd6"],[],["acc7fc7.7d032"]],"outputLabels":["Watt - Estimert","kW - Estimert","kW/10s - Estimert "]},{"id":"11239bcd.692034","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_x1","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":960,"wires":[[]]},{"id":"1879837f.02600d","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_x2","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":1000,"wires":[[]]},{"id":"c1b75b86.eef0d8","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_x3","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":1040,"wires":[[]]},{"id":"e0758a2f.f14c78","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_x4","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":1080,"wires":[[]]},{"id":"1c3629b2.63e5d6","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_x5","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":1120,"wires":[[]]},{"id":"32e867e4.bc5db8","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_x6","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":1160,"wires":[[]]},{"id":"6ad9ba0f.f22ae4","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_y1","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":960,"wires":[[]]},{"id":"7273e889.fb06a8","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_y2","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":1000,"wires":[[]]},{"id":"89162f23.efcda","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_y3","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":1040,"wires":[[]]},{"id":"14d97de0.64b642","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_y4","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":1080,"wires":[[]]},{"id":"9cc44202.79f7f","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_y5","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":1120,"wires":[[]]},{"id":"329b5775.d9bda8","type":"change","z":"c1e03843.9d14a8","name":"SP to Mem.","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_y6","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":1160,"wires":[[]]},{"id":"80df6da6.17582","type":"function","z":"c1e03843.9d14a8","name":"Kalk.: utekomp [°C]","func":"//  X  :Y(ute temp) og X (ønsket tilluft) plot:\n//  X1 :5,0,\tY6 :22,0 (Eks.) - Slope 1\n//  X2 :7,5,\tY5 :21,0 (Eks.) - Slope 1\n//  X3 :10,0,\tY4 :20,0 (Eks.) - Slope 2\n//  X4 :12,5,\tY3 :18,0 (Eks.) - Slope 2\n//  X5 :15,0,\tY2 :17,0 (Eks.) - Slope 3\n//  X6 :20,0,\tY1 :15,0 (Eks.) - Slope 3\n\n// Slope = \"change in Y/change in X=deltaY/deltaX\"\n\nvar x= msg.payload; // utetemp.\nvar Y_output;       // Ønsket tilluftstemp.\n\n// Utetmp plot:\nvar X1 = flow.get (\"vtr300_tilluftstemp_utekomp_x1\",\"default\");   // Henter settpunkt fra HA, lagrer i memory.\nvar X2 = flow.get (\"vtr300_tilluftstemp_utekomp_x2\",\"default\");\nvar X3 = flow.get (\"vtr300_tilluftstemp_utekomp_x3\",\"default\");\t\nvar X4 = flow.get (\"vtr300_tilluftstemp_utekomp_x4\",\"default\");\t\nvar X5 = flow.get (\"vtr300_tilluftstemp_utekomp_x5\",\"default\");\t\nvar X6 = flow.get (\"vtr300_tilluftstemp_utekomp_x6\",\"default\");\n\n// Ønsket tillufts temp. plot:\nvar Y6 = flow.get (\"vtr300_tilluftstemp_utekomp_y6\",\"default\");   // Henter settpunkt fra HA, lagrer i memory.\nvar Y5 = flow.get (\"vtr300_tilluftstemp_utekomp_y5\",\"default\"); \nvar Y4 = flow.get (\"vtr300_tilluftstemp_utekomp_y4\",\"default\"); \nvar Y3 = flow.get (\"vtr300_tilluftstemp_utekomp_y3\",\"default\"); \nvar Y2 = flow.get (\"vtr300_tilluftstemp_utekomp_y2\",\"default\"); \nvar Y1 = flow.get (\"vtr300_tilluftstemp_utekomp_y1\",\"default\"); \n\nvar slope_1 = (Y6-Y5)/(X1-X2); // Kalk. stigning \nvar slope_2 = (Y5-Y4)/(X2-X3);\nvar slope_3 = (Y4-Y3)/(X3-X4);\nvar slope_4 = (Y3-Y2)/(X4-X5);\nvar slope_5 = (Y2-Y1)/(X5-X6);\n\nvar Y_out_1 = Y6+slope_1*(x-X1); // Kalk. linje (Y1 --> Y2) \nvar Y_out_2 = Y5+slope_2*(x-X2); // Kalk. linje (Y2 --> Y3)  \nvar Y_out_3 = Y4+slope_3*(x-X3); // Kalk. linje (Y3 --> Y4) \nvar Y_out_4 = Y3+slope_4*(x-X4); // Kalk. linje (Y4 --> Y5)  \nvar Y_out_5 = Y2+slope_5*(x-X5); // Kalk. linje (Y5 --> Y6)  \n\n// Sjekker for \"isNotNumber, ved \"isNan\" tidlig \"exit\" (ved evt. feil ved HA reconnect ell.) (prøv igjen).\n  if (isNaN(Y_out_1) || isNaN(Y_out_2) || isNaN(Y_out_3) || isNaN(Y_out_4) || isNaN(Y_out_5)) {\n    return;\n  }\n\n// Bruker Y6 som for max ytterpunkt (Utetemp < X1)\nif (x < X1) { \n  Y_output = Y6;\n}\n//Rak linje for Y1 & Y2 (Ved X1 & X2) \nelse if (x >= X1 && x < X2) { \n  Y_output = Y_out_1;\n}\n//Rak linje for Y2 & Y3 (Ved X2 & X3) \nelse if (x >= X2 && x < X3) { \n  Y_output = Y_out_2;\n}\n//Rak linje for Y3 & Y4 (Ved X3 & X4) \nelse if (x >= X3 && x < X4) { \n  Y_output = Y_out_3;\n}\n//Rak linje for Y4 & Y5 (Ved X4 & X5) \nelse if (x >= X4 && x < X5) { \n  Y_output = Y_out_4;\n}\n//Rak linje for Y5 & Y6  (Ved X5 & X6) \nelse if (x >= X5 && x <= X6) { \n  Y_output = Y_out_5;\n}\n// Bruker Y1 som min ytterpunkt (Utetemp > X6)\nelse if (x > X6) { \n  Y_output = Y1;\n}\n// Bruker Y6 som min ytterpunkt\nelse { \n  Y_output = Y6;\n}\n\nvar Y_output_out = {payload:parseFloat((Y_output).toFixed(1))}; // Kalkulert utekompensert tilluftstemperatur\nvar Selected_sensor_temp_out = {payload:(x).toFixed(1)};        // Aktiv sensor verdi før utekomp. beregning\n\nreturn [Y_output_out,Selected_sensor_temp_out];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1830,"y":1060,"wires":[["210d89c2.f42156","e33222af.3c2b4"],["e6312dd1.b7c4d"]],"outputLabels":["Kalkulert tilluftstemperatur",""]},{"id":"3d60227c.b332fe","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. X6","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_x6","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2390,"y":1160,"wires":[["32e867e4.bc5db8"]]},{"id":"786d97a1.c8c598","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. X5","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_x5","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2390,"y":1120,"wires":[["1c3629b2.63e5d6"]]},{"id":"549100a9.70e1","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. X4","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_x4","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2390,"y":1080,"wires":[["e0758a2f.f14c78"]]},{"id":"845cd951.bc5388","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. X3","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_x3","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2390,"y":1040,"wires":[["c1b75b86.eef0d8"]]},{"id":"c9c86432.41e2a8","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. X2","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_x2","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2390,"y":1000,"wires":[["1879837f.02600d"]]},{"id":"51bcf9d4.d5bba8","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. X1","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_x1","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2390,"y":960,"wires":[["11239bcd.692034"]]},{"id":"e0d9c94a.57b4b8","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. Y6","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_y6","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2710,"y":1160,"wires":[["329b5775.d9bda8"]]},{"id":"f5ad88a7.0544f8","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. Y5","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_y5","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2710,"y":1120,"wires":[["9cc44202.79f7f"]]},{"id":"5ad21e9f.f1d9c","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. Y4","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_y4","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2710,"y":1080,"wires":[["14d97de0.64b642"]]},{"id":"cabc4acb.bc5a68","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. Y3","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_y3","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2710,"y":1040,"wires":[["89162f23.efcda"]]},{"id":"6ee15ffd.afa5f","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. Y2","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_y2","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2710,"y":1000,"wires":[["7273e889.fb06a8"]]},{"id":"d18de4eb.cfb9e8","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp. Y1","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_number.vtr300_tilluftstemp_utekomp_y1","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":2710,"y":960,"wires":[["6ad9ba0f.f22ae4"]]},{"id":"26cd76b6.737b9a","type":"smooth","z":"c1e03843.9d14a8","name":"Avg.5 min","property":"payload","action":"mean","count":"30","round":"1","mult":"single","reduce":false,"x":1660,"y":1060,"wires":[["2024aeb.34ad552","80df6da6.17582"]]},{"id":"5e4c0ffa.22bd6","type":"smooth","z":"c1e03843.9d14a8","name":"Smooth","property":"payload","action":"mean","count":"20","round":"0","mult":"single","reduce":false,"x":2100,"y":3560,"wires":[["10434896.ee7627"]]},{"id":"40bd7b43.553104","type":"smooth","z":"c1e03843.9d14a8","name":"Smooth","property":"payload","action":"mean","count":"20","round":"0","mult":"single","reduce":false,"x":2180,"y":3660,"wires":[["df1cf085.1899c"]]},{"id":"38a3c7ad.ec8a68","type":"smooth","z":"c1e03843.9d14a8","name":"Smooth","property":"payload","action":"mean","count":"20","round":"2","mult":"single","reduce":false,"x":2180,"y":3700,"wires":[["bd4e4e37.d39f2"]]},{"id":"53ac02d7.780c5c","type":"poll-state","z":"c1e03843.9d14a8","name":"Netatmo outdoortemp.","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.netatmo_netatmo_indoor_outdoor_temperature","state_type":"num","halt_if":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"x":1340,"y":960,"wires":[["38b3a52c.29419a"]]},{"id":"df213ba5.bb9958","type":"function","z":"c1e03843.9d14a8","name":"Auto velg sensor","func":"// VTR300 inntakstemp. er montert over inngangsdør, ved åpen dør på vinteren kommer varm luft inn i inntaket og generere temp spikes.\n// Temp spikes er smí� men vil da påvirke feks. VTR300 utekompensert tilluftsreg. unødig. Netatmo Outddor_temp er derfor Pri. sensor.\n\nvar Netatmo_outdoor_temp = flow.get (\"Netatmo_outdoor_temp\",\"default\"); \nvar vtr300_inlet_temp = flow.get (\"vtr300_inntak_temp\",\"default\"); \nvar Outdoor_sensor_selected;\n\n// Bruker ingen sensorer dersom Netatmo utetemp. og VTR300 inntaks temp. feiler (returner og prøv igjen)  \n  if (isNaN(Netatmo_outdoor_temp) && isNaN(vtr300_inlet_temp)) {\n    return;\n  }  \n  \n// Netatmo pri. sensor aktiv dersom VTR300 inntakstemp. er \"NotNumber\".\nelse if (isNaN(vtr300_inlet_temp)) {\n  Outdoor_sensor_selected = Netatmo_outdoor_temp;\n}\n\n// VTR300 inntaks temp. sensor aktiv dersom Netatmo (Pri.) er \"NotNumber\".\nelse if (isNaN(Netatmo_outdoor_temp)) {\n  Outdoor_sensor_selected = vtr300_inlet_temp;\n}\n  \n// Netatmo Pri sensor valgt\nelse { \n  Outdoor_sensor_selected = Netatmo_outdoor_temp;\n}\n\nmsg.payload = parseFloat((Outdoor_sensor_selected).toFixed(1));\nreturn msg;  ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1060,"wires":[["26cd76b6.737b9a"]],"outputLabels":["Valgt utetemp sensor"]},{"id":"d78f1fea.4a916","type":"inject","z":"c1e03843.9d14a8","name":"Poll 10s","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1320,"y":1060,"wires":[["df213ba5.bb9958","e8510411.005ac8"]]},{"id":"3859d4a4.ec00bc","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"Netatmo_outdoor_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1780,"y":960,"wires":[["8bfcfa55.33fbb8"]]},{"id":"e8510411.005ac8","type":"function","z":"c1e03843.9d14a8","name":"Auto valgt sensor status","func":"// VTR300 inntakstemp. er montert over inngangsdør, ved åpen dør på vinteren kommer varm luft inn i inntaket og generere temp spikes.\n// Temp spikes er små men vil da påvirke feks. VTR300 utekompensert tilluftsreg. unødig. Netatmo Outddor_temp er derfor Pri. sensor.\n\nvar Netatmo_outdoor_temp = flow.get (\"Netatmo_outdoor_temp\",\"default\"); \nvar vtr300_inlet_temp = flow.get (\"vtr300_inntak_temp\",\"default\"); \nvar Outdoor_sensor_selected;\n\n\n// Begge sensorer feiler\n  if (isNaN(Netatmo_outdoor_temp) && isNaN(vtr300_inlet_temp)) {\n    Outdoor_sensor_selected = 'Netatmo & VTR300 sensor feil';\n  }\n\n// Netatmo pri. sensor aktiv dersom VTR300 inntakstemp. er \"NotNumber\" & er definert\nelse if (isNaN(vtr300_inlet_temp)) {\n  Outdoor_sensor_selected = 'Netatmo pri sensor aktiv';\n}\n\n// VTR300 inntaks temp. sensor aktiv dersom Netatmo (Pri.) er \"NotNumber\" & er definert\nelse if (isNaN(Netatmo_outdoor_temp)) {\n  Outdoor_sensor_selected = 'VTR300 sensor aktiv, netatmo feil!';\n}\n\n// Netatmo Pri sensor valgt\nelse { \n  Outdoor_sensor_selected = 'Netatmo pri sensor aktiv';\n}\n\nmsg.payload = Outdoor_sensor_selected;\nreturn msg; \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1510,"y":1100,"wires":[["854c33e6.200a2","8597f384.e2c1d"]],"outputLabels":["Valgt utetemp sensor"]},{"id":"8bfcfa55.33fbb8","type":"fixed-for","z":"c1e03843.9d14a8","name":"No change in 2hr.","casesensitive":false,"for":"2","units":"hr","continuous":false,"ondeploy":true,"x":1950,"y":960,"wires":[["7a493838.725b78"],[]]},{"id":"7a493838.725b78","type":"change","z":"c1e03843.9d14a8","name":"Delete flow","rules":[{"t":"delete","p":"Netatmo_outdoor_temp","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":2150,"y":960,"wires":[[]]},{"id":"854c33e6.200a2","type":"ha-entity","z":"c1e03843.9d14a8","name":"Utetemp sensor status","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Utetemp_sensor_status"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"Netatmo utetemp.","value":"Netatmo_outdoor_temp","valueType":"flow"},{"property":"VTR300 inntakstemp.","value":"vtr300_inntak_temp","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":1760,"y":1100,"wires":[[]]},{"id":"2024aeb.34ad552","type":"change","z":"c1e03843.9d14a8","name":"Utetemp - Set glob.flow","rules":[{"t":"set","p":"Glob_autovalgt_utetemp","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":1020,"wires":[[]]},{"id":"6b7519a3.e53438","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2200,"y":1160,"wires":[[]]},{"id":"433e02ea.3bb60c","type":"function","z":"c1e03843.9d14a8","name":"ALM: Utetemp. sensor feil","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Utetemperatur sensor auto valg\",\n     \"title\": msg.payload,\n  }\n}\nreturn msg;\n\n ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":1160,"wires":[["6b7519a3.e53438"]]},{"id":"e6312dd1.b7c4d","type":"ha-entity","z":"c1e03843.9d14a8","name":"Utetemp sensor valgt [°C]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Utetemp_sensor_valgt"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"mdi:thermometer"},{"property":"unit_of_measurement","value":"°C"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2190,"y":1100,"wires":[[]]},{"id":"38b3a52c.29419a","type":"switch","z":"c1e03843.9d14a8","name":"Number?","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"number","vt":"number"}],"checkall":"true","repair":false,"outputs":1,"x":1520,"y":960,"wires":[["6fc9f18.eb3cf1"]]},{"id":"6fc9f18.eb3cf1","type":"switch","z":"c1e03843.9d14a8","name":"!=","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":1650,"y":960,"wires":[["3859d4a4.ec00bc"]]},{"id":"8597f384.e2c1d","type":"switch","z":"c1e03843.9d14a8","name":"Pass ALM","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Netatmo pri sensor aktiv","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1640,"y":1160,"wires":[["ea49deff.b4c7"]]},{"id":"ea49deff.b4c7","type":"trigger","z":"c1e03843.9d14a8","name":"Rate 6Hr.","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"6","extend":false,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1780,"y":1160,"wires":[["433e02ea.3bb60c"]]},{"id":"7a7722e2.62a61c","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført i dag [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_daily_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige dag","value":"#:(storeInFile)::vtr300_fakt_tilfort_kr_pday","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_daily_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2540,"y":3860,"wires":[[]]},{"id":"2148a16.512935e","type":"function","z":"c1e03843.9d14a8","name":"Kalk.: Tilført [Kr]","func":"// Polles hvert 10s pga. akkumulering av \"kW_10s\" * \"Kr kWt\", 360 poll pr. time gir kWt * kWt pris gir energi kostnad/produksjon/tilfort.\n\nvar tilfort_kW_10s = flow.get (\"vtr300_tilfort_kW_10s\",\"default\"); // Energi levert/tilført i kW/10s.\n\n//var Strompris_tot_kr_kW_10s = global.get (\"Strompris_tot_Kr_kW_10s\",\"default\");  // Noordpool pris kW/10s.\nvar Strompris_tot_kr_kWt = global.get (\"Strompris_tot_kr_kWt\",\"default\");          // Noordpool + nettleie + påslag pris i kW/t.\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (Kom. feil/sensor feil etc.) tidlig \"exit\" (prøv igjen).\n  if (isNaN(tilfort_kW_10s) || isNaN(Strompris_tot_kr_kWt)) {\n    return;\n  }\n\n//var Kr_kW_10s = flow.get (\"vtr300_tilfort_Kr_kW_10s\",\"default\"); // Daglig energi\nvar Previous_tilfort_kWh_tot_Kr = flow.get (\"vtr300_tilfort_kWh_total_Kr\",\"default\");          // Total tilført energi kostnad - Flytter siste akkumulerte verdi til forrige verdi\nvar Previous_tilfort_kWh_daily_Kr = flow.get (\"vtr300_tilfort_kWh_daily_Kr\",\"default\");     // Daglig tilført energi kostnad.\nvar Previous_tilfort_kWh_weekly_Kr = flow.get (\"vtr300_tilfort_kWh_weekly_Kr\",\"default\");   // Ukentlig tilført energi kostnad.\nvar Previous_tilfort_kWh_monthly_Kr = flow.get (\"vtr300_tilfort_kWh_monthly_Kr\",\"default\"); // Månedlig tilført energi kostnad.\nvar Previous_tilfort_kWh_yearly_Kr = flow.get (\"vtr300_tilfort_kWh_yearly_Kr\",\"default\");   // Årlig tilført energi kostnad.\n\nvar tilfort_Kr_kW_10s = tilfort_kW_10s * Strompris_tot_kr_kWt; //Tilfô�rt/levert energi i Kr kW/10s\n\n\n// Total, daglig, ukentlig, månedlig & årlig tilført energiberegning (kun tilført, forbruk må trekkes fra).\nvar Kr_kWh_total;\nvar Kr_kWh_tot_daily;\nvar Kr_kWh_tot_weekly;\nvar Kr_kWh_tot_monthly;\nvar Kr_kWh_tot_yearly;\n\n// Totalteller energi kostnad - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_tilfort_kWh_tot_Kr == undefined) { \n  Kr_kWh_total = 0;\n}\n// Totalteller energi kostnad - Akkumulerer forrige verdi med ny verdi.\nelse {\n  Kr_kWh_total = Previous_tilfort_kWh_tot_Kr + tilfort_Kr_kW_10s;\n}\n\n// Daglig energi kostnad - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_tilfort_kWh_daily_Kr == undefined) { \n  Kr_kWh_tot_daily = 0;\n}\n// Daglig energi kostnad - Akkumulerer forrige verdi med ny verdi.\nelse {\n  Kr_kWh_tot_daily = Previous_tilfort_kWh_daily_Kr + tilfort_Kr_kW_10s;\n}\n\n// Ukentlig energi kostnad - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_tilfort_kWh_weekly_Kr == undefined) { \n  Kr_kWh_tot_weekly = 0;\n}\n// Ukentlig energi kostnad - Akkumulerer forrige verdi med ny verdi.\nelse {\n  Kr_kWh_tot_weekly = Previous_tilfort_kWh_weekly_Kr + tilfort_Kr_kW_10s;\n}\n\n// Månedlig energi kostnad - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_tilfort_kWh_monthly_Kr == undefined) { \n  Kr_kWh_tot_monthly = 0;\n}\n// MÓ�nedlig energi kostnad - Akkumulerer forrige verdi med ny verdi.\nelse {\n  Kr_kWh_tot_monthly = Previous_tilfort_kWh_monthly_Kr + tilfort_Kr_kW_10s;\n}\n\n// Årlig energi kostnad - Initilialiser verdi dersom udefinert/fÉ�rste gang verdi settes.\nif (Previous_tilfort_kWh_yearly_Kr == undefined) { \n  Kr_kWh_tot_yearly = 0;\n}\n// Årlig energi kostnad - Akkumulerer forrige verdi med ny verdi.\nelse {\n  Kr_kWh_tot_yearly = Previous_tilfort_kWh_yearly_Kr + tilfort_Kr_kW_10s;\n}\n\n//Oppdaterer med nyeste akkumulerte verdi (Scantid må være 10s pga. \"kW_10s\")\nflow.set(\"vtr300_tilfort_kWh_total_Kr\", Kr_kWh_total,\"default\");         // Total tilført eneregikostnads.\nflow.set(\"vtr300_tilfort_kWh_daily_Kr\", Kr_kWh_tot_daily,\"default\");     // Daglig tilført energikostnad.\nflow.set(\"vtr300_tilfort_kWh_weekly_Kr\", Kr_kWh_tot_weekly,\"default\");   // Ukentlig tilført energikostnad.\nflow.set(\"vtr300_tilfort_kWh_monthly_Kr\", Kr_kWh_tot_monthly,\"default\"); // Månedlig tilført energikostnad.\nflow.set(\"vtr300_tilfort_kWh_yearly_Kr\", Kr_kWh_tot_yearly,\"default\");   // Årlig tilført energikostnad.\n\n\n//var msg1 = {payload:Kr_kWh_tot_daily};\n//var msg2 = {payload:Kr_kWh_tot_weekly};\n//var msg3 = {payload:Kr_kWh_tot_monthly};\n//var msg4 = {payload:Kr_kWh_tot_yearly};\n//var msg5 = {payload:Kr_kWh_total};\n\n//return [msg1,msg2,msg3,msg4,msg5];","outputs":0,"noerr":0,"initialize":"","finalize":"","x":1860,"y":3640,"wires":[]},{"id":"4ba91728.44a578","type":"ha-entity","z":"c1e03843.9d14a8","name":"Forbruk i dag [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_forbruk_kwh_daily_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige dag","value":"#:(storeInFile)::vtr300_forbruk_kr_pday","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_daily_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2530,"y":3740,"wires":[[]]},{"id":"687d5b6b.008b54","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført i dag [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_daily_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige dag","value":"#:(storeInFile)::vtr300_tilfort_kr_pday","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_daily_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2520,"y":3780,"wires":[[]]},{"id":"4f0c40fe.a1e5f","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført i dag [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_daily"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige dag","value":"#:(storeInFile)::vtr300_fakt_tilfort_kWh_pday","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_daily_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2550,"y":3900,"wires":[[]]},{"id":"14d81d2d.8b0173","type":"poll-state","z":"c1e03843.9d14a8","name":"Effektforbruk (Poll 10s)","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"10","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":false,"entity_id":"sensor.tp_link_vtr300_watts","state_type":"num","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1700,"y":3700,"wires":[["8394587.fcfb7a8","6ec7c6c.8a2e638","3deea3af.23a94c","8c466545.274f78","1ed2f69c.f3a279","33fd88dc.00d3d8"]]},{"id":"951b7052.52372","type":"inject","z":"c1e03843.9d14a8","name":"Estimert kWt forbruk","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"vtr300_forbruk_kWh_daily","payloadType":"flow","x":2470,"y":3600,"wires":[["8fcf2d77.164f8"]]},{"id":"8fcf2d77.164f8","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2660,"y":3600,"wires":[]},{"id":"3deea3af.23a94c","type":"function","z":"c1e03843.9d14a8","name":"Kalk. uke [kWt & Kr]","func":"\nvar Watt_forbruk = msg.payload;\nvar Strompris_tot_kr_kWt = global.get (\"Strompris_tot_kr_kWt\",\"default\");         // Nordpool summert timespris.\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (Kom. feil/sensor feil etc.) tidlig \"exit\" (prøv igjen).\n  if (isNaN(Watt_forbruk) || isNaN(Strompris_tot_kr_kWt)) {\n    return;\n  }\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh --------------------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_forbruk_weekly_10s = (Watt_forbruk/1000)/360; // Watt --> kW, må polles hvert 10s pga. kW/10s.\nvar kWh_tilfort_weekly = flow.get (\"vtr300_tilfort_kWh_weekly\",\"default\");   // Tilført energi, opprettet i node \"Kalk.: Tilført Kr kW/10s\".\nvar Previous_forbruk_kWh = flow.get (\"vtr300_forbruk_kWh_weekly\",\"default\")  // Energiforbruk.\nvar kWh_forbruk_weekly;  \n\n// Energiforbruk - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh == undefined) { \n  kWh_forbruk_weekly = 0;\n}\n// Energiforbruk - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_weekly = Previous_forbruk_kWh + kWh_forbruk_weekly_10s; \n}\n\nflow.set(\"vtr300_forbruk_kWh_weekly\", kWh_forbruk_weekly, \"default\"); // Enegiforbruk kWh - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh weekly ------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_faktisk_tilfort_weekly = kWh_tilfort_weekly - kWh_forbruk_weekly; \nflow.set(\"vtr300_fakt_tilfort_kWh_weekly\", kWh_faktisk_tilfort_weekly, \"default\");\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh weekly i Kr ---------------------------------\n//-------------------------------------------------------------------------------\nvar Previous_forbruk_kWh_Kr = flow.get (\"vtr300_forbruk_kWh_weekly_Kr\",\"default\"); // Energiforbruk i Kr.\nvar forbruk_weekly_Kr_kW_10s = kWh_forbruk_weekly_10s * Strompris_tot_kr_kWt;      // kWh forbruk i Kr/10s.\nvar kWh_forbruk_weekly_Kr;\n\n// Energiforbruk i Kr - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh_Kr == undefined) { \n  kWh_forbruk_weekly_Kr = 0;\n}\n// Energiforbruk i Kr - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_weekly_Kr = Previous_forbruk_kWh_Kr + forbruk_weekly_Kr_kW_10s; // Akkumulerer forrige verdi med ny verdi \n}\n\nflow.set(\"vtr300_forbruk_kWh_weekly_Kr\", kWh_forbruk_weekly_Kr, \"default\");   // Energiforbruk i Kr - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh weekly i Kr ------------------------- (forbr. kWh i Kr - Tilført kWh i Kr).\n//-------------------------------------------------------------------------------\nvar kWh_tilfort_weekly_Kr = flow.get (\"vtr300_tilfort_kWh_weekly_Kr\",\"default\");   // Tilført kWh weekly i Kr.\nvar kWh_faktisk_tilfort_weekly_Kr = kWh_tilfort_weekly_Kr - kWh_forbruk_weekly_Kr; \nflow.set(\"vtr300_fakt_tilfort_kr_weekly\", kWh_faktisk_tilfort_weekly_Kr, \"default\");\n\n//-------------------------------------------------------------------------------\n//---------------------- Pweek --------------------------------------------------- (Data forrige dag).\n//-------------------------------------------------------------------------------\n// Get Pweek\n// Forbruk week & Pweek avleses fra TP-link, derfor ikke her.\nvar tilfort_kWh_pweek= flow.get (\"vtr300_tilfort_kWh_pweek\",\"storeInFile\");            // GET - pweek - Tilfort kWt \nvar fakt_tilfort_kWh_pweek = flow.get (\"vtr300_fakt_tilfort_kWh_pweek\",\"storeInFile\"); // GET - pweek - Faktisk tilfort kWt\nvar forbruk_kr_pweek = flow.get (\"vtr300_forbruk_kr_pweek\",\"storeInFile\");             // GET - pweek - Forbruk Kr\nvar tilfort_kr_pweek = flow.get (\"vtr300_tilfort_kr_pweek\",\"storeInFile\");             // GET - pweek - Tilfort Kr\nvar fakt_tilfort_kr_pweek= flow.get (\"vtr300_fakt_tilfort_kr_pweek\",\"storeInFile\");    // GET - pweek - Faktisk tilfort Kr\nvar weekly_rst_time = flow.get (\"vtr300_weekly_rst_time\",\"storeInFile\");               // GET - pweek - Siste tidspunkt for reset\n\n//Initilialiser Pweek dersom udefinert.\nif (typeof tilfort_kWh_pweek == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kWh_pweek\", 'Not set',\"storeInFile\");      // Initialize - Pweek - Tilfort kWt \nif (typeof fakt_tilfort_kWh_pweek == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kWh_pweek\", 'Not set',\"storeInFile\"); // Initialize - Pweek - Faktisk tilfort kWt\nif (typeof forbruk_kr_pweek == \"undefined\") //Forrige_0\nflow.set(\"vtr300_forbruk_kr_pweek\", 'Not set',\"storeInFile\");       // Initialize - Pweek - Forbruk Kr\nif (typeof tilfort_kr_pweek == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kr_pweek\", 'Not set',\"storeInFile\");       // Initialize - Pweek - Tilfort Kr\nif (typeof fakt_tilfort_kr_pweek == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kr_pweek\", 'Not set',\"storeInFile\");  // Initialize - Pweek - Faktisk tilfort Kr\nif (typeof weekly_rst_time == \"undefined\") //Forrige_0\nflow.set(\"vtr300_weekly_rst_time\", 'Not reset',\"storeInFile\");      // Initialize - Pweek - Siste tidspunkt for reset\n\n//-------------------------------------------------------------------------------\n//---------------------- Utgangs verdier ---------------------------------------- \n//-------------------------------------------------------------------------------\n\n// Energi forbruk, tilført og kostnads beregninger\nvar msg1 = {payload:parseFloat((kWh_forbruk_weekly_Kr).toFixed(1))};         // Ukentlig energiforbruk i Kr.\nvar msg2 = {payload:parseFloat((kWh_tilfort_weekly_Kr).toFixed(1))};         // Ukentlig tilført energi i Kr.\nvar msg3 = {payload:parseFloat((kWh_tilfort_weekly).toFixed(1))};            // Ukentlig tilført energi.i kWh.\nvar msg4 = {payload:parseFloat((kWh_faktisk_tilfort_weekly_Kr).toFixed(1))}; // Ukentlig faktisk tilført energi i Kr.\nvar msg5 = {payload:parseFloat((kWh_faktisk_tilfort_weekly).toFixed(1))};    // Ukentlig faktisk tilført energi i kWh.\nvar msg6 = {payload:parseFloat((kWh_forbruk_weekly).toFixed(3))};            // TEST FORBRUK UKE\n\nreturn [msg1,msg2,msg3,msg4,msg5,msg6];","outputs":6,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1940,"y":3860,"wires":[["177fb992.580186"],["dec83968.68cef8"],["a25c68da.78aa68"],["7d947e14.e06e1"],["64142d5b.e37e64"],["a4e5f79a.1a2068"]],"outputLabels":["Kr - Forbruk  weekly","Kr - Tilført weekly","KWh - Tilført weekly","Kr - Faktisk tilført weekly (Tilført - Forbruk)","kWh - Faktisk tilført weekly (Tilført - Forbruk)",""],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"8c466545.274f78","type":"function","z":"c1e03843.9d14a8","name":"Kalk. md [kWt & Kr]","func":"\nvar Watt_forbruk = msg.payload;\nvar Strompris_tot_kr_kWt = global.get (\"Strompris_tot_kr_kWt\",\"default\");         // Nordpool summert timespris.\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (Kom. feil/sensor feil etc.) tidlig \"exit\" (prøv igjen).\n  if (isNaN(Watt_forbruk) || isNaN(Strompris_tot_kr_kWt)) {\n    return;\n  }\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh --------------------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_forbruk_monthly_10s = (Watt_forbruk/1000)/360; // Watt --> kW, må polles hvert 10s pga. kW/10s.\nvar kWh_tilfort_monthly = flow.get (\"vtr300_tilfort_kWh_monthly\",\"default\");        // Tilført energi, opprettet i node \"Kalk.: Tilført Kr kW/10s\".\nvar Previous_forbruk_kWh = flow.get (\"vtr300_forbruk_kWh_monthly\",\"default\")        // Energiforbruk.\nvar kWh_forbruk_monthly;  \n\n// Energiforbruk - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh == undefined) { \n  kWh_forbruk_monthly = 0;\n}\n// Energiforbruk - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_monthly = Previous_forbruk_kWh + kWh_forbruk_monthly_10s; \n}\n\nflow.set(\"vtr300_forbruk_kWh_monthly\", kWh_forbruk_monthly, \"default\"); // Enegiforbruk kWh - Oppdaterer med nyeste akkumulerte verdi (scantid må vç�re 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh monthly ------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_faktisk_tilfort_monthly = kWh_tilfort_monthly - kWh_forbruk_monthly; \nflow.set(\"vtr300_fakt_tilfort_kWh_monthly\", kWh_faktisk_tilfort_monthly, \"default\");\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh monthly i Kr ---------------------------------\n//-------------------------------------------------------------------------------\nvar Previous_forbruk_kWh_Kr = flow.get (\"vtr300_forbruk_kWh_monthly_Kr\",\"default\"); // Energiforbruk i Kr.\nvar forbruk_monthly_Kr_kW_10s = kWh_forbruk_monthly_10s * Strompris_tot_kr_kWt;     // kWh forbruk i Kr/10s.\nvar kWh_forbruk_monthly_Kr;\n\n// Energiforbruk i Kr - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh_Kr == undefined) { \n  kWh_forbruk_monthly_Kr = 0;\n}\n// Energiforbruk i Kr - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_monthly_Kr = Previous_forbruk_kWh_Kr + forbruk_monthly_Kr_kW_10s; // Akkumulerer forrige verdi med ny verdi \n}\n\nflow.set(\"vtr300_forbruk_kWh_monthly_Kr\", kWh_forbruk_monthly_Kr, \"default\");   // Energiforbruk i Kr - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh monthly i Kr ------------------------- (forbr. kWh i Kr - Tilført kWh i Kr).\n//-------------------------------------------------------------------------------\nvar kWh_tilfort_monthly_Kr = flow.get (\"vtr300_tilfort_kWh_monthly_Kr\",\"default\");   // Tilført kWh monthly i Kr.\nvar kWh_faktisk_tilfort_monthly_Kr = kWh_tilfort_monthly_Kr - kWh_forbruk_monthly_Kr; \nflow.set(\"vtr300_fakt_tilfort_kr_monthly\", kWh_faktisk_tilfort_monthly_Kr, \"default\");\n\n//-------------------------------------------------------------------------------\n//---------------------- Pmonth ------------------------------------------------- (Data forrige md).\n//-------------------------------------------------------------------------------\n// Get Pmonth\n// Forbruk month & Pmonth avleses fra TP-link, derfor ikke her.\nvar tilfort_kWh_pmonth= flow.get (\"vtr300_tilfort_kWh_pmonth\",\"storeInFile\");            // GET - pmonth - Tilfort kWt \nvar fakt_tilfort_kWh_pmonth = flow.get (\"vtr300_fakt_tilfort_kWh_pmonth\",\"storeInFile\"); // GET - pmonth - Faktisk tilfort kWt\nvar forbruk_kr_pmonth = flow.get (\"vtr300_forbruk_kr_pmonth\",\"storeInFile\");             // GET - pmonth - Forbruk Kr\nvar tilfort_kr_pmonth = flow.get (\"vtr300_tilfort_kr_pmonth\",\"storeInFile\");             // GET - pmonth - Tilfort Kr\nvar fakt_tilfort_kr_pmonth= flow.get (\"vtr300_fakt_tilfort_kr_pmonth\",\"storeInFile\");    // GET - pmonth - Faktisk tilfort Kr\nvar monthly_rst_time = flow.get (\"vtr300_monthly_rst_time\",\"storeInFile\");               // GET - pmonth - Siste tidspunkt for reset\n\n//Initilialiser Pmonth dersom udefinert.\nif (typeof tilfort_kWh_pmonth == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kWh_pmonth\", 'Not set',\"storeInFile\");      // Initialize - pmonth - Tilfort kWt \nif (typeof fakt_tilfort_kWh_pmonth == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kWh_pmonth\", 'Not set',\"storeInFile\"); // Initialize - pmonth - Faktisk tilfort kWt\nif (typeof forbruk_kr_pmonth == \"undefined\") //Forrige_0\nflow.set(\"vtr300_forbruk_kr_pmonth\", 'Not set',\"storeInFile\");       // Initialize - pmonth - Forbruk Kr\nif (typeof tilfort_kr_pmonth == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kr_pmonth\", 'Not set',\"storeInFile\");       // Initialize - pmonth - Tilfort Kr\nif (typeof fakt_tilfort_kr_pmonth == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kr_pmonth\", 'Not set',\"storeInFile\");  // Initialize - pmonth - Faktisk tilfort Kr\nif (typeof monthly_rst_time == \"undefined\") //Forrige_0\nflow.set(\"vtr300_monthly_rst_time\", 'Not reset',\"storeInFile\");      // Initialize - pmonth - Siste tidspunkt for reset\n\n//-------------------------------------------------------------------------------\n//---------------------- Utgangs verdier ---------------------------------------- \n//-------------------------------------------------------------------------------\n\n// Energi forbruk, tilført og kostnads beregninger\nvar msg1 = {payload:parseFloat((kWh_forbruk_monthly_Kr).toFixed(1))};         // Md energiforbruk i Kr.\nvar msg2 = {payload:parseFloat((kWh_tilfort_monthly_Kr).toFixed(1))};         // Tilført energi i Kr.\nvar msg3 = {payload:parseFloat((kWh_tilfort_monthly).toFixed(1))};            // Tilført energi.i kWh.\nvar msg4 = {payload:parseFloat((kWh_faktisk_tilfort_monthly_Kr).toFixed(1))}; // Md faktisk tilført energi i Kr.\nvar msg5 = {payload:parseFloat((kWh_faktisk_tilfort_monthly).toFixed(1))};    // Md faktisk tilført energi i kWh.\nvar msg6 = {payload:parseFloat((kWh_forbruk_monthly).toFixed(3))};            // TEST FORBRUK MD\n\nreturn [msg1,msg2,msg3,msg4,msg5,msg6];","outputs":6,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1930,"y":3980,"wires":[["bd410a67.491828"],["b458cc5c.2e4eb"],["aa2ab891.90b6d8"],["24e8d904.7a8ac6"],["8ce9030c.549a2"],["132eb0cc.72ed1f"]],"outputLabels":["Kr - Forbruk  md.","Kr - Tilført md.","KWh - Tilført md.","Kr - Faktisk tilført md. (Tilført - Forbruk)","kWh - Faktisk tilført md. (Tilført - Forbruk)",""],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"1ed2f69c.f3a279","type":"function","z":"c1e03843.9d14a8","name":"Kalk. year [kWt & Kr]","func":"\nvar Watt_forbruk = msg.payload;\nvar Strompris_tot_kr_kWt = global.get (\"Strompris_tot_kr_kWt\",\"default\");         // Nordpool summert timespris.\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (Kom. feil/sensor feil etc.) tidlig \"exit\" (prøv igjen).\n  if (isNaN(Watt_forbruk) || isNaN(Strompris_tot_kr_kWt)) {\n    return;\n  }\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh --------------------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_forbruk_yearly_10s = (Watt_forbruk/1000)/360; // Watt --> kW, må polles hvert 10s pga. kW/10s.\nvar kWh_tilfort_yearly = flow.get (\"vtr300_tilfort_kWh_yearly\",\"default\");         // Tilført energi, opprettet i node \"Kalk.: Tilført Kr kW/10s\".\nvar Previous_forbruk_kWh = flow.get (\"vtr300_forbruk_kWh_yearly\",\"default\")        // Energiforbruk.\nvar kWh_forbruk_yearly;  \n\n// Energiforbruk - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh == undefined) { \n  kWh_forbruk_yearly = 0;\n}\n// Energiforbruk - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_yearly = Previous_forbruk_kWh + kWh_forbruk_yearly_10s; \n}\n\nflow.set(\"vtr300_forbruk_kWh_yearly\", kWh_forbruk_yearly, \"default\"); // Enegiforbruk kWh - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh yearly ------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_faktisk_tilfort_yearly = kWh_tilfort_yearly - kWh_forbruk_yearly; \nflow.set(\"vtr300_fakt_tilfort_kWh_yearly\", kWh_faktisk_tilfort_yearly, \"default\");\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh yearly i Kr ---------------------------------\n//-------------------------------------------------------------------------------\nvar Previous_forbruk_kWh_Kr = flow.get (\"vtr300_forbruk_kWh_yearly_Kr\",\"default\"); // Energiforbruk i Kr.\nvar forbruk_yearly_Kr_kW_10s = kWh_forbruk_yearly_10s * Strompris_tot_kr_kWt;      // kWh forbruk i Kr/10s.\nvar kWh_forbruk_yearly_Kr;\n\n// Energiforbruk i Kr - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh_Kr == undefined) { \n  kWh_forbruk_yearly_Kr = 0;\n}\n// Energiforbruk i Kr - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_yearly_Kr = Previous_forbruk_kWh_Kr + forbruk_yearly_Kr_kW_10s; // Akkumulerer forrige verdi med ny verdi \n}\n\nflow.set(\"vtr300_forbruk_kWh_yearly_Kr\", kWh_forbruk_yearly_Kr, \"default\");   // Energiforbruk i Kr - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh yearly i Kr ------------------------- (forbr. kWh i Kr - Tilført kWh i Kr).\n//-------------------------------------------------------------------------------\nvar kWh_tilfort_yearly_Kr = flow.get (\"vtr300_tilfort_kWh_yearly_Kr\",\"default\");   // Tilført kWh yearly i Kr.\nvar kWh_faktisk_tilfort_yearly_Kr = kWh_tilfort_yearly_Kr - kWh_forbruk_yearly_Kr; \nflow.set(\"vtr300_fakt_tilfort_kr_yearly\", kWh_faktisk_tilfort_yearly_Kr, \"default\");\n\n//-------------------------------------------------------------------------------\n//---------------------- Pyear ------------------------------------------------- (Data forrige år).\n//-------------------------------------------------------------------------------\n// Get Pyear\n// Forbruk month & Pyear avleses fra TP-link, derfor ikke her.\nvar tilfort_kWh_pyear= flow.get (\"vtr300_tilfort_kWh_pyear\",\"storeInFile\");            // GET - pyear - Tilfort kWt \nvar fakt_tilfort_kWh_pyear = flow.get (\"vtr300_fakt_tilfort_kWh_pyear\",\"storeInFile\"); // GET - pyear - Faktisk tilfort kWt\nvar forbruk_kr_pyear = flow.get (\"vtr300_forbruk_kr_pyear\",\"storeInFile\");             // GET - pyear - Forbruk Kr\nvar tilfort_kr_pyear = flow.get (\"vtr300_tilfort_kr_pyear\",\"storeInFile\");             // GET - pyear - Tilfort Kr\nvar fakt_tilfort_kr_pyear= flow.get (\"vtr300_fakt_tilfort_kr_pyear\",\"storeInFile\");    // GET - pyear - Faktisk tilfort Kr\nvar yearly_rst_time = flow.get (\"vtr300_yearly_rst_time\",\"storeInFile\");              // GET - pyear - Siste tidspunkt for reset\n\n//Initilialiser Pyear dersom udefinert.\nif (typeof tilfort_kWh_pyear == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kWh_pyear\", 'Not set',\"storeInFile\");      // Initialize - pyear - Tilfort kWt \nif (typeof fakt_tilfort_kWh_pyear == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kWh_pyear\", 'Not set',\"storeInFile\"); // Initialize - pyear - Faktisk tilfort kWt\nif (typeof forbruk_kr_pyear == \"undefined\") //Forrige_0\nflow.set(\"vtr300_forbruk_kr_pyear\", 'Not set',\"storeInFile\");       // Initialize - pyear - Forbruk Kr\nif (typeof tilfort_kr_pyear == \"undefined\") //Forrige_0\nflow.set(\"vtr300_tilfort_kr_pyear\", 'Not set',\"storeInFile\");       // Initialize - pyear - Tilfort Kr\nif (typeof fakt_tilfort_kr_pyear == \"undefined\") //Forrige_0\nflow.set(\"vtr300_fakt_tilfort_kr_pyear\", 'Not set',\"storeInFile\");  // Initialize - pyear - Faktisk tilfort Kr\nif (typeof monthly_rst_time == \"undefined\") //Forrige_0\nflow.set(\"vtr300_yearly_rst_time\", 'Not reset',\"storeInFile\");      // Initialize - pyear - Siste tidspunkt for reset\n\n//-------------------------------------------------------------------------------\n//---------------------- Utgangs verdier ---------------------------------------- \n//-------------------------------------------------------------------------------\n\n// Energi forbruk, tilført og kostnads beregninger\nvar msg1 = {payload:parseFloat((kWh_forbruk_yearly_Kr).toFixed(1))};         // Arlig energiforbruk i Kr.\nvar msg2 = {payload:parseFloat((kWh_tilfort_yearly_Kr).toFixed(1))};         // Tilført energi i Kr.\nvar msg3 = {payload:parseFloat((kWh_tilfort_yearly).toFixed(1))};            // Tilført energi.i kWh.\nvar msg4 = {payload:parseFloat((kWh_faktisk_tilfort_yearly_Kr).toFixed(1))}; // Arlig faktisk tilført energi i Kr.\nvar msg5 = {payload:parseFloat((kWh_faktisk_tilfort_yearly).toFixed(1))};    // Arlig faktisk tilført energi i kWh.\n\nreturn [msg1,msg2,msg3,msg4,msg5];","outputs":5,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1940,"y":4080,"wires":[["9314d73a.d55838"],["e6c7dd12.25def"],["f2f5881c.e438b8"],["fcd56e80.e3ebd"],["23b350ad.9d0d5"]],"outputLabels":["Kr - Forbruk  yearly","Kr - Tilført yearly","KWh - Tilført yearly","Kr - Faktisk tilført yearly (Tilført - Forbruk)","kWh - Faktisk tilført yearly (Tilført - Forbruk)"],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"a25c68da.78aa68","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført i uke [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige uke","value":"#:(storeInFile)::vtr300_tilfort_kWh_pweek","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_weekly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2250,"y":3820,"wires":[[]]},{"id":"7d947e14.e06e1","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført uke [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_weekly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige uke","value":"#:(storeInFile)::vtr300_fakt_tilfort_kr_pweek","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_weekly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2260,"y":3860,"wires":[[]]},{"id":"177fb992.580186","type":"ha-entity","z":"c1e03843.9d14a8","name":"Forbruk uke [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_forbruk_kwh_weekly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige uke","value":"#:(storeInFile)::vtr300_forbruk_kr_pweek","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_weekly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2240,"y":3740,"wires":[[]]},{"id":"dec83968.68cef8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført i uke [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_weekly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige uke","value":"#:(storeInFile)::vtr300_tilfort_kr_pweek","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_weekly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2240,"y":3780,"wires":[[]]},{"id":"64142d5b.e37e64","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført uke [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_weekly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige uke","value":"#:(storeInFile)::vtr300_fakt_tilfort_kWh_pweek","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_weekly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2260,"y":3900,"wires":[[]]},{"id":"aa2ab891.90b6d8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført md [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_monthly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige Md.","value":"#:(storeInFile)::vtr300_tilfort_kWh_pmonth","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_monthly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2520,"y":4040,"wires":[[]]},{"id":"24e8d904.7a8ac6","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført md [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_monthly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige Md.","value":"#:(storeInFile)::vtr300_fakt_tilfort_kr_pmonth","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_monthly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2540,"y":4080,"wires":[[]]},{"id":"bd410a67.491828","type":"ha-entity","z":"c1e03843.9d14a8","name":"Forbruk md [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_forbruk_kwh_monthly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige Md.","value":"#:(storeInFile)::vtr300_forbruk_kr_pmonth","valueType":"flow"},{"property":"Siste resatt","value":"#:(storeInFile)::vtr300_monthly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2520,"y":3960,"wires":[[]]},{"id":"b458cc5c.2e4eb","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført md [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_monthly_kr\t"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige Md.","value":"#:(storeInFile)::vtr300_tilfort_kr_pmonth","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_monthly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2520,"y":4000,"wires":[[]]},{"id":"8ce9030c.549a2","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført md [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_monthly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forrige Md.","value":"#:(storeInFile)::vtr300_fakt_tilfort_kWh_pmonth","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_monthly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2540,"y":4120,"wires":[[]]},{"id":"f2f5881c.e438b8","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført år [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Tilfort Pyear","value":"#:(storeInFile)::vtr300_tilfort_kWh_pyear","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_yearly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2240,"y":4040,"wires":[[]]},{"id":"fcd56e80.e3ebd","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført år [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_yearly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Fakt. tilfort Pyear","value":"","valueType":"flow"},{"property":"Sist resatt","value":"","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2250,"y":4080,"wires":[[]]},{"id":"9314d73a.d55838","type":"ha-entity","z":"c1e03843.9d14a8","name":"Forbruk år [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_forbruk_kwh_yearly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Forbruk Pyear","value":"#:(storeInFile)::vtr300_forbruk_kr_pyear","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_yearly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2240,"y":3960,"wires":[[]]},{"id":"e6c7dd12.25def","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført år [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_yearly_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[{"property":"Tilfort Pyear","value":"#:(storeInFile)::vtr300_tilfort_kr_pyear","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_yearly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2230,"y":4000,"wires":[[]]},{"id":"23b350ad.9d0d5","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført år [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_yearly"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[{"property":"Fakt. tilfort Pyear","value":"#:(storeInFile)::vtr300_fakt_tilfort_kWh_pyear","valueType":"flow"},{"property":"Sist resatt","value":"#:(storeInFile)::vtr300_yearly_rst_time","valueType":"flow"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2260,"y":4120,"wires":[[]]},{"id":"33fd88dc.00d3d8","type":"function","z":"c1e03843.9d14a8","name":"Kalk. total [kWt & Kr]","func":"\nvar Watt_forbruk = msg.payload;\nvar Strompris_tot_kr_kWt = global.get (\"Strompris_tot_kr_kWt\",\"default\");         // Nordpool summert timespris.\n\n// Sjekker for \"isNotNumber, ved \"isNan\" (Kom. feil/sensor feil etc.) tidlig \"exit\" (prøv igjen).\n  if (isNaN(Watt_forbruk) || isNaN(Strompris_tot_kr_kWt)) {\n    return;\n  }\n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh --------------------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_forbruk_total_10s = (Watt_forbruk/1000)/360; // Watt --> kW, må polles hvert 10s pga. kW/10s.\nvar kWh_tilfort_total = flow.get (\"vtr300_tilfort_kWh_total\",\"default\");          // Tilført energi, opprettet i node \"Kalk.: Tilført Kr kW/10s\".\nvar Previous_forbruk_kWh = flow.get (\"vtr300_forbruk_kWh_total\",\"default\")        // Energiforbruk.\nvar kWh_forbruk_total;  \n\n// Energiforbruk - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh == undefined) { \n  kWh_forbruk_total = 0;\n}\n// Energiforbruk - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_total = Previous_forbruk_kWh + kWh_forbruk_total_10s; \n}\n\nflow.set(\"vtr300_forbruk_kWh_total\", kWh_forbruk_total, \"default\"); // Enegiforbruk kWh - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh total ------------------------------\n//-------------------------------------------------------------------------------\nvar kWh_faktisk_tilfort_total = kWh_tilfort_total - kWh_forbruk_total; \n\n//-------------------------------------------------------------------------------\n//---------------------- Forbruk kWh total i Kr ---------------------------------\n//-------------------------------------------------------------------------------\nvar Previous_forbruk_kWh_Kr = flow.get (\"vtr300_forbruk_kWh_total_Kr\",\"default\"); // Energiforbruk i Kr.\nvar forbruk_total_Kr_kW_10s = kWh_forbruk_total_10s * Strompris_tot_kr_kWt;       // kWh forbruk i Kr/10s.\nvar kWh_forbruk_total_Kr;\n\n// Energiforbruk i Kr - Initilialiser verdi dersom udefinert/første gang verdi settes.\nif (Previous_forbruk_kWh_Kr == undefined) { \n  kWh_forbruk_total_Kr = 0;\n}\n// Energiforbruk i Kr - Akkumulerer forrige verdi med ny verdi.\nelse {\n  kWh_forbruk_total_Kr = Previous_forbruk_kWh_Kr + forbruk_total_Kr_kW_10s; // Akkumulerer forrige verdi med ny verdi \n}\n\nflow.set(\"vtr300_forbruk_kWh_total_Kr\", kWh_forbruk_total_Kr, \"default\");   // Energiforbruk i Kr - Oppdaterer med nyeste akkumulerte verdi (scantid må være 10s pga. \"kW/10s\").\n\n//-------------------------------------------------------------------------------\n//---------------------- Faktisk tilført kWh total i Kr ------------------------- (forbr. kWh i Kr - Tilført kWh i Kr).\n//-------------------------------------------------------------------------------\nvar kWh_tilfort_total_Kr = flow.get (\"vtr300_tilfort_kWh_total_Kr\",\"default\");   // Tilført kWh total i Kr.\nvar kWh_faktisk_tilfort_total_Kr = kWh_tilfort_total_Kr - kWh_forbruk_total_Kr; \n\n//-------------------------------------------------------------------------------\n//---------------------- Utgangs verdier ---------------------------------------- \n//-------------------------------------------------------------------------------\n\n// Energi forbruk, tilført og kostnads beregninger\nvar msg1 = {payload:parseFloat((kWh_forbruk_total_Kr).toFixed(1))};         // Total energiforbruk i Kr.\nvar msg2 = {payload:parseFloat((kWh_tilfort_total_Kr).toFixed(1))};         // Total tilført energi i Kr.\nvar msg3 = {payload:parseFloat((kWh_tilfort_total).toFixed(1))};            // Total tilført energi.i kWh.\nvar msg4 = {payload:parseFloat((kWh_faktisk_tilfort_total_Kr).toFixed(1))}; // Total faktisk tilført energi i Kr.\nvar msg5 = {payload:parseFloat((kWh_faktisk_tilfort_total).toFixed(1))};    // Total faktisk tilført energi i kWh.\nvar msg6 = {payload:parseFloat((kWh_forbruk_total).toFixed(1))};            // Total forbruk energi i kWh.\n\nreturn [msg1,msg2,msg3,msg4,msg5,msg6];","outputs":6,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1940,"y":4180,"wires":[["d328abbc.fd7928"],["b98051ca.0053a"],["8334c0c2.d710e"],["8e743d18.354bc"],["9512bfff.dfcf2"],["9d7ec1ab.91bbf"]],"outputLabels":["Kr - Forbruk  totalt","Kr - Tilført totalt","KWh - Tilført totalt","Kr - Faktisk tilført totalt (Tilført - Forbruk)","kWh - Faktisk tilført totalt (Tilført - Forbruk)","kWh - Forbruk  totalt"],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"8334c0c2.d710e","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført total [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_total"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2520,"y":4260,"wires":[[]]},{"id":"8e743d18.354bc","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført total [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_total_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2260,"y":4180,"wires":[[]]},{"id":"d328abbc.fd7928","type":"ha-entity","z":"c1e03843.9d14a8","name":"Forbruk total [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_forbruk_kwh_total_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2530,"y":4180,"wires":[[]]},{"id":"b98051ca.0053a","type":"ha-entity","z":"c1e03843.9d14a8","name":"Tilført total [Kr]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_tilført_kwh_total_kr"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cash"},{"property":"unit_of_measurement","value":"Kr"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2520,"y":4220,"wires":[[]]},{"id":"9512bfff.dfcf2","type":"ha-entity","z":"c1e03843.9d14a8","name":"Faktisk tilført total [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_faktisk_tilført_kwh_total"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2270,"y":4220,"wires":[[]]},{"id":"e76f5cd0.fdea","type":"inject","z":"c1e03843.9d14a8","name":"Poll(10s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":1320,"y":1420,"wires":[["7ba45d89.901274","3d0cbf37.b2f45"]]},{"id":"e33222af.3c2b4","type":"change","z":"c1e03843.9d14a8","name":"Tilluftstemp. Kalk. - Set flow","rules":[{"t":"set","p":"vtr300_tilluftstemp_utekomp_kalk","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2140,"y":1020,"wires":[[]]},{"id":"7b7c9fb9.aa35c","type":"function","z":"c1e03843.9d14a8","name":"Tilluft Ctrl.","func":"// Tillufts regulering, utang settes ihht. om utekomp er Av/På.\n// Når \"På\", brukes kalkulert settpunkt fra utekomp kurve.\n// Når \"AV\", brukes vanlig/manuell sp.\n\nvar Utekomp_ctrl_state = msg.payload; //Utekompensering Av/På bool state.\n\nvar Man_tilluft_sp = flow.get (\"vtr300_tilluft_temp_sp\",\"default\");               // Standard/manuell tilluft sp.\nvar Utekomp_tilluft_sp = flow.get (\"vtr300_tilluftstemp_utekomp_kalk\",\"default\"); // Kalkulert tilluftstemperatur via utekomp. kurve.\n\n// Sjekker for \"isNotNumber, ved \"isNan\" tidlig \"exit\" (prøv igjen).\n  if (isNaN(Man_tilluft_sp) || isNaN(Utekomp_tilluft_sp)) {\n    return;\n  }\n  \nvar temp_sp_out; // Intern var for aktivt sp til VTR300 .\n\n// Utekomp AV, bruk man tilluft sp.\nif (Utekomp_ctrl_state === 'off') { \n  temp_sp_out = Man_tilluft_sp;\n}\n\n// Utekomp PÅ, bruk kalkulert tilluft sp.\nelse if (Utekomp_ctrl_state === 'on') { \n  temp_sp_out = Utekomp_tilluft_sp;\n}\n\n// Fail safe: Dersom uønkset tilstand skulle oppstå, sett 22 tilluft sp.\nelse {\n  temp_sp_out = 22; \n}\n\nmsg.payload = parseFloat((temp_sp_out).toFixed(0));\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":100,"y":140,"wires":[["630a1006.41399"]],"outputLabels":["Aktiv tilluftstemp_sp"]},{"id":"e7aa6794.075bc8","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Ønsket Tilluftstemp","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":"vtr300_tilluft_sp"},{"property":"icon","value":"mdi:thermometer-lines"}],"entityidfilter":"sensor.climate_vtr300_tilluft_sp","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":390,"y":100,"wires":[["c65978d1.c37358"]]},{"id":"c65978d1.c37358","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_tilluft_temp_sp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":100,"wires":[[]]},{"id":"8182a50e.693908","type":"function","z":"c1e03843.9d14a8","name":"100->500","func":"var Temp_scaled = msg.payload;\nvar Temp_raw;\n\nTemp_raw = (Temp_scaled *10); \n\nmsg.payload = Temp_raw;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":140,"wires":[["6ac59c59.c6ecd4"]],"info":"Engineering range: 10°C -> 50°C\nRaw value range:   100 -> 500"},{"id":"7b841d76.d85f54","type":"poll-state","z":"c1e03843.9d14a8","name":"Utekomp.Av/På(30s)","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"input_boolean.vtr300_utekomp_tilluft_reg","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":110,"y":80,"wires":[["7b7c9fb9.aa35c"]]},{"id":"630a1006.41399","type":"switch","z":"c1e03843.9d14a8","name":"Send if !=Resp. ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_tilluft_temp_sp_modbus_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":140,"wires":[["8182a50e.693908"]]},{"id":"168e0b11.26c0e5","type":"ha-entity","z":"c1e03843.9d14a8","name":"Heat On/Off - Dummy switch","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"vtr300_climate_dummyswitch"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":700,"y":340,"wires":[["7ff0b2d2.8945cc"],["7ff0b2d2.8945cc"]]},{"id":"14419122.25104f","type":"function","z":"c1e03843.9d14a8","name":"Kalk. gjenv.grad (1)","func":"\nvar temp_tilluft = flow.get (\"vtr300_tillufts_temperatur\",\"default\");  \nvar temp_inntak = flow.get (\"vtr300_inntak_temp\",\"default\"); \nvar temp_avtrekk = flow.get (\"vtr300_avtrekk_temp\",\"default\");  \n//var gjenvinner_padrag = flow.get (\"vtr300_gjenvinner_padrag\",\"default\");  \n\n\n// Sjekker for \"isNotNumber, ved \"isNan\" tidlig \"exit\" (prøv igjen).\n  if (isNaN(temp_tilluft) || isNaN(temp_inntak) || isNaN(temp_avtrekk)) {\n    return;\n  }\n  \nvar Gjenv_grad; // Intern variable for kalkulert gjenvinningrad.\n\n// Ved ugyldig resultat som under, sett \"0\".\nif (temp_avtrekk - temp_inntak  === 0) { \n  Gjenv_grad = 0;\n}\n\n// Dersom man ikke ønsker beregning av gjenvinningsgrad når gjenvinner ikke er i drift, sett 0\".\n//else if (gjenvinner_padrag  === 0) { \n//  Gjenv_grad = 0;\n//}\n\n// Kalkulert gjenvinningsgrad.\nelse {\n  Gjenv_grad = ((temp_tilluft - temp_inntak) / (temp_avtrekk - temp_inntak)) * 100 ; \n}\n\nmsg.payload = parseFloat((Gjenv_grad).toFixed(1));\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":1480,"wires":[["3f578038.ff988"]],"outputLabels":["Kalkulert gjenvinningsgrad"]},{"id":"147981f3.7e567e","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_avtrekk_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":740,"wires":[["8caa3e3a.f515c"]]},{"id":"8fcfb8f.52b2b48","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_gjenvinner_padrag","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1020,"wires":[["e536cce4.b9dbd"]]},{"id":"1e36d64c.9f172a","type":"function","z":"c1e03843.9d14a8","name":"Set Climate Off/Heat/Cool*","func":"\nvar climate_state = msg.payload;\nvar temp_avtrekk = flow.get (\"vtr300_avtrekk_temp\",\"default\");\nvar temp_inntak = flow.get (\"vtr300_inntak_temp\",\"default\");\nvar gjenvinner_padrag = flow.get (\"vtr300_gjenvinner_padrag\",\"default\"); \nvar allow_cool_recovery_limit = flow.get (\"vtr300_cooling_recovery_allow_limit_response\",\"default\");  \n\n// Sjekker for \"isNotNumber, ved \"isNan\" tidlig \"exit\" (prøv igjen).\n  if (isNaN(temp_avtrekk) || isNaN(temp_inntak) || isNaN(gjenvinner_padrag) || isNaN(allow_cool_recovery_limit)) {\n    return;\n  }  \n  \n//var temp_diff_val = (temp_inntak - temp_avtrekk);\nvar temp_diff_val = 1;\n\n// Skriver til Climate for å visualisere tilstand på Climate objekt. -------------------------------------------------------- \nvar set_climate;\n\n//******************************* NA - Cool støttes ikke av genereic thermostat... ******************************************\n//Kjølegjenvinning i drift, set climate cool.\n//if ((gjenvinner_padrag  >= 2) && (temp_diff_val >= allow_cool_recovery_limit) && (climate_state === 'off')) { \n//  set_climate = 'cool';\n//}\n//else if ((gjenvinner_padrag  < 2) && (temp_diff_val >= allow_cool_recovery_limit) && (climate_state === 'cool')) { \n//  set_climate = 'off';\n//}\n\n//******************************* SET - Climate Heat on/off... ******************************************\n//Varmegjenvinning i drift, set climate heat.\nif ((gjenvinner_padrag  >= 2) && (temp_diff_val < allow_cool_recovery_limit) && (climate_state === 'off')) { \n  set_climate = 'heat';\n}\n\nelse if ((gjenvinner_padrag  < 2) && (temp_diff_val < allow_cool_recovery_limit) && (climate_state === 'heat')) { \n  set_climate = 'off';\n}\n// Unngå unødig skriving til switch dersom climate er i riktig modus, returner.\nelse {\n  return;\n}\n\nvar msg1 = {payload:(set_climate)}; \n\nreturn [msg1];\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":240,"wires":[["3695421e.6bf6fe"]],"outputLabels":["Set Climate"]},{"id":"52a7f6e3.cb4618","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_avtrekksvifte_pv","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":900,"wires":[["7ab81779.c197a8"]]},{"id":"abec1520.fb9838","type":"function","z":"c1e03843.9d14a8","name":"Calc. m3/t","func":"\nvar vifte_tilluft_pv = flow.get (\"vtr300_tilluftsvifte_pv\",\"default\"); \nvar vifte_avtrekk_pv = flow.get (\"vtr300_avtrekksvifte_pv\",\"default\");  \n\n// Sjekker for \"isNotNumber, ved \"isNan\" tidlig \"exit\" (prøv igjen).\n  if (isNaN(vifte_tilluft_pv) || isNaN(vifte_avtrekk_pv)) {\n    return;\n  }  \n\n// Estimert luftmengde, 0 --> 100% = 0 --> 300m3/t\nvar vifte_tilluft_RF = vifte_tilluft_pv * 3; \nvar vifte_avtrekk_RF = vifte_avtrekk_pv * 3; \n\nvar msg1 = {payload:parseFloat((vifte_tilluft_RF).toFixed(0))};           \nvar msg2 = {payload:parseFloat((vifte_avtrekk_RF).toFixed(0))}; \n\nreturn [msg1,msg2];\n\n\n\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":280,"y":1600,"wires":[["3aa44cda.5f5d94"],["8ad972c5.d1f58"]],"outputLabels":["Tilluftsvifte - Luftmengde","Avtrekksvifte - Luftmengde"]},{"id":"ca1fe674.19be48","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Man mode (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":1300,"y":2900,"wires":[["762d7a11.f6d0d4","4a3930cb.f645"],[]]},{"id":"edc910f5.4dbd6","type":"function","z":"c1e03843.9d14a8","name":"Correct Fan Comp.","func":"// Utekompensert vifte kompensering: 0% --> 50% pådrags kompensering ihht. utetemp.\n\nvar vifte_hast_komp_rpm = flow.get (\"vtr300_vifte_hast_komp_rpm\",\"default\"); //Aktuell vifte kompensering ihht. utekompensert vifte hast.\nvar tilluftsvifte_rpm = flow.get (\"vtr300_tilluftsvifte_rpm\",\"default\");     // Aktuell vifte hastighet\n\n// Sjekker for \"isNotNumber, ved \"isNan\" tidlig \"exit\" (prøv igjen).\n  if (isNaN(vifte_hast_komp_rpm) || isNaN(tilluftsvifte_rpm)) {\n    return;\n  }  \n\n// Gjør om til % for enkel sammenligning med vifte hastighet som også er i %\nvar vifte_hast_komp_korr = ((vifte_hast_komp_rpm / (tilluftsvifte_rpm + vifte_hast_komp_rpm)) * 100); \n\n\nvar msg1 = {payload:parseFloat((vifte_hast_komp_korr).toFixed(0))};           \n \n\nreturn [msg1];\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":1560,"wires":[["ddb55761.c9d7b8"]],"outputLabels":["Aktuell vift komp. [%]"]},{"id":"c640e76a.c67878","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_vifte_hast_komp_rpm","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":580,"wires":[["e310653.30ff398"]]},{"id":"1270e2b2.14939d","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_tilluftsvifte_rpm","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":940,"wires":[["344460eb.f61ab"]]},{"id":"3eb6a89d.bc64c8","type":"function","z":"c1e03843.9d14a8","name":"Modbus write**","func":"// ** Hindre unødig modbus skriving dersom man har fått modbus respons som forespurt.\n\nvar Modbus_response = flow.get (\"vtr300_man_mode_modbus_response\",\"default\"); // Modbus respons/svar i verdi ved modbus write  \n\n//Initilialiser verdi dersom udefinert, setter verdi som ikke skal skrives for at første gangs verdi skal gå igjennom.\nif (typeof Modbus_response == \"undefined\") \nModbus_response = 10;\n\nvar value_in = msg.payload; // Ønsket verdi som skal skrives\nvar value_out;\n\n// Tidlig \"Exit\" dersom modbus respons = payload.\nif (Modbus_response === value_in ) { \n  return;\n}\n\n// Skriv verdi kun dersom modbus respons er != payload in.\nelse {\n  value_out = value_in ; \n}\n\nvar fc=6;\nvar sa=1130;\nvar addresses=1;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value_out , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1120,"y":2900,"wires":[["ca1fe674.19be48","faba9786.74c368"]]},{"id":"4a3930cb.f645","type":"function","z":"c1e03843.9d14a8","name":"Resp. to Flow Ctxt.","func":"var value_response = msg.payload.value;\n\nflow.set(\"vtr300_man_mode_modbus_response\", value_response, \"default\"); //Lagrer Modbus respons i verdi ved modbus write  \n\nmsg.payload = value_response;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1510,"y":2900,"wires":[[]]},{"id":"ee01aff1.248ed","type":"function","z":"c1e03843.9d14a8","name":"Modbus write***","func":"// ** Hindre unødig modbus skriving dersom man har fått modbus respons som forespurt.\n\n// NB! \"Modbus_response\" resettes  av Boost*/Borte*/Ferie*/Ildsted*/Party* switch off ved falling edge, se \"* switch off\", om ikke blir \"Modbus Write\" interlock'et.\n//      Gjelder kun Main modus register og kun moduser som timer ut og går tilbake til forrige mode i aggr. PLS.\nvar Modbus_response = flow.get (\"vtr300_main_mode_modbus_response\",\"default\"); // Modbus respons/svar i verdi ved modbus write  \n\n//Initilialiser verdi dersom udefinert, setter verdi som ikke skal skrives for at første gangs verdi skal gå igjennom.\nif (typeof Modbus_response == \"undefined\") \nModbus_response = 0;\n\nvar value_in = msg.payload; // Ønsket verdi som skal skrives\nvar value_out;\n\n// Tidlig \"Exit\" dersom modbus respons = payload.\nif (Modbus_response === value_in ) { \n  return;\n}\n\n// Skriv verdi kun dersom modbus respons er != payload in.\nelse {\n  value_out = value_in ; \n}\n\nvar fc=6;\nvar sa=1161;\nvar addresses=1;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value_out , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":2520,"wires":[["db2734ad.c40af8"]]},{"id":"194659c1.0dc5b6","type":"function","z":"c1e03843.9d14a8","name":"Resp. to Flow Ctxt.","func":"var value_response = msg.payload.value;\n\nflow.set(\"vtr300_main_mode_modbus_response\", value_response, \"default\"); //Lagrer Modbus respons i verdi ved modbus write  \n\nmsg.payload = value_response;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":2520,"wires":[["fef741d.d8b5cc"]]},{"id":"56710c4c.cb5304","type":"function","z":"c1e03843.9d14a8","name":"Main modus status + set flow","func":"\nlet values = {\"0\":\"Auto_schedule\",\n            \"1\": \"Manuell\",\n            \"2\": \"Party\",\n            \"3\": \"Boost\",\n            \"4\": \"Ildsted\", \n            \"5\": \"Borte\",\n            \"6\": \"Ferie\",\n            \"7\": \"Cooker\",\n            \"8\": \"Hood\",\n            \"9\": \"Støvsuger\",\n            \"10\": \"CDI1\",\n            \"11\": \"CDI2\",\n            \"12\": \"Komfyravtrekk\"}           \n\nlet vtr300_main_modus = msg.payload.data[0].toString();\n\n// Dersom \"isNotNumber\", tidlig \"exit\" (prøv igjen).\n  if (isNaN(vtr300_main_modus)) {\n    return;\n  }\n\nflow.set(\"vtr300_main_mode_state_str\", values[vtr300_main_modus], \"default\"); //Lagrer Modus string i memory for gjenbruk\n\nmsg.payload = values[vtr300_main_modus];\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2140,"y":1400,"wires":[["feb84230.3cc4c"]]},{"id":"a9427683.c17b08","type":"function","z":"c1e03843.9d14a8","name":"Manuell modus  status + set flow","func":"// Manuell status register = 1 (ukjent), ingen info i dokumentasjon... Derfor WTF!\n\nlet values = {\"0\":\"Man_stopp\",\n            \"1\": \"WTF!\",\n            \"2\": \"Man_lav\",\n            \"3\": \"Man_normal\",\n            \"4\": \"Man_hi\"} \n        \nlet vtr300_man_modus = msg.payload.data[0].toString();\n\n// Dersom \"isNotNumber\", tidlig \"exit\" (prøv igjen).\n  if (isNaN(vtr300_man_modus)) {\n    return;\n  }\n\nflow.set(\"vtr300_man_mode_state_str\", values[vtr300_man_modus], \"default\"); //Lagrer Modus string i memory for gjenbruk\n\nmsg.payload = values[vtr300_man_modus];\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2150,"y":1440,"wires":[["73c85fd0.791af"]]},{"id":"e01b607a.dec6b","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_ppm_mode_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":3160,"wires":[["9365826d.2f247"]]},{"id":"53b30720.1db418","type":"function","z":"c1e03843.9d14a8","name":"PPM states","func":"// Status visning i liten tekst på PPM switch.\n\nvar ppm_mode_state = flow.get (\"vtr300_ppm_mode_state\",\"default\");       //PPM switch status.\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\"); //Main mode status register, omgjort til string.\nvar man_mode_state = flow.get (\"vtr300_man_mode_state_str\",\"default\");   //Manuell kommadno register, omgjort til string. Status register finnes ikke.\nvar noen_hjemme = global.get (\"Noen_hjemme\",\"default\");                  //Folk hjemme/borte.\nvar saf_override_state = flow.get (\"vtr300_fan_supply_man_override_response\",\"default\");  // Supply fan override state\nvar eaf_override_state = flow.get (\"vtr300_fan_extract_man_override_response\",\"default\"); // Extract fan override state\nvar freecool_state = flow.get (\"vtr300_freecool_states\",\"default\");                       // Frikjøling/Nattkjû�ling (Av/Standby/Kjøler)\nvar modes_ctd_sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");                 // Felles register for nedtelling av alle modus med CTD.\n\n// Dersom udefinert, tidlig \"exit\" (prøv igjen).\n  if ((typeof ppm_mode_state === \"undefined\") || (typeof main_mode_state === \"undefined\") || (typeof man_mode_state === \"undefined\") || (typeof saf_override_state === \"undefined\") || (typeof eaf_override_state === \"undefined\") || (typeof freecool_state === \"undefined\")) {\n    return;\n  }\n\nvar ppm_mode_state_out;\n\n// PPM Borte modus - Lav hastighet\nif ((ppm_mode_state === 'on') && (main_mode_state === 'Manuell') && (man_mode_state === 'Man_lav') && (noen_hjemme === 'Ingen hjemme') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) {\n  ppm_mode_state_out = 'Borte - Lav';\n}\n// PPM Lav hastighet\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Manuell') && (man_mode_state === 'Man_lav') && (noen_hjemme != 'Ingen hjemme') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) {\n  ppm_mode_state_out = 'Lav';\n}\n// PPM Normal hastighet\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Manuell') && (man_mode_state === 'Man_normal') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) {\n  ppm_mode_state_out = 'Normal';\n}\n//// PPM Høy hastighet\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Manuell') && (man_mode_state === 'Man_hi') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) {\n  ppm_mode_state_out = 'Høy';\n}\n// PPM Boost hastighet\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Boost') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'BOOST';\n}\n// PPM Standby - Party\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Party') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'Standby';\n}\n// PPM Standby - Ildsted\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Ildsted') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'Standby';\n}\n// PPM Standby - Borte\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Borte') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'Standby';\n}\n// PPM Standby - Ferie\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Ferie') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'Standby';\n}\n// PPM Standby - Komfyravtrekk\nelse if ((ppm_mode_state === 'on') && (main_mode_state === 'Komfyravtrekk') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'Standby';\n}\n// PPM Standby - Frikjøling\nelse if ((modes_ctd_sec === 0) && (ppm_mode_state === 'on') && (freecool_state === 'Kjøler') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'Standby';\n}\n// Vifter overstyres\nelse if ((ppm_mode_state === 'on') && (saf_override_state === 'Auto') && (eaf_override_state === 'Overstyrer')) {\n  ppm_mode_state_out = 'Overstyres!';\n}\n// Vifter overstyres\nelse if ((ppm_mode_state === 'on') && (saf_override_state === 'Overstyrer') && (eaf_override_state === 'Auto')) { \n  ppm_mode_state_out = 'Overstyres!';\n}\n// Vifter overstyres\nelse if ((ppm_mode_state === 'on') && (saf_override_state === 'Overstyrer') && (eaf_override_state === 'Overstyrer')) { \n  ppm_mode_state_out = 'Overstyres!';\n}\n// Skriv verdi kun dersom modbus respons er != payload in.\nelse {\n  ppm_mode_state_out = 'Av'; \n}\n\nmsg.payload = ppm_mode_state_out;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1400,"wires":[["1fb9a854.6bbb98","6e810f3d.8472d"]]},{"id":"c8847484.b90e28","type":"function","z":"c1e03843.9d14a8","name":"Button states","func":"// Status visning i liten tekst på modus switcher.\n\nvar ppm_mode_state = flow.get (\"vtr300_ppm_mode_state\",\"default\");       //PPM switch status.\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\"); //Main mode status register, omgjort til string.\nvar man_mode_state = flow.get (\"vtr300_man_mode_state_str\",\"default\");   //Manuell kommadno register, omgjort til string. Status register finnes ikke.\nvar saf_override_state = flow.get (\"vtr300_fan_supply_man_override_response\",\"default\");  // Supply fan override state\nvar eaf_override_state = flow.get (\"vtr300_fan_extract_man_override_response\",\"default\"); // Extract fan override state\nvar freecool_state = flow.get (\"vtr300_freecool_states\",\"default\");                       // Frikjøling/Nattkjøling (Av/Standby/Kjøler)\nvar modes_ctd_sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");                 // Felles register for nedtelling av alle modus med CTD.\n\n// Dersom udefinert, tidlig \"exit\" (prøv igjen).\n  if ((typeof ppm_mode_state === \"undefined\") || (typeof freecool_state === \"undefined\")  || (typeof main_mode_state === \"undefined\") || (typeof man_mode_state === \"undefined\") || (typeof saf_override_state === \"undefined\") || (typeof eaf_override_state === \"undefined\")) {\n    return;\n  }\n\nvar button_state_out;\n\n// Auto Schedule\nif ((main_mode_state === 'Auto_schedule') && (man_mode_state != 'Man_stopp') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) {\n  button_state_out = 'Auto Sch.';\n}\n// Manuell\nelse if ((main_mode_state === 'Manuell') && (man_mode_state != 'Man_stopp') && (ppm_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  button_state_out = 'Manuell';\n}\n// PPM Auto\nelse if ((main_mode_state === 'Manuell') && (man_mode_state != 'Man_stopp') && (ppm_mode_state === 'on') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) {\n  button_state_out = 'PPM Auto';\n}\n// Standby\nelse if ((main_mode_state != 'Auto_schedule') && (man_mode_state != 'Man_stopp') && (ppm_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) {\n  button_state_out = 'Standby';\n}\n// Frikjøler - Tidsmoduser + Stopp + Overstyring inaktiv\nelse if ((modes_ctd_sec === 0) && (main_mode_state != 'Komfyravtrekk') && (man_mode_state != 'Man_stopp') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state === 'Kjøler')) {\n  button_state_out = 'Frikjøler';\n}\n// Vifter overstyres\nelse if ((saf_override_state === 'Auto') && (eaf_override_state === 'Overstyrer')) { \n  button_state_out = 'Overstyres!';\n}\n// Vifter overstyres\nelse if ((saf_override_state === 'Overstyrer') && (eaf_override_state === 'Auto')) { \n  button_state_out = 'Overstyres!';\n}\n// Vifter overstyres\nelse if ((saf_override_state === 'Overstyrer') && (eaf_override_state === 'Overstyrer')) { \n  button_state_out = 'Overstyres!';\n}\n// Av\nelse {\n  button_state_out = 'Av'; \n}\n\nmsg.payload = button_state_out;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1360,"wires":[["451d83dc.dc179c","8fec6370.d72db"]]},{"id":"63a14069.e1f43","type":"function","z":"c1e03843.9d14a8","name":"Mode states","func":"// Modus statuser for aggregatet.\n\nvar ppm_mode_state = flow.get (\"vtr300_ppm_mode_state\",\"default\");                        // PPM switch status.\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\");                  // Main mode status register, omgjort til string.\nvar man_mode_state = flow.get (\"vtr300_man_mode_state_str\",\"default\");                    // Manuell kommadno register, omgjort til string. Status register finnes ikke.\nvar tilluftsvifte_pv = flow.get (\"vtr300_tilluftsvifte_pv\",\"default\");                    // Tilluftsvifte pådrag [%].\nvar noen_hjemme = global.get (\"Noen_hjemme\",\"default\");                                   // Folk hjemme/borte.\nvar moist_mode_state = flow.get (\"vtr300_ppm_moist_mode_state\",\"default\");                // Fukt overstyring status i PPM Auto\nvar saf_override_state = flow.get (\"vtr300_fan_supply_man_override_response\",\"default\");  // Supply fan override state\nvar eaf_override_state = flow.get (\"vtr300_fan_extract_man_override_response\",\"default\"); // Extract fan override state\nvar freecool_state = flow.get (\"vtr300_freecool_states\",\"default\");                       // Frikjøling/Nattkjøling (Av/Standby/Kjøler)\nvar modes_ctu_sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");                 // Felles register for nedtelling av alle modus med CTD.\nvar saf_fan_override_spd = flow.get (\"vtr300_fan_supply_man_override_spd_response\",\"default\");  // Tilluftsvifte overstyring hast.\nvar eaf_fan_override_spd = flow.get (\"vtr300_fan_extract_man_override_spd_response\",\"default\"); // Avtrekksvifte overstyring hast.\n\n// Dersom udefinert & \"isNotNumber\", tidlig \"exit\" (prøv igjen).\n  if ((typeof ppm_mode_state === \"undefined\") || (typeof freecool_state === \"undefined\") || (typeof main_mode_state === \"undefined\") || (typeof man_mode_state === \"undefined\") || isNaN(tilluftsvifte_pv) || (typeof saf_override_state === \"undefined\") || (typeof eaf_override_state === \"undefined\")) {\n    return;\n  }\n\n\nvar mode_state_out;\n\n// --------------------------------------------------------------------------------------------------------------- AUTO SCHEDULE (Ingen registre å avlese for hast. i Auto, bruker pådrag.)\nif ((main_mode_state === 'Auto_schedule') && (tilluftsvifte_pv < 35) && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Auto schedule - Oppstart';\n}\nelse if ((main_mode_state === 'Auto_schedule') && (tilluftsvifte_pv >= 35 && tilluftsvifte_pv < 50) && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Auto schedule - Lav';\n}\nelse if ((main_mode_state === 'Auto_schedule') && (tilluftsvifte_pv >= 50 && tilluftsvifte_pv < 68) && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Auto schedule - Normal';\n}\nelse if ((main_mode_state === 'Auto_schedule') && (tilluftsvifte_pv >= 68 && tilluftsvifte_pv < 80) && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Auto schedule - Høy';\n}\nelse if ((main_mode_state === 'Auto_schedule') && (tilluftsvifte_pv >= 80) && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Auto schedule - I transisjon';\n}\n// --------------------------------------------------------------------------------------------------------------- MANUELL\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_stopp') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Manuell STOPP';\n}\n// Manuell status register = 1 (ukjent), ingen info i dokumentasjon... Derfor WTF!\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'WTF!') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Manuell Shitstorm?';\n}\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_lav') && (ppm_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Manuell Lav';\n}\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_normal') && (ppm_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Manuell Normal';\n}\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_hi') && (ppm_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Manuell Høy';\n}\n// --------------------------------------------------------------------------------------------------------------- TIDSSTYRT, nedtelling før deaktivering til forrige/siste modus.\nelse if ((main_mode_state === 'Boost') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Boost';\n}\nelse if ((main_mode_state === 'Party') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Party';\n}\nelse if ((main_mode_state === 'Ildsted') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Ildsted';\n}\nelse if ((main_mode_state === 'Borte') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Borte';\n}\nelse if ((main_mode_state === 'Ferie') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) {  \n  mode_state_out = 'Ferie';\n// --------------------------------------------------------------------------------------------------------------- DI, styrt av digitale innganger.\n}\nelse if ((main_mode_state === 'Cooker') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Cooker';\n}\nelse if ((main_mode_state === 'Hood') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Hood';\n}\nelse if ((main_mode_state === 'Stã�vsuger') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Støvsuger';\n}\nelse if ((main_mode_state === 'CDI1') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'CDI1';\n}\nelse if ((main_mode_state === 'CDI2') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'CDI2';\n}\nelse if ((main_mode_state === 'Komfyravtrekk') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Komfyravtrekk';\n}\n// --------------------------------------------------------------------------------------------------------------- PPM Mode\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_lav') && (ppm_mode_state === 'on') && (noen_hjemme === 'Ingen hjemme') && (moist_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'PPM Auto - Borte (Lav)';\n}\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_lav') && (ppm_mode_state === 'on') && (noen_hjemme != 'Ingen hjemme') && (moist_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'PPM Auto - Lav';\n}\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_normal') && (ppm_mode_state === 'on') && (moist_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'PPM Auto - Normal';\n}\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_normal') && (ppm_mode_state === 'on') && (moist_mode_state === 'on') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Fuktoverstyring - Normal';\n}\nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_hi') && (ppm_mode_state === 'on') && (moist_mode_state === 'off') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'PPM Auto - Høy';\n}  \nelse if ((main_mode_state === 'Manuell') && (man_mode_state === 'Man_hi') && (ppm_mode_state === 'on') && (moist_mode_state === 'on') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'Fuktoverstyring - Høy';\n}  \nelse if ((main_mode_state === 'Boost') && (ppm_mode_state === 'on') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state != 'Kjøler')) { \n  mode_state_out = 'PPM Auto - Boost';\n}\n// --------------------------------------------------------------------------------------------------------------- Overstyring vifter\nelse if ((saf_override_state === 'Overstyrer') && (eaf_override_state === 'Auto')) { \n  mode_state_out = 'Tilluftsvifte overstyres! - ' + saf_fan_override_spd;\n}\nelse if ((saf_override_state === 'Auto') && (eaf_override_state === 'Overstyrer')) { \n  mode_state_out = 'Avtrekksvifte overstyres! - ' + eaf_fan_override_spd;\n}\nelse if ((saf_override_state === 'Overstyrer') && (eaf_override_state === 'Overstyrer')) { \n  mode_state_out = 'Vifter overstyres! - ' + eaf_fan_override_spd + '/' + saf_fan_override_spd ;\n}\n// --------------------------------------------------------------------------------------------------------------- Frikjøling + Kjølegjenvinning\nelse if ((modes_ctu_sec === 0) && (main_mode_state != 'Komfyravtrekk') && (man_mode_state != 'Man_stopp') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state === 'Kjøler') && (tilluftsvifte_pv < 68)) { \n  mode_state_out = 'Frikjøler - Normal';\n}\nelse if ((modes_ctu_sec === 0) && (main_mode_state != 'Komfyravtrekk') && (man_mode_state != 'Man_stopp') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state === 'Kjøler') && (tilluftsvifte_pv >= 68 && tilluftsvifte_pv < 80)) { \n  mode_state_out = 'Frikjøler - Høy';\n}\nelse if ((modes_ctu_sec === 0) && (main_mode_state != 'Komfyravtrekk') && (man_mode_state != 'Man_stopp') && (saf_override_state === 'Auto') && (eaf_override_state === 'Auto') && (freecool_state === 'Kjøler') && (tilluftsvifte_pv >= 80)) {\n  mode_state_out = 'Frikjøler - Maks';\n}\n// --------------------------------------------------------------------------------------------------------------- ERROR!!\nelse {\n  mode_state_out = 'Feil, sjekk kode!'; \n}\n\nmsg.payload = mode_state_out;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1320,"wires":[["49a8120a.72133c","a246b9ea.600988"]]},{"id":"161b541f.088a7c","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_nedtelling_modus_tid_s","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1960,"y":1640,"wires":[[]]},{"id":"7626e293.82c05c","type":"function","z":"c1e03843.9d14a8","name":"Ildsted - Format time","func":"// Ildsted modus, gjenstående tid fra modus startet\n// Gjør om fra sek. til dager og minutter (1-60min)\n\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\"); //Main mode status register, omgjort til string.\nvar sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");          // Felles register for nedtelling av alle modus med CTD.\nvar time_sp = flow.get (\"vtr300_ildsted_modus_varighet_state\",\"default\");       // Nedtelling settpunkt for aktuell modus\n\n// Ved sec. \"NaN\" eller \"udefinert\", tidlig \"exit\" (returner).\n  if (isNaN(sec) || isNaN(time_sp)) {\n    return;\n  }\n\n//Calc.\nHours = (sec % 86400/3600);         //Hours\nMin = (sec % 3600/60);              //Minutes\nvar msgOut;\n\n//Fjerne desimaler & legger til benevnelse ------------------------------ Nedtelling, visning på switcher.\n// Viser settpunkt når inaktiv:\nif (main_mode_state != 'Ildsted') {\n  msgOut = time_sp + 'm';\n}\n// Viser Timer og Min. når (< 1Dag & >= 1t):\nelse if ((main_mode_state = 'Ildsted') && (sec < 86400) && (sec >= 3600)) {\n  msgOut = Hours.toFixed(1) +'t';  \n}\n// Viser Min. når (<= 1t & < 60sec):\nelse if ((main_mode_state = 'Ildsted') && (sec < 3600) && (sec > 60)) {\n  msgOut = Min.toFixed(0) +'m';    \n}\n// Viser < 1 min. når (<= 60 & < 0sec):\nelse if ((main_mode_state = 'Ildsted') && (sec <= 60) && (sec > 0)) {\n  msgOut = '< 1 min';    \n}\nelse {\n  msgOut = 'Inaktiv';  \n}\n\n//----------------------------------------------------------------------- Deaktiver mode switch \n// switch for mode med nedtelling må deaktiveres dersom den timer ut uten å bli avbrutt av annen modus manuelt, for å ungå uønsket modus kall.\n// Må trigges litt før for å være sikker pí� at switch deaktiveres pga. 10s poll.\nvar mode_switch_off;\n\nif (main_mode_state != 'ldsted') {\n  mode_switch_off = 1000; \n}\nelse if ((main_mode_state = 'Ildsted') && (sec <= 40) && (sec >= 15)) {\n  mode_switch_off = 0; \n}\nelse {\n    mode_switch_off = 1000; // Bare for å sette en verdi høyere enn at \"switch off\" trigges.\n}\n\n//----------------------------------------------------------------------- Utganger.\n\nvar msg1 = {payload:(msgOut)}; \nvar msg2 = {payload:(mode_switch_off)}; \n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":1880,"wires":[["f384e54.4fdc018"],["652289ee.4e4168"]],"outputLabels":["Gjenstående modus tid","Trigger for switch turn off"]},{"id":"373dc51f.827aea","type":"function","z":"c1e03843.9d14a8","name":"Party - Format time","func":"// Party modus, gjenstående tid fra modus startet\n// Gjør om fra sek. til dager og minutter (1-8t)\n\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\"); //Main mode status register, omgjort til string.\nvar sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");          // Felles register for nedtelling av alle modus med CTD.\nvar time_sp = flow.get (\"vtr300_party_modus_varighet_state\",\"default\");       // Nedtelling settpunkt for aktuell modus\n\n\n// Ved sec. \"NaN\" eller \"udefinert\", tidlig \"exit\" (returner).\n  if (isNaN(sec) || isNaN(time_sp)) {\n    return;\n  }\n\n//Calc.\nHours = (sec % 86400/3600);         //Hours\nMin = (sec % 3600/60);              //Minutes\nvar msgOut;\n\n//Fjerne desimaler & legger til benevnelse ------------------------------ Nedtelling, visning på switcher.\n// Viser settpunkt når inaktiv:\nif (main_mode_state != 'Party') {\n  msgOut = time_sp + 't';\n}\n// Viser Timer og Min. når (< 1Dag & >= 1t):\nelse if ((main_mode_state = 'Party') && (sec < 86400) && (sec >= 3600)) {\n  msgOut = Hours.toFixed(1) +'t';  \n}\n// Viser Min. når (<= 1t & < 60sec):\nelse if ((main_mode_state = 'Party') && (sec < 3600) && (sec > 60)) {\n  msgOut = Min.toFixed(0) +'m';    \n}\n// Viser < 1 min. når (<= 60 & < 0sec):\nelse if ((main_mode_state = 'Party') && (sec <= 60) && (sec > 0)) {\n  msgOut = '< 1 min';    \n}\nelse {\n  msgOut = 'Inaktiv';\n}\n\n//----------------------------------------------------------------------- Deaktiver mode switch. \n// switch for mode med nedtelling mÈ�� deaktiveres dersom den timer ut uten å bli avbrutt av annen modus manuelt, for å ungå uønsket modus kall.\n\nvar mode_switch_off;\n\nif (main_mode_state != 'Party') {\n  mode_switch_off = 1000; \n}\nelse if ((main_mode_state = 'Party') && (sec <= 40) && (sec >= 15)) {\n  mode_switch_off = 0; \n}\nelse {\n    mode_switch_off = 1000; // Bare for å sette en verdi høyere enn at \"switch off\" trigges.\n}\n\n//----------------------------------------------------------------------- Utganger.\n\nvar msg1 = {payload:(msgOut)}; \nvar msg2 = {payload:(mode_switch_off)}; \n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1940,"wires":[["658fef1.5c67e1"],["b748a60.eecc658"]],"outputLabels":["Gjenstående modus tid","Trigger for switch turn off"]},{"id":"2e143fb.55e32c","type":"function","z":"c1e03843.9d14a8","name":"Boost - Format time","func":"// Boost modus, gjenstående tid fra modus startet\n// Gjør om fra sek. til dager og minutter (1-240min)\n\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\"); //Main mode status register, omgjort til string.\nvar sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");          // Felles register for nedtelling av alle modus med CTD.\nvar time_sp = flow.get (\"vtr300_boost_modus_varighet_state\",\"default\");       // Nedtelling settpunkt for aktuell modus\n\n\n// Ved sec. \"NaN\" eller \"udefinert\", tidlig \"exit\" (returner).\n  if (isNaN(sec) || isNaN(time_sp)) {\n    return;\n  }\n\n//Calc.\nHours = (sec % 86400/3600);         //Hours\nMin = (sec % 3600/60);              //Minutes\nvar msgOut;\n\n//Fjerne desimaler & legger til benevnelse ------------------------------ Nedtelling, visning på switcher.\n// Viser settpunkt når inaktiv:\nif (main_mode_state != 'Boost') {\n  msgOut = time_sp + 'm';\n}\n// Viser Timer og Min. når (< 1Dag & >= 1t):\nelse if ((main_mode_state = 'Boost') && (sec < 86400) && (sec >= 3600)) {\n  msgOut = Hours.toFixed(1) +'t';  \n}\n// Viser Min. nÊ�r (<= 1t & < 60sec):\nelse if ((main_mode_state = 'Boost') && (sec < 3600) && (sec > 60)) {\n  msgOut = Min.toFixed(0) +'m';    \n}\n// Viser < 1 min. når (<= 60 & < 0sec):\nelse if ((main_mode_state = 'Boost') && (sec <= 60) && (sec > 0)) {\n  msgOut = '< 1 min';    \n}\nelse {\n  msgOut = 'Inaktiv';  \n}\n\n//----------------------------------------------------------------------- Deaktiver mode switch \n// switch for mode med nedtelling mÛ� deaktiveres dersom den timer ut uten å bli avbrutt av annen modus manuelt, for å ungå uønsket modus kall.\n// Må trigges litt før for å være sikker på at switch deaktiveres pga. 10s poll.\nvar mode_switch_off;\n\nif (main_mode_state != 'Boost') {\n  mode_switch_off = 1000; \n}\nelse if ((main_mode_state = 'Boost') && (sec <= 40) && (sec >= 15)) {\n  mode_switch_off = 0; \n}\nelse {\n    mode_switch_off = 1000; // Bare for å sette en verdi høyere enn at \"switch off\" trigges.\n}\n\n//----------------------------------------------------------------------- Utganger.\n\nvar msg1 = {payload:(msgOut)}; \nvar msg2 = {payload:(mode_switch_off)}; \n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1760,"wires":[["d4993675.a728d8"],["bc1c6488.5f3d78"]],"outputLabels":["Gjenstående modus tid","Trigger for switch turn off"]},{"id":"eba2f59f.e7d6a8","type":"function","z":"c1e03843.9d14a8","name":"Ferie - Format time","func":"// Ferie modus, gjenstående tid fra modus startet\n// Gjør om fra sek. til dager og minutter (1-365d)\n\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\"); //Main mode status register, omgjort til string.\nvar sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");          // Felles register for nedtelling av alle modus med CTD.\nvar time_sp = flow.get (\"vtr300_ferie_modus_varighet_state\",\"default\");       // Nedtelling settpunkt for aktuell modus\n\n\n// Ved sec. \"NaN\" eller \"udefinert\", tidlig \"exit\" (returner).\n  if (isNaN(sec) || isNaN(time_sp)) {\n    return;\n  }\n\n//Calc.\nDays = (sec % 604800/86400);        //Days\nHours = (sec % 86400/3600);         //Hours\nMin = (sec % 3600/60);              //Minutes\nvar msgOut;\n\n//Fjerne desimaler & legger til benevnelse ------------------------------ Nedtelling, visning på switcher.\n// Viser settpunkt når inaktiv:\nif (main_mode_state != 'Ferie') {\n  msgOut = time_sp + 'd';\n}\n//Viser Dager når (< 1Uke & > 1Dag):\nelse if ((main_mode_state = 'Ferie') && (sec < 604800) && (sec >= 86400)) {\n  msgOut = Days.toFixed(1) +'d';\n}\n// Viser Timer og Min. når (< 1Dag & >= 1t):\nelse if ((main_mode_state = 'Ferie') && (sec < 86400) && (sec >= 3600)) {\n  msgOut = Hours.toFixed(1) +'t';  \n}\n// Viser Min. når (<= 1t & < 60sec):\nelse if ((main_mode_state = 'Ferie') && (sec < 3600) && (sec > 60)) {\n  msgOut = Min.toFixed(0) +'m';    \n}\n// Viser < 1 min. når (<= 60 & < 0sec):\nelse if ((main_mode_state = 'Ferie') && (sec <= 60) && (sec > 0)) {\n  msgOut = '< 1 min';    \n}\nelse {\n  msgOut = 'Inaktiv';  \n}\n\n//----------------------------------------------------------------------- Deaktiver mode switch \n// switch for mode med nedtelling må deaktiveres dersom den timer ut uten å bli avbrutt av annen modus manuelt, for þ��� ungå uønsket modus kall.\n// Må trigges litt før for å være sikker på at switch deaktiveres pga. 10s poll.\nvar mode_switch_off;\n\nif (main_mode_state != 'Ferie') {\n  mode_switch_off = 1000; \n}\nelse if ((main_mode_state = 'Ferie') && (sec <= 40) && (sec >= 15)) {\n  mode_switch_off = 0; \n}\nelse {\n    mode_switch_off = 1000; // Bare for å sette en verdi høyere enn at \"switch off\" trigges.\n}\n\n//----------------------------------------------------------------------- Utganger.\n\nvar msg1 = {payload:(msgOut)}; \nvar msg2 = {payload:(mode_switch_off)}; \n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1820,"wires":[["894a523d.74629"],["d99f8960.f988a8"]],"inputLabels":["Gjenstående modus tid"],"outputLabels":["Trigger for switch turn off",""]},{"id":"f0de389b.c57ef8","type":"function","z":"c1e03843.9d14a8","name":"Borte - Format time","func":"// Borte modus, gjenstående tid fra modus startet\n// Gjør om fra sek. til dager og minutter (1-72t)\n\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\"); //Main mode status register, omgjort til string.\nvar sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\");          // Felles register for nedtelling av alle modus med CTD.\nvar time_sp = flow.get (\"vtr300_borte_modus_varighet_state\",\"default\");       // Nedtelling settpunkt for aktuell modus\n\n\n// Ved sec. \"NaN\" eller \"udefinert\", tidlig \"exit\" (returner).\n  if (isNaN(sec) || isNaN(time_sp)) {\n    return;\n  }\n\n//Calc.\nDays = (sec % 604800/86400);        //Days\nHours = (sec % 86400/3600);         //Hours\nMin = (sec % 3600/60);              //Minutes\nvar msgOut;\n\n//Fjerne desimaler & legger til benevnelse ------------------------------ Nedtelling, visning på switcher.\n// Viser settpunkt når inaktiv:\nif (main_mode_state != 'Borte') {\n  msgOut = time_sp + 't';\n}\n//Viser Dager når (< 1Uke & > 1Dag):\nelse if ((main_mode_state = 'Borte') && (sec < 604800) && (sec >= 86400)) {\n  msgOut = Days.toFixed(1) +'d';\n}\n// Viser Timer og Min. når (< 1Dag & >= 1t):\nelse if ((main_mode_state = 'Borte') && (sec < 86400) && (sec >= 3600)) {\n  msgOut = Hours.toFixed(1) +'t';  \n}\n// Viser Min. når (<= 1t & < 60sec):\nelse if ((main_mode_state = 'Borte') && (sec < 3600) && (sec > 60)) {\n  msgOut = Min.toFixed(0) +'m';    \n}\n// Viser < 1 min. når (<= 60 & < 0sec):\nelse if ((main_mode_state = 'Borte') && (sec <= 60) && (sec > 0)) {\n  msgOut = '< 1 min';    \n}\nelse {\n    msgOut = 'Inaktiv'; \n}\n\n//----------------------------------------------------------------------- Deaktiver mode switch. \n// switch for mode med nedtelling må deaktiveres dersom den timer ut uten å bli avbrutt av annen modus manuelt, for å ungå uønsket modus kall.\n\nvar mode_switch_off;\n\nif (main_mode_state != 'Borte') {\n  mode_switch_off = 1000; \n}\nelse if ((main_mode_state = 'Borte') && (sec <= 40) && (sec >= 15)) {\n  mode_switch_off = 0; \n}\nelse {\n    mode_switch_off = 1000; // Bare for å sette en verdi hþ�yere enn at \"switch off\" trigges.\n}\n\n//----------------------------------------------------------------------- Utganger.\n\nvar msg1 = {payload:(msgOut)}; \nvar msg2 = {payload:(mode_switch_off)}; \n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":1700,"wires":[["d1d0a4f3.fe7218"],["42e6c212.a477cc"]],"outputLabels":["Gjenstående modus tid","Trigger for switch turn off"]},{"id":"7abf90db.8fd38","type":"function","z":"c1e03843.9d14a8","name":"Borte switch off","func":"\nvar Modbus_response = flow.get (\"vtr300_main_mode_modbus_response\",\"default\"); // Modbus respons/svar i verdi ved modbus write \n\n// \"Modbus_response\" resettes  av Boost*/Borte*/Ferie*/Ildsted*/Party* switch off ved falling edge, om ikke blir \"Modbus Write\" interlock'et.\n//      Gjelder kun Main modus register og kun moduser som timer ut og går tilbake til forrige mode i aggr. PLS. \n//      Se \"Modbus write***\"\nflow.set(\"vtr300_main_mode_modbus_response\", 0, \"default\"); // \"Resetter\" Modbus respons (kun Main mode reg.) når timer moduser timer ut. \n\n\n// Switch som skal deaktiveres ved modus timeout.\nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_borte_modus\"\n   }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1720,"wires":[["73be7a53.d5c024"]]},{"id":"42e6c212.a477cc","type":"falling-edge","z":"c1e03843.9d14a8","name":"","threshold":"1","x":710,"y":1720,"wires":[["7abf90db.8fd38"]]},{"id":"73be7a53.d5c024","type":"api-call-service","z":"c1e03843.9d14a8","name":"Timer mode switch Off","server":"2c4e313e.d0fc5e","version":3,"debugenabled":true,"service_domain":"switch","service":"turn_off","entityId":"","data":"{}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1100,"y":1720,"wires":[[]]},{"id":"bc1c6488.5f3d78","type":"falling-edge","z":"c1e03843.9d14a8","name":"","threshold":"1","x":710,"y":1780,"wires":[["cb1147a7.b2f1a8"]]},{"id":"cb1147a7.b2f1a8","type":"function","z":"c1e03843.9d14a8","name":"Boost switch off","func":"\nvar Modbus_response = flow.get (\"vtr300_main_mode_modbus_response\",\"default\"); // Modbus respons/svar i verdi ved modbus write \n\n// \"Modbus_response\" resettes  av Boost*/Borte*/Ferie*/Ildsted*/Party* switch off ved falling edge, om ikke blir \"Modbus Write\" interlock'et.\n//      Gjelder kun Main modus register og kun moduser som timer ut og går tilbake til forrige mode i aggr. PLS. \n//      Se \"Modbus write***\"\nflow.set(\"vtr300_main_mode_modbus_response\", 0, \"default\"); // \"Resetter\" Modbus respons (kun Main mode reg.) nþ�r timer moduser timer ut. \n\n\n// Switch som skal deaktiveres ved modus timeout.\nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_boost_modus\"\n   }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1780,"wires":[["73be7a53.d5c024"]]},{"id":"1526bfb7.86017","type":"inject","z":"c1e03843.9d14a8","name":"Poll(10s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":1320,"y":1640,"wires":[["a4e990d0.8175e"]]},{"id":"d99f8960.f988a8","type":"falling-edge","z":"c1e03843.9d14a8","name":"","threshold":"1","x":710,"y":1840,"wires":[["4a64f899.c39988"]]},{"id":"4a64f899.c39988","type":"function","z":"c1e03843.9d14a8","name":"Ferie switch off","func":"\nvar Modbus_response = flow.get (\"vtr300_main_mode_modbus_response\",\"default\"); // Modbus respons/svar i verdi ved modbus write \n\n// \"Modbus_response\" resettes  av Boost*/Borte*/Ferie*/Ildsted*/Party* switch off ved falling edge, om ikke blir \"Modbus Write\" interlock'et.\n//      Gjelder kun Main modus register og kun moduser som timer ut og går tilbake til forrige mode i aggr. PLS. \n//      Se \"Modbus write***\"\nflow.set(\"vtr300_main_mode_modbus_response\", 0, \"default\"); // \"Resetter\" Modbus respons (kun Main mode reg.) når timer moduser timer ut. \n\n\n// Switch som skal deaktiveres ved modus timeout.\nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_ferie_modus\"\n   }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1840,"wires":[["73be7a53.d5c024"]]},{"id":"652289ee.4e4168","type":"falling-edge","z":"c1e03843.9d14a8","name":"","threshold":"1","x":710,"y":1900,"wires":[["5050cafe.dd0794"]]},{"id":"5050cafe.dd0794","type":"function","z":"c1e03843.9d14a8","name":"Ildsted switch off","func":"\nvar Modbus_response = flow.get (\"vtr300_main_mode_modbus_response\",\"default\"); // Modbus respons/svar i verdi ved modbus write \n\n// \"Modbus_response\" resettes  av Boost*/Borte*/Ferie*/Ildsted*/Party* switch off ved falling edge, om ikke blir \"Modbus Write\" interlock'et.\n//      Gjelder kun Main modus register og kun moduser som timer ut og går tilbake til forrige mode i aggr. PLS. \n//      Se \"Modbus write***\"\nflow.set(\"vtr300_main_mode_modbus_response\", 0, \"default\"); // \"Resetter\" Modbus respons (kun Main mode reg.) når timer moduser timer ut. \n\n\n// Switch som skal deaktiveres ved modus timeout.\nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_ildsted_modus\"\n   }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1900,"wires":[["73be7a53.d5c024"]]},{"id":"b748a60.eecc658","type":"falling-edge","z":"c1e03843.9d14a8","name":"","threshold":"1","x":710,"y":1960,"wires":[["ef045f21.642bf"]]},{"id":"ef045f21.642bf","type":"function","z":"c1e03843.9d14a8","name":"Party switch off","func":"\nvar Modbus_response = flow.get (\"vtr300_main_mode_modbus_response\",\"default\"); // Modbus respons/svar i verdi ved modbus write \n\n// \"Modbus_response\" resettes  av Boost*/Borte*/Ferie*/Ildsted*/Party* switch off ved falling edge, om ikke blir \"Modbus Write\" interlock'et.\n//      Gjelder kun Main modus register og kun moduser som timer ut og går tilbake til forrige mode i aggr. PLS. \n//      Se \"Modbus write***\"\nflow.set(\"vtr300_main_mode_modbus_response\", 0, \"default\"); // \"Resetter\" Modbus respons (kun Main mode reg.) når timer moduser timer ut. \n\n\n// Switch som skal deaktiveres ved modus timeout.\nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_party_modus\"\n   }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1960,"wires":[["73be7a53.d5c024"]]},{"id":"9ff55cd4.2f20b","type":"poll-state","z":"c1e03843.9d14a8","name":"Climate state","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"10","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"climate.vtr300_tilluft_sp","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":370,"y":260,"wires":[["1ed9650a.de34ab","8538d6d3.0b4838"]]},{"id":"1ed9650a.de34ab","type":"trigger","z":"c1e03843.9d14a8","name":"Wait 2s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":540,"y":240,"wires":[["1e36d64c.9f172a"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke gó�r ikke settpunkt gjennom."},{"id":"cfee3629.76b4e8","type":"comment","z":"c1e03843.9d14a8","name":"Gjelder kun modus switcher som \"timer\" ut.","info":"","x":960,"y":1680,"wires":[]},{"id":"b54dda1e.e4c0c8","type":"inject","z":"c1e03843.9d14a8","name":"Poll(10s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":100,"y":3560,"wires":[["4becc2c8.6e5edc"]]},{"id":"4becc2c8.6e5edc","type":"function","z":"c1e03843.9d14a8","name":"Read","func":"var fc=3;\nvar sa=2504;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":3560,"wires":[["3146fba0.9df104"]]},{"id":"3146fba0.9df104","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Eco.mode(r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":370,"y":3560,"wires":[[],["e1ca2ea.5f312d"]],"info":"VTR300 Intern UR"},{"id":"e1ca2ea.5f312d","type":"function","z":"c1e03843.9d14a8","name":"Eco mode","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":3560,"wires":[["f42b086a.d3fe78","76faae45.eb307"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1¾�C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"f42b086a.d3fe78","type":"ha-entity","z":"c1e03843.9d14a8","name":"Eco mode state","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"vtr300_eco_mode_state"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:leaf"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":680,"y":3600,"wires":[[]]},{"id":"cf18cec.f70653","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Eco. Off","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.vtr300_eco_mode","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1150,"y":3540,"wires":[[]]},{"id":"c8bb1c60.fb0df","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Eco. On","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_eco_mode","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1150,"y":3580,"wires":[[]]},{"id":"76166588.d9864c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Eco.mode(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":550,"y":3500,"wires":[["3acbf886.4ff818"],[]]},{"id":"81d33929.60d058","type":"function","z":"c1e03843.9d14a8","name":"On/Off","func":"var fc=6;\nvar sa=2504;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":3500,"wires":[["76166588.d9864c"]],"info":"# 0  Deaktiverer Eco drift\n# 1  Aktiverer Eco"},{"id":"b1bdfe72.e544d","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"off","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":3500,"wires":[["81d33929.60d058"]]},{"id":"553e7284.6179fc","type":"poll-state","z":"c1e03843.9d14a8","name":"Eco mode trigger","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_boolean.vtr300_eco_mode_dummy","state_type":"str","halt_if":"vtr300_eco_mode_modbus_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":120,"y":3500,"wires":[["b1bdfe72.e544d"],[]]},{"id":"39818598.1bc3ba","type":"switch","z":"c1e03843.9d14a8","name":"Split","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1010,"y":3560,"wires":[["cf18cec.f70653"],["c8bb1c60.fb0df"]]},{"id":"c723d9ad.fdd338","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":880,"y":3560,"wires":[["39818598.1bc3ba"]]},{"id":"76faae45.eb307","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"off","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"on","tot":"str"},{"t":"set","p":"vtr300_eco_mode_modbus_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":3560,"wires":[["c723d9ad.fdd338"]]},{"id":"2abfd68d.e6225a","type":"change","z":"c1e03843.9d14a8","name":"Resp. to flow","rules":[{"t":"set","p":"vtr300_tilluft_temp_sp_modbus_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":200,"wires":[["fff9f455.cffaf8"]]},{"id":"df8227e7.a72c48","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":1050,"y":140,"wires":[]},{"id":"83be6967.f4ee88","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Climate Tilluft - Dummy switch","server":"868599a7.b14688","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.vtr300_climate_dummyswitch","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":420,"y":340,"wires":[["168e0b11.26c0e5"]]},{"id":"7ff0b2d2.8945cc","type":"change","z":"c1e03843.9d14a8","name":"Request heat assist - Set Global","rules":[{"t":"set","p":"vtr300_request_heat_assist","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":340,"wires":[[]]},{"id":"3acbf886.4ff818","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":730,"y":3500,"wires":[]},{"id":"3d7a7378.75266c","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":850,"y":3700,"wires":[]},{"id":"2b3417c1.cf4998","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":960,"y":3760,"wires":[["39958fdb.4785a"]]},{"id":"c3996229.d2e7a","type":"poll-state","z":"c1e03843.9d14a8","name":"Tilluft/Avtrekks reg.","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"40","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_reg_metode","state_type":"str","halt_if":"vtr300_reg_metode_modbus_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":150,"y":3700,"wires":[["ee8c3d89.8e3c6"],[]]},{"id":"6cc5047f.6789fc","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_intern_ur_abs_value_min","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":4920,"wires":[["b309793a.025738"]]},{"id":"56811f72.1643f","type":"delay","z":"c1e03843.9d14a8","name":"5min","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":950,"y":4920,"wires":[["6cc5047f.6789fc"]]},{"id":"8c91146.0c0ede8","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_intern_ur_abs_value_hour","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":4880,"wires":[["292f4659.b8b7fa"]]},{"id":"1caee2b.e9d1a1d","type":"comment","z":"c1e03843.9d14a8","name":"Kjølegjenvinning --------------------------------------------------------------------------------------------------------------------------------------------------- Node Red produserte HA entiteter","info":"","x":530,"y":3840,"wires":[]},{"id":"e687bd5b.d2ee8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Grense for tillatt Gjenv.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_cooling_recovery_allow_limit_temp_sp","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1120,"y":4060,"wires":[[]]},{"id":"7c21d064.7bdca","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":920,"y":4060,"wires":[["e687bd5b.d2ee8"]]},{"id":"20800375.2bc5fc","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_cooling_recovery_allow_limit_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":4060,"wires":[["7c21d064.7bdca"]]},{"id":"3e6632c6.5138de","type":"function","z":"c1e03843.9d14a8","name":"0->10 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":4060,"wires":[["20800375.2bc5fc"]],"info":"# Engineering range: 0°C -> 10°C\n"},{"id":"b9c2274e.8e70d8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Kjølegjenv. grense (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":440,"y":4060,"wires":[[],["3e6632c6.5138de"]]},{"id":"2f0a7b53.3e8274","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":100,"y":4060,"wires":[["75252460.8fce9c"]]},{"id":"589d3891.7a8848","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Kjølegjenv. grense (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":640,"y":4020,"wires":[["b9f07e77.109e6"],[]]},{"id":"4ae34c7b.9d8574","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=2314;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":4020,"wires":[["589d3891.7a8848"]]},{"id":"92890302.5c748","type":"function","z":"c1e03843.9d14a8","name":"0->100","func":"var Temp_scaled = msg.payload;\nvar Temp_raw;\n\nTemp_raw = (Temp_scaled *10); \n\nmsg.payload = Temp_raw;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":4020,"wires":[["4ae34c7b.9d8574"]],"info":"# Engineering range: 12°C -> 30°C"},{"id":"5a4d5304.f4937c","type":"poll-state","z":"c1e03843.9d14a8","name":"Grense for tillatt Gjenv.","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"40","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_cooling_recovery_allow_limit_temp_sp","state_type":"num","halt_if":"vtr300_cooling_recovery_allow_limit_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":120,"y":4020,"wires":[["92890302.5c748"],[]]},{"id":"75252460.8fce9c","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2314;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":4060,"wires":[["b9c2274e.8e70d8"]]},{"id":"b9f07e77.109e6","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":850,"y":4020,"wires":[]},{"id":"c6a015a8.4a7e78","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=2133;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":3920,"wires":[["92e16b21.e94ee8"]]},{"id":"92e16b21.e94ee8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Kjølegjenv. cmd (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":430,"y":3920,"wires":[["2d75426a.00580e"],["bc5d0dd0.7c55a"]]},{"id":"bc5d0dd0.7c55a","type":"function","z":"c1e03843.9d14a8","name":"0->1","func":"var State = msg.payload.data[0];\n\nmsg.payload = State;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":3920,"wires":[["f76f0b7.3ec7ff8"]],"info":"# Engineering range: 0 -> 1"},{"id":"83a12cc4.e75ec","type":"inject","z":"c1e03843.9d14a8","name":"Poll(10s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":100,"y":3920,"wires":[["c6a015a8.4a7e78"]]},{"id":"4f495e26.a963a","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Kjølegjenv. cmd (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":610,"y":3880,"wires":[["bf004728.64f2a8"],[]]},{"id":"1d73a998.3aaae6","type":"function","z":"c1e03843.9d14a8","name":"On/Off","func":"var fc=6;\nvar sa=2133;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":3880,"wires":[["4f495e26.a963a"]],"info":"# 0  Deaktiverer Eco drift\n# 1  Aktiverer Eco"},{"id":"69149876.f37918","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"off","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":3880,"wires":[["1d73a998.3aaae6"]]},{"id":"c5a2a363.c5aeb","type":"poll-state","z":"c1e03843.9d14a8","name":"Kjølegjenv. mode trigger","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"40","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_boolean.vtr300_cooling_recovery_dummy","state_type":"str","halt_if":"vtr300_cooling_recovery_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":130,"y":3880,"wires":[["69149876.f37918"],[]]},{"id":"bf004728.64f2a8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":810,"y":3880,"wires":[]},{"id":"f76f0b7.3ec7ff8","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"off","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"on","tot":"str"},{"t":"set","p":"vtr300_cooling_recovery_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":3920,"wires":[["42777d77.544224"]]},{"id":"42777d77.544224","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":940,"y":3920,"wires":[["f74d1374.a2233"]]},{"id":"f74d1374.a2233","type":"switch","z":"c1e03843.9d14a8","name":"Split","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1070,"y":3920,"wires":[["f2939a8f.60c8b8"],["389be47b.5242bc"]]},{"id":"f2939a8f.60c8b8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set kjølegjenv. Off","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.vtr300_cooling_recovery","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1230,"y":3900,"wires":[[]]},{"id":"389be47b.5242bc","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set kjølegjenv. On","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_cooling_recovery","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1230,"y":3940,"wires":[[]]},{"id":"2d75426a.00580e","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":790,"y":3960,"wires":[]},{"id":"f8f82165.a34c4","type":"ha-entity","z":"c1e03843.9d14a8","name":"Cool recovery states","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_cooling_recovery_states"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:snowflake"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1000,"y":280,"wires":[[]],"info":"# 0=sommerdrift\n# 1=Vinterdrift (status basert på fukt i inntak)"},{"id":"8538d6d3.0b4838","type":"function","z":"c1e03843.9d14a8","name":"Kjølegjenvinning","func":"\nvar climate_state = msg.payload; // Off, Heat, & Cool.\nvar cool_recovery = flow.get (\"vtr300_cooling_recovery_response\",\"default\"); // Switch for om kjølegjenvinning modus er on/off \n\nvar cool_recovery_state; \n\n// Tilstand kjøling (cooling recovery) for visualisering på knapp. \n// Sett Cool recovery tilstand (kjølegjenvinning) for visualisering på knapp.\nif ((climate_state === 'cool') && (cool_recovery === 'on')) { \n  cool_recovery_state = 'Kjøler';\n}\n// Standby\nelse if ((climate_state === 'heat') && (cool_recovery === 'on')) { \n  cool_recovery_state = 'Standby';\n}\n\nelse {\n  cool_recovery_state = 'Av';\n}\n\nvar msg1 = {payload:(cool_recovery_state)};\n\nreturn [msg1];\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":280,"wires":[["7845d64a.a3a2f8"]],"outputLabels":["Kjølegjenvinning tilstand "]},{"id":"833ca3e2.44bc4","type":"comment","z":"c1e03843.9d14a8","name":"Fri kjøling / Nattkjøling --------------------------------------------------------------------------------------------------------------------------------------------------- Node Red produserte HA entiteter","info":"","x":1970,"y":1740,"wires":[]},{"id":"d122ea4c.d445e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=4100;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1820,"wires":[["70df5046.11825"]]},{"id":"70df5046.11825","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj. cmd (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1830,"y":1820,"wires":[[],["f200bea8.08a7d"]]},{"id":"f200bea8.08a7d","type":"function","z":"c1e03843.9d14a8","name":"0->1","func":"var State = msg.payload.data[0];\n\nmsg.payload = State;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":1820,"wires":[["2eca1a7.462e7e6"]],"info":"# Engineering range: 0 -> 1"},{"id":"da13f0b1.beaa1","type":"inject","z":"c1e03843.9d14a8","name":"Poll(15s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"15","crontab":"","once":true,"onceDelay":"12","topic":"","payload":"","payloadType":"date","x":1520,"y":1820,"wires":[["d122ea4c.d445e8"]]},{"id":"b884a521.777968","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj. cmd (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2180,"y":1780,"wires":[["fb87bb08.8346f8"],[]]},{"id":"eafc2d10.eb979","type":"function","z":"c1e03843.9d14a8","name":"On/Off","func":"var fc=6;\nvar sa=4100;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2030,"y":1780,"wires":[["b884a521.777968"]],"info":"# 0  Deaktiverer Eco drift\n# 1  Aktiverer Eco"},{"id":"8cea5fbd.9912b","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"off","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"on","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1900,"y":1780,"wires":[["eafc2d10.eb979"]]},{"id":"55f71c68.6cc4a4","type":"poll-state","z":"c1e03843.9d14a8","name":"Fri /Nattkjøling mode trigger","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_boolean.vtr300_freecooling_dummy","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1560,"y":1780,"wires":[["2a4fffe7.7b514"]]},{"id":"2a4fffe7.7b514","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecooling_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1760,"y":1780,"wires":[["8cea5fbd.9912b"]]},{"id":"fb87bb08.8346f8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2370,"y":1780,"wires":[]},{"id":"2eca1a7.462e7e6","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"off","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"on","tot":"str"},{"t":"set","p":"vtr300_freecooling_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2140,"y":1820,"wires":[["efaede2d.9bc18"]]},{"id":"efaede2d.9bc18","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2320,"y":1820,"wires":[["70ce233b.a7862c"]]},{"id":"70ce233b.a7862c","type":"switch","z":"c1e03843.9d14a8","name":"Split","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2450,"y":1820,"wires":[["a0d30a7f.c69e78"],["ec21aa78.8db488"]]},{"id":"a0d30a7f.c69e78","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Fri/Nattkjøling Off","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.vtr300_freecooling","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2620,"y":1800,"wires":[[]]},{"id":"ec21aa78.8db488","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Fri/Nattkjøling On","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.vtr300_freecooling","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2620,"y":1840,"wires":[[]]},{"id":"5b2ddac0.c908b4","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Min Hi utetemp dag akt.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_freecooling_start_outdoor_daytime_min_temp","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2540,"y":1920,"wires":[[]]},{"id":"2e667056.0b395","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2340,"y":1920,"wires":[["5b2ddac0.c908b4"]]},{"id":"53e3c44d.fcc51c","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_freecooling_start_outdoor_daytime_min_temp_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2200,"y":1920,"wires":[["2e667056.0b395"]]},{"id":"5d555a42.444bb4","type":"function","z":"c1e03843.9d14a8","name":"12->30 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2050,"y":1920,"wires":[["53e3c44d.fcc51c"]],"info":"# Engineering range: 0°C -> 10°C\n"},{"id":"6b33e6cb.9fcb28","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.dag grense (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1850,"y":1920,"wires":[[],["5d555a42.444bb4"]]},{"id":"6fc95cb3.f02cc4","type":"inject","z":"c1e03843.9d14a8","name":"Poll(1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"12","topic":"","payload":"","payloadType":"date","x":1520,"y":1920,"wires":[["bf4f8697.2f65b8"]]},{"id":"521c10ae.7b355","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj. dag grense (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2280,"y":1880,"wires":[["96d7b889.531758"],[]]},{"id":"81637b79.eaefb8","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=4101;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2090,"y":1880,"wires":[["521c10ae.7b355"]]},{"id":"bb39fed0.d2bf3","type":"function","z":"c1e03843.9d14a8","name":"120->300","func":"var Temp_scaled = msg.payload;\nvar Temp_raw;\n\nTemp_raw = (Temp_scaled *10); \n\nmsg.payload = Temp_raw;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1940,"y":1880,"wires":[["81637b79.eaefb8"]],"info":"# Engineering range: 12°C -> 30°C"},{"id":"4f0158eb.687f28","type":"poll-state","z":"c1e03843.9d14a8","name":"Min Hi utetemp dag aktiver","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_freecooling_start_outdoor_daytime_min_temp","state_type":"num","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1550,"y":1880,"wires":[["49a61174.87c7f"]]},{"id":"bf4f8697.2f65b8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=4101;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1920,"wires":[["6b33e6cb.9fcb28"]]},{"id":"49a61174.87c7f","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecooling_start_outdoor_daytime_min_temp_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1800,"y":1880,"wires":[["bb39fed0.d2bf3"]]},{"id":"96d7b889.531758","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2490,"y":1880,"wires":[]},{"id":"29a589f2.bbc046","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Hi utetemp natt deakt.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_freecooling_stop_outdoor_temp_hi_sp","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2530,"y":2020,"wires":[[]]},{"id":"d0baff69.28fb1","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2340,"y":2020,"wires":[["29a589f2.bbc046"]]},{"id":"b84bf482.f1b148","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_freecooling_stop_outdoor_temp_hi_sp_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2200,"y":2020,"wires":[["d0baff69.28fb1"]]},{"id":"b2f14bb4.4df6c8","type":"function","z":"c1e03843.9d14a8","name":"7->30 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2040,"y":2020,"wires":[["b84bf482.f1b148"]],"info":"# Engineering range: 0°C -> 10°C\n"},{"id":"2f33884b.e33088","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.natt grense (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1850,"y":2020,"wires":[[],["b2f14bb4.4df6c8"]]},{"id":"22e0bf7f.21841","type":"inject","z":"c1e03843.9d14a8","name":"Poll(1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"12","topic":"","payload":"","payloadType":"date","x":1520,"y":2020,"wires":[["ec7f250f.e83e38"]]},{"id":"ad17d341.dcad5","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.natt grense (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2270,"y":1980,"wires":[["1ab94f70.5ceff1"],[]]},{"id":"d0c4fabe.96dda8","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=4102;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2090,"y":1980,"wires":[["ad17d341.dcad5"]]},{"id":"efc4b324.3f835","type":"function","z":"c1e03843.9d14a8","name":"70->300","func":"var Temp_scaled = msg.payload;\nvar Temp_raw;\n\nTemp_raw = (Temp_scaled *10); \n\nmsg.payload = Temp_raw;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1940,"y":1980,"wires":[["d0c4fabe.96dda8"]],"info":"# Engineering range: 12°C -> 30­�C"},{"id":"8451fd77.1f04a","type":"poll-state","z":"c1e03843.9d14a8","name":"Hi utetemp natt deaktiver","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_freecooling_stop_outdoor_temp_hi_sp","state_type":"num","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1610,"y":1980,"wires":[["417de853.648a18"]]},{"id":"ec7f250f.e83e38","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=4102;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":2020,"wires":[["2f33884b.e33088"]]},{"id":"417de853.648a18","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecooling_stop_outdoor_temp_hi_sp_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1800,"y":1980,"wires":[["efc4b324.3f835"]]},{"id":"1ab94f70.5ceff1","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2490,"y":1980,"wires":[]},{"id":"93dd8341.8f7f4","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Lo uttemp natt deakt.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_freecooling_stop_outdoor_temp_lo_sp","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2550,"y":2100,"wires":[[]]},{"id":"c7bd684.5065998","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2360,"y":2100,"wires":[["93dd8341.8f7f4"]]},{"id":"df557a82.076ba8","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_freecooling_stop_outdoor_temp_lo_sp_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2220,"y":2100,"wires":[["c7bd684.5065998"]]},{"id":"38ca2aa7.5d4176","type":"function","z":"c1e03843.9d14a8","name":"7->30 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2080,"y":2100,"wires":[["df557a82.076ba8"]],"info":"# Engineering range: 0°C -> 10°C\n"},{"id":"6d8fbd8a.0ea1f4","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.natt L grense (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1900,"y":2100,"wires":[[],["38ca2aa7.5d4176"]]},{"id":"8f172bc.60acdd8","type":"inject","z":"c1e03843.9d14a8","name":"Poll(1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"12","topic":"","payload":"","payloadType":"date","x":1560,"y":2100,"wires":[["1912973d.1329f9"]]},{"id":"9a6067fe.a2d478","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.natt L grense (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2320,"y":2060,"wires":[["a87912fe.bee6f"],[]]},{"id":"3abd4f51.1d69a","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=4103;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2130,"y":2060,"wires":[["9a6067fe.a2d478"]]},{"id":"790f6bb4.2b1784","type":"function","z":"c1e03843.9d14a8","name":"70->300","func":"var Temp_scaled = msg.payload;\nvar Temp_raw;\n\nTemp_raw = (Temp_scaled *10); \n\nmsg.payload = Temp_raw;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":2060,"wires":[["3abd4f51.1d69a"]],"info":"# Engineering range: 12°C -> 30°C"},{"id":"fe0ba17b.753d1","type":"poll-state","z":"c1e03843.9d14a8","name":"Lo utetemp natt deaktiver","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_freecooling_stop_outdoor_temp_lo_sp","state_type":"num","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1650,"y":2060,"wires":[["ce585e52.b3ded"]]},{"id":"1912973d.1329f9","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=4103;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2100,"wires":[["6d8fbd8a.0ea1f4"]]},{"id":"ce585e52.b3ded","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecooling_stop_outdoor_temp_lo_sp_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1840,"y":2060,"wires":[["790f6bb4.2b1784"]]},{"id":"a87912fe.bee6f","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2530,"y":2060,"wires":[]},{"id":"b729f797.de0538","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Lo avtr.temp natt deakt.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_freecooling_stop_extractair_temp_lo_sp","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2560,"y":2180,"wires":[[]]},{"id":"ffcbf084.679f4","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2360,"y":2180,"wires":[["b729f797.de0538"]]},{"id":"4c05680a.829138","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_freecooling_stop_extractair_temp_lo_sp_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2220,"y":2180,"wires":[["ffcbf084.679f4"]]},{"id":"d0b08cc7.2beae","type":"function","z":"c1e03843.9d14a8","name":"12->30 [°C]","func":"var Temp_raw = msg.payload.data[0];\nvar Temp_scaled;\n\nif (Temp_raw < 6280) { \n  Temp_scaled = (Temp_raw *0.1);\n}\nelse {\n  Temp_scaled = ((Temp_raw - 65535) *0.1); \n}\n\nmsg.payload = parseFloat((Temp_scaled).toFixed(2));\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2070,"y":2180,"wires":[["4c05680a.829138"]],"info":"# Engineering range: 0°C -> 10°C\n"},{"id":"4ca595a0.d3d86c","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.avtr. L grense (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1880,"y":2180,"wires":[[],["d0b08cc7.2beae"]]},{"id":"643f8bc7.706d94","type":"inject","z":"c1e03843.9d14a8","name":"Poll(1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"12","topic":"","payload":"","payloadType":"date","x":1540,"y":2180,"wires":[["671844d2.b331cc"]]},{"id":"b0f9a29a.ffa2b","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.avtr. L grense (r)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2320,"y":2140,"wires":[["f103853c.658ab8"],[]]},{"id":"457beb24.35d474","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=4104;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2130,"y":2140,"wires":[["b0f9a29a.ffa2b"]]},{"id":"cf0db275.4ff48","type":"function","z":"c1e03843.9d14a8","name":"120->300","func":"var Temp_scaled = msg.payload;\nvar Temp_raw;\n\nTemp_raw = (Temp_scaled *10); \n\nmsg.payload = Temp_raw;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":2140,"wires":[["457beb24.35d474"]],"info":"# Engineering range: 12°C -> 30�C"},{"id":"c118d497.1c78b8","type":"poll-state","z":"c1e03843.9d14a8","name":"Lo avtr.temp natt deaktiver","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_freecooling_stop_extractair_temp_lo_sp","state_type":"num","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1650,"y":2140,"wires":[["830b15d.58b34e8"]]},{"id":"671844d2.b331cc","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=4104;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":2180,"wires":[["4ca595a0.d3d86c"]]},{"id":"830b15d.58b34e8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecooling_stop_extractair_temp_lo_sp_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1840,"y":2140,"wires":[["cf0db275.4ff48"]]},{"id":"f103853c.658ab8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2530,"y":2140,"wires":[]},{"id":"83ed139f.782ca","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.start hr (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2440,"y":2220,"wires":[[],[]]},{"id":"1da930d2.8f55df","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=4105;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":2220,"wires":[["83ed139f.782ca"]]},{"id":"1705b658.c6ffda","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":2000,"y":2240,"wires":[["c78bba4a.3e2be8"],["a8f45da8.6826"]]},{"id":"e8a85379.ede9d","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=4106;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":2260,"wires":[["1914abce.594d64"]]},{"id":"1914abce.594d64","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.start m. (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2440,"y":2260,"wires":[[],[]]},{"id":"b1ce19b2.0c7098","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecool_night_prd_start_sp_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1840,"y":2240,"wires":[["1705b658.c6ffda"]]},{"id":"8960e60b.6256c8","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":2300,"wires":[["9941bc42.8b6b1"]]},{"id":"3a8b960d.7602ca","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Frikjøl natt start_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_freecool_night_prd_start_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2590,"y":2300,"wires":[[]]},{"id":"f5cff88c.53d2e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=4105;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":2300,"wires":[["1b8067aa.6d5cf8"]]},{"id":"1b8067aa.6d5cf8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.strt hr/m (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1900,"y":2300,"wires":[[],["8960e60b.6256c8"]]},{"id":"289e9d49.ddec02","type":"inject","z":"c1e03843.9d14a8","name":"Poll (1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":1570,"y":2300,"wires":[["f5cff88c.53d2e8"]]},{"id":"de5c6118.57961","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Frikjøl natt start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_freecool_night_prd_start_sp","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1650,"y":2240,"wires":[["b1ce19b2.0c7098"]]},{"id":"c78bba4a.3e2be8","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":2150,"y":2220,"wires":[["1da930d2.8f55df"]]},{"id":"a8f45da8.6826","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":2150,"y":2260,"wires":[["e8a85379.ede9d"]]},{"id":"9941bc42.8b6b1","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_freecool_night_prd_start_sp_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2260,"y":2300,"wires":[["46d746c9.f6a388"]]},{"id":"46d746c9.f6a388","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2400,"y":2300,"wires":[["3a8b960d.7602ca"]]},{"id":"9f8d2ce0.179b8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.stop hr (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2420,"y":2340,"wires":[[],[]]},{"id":"9ac77cc8.cc12","type":"function","z":"c1e03843.9d14a8","name":"Set Hour","func":"\nvar fc=6;\nvar sa=4107;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":2340,"wires":[["9f8d2ce0.179b8"]]},{"id":"456ba080.fe788","type":"function","z":"c1e03843.9d14a8","name":"Split Hr.& Min","func":"\nvar output = msg.payload.split(\":\");\nvar hour = parseInt(output[0]);\nvar min = parseInt(output[1]);\n\nvar msg1 = {payload:hour};\nvar msg2 = {payload:min};\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1980,"y":2360,"wires":[["a02793eb.3f9a3"],["11934450.ff12ec"]]},{"id":"9cf47a87.149d98","type":"function","z":"c1e03843.9d14a8","name":"Set Min","func":"\nvar fc=6;\nvar sa=4108;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":2380,"wires":[["4ab3f927.0deb98"]]},{"id":"4ab3f927.0deb98","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.stop m (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2420,"y":2380,"wires":[[],[]]},{"id":"5a207519.751a9c","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecool_night_prd_end_sp_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1820,"y":2360,"wires":[["456ba080.fe788"]]},{"id":"6ad980f5.292fa","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2080,"y":2420,"wires":[["25cb0d29.d93982"]]},{"id":"37d4260f.23c2da","type":"api-call-service","z":"c1e03843.9d14a8","name":"Sch. Frikjøl natt end_sp","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_datetime","service":"set_datetime","entityId":"input_datetime.vtr300_freecool_night_prd_end_sp","data":"{\"time\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2570,"y":2420,"wires":[[]]},{"id":"b2465fde.e568f","type":"function","z":"c1e03843.9d14a8","name":"Modbus read","func":"var fc=3;\nvar sa=4107;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2420,"wires":[["5f4961b6.576ba"]]},{"id":"5f4961b6.576ba","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.stop hr/m (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1890,"y":2420,"wires":[[],["6ad980f5.292fa"]]},{"id":"ccf4c1cb.07527","type":"inject","z":"c1e03843.9d14a8","name":"Poll (1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":1550,"y":2420,"wires":[["b2465fde.e568f"]]},{"id":"99bc9847.a56a98","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch. Frikjøl natt end_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_freecool_night_prd_end_sp","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1640,"y":2360,"wires":[["5a207519.751a9c"]]},{"id":"a02793eb.3f9a3","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":2130,"y":2340,"wires":[["9ac77cc8.cc12"]]},{"id":"11934450.ff12ec","type":"rbe","z":"c1e03843.9d14a8","name":"POC","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":2130,"y":2380,"wires":[["9cf47a87.149d98"]]},{"id":"25cb0d29.d93982","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_freecool_night_prd_end_sp_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":2420,"wires":[["54a4b4c2.a52a7c"]]},{"id":"54a4b4c2.a52a7c","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2380,"y":2420,"wires":[["37d4260f.23c2da"]]},{"id":"996c8050.aca18","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=4111;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2090,"y":2560,"wires":[["a9be4121.73bf8"]]},{"id":"d512f2a9.9ae17","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Normal","fromt":"str","to":"3","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"HÈ��y","fromt":"str","to":"4","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Maksimum","fromt":"str","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1940,"y":2560,"wires":[["996c8050.aca18"]]},{"id":"5c51b0cf.a0576","type":"function","z":"c1e03843.9d14a8","name":"Read","func":"var fc=3;\nvar sa=4111;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":2600,"wires":[["14bdf54e.8d71cb"]]},{"id":"14bdf54e.8d71cb","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.tilluft hast (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1890,"y":2600,"wires":[[],["58dc6021.07274"]],"info":"VTR300 Intern UR"},{"id":"58dc6021.07274","type":"function","z":"c1e03843.9d14a8","name":"Vifte hast.","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2060,"y":2600,"wires":[["ac1d18c4.2dadf8"]]},{"id":"952dfbb3.0363f8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Frikjøl tilluft vifte hast.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_freecooling_supply_fan_level_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2610,"y":2600,"wires":[[]]},{"id":"ac1d18c4.2dadf8","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"3","fromt":"num","to":"Normal","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"4","fromt":"num","to":"Høy","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"5","fromt":"num","to":"Maksimum","tot":"str"},{"t":"set","p":"vtr300_freecooling_supply_fan_level_set_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":2600,"wires":[["446f9bc4.959cc4"]]},{"id":"a9be4121.73bf8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.tilluft hast (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2270,"y":2560,"wires":[["c3c8e14.336d82"],[]]},{"id":"c3c8e14.336d82","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2470,"y":2560,"wires":[]},{"id":"446f9bc4.959cc4","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2420,"y":2600,"wires":[["952dfbb3.0363f8"]]},{"id":"cea2ba35.3d9e28","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecooling_supply_fan_level_set_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1800,"y":2560,"wires":[["d512f2a9.9ae17"]]},{"id":"688b7d79.6bd894","type":"inject","z":"c1e03843.9d14a8","name":"Poll (1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":1590,"y":2600,"wires":[["5c51b0cf.a0576"]]},{"id":"904b6bb0.a06948","type":"poll-state","z":"c1e03843.9d14a8","name":"Frikjøl tilluft vifte hast.","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_freecooling_supply_fan_level_set","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1620,"y":2560,"wires":[["cea2ba35.3d9e28"]]},{"id":"d223bfd5.eebc7","type":"ha-entity","z":"c1e03843.9d14a8","name":"Frikjøl. state","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_freecooling_state"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:snowflake-variant"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":2590,"y":2500,"wires":[[]]},{"id":"b6c8e5cf.e78468","type":"function","z":"c1e03843.9d14a8","name":"Frikj.state","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2000,"y":2500,"wires":[["1f8d8b5b.a343d5"]],"info":"# Engineering range: -30°C -> 0°C\n\nRaw 0 = 0°C\nRaw 65526 = -1°C\nRaw 65236 = -15°C\n\nRange 65526 - 65236 = 290\n290/29= 10Raw/1°C"},{"id":"86532da.144ffd","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.state (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1850,"y":2500,"wires":[[],["b6c8e5cf.e78468"]],"info":"VTR300 Intern UR"},{"id":"e22282b9.3bf37","type":"function","z":"c1e03843.9d14a8","name":"Read","func":"var fc=3;\nvar sa=4110;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2500,"wires":[["86532da.144ffd"]]},{"id":"21771b97.4046b4","type":"inject","z":"c1e03843.9d14a8","name":"Poll(10s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":true,"onceDelay":"7","topic":"","payload":"","payloadType":"date","x":1580,"y":2500,"wires":[["e22282b9.3bf37"]]},{"id":"1f8d8b5b.a343d5","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str.","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Inaktiv","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Kjøler","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2140,"y":2500,"wires":[["d09a9875.aca1b8"]]},{"id":"fbe641ae.e3b2b","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=4112;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2090,"y":2660,"wires":[["4b0c8f41.b7051"]]},{"id":"accb8a2b.a04408","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Normal","fromt":"str","to":"3","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Høy","fromt":"str","to":"4","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Maksimum","fromt":"str","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1940,"y":2660,"wires":[["fbe641ae.e3b2b"]]},{"id":"827086b9.7d0138","type":"function","z":"c1e03843.9d14a8","name":"Read","func":"var fc=3;\nvar sa=4112;\nvar addresses=1;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":2700,"wires":[["418f49e9.b80058"]]},{"id":"418f49e9.b80058","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Frikj.avtr. hast (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":1890,"y":2700,"wires":[[],["6f29575a.3eca68"]],"info":"VTR300 Intern UR"},{"id":"6f29575a.3eca68","type":"function","z":"c1e03843.9d14a8","name":"Vifte hast.","func":"var msg0 = msg.payload.data[0];\n\nmsg.payload = msg0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2060,"y":2700,"wires":[["65869109.e424b"]]},{"id":"8e0b6341.ccca1","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Frikjøl avtr. vifte hast.","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_freecooling_extract_fan_level_set","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2610,"y":2700,"wires":[[]]},{"id":"65869109.e424b","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"3","fromt":"num","to":"Normal","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"4","fromt":"num","to":"Høy","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"5","fromt":"num","to":"Maksimum","tot":"str"},{"t":"set","p":"vtr300_freecooling_extract_fan_level_set_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":2700,"wires":[["cb1a453c.722ae8"]]},{"id":"4b0c8f41.b7051","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Frikj.avtr. hast (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2270,"y":2660,"wires":[["1e084261.e68eae"],[]]},{"id":"1e084261.e68eae","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":2470,"y":2660,"wires":[]},{"id":"cb1a453c.722ae8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":2420,"y":2700,"wires":[["8e0b6341.ccca1"]]},{"id":"5f223515.018fac","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"vtr300_freecooling_extract_fan_level_set_response","vt":"flow"}],"checkall":"true","repair":false,"outputs":1,"x":1800,"y":2660,"wires":[["accb8a2b.a04408"]]},{"id":"90068e08.ed61c","type":"inject","z":"c1e03843.9d14a8","name":"Poll (1m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":1590,"y":2700,"wires":[["827086b9.7d0138"]]},{"id":"5871cb2f.51bd34","type":"poll-state","z":"c1e03843.9d14a8","name":"Frikjøl avtr. vifte hast.","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_freecooling_extract_fan_level_set","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":1620,"y":2660,"wires":[["5f223515.018fac"]]},{"id":"6ba7d4a2.65fbbc","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1610,"y":80,"wires":[["a75d0d13.075a5"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"d09a9875.aca1b8","type":"function","z":"c1e03843.9d14a8","name":"Button states","func":"\nvar free_cool_state = msg.payload; // Kjøler/Inaktiv.\nvar free_cool_switch = flow.get (\"vtr300_freecooling_response\",\"default\"); // Switch for om frikjøling modus er on/off \n\nvar freecool_states; \n\n// Tilstander Frikjøling/Nattkjøling for visualisering på knapp. \nif ((free_cool_state === 'Kjøler') && (free_cool_switch === 'on')) { \n  freecool_states = 'Kjøler';\n}\n// Standby.\nelse if ((free_cool_state === 'Inaktiv') && (free_cool_switch === 'on')) { \n  freecool_states = 'Standby';\n}\n// Av.\nelse {\n  freecool_states = 'Av';\n}\n\nvar msg1 = {payload:(freecool_states)};\n\nreturn [msg1];\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2290,"y":2500,"wires":[["6dff6144.090fc"]],"outputLabels":["Kjølegjenvinning tilstand "]},{"id":"50e87aaf.45e894","type":"function","z":"c1e03843.9d14a8","name":"Kalk. gjenv.grad (2)","func":"\nvar temp_avkast = flow.get (\"vtr300_avkast_temp\",\"default\");  \nvar temp_inntak = flow.get (\"vtr300_inntak_temp\",\"default\"); \nvar temp_avtrekk = flow.get (\"vtr300_avtrekk_temp\",\"default\");  \n//var gjenvinner_padrag = flow.get (\"vtr300_gjenvinner_padrag\",\"default\");  \n\n\n// Sjekker for \"isNotNumber, ved \"isNan\" tidlig \"exit\" (prøv igjen).\n  if (isNaN(temp_avkast) || isNaN(temp_inntak) || isNaN(temp_avtrekk)) {\n    return;\n  }\n  \nvar Gjenv_grad; // Intern variable for kalkulert gjenvinningrad.\n\n// Ved ugyldig resultat som under, sett \"0\".\nif (temp_avtrekk - temp_inntak  === 0) { \n  Gjenv_grad = 0;\n}\n\n// Dersom man ikke ønsker beregning av gjenvinningsgrad når gjenvinner ikke er i drift, sett 0\".\n//else if (gjenvinner_padrag  === 0) { \n//  Gjenv_grad = 0;\n//}\n\n// Kalkulert gjenvinningsgrad.\nelse {\n  Gjenv_grad = ((temp_avtrekk - temp_avkast) / (temp_avtrekk - temp_inntak)) * 100 ; \n}\n\nmsg.payload = parseFloat((Gjenv_grad).toFixed(1));\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":1520,"wires":[["143c594c.973a47"]],"outputLabels":["Kalkulert gjenvinningsgrad"],"info":"\n# T0 = Utetemp/Inntakstemp.\n# T2 = Avtrekkstemp.\n# T3 = Avkast Temp.\n# \n# Kalk.\n# N=(T2-T3)/(T2-T0)"},{"id":"cacb727b.c531d","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_avkast_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":780,"wires":[["8fd00e76.b40c6"]]},{"id":"143c594c.973a47","type":"ha-entity","z":"c1e03843.9d14a8","name":"Gjenvinningsgrad - 2 [%]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_gjenvinningsgrad_1"},{"property":"device_class","value":"power_factor"},{"property":"icon","value":"mdi:leaf"},{"property":"unit_of_measurement","value":"%"}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":1520,"wires":[[]]},{"id":"cc2ab8ac.de64f8","type":"inject","z":"c1e03843.9d14a8","name":"Poll(5m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"300","crontab":"","once":false,"onceDelay":"8","topic":"","payload":"","payloadType":"date","x":1320,"y":1320,"wires":[["a112e436.615b38","bdbbe1d9.fb668"]]},{"id":"8251152e.3d1428","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":4820,"wires":[["4e5611e8.dda3"]]},{"id":"b8575f77.aa598","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":4600,"wires":[["4786e63b.ff4918"]]},{"id":"1e9ebded.3bf4a2","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":4380,"wires":[["6a145f37.c738d"]]},{"id":"d6e58ae7.293e68","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":4160,"wires":[["a723f537.276838"]]},{"id":"1840428.cb3f2be","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":3940,"wires":[["3657c90b.73eeb6"]]},{"id":"4934152.7b445ec","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":3720,"wires":[["a93371ad.38ad1"]]},{"id":"4e752fe6.9908c","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":3500,"wires":[["8ff9cdd0.95282"]]},{"id":"2b346ca8.a014d4","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":3280,"wires":[["54685c35.36b954"]]},{"id":"a3ecb518.b80ff8","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":3060,"wires":[["a3fde984.92df78"]]},{"id":"f786433f.582e1","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":2840,"wires":[["cc78d7ed.801a68"]]},{"id":"3ee80c87.1d6414","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":2620,"wires":[["af9a10b6.138b7"]]},{"id":"6300a3fe.f4f22c","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":2400,"wires":[["29ea6e9b.cc3652"]]},{"id":"17384421.51c9cc","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":2280,"wires":[["7eae4a7c.5d4384"]]},{"id":"78d39218.56422c","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":2180,"wires":[["83f789df.3df768"]]},{"id":"d8782f6f.4f253","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":2060,"wires":[["7bdfa6ec.eb3b78"]]},{"id":"93872a66.c607c8","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":4070,"y":1960,"wires":[["a76155d8.eac5f8"]]},{"id":"26d87ae3.148126","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":2500,"wires":[["e76409d7.e5b1f8"]]},{"id":"6566af12.975a4","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":2720,"wires":[["33e167f4.9c0948"]]},{"id":"53ff9bfc.5f4184","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":2940,"wires":[["ef6999fb.d13d68"]]},{"id":"224fd028.74f78","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":3160,"wires":[["ee35c15c.1a8e8"]]},{"id":"ce57e11c.f96b2","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":3380,"wires":[["fb65fbc9.6f6e98"]]},{"id":"f4d8b831.8d25a8","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":4480,"wires":[["8a17e91e.c99818"]]},{"id":"32899810.db2ee8","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":4700,"wires":[["98189ca2.23ef4"]]},{"id":"4b61096a.6217f8","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":4920,"wires":[["e32cb3ef.4ef"]]},{"id":"66e739f3.4cdcb8","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":4260,"wires":[["bf430ba8.774f48"]]},{"id":"32d7d934.1e38d6","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":4040,"wires":[["cee9fbb2.6df3f8"]]},{"id":"4f247f61.88a55","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":3820,"wires":[["b6533f15.c7939"]]},{"id":"75493b10.1b07c4","type":"inject","z":"c1e03843.9d14a8","name":"Poll (105s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"105","crontab":"","once":true,"onceDelay":"15","topic":"","payload":"","payloadType":"date","x":4070,"y":3600,"wires":[["f4158be5.40b158"]]},{"id":"7bb7b362.2b45fc","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":1960,"wires":[["c6f54188.23f6e"]]},{"id":"d59a6714.245178","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day1.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day1_start_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day1_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":1960,"wires":[["d8e7910e.41dba"],[]]},{"id":"f09d98a6.7914e8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2060,"wires":[["4d7348c1.3fa918"]]},{"id":"9fdbf536.cf01f8","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day1_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2280,"wires":[["3a516d09.0d4c02"]]},{"id":"e4740cc0.d0031","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day2_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2620,"wires":[["55166269.90d54c"]]},{"id":"35eeeb95.a842c4","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day2_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2500,"wires":[["188455e4.130efa"]]},{"id":"8d63d4ba.655278","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day2_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2400,"wires":[["a6f6a943.898558"]]},{"id":"7d1967b.77cb498","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day3_end_sp_reponse\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2940,"wires":[["67076884.dbed28"]]},{"id":"40b1a77d.03d6d8","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day3_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2840,"wires":[["cf278c56.af5c3"]]},{"id":"b98a05fe.1aa4a8","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day2_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":2720,"wires":[["ae432b7e.acb728"]]},{"id":"71db4112.4f63","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day4_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3280,"wires":[["963b785d.359de8"]]},{"id":"974a76be.9f6248","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day3_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3160,"wires":[["c96fad4e.fa79"]]},{"id":"1e50f3f2.651d6c","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day3_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3060,"wires":[["ec49ad2c.c4c8a"]]},{"id":"7297d875.d9e888","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day4_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3600,"wires":[["50579e24.dce4d"]]},{"id":"d876dbf9.2845c8","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day4_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3500,"wires":[["ac0f8032.0f78e"]]},{"id":"1e49a16a.33a59f","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day4_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3380,"wires":[["145148f6.3fa317"]]},{"id":"21afcbb4.bdb134","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day5_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3940,"wires":[["858e0159.7064e"]]},{"id":"d694f222.8f632","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day5_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3820,"wires":[["4bc8d0c1.1eed9"]]},{"id":"bae6de9c.00526","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day5_start_sp_reponse\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":3720,"wires":[["989f200.05eeae"]]},{"id":"8cd748fc.1f7228","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day6_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4260,"wires":[["9201c64c.7d1758"]]},{"id":"1925bfbd.1197a","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day6_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4160,"wires":[["14ba38b8.257cd7"]]},{"id":"a71dde66.37a9d","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day5_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4040,"wires":[["3d4ed46d.cb988c"]]},{"id":"1de9094d.99aa57","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day7_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4600,"wires":[["2a3627f.de7e3d8"]]},{"id":"7626f4ef.4b558c","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day6_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4480,"wires":[["ec1a5ea9.c9955"]]},{"id":"f2c43732.253a98","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day6_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4380,"wires":[["581c4e63.b82e7"]]},{"id":"8df265e0.8829c8","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day7_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4900,"wires":[["bb3edb69.071f48"]]},{"id":"a1880b46.ec93d8","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd2_day7_start_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4820,"wires":[["e4509170.5e711"]]},{"id":"4eb456c6.4da888","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr.& Min+Set flow","func":"var StartHours = msg.payload.data[0];\nvar StartMin = msg.payload.data[1];\nvar StartSec = 0; \n// Concatenate to correct format\nvar StartTime = ('0' +StartHours).slice(-2)+':'+('0' +StartMin).slice(-2)+':'+('0' +StartSec).slice(-2);\n\nflow.set(\"vtr300_sch_prd1_day7_end_sp_response\", StartTime, \"default\"); // Set flow, compare when writing.\n\nmsg.payload = StartTime;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4580,"y":4700,"wires":[["b6775dd2.7bf92"]]},{"id":"a0fccec3.309eb","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day1.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day1_end_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day1_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2060,"wires":[["b8511b4c.5230f8"],[]]},{"id":"3f5a3685.c8850a","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day1.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day1_start_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day1_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2180,"wires":[["6c43b41a.7dd89c"],[]]},{"id":"bdb97913.db6ef8","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day1.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day1_end_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day1_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2280,"wires":[["cc0cabe8.aed148"],[]]},{"id":"1cb27efa.6b3a91","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day2.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day2_start_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day2_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2400,"wires":[["7a8f03bd.54bc3c"],[]]},{"id":"b070fffd.d464b","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day2.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day2_end_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day2_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2500,"wires":[["ff180d4f.72e2b"],[]]},{"id":"d2512688.b76878","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day2.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day2_start_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day2_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2620,"wires":[["9de3adc5.acbab"],[]]},{"id":"893aed6.5bf951","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day2.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day2_end_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day2_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2720,"wires":[["7c12099b.829818"],[]]},{"id":"56f48519.15cbbc","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day3.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day3_start_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day3_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2840,"wires":[["13c408a8.663d57"],[]]},{"id":"6a6035cd.6638bc","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day3.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day3_end_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day3_end_sp_reponse","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":2940,"wires":[["3c6b21bb.f97ede"],[]]},{"id":"823edfd.f80202","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day3.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day3_start_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day3_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3060,"wires":[["c2eae259.2bdd7"],[]]},{"id":"3060cea5.15ee92","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day3.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day3_end_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day3_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3160,"wires":[["37cebe11.c3a542"],[]]},{"id":"57cb4edf.b918","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day4.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day4_start_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day4_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3280,"wires":[["7bd214e.2f6d2ec"],[]]},{"id":"368de2a3.16144e","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day4.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day4_end_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day4_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3380,"wires":[["96e85ac8.020fc8"],[]]},{"id":"de0f4da.3eef1b","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day4.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day4_start_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day4_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3500,"wires":[["b0273643.33e388"],[]]},{"id":"c7d45ff9.aad4","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day4.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day4_end_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day4_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3600,"wires":[["5c9dc1d6.b27cb"],[]]},{"id":"5b41fb23.8f2854","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day5.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day5_start_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day5_start_sp_reponse","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3720,"wires":[["f5247096.b1ac4"],[]]},{"id":"446516c3.008548","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day5.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day5_end_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day5_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3820,"wires":[["e2ea861c.bd24f8"],[]]},{"id":"e429b813.132538","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day5.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day5_start_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day5_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":3940,"wires":[["90610037.2b1ae"],[]]},{"id":"dc74fafd.152298","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day5.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day5_end_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day5_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4040,"wires":[["9515a8f7.439868"],[]]},{"id":"17d18379.9dcbad","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day6.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day6_start_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day6_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4160,"wires":[["52e023e1.bc906c"],[]]},{"id":"d1387fb9.1f57","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day6.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day6_end_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day6_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4260,"wires":[["37726264.d61e0e"],[]]},{"id":"9740f0ba.3b6d9","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day6.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day6_start_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day6_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4380,"wires":[["dcf11172.e9d34"],[]]},{"id":"1694e4a2.c1fc8b","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day6.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day6_end_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day6_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4480,"wires":[["f53926f6.5b6d88"],[]]},{"id":"bdf1ea78.8d8b28","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day7.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day7_start_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day7_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4600,"wires":[["9f58a2c.279116"],[]]},{"id":"e7cfd07d.74325","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day7.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day7_end_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day7_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4920,"wires":[["6f515520.724c6c"],[]]},{"id":"73694ce0.bcda54","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd2.Day7.Start_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd2_day7_start_sp","state_type":"str","halt_if":"vtr300_sch_prd2_day7_start_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4820,"wires":[["7c55d436.661abc"],[]]},{"id":"a876b3d.38f465","type":"poll-state","z":"c1e03843.9d14a8","name":"Sch.Prd1.Day7.End_sp","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_datetime.vtr300_sch_prd1_day7_end_sp","state_type":"str","halt_if":"vtr300_sch_prd1_day7_end_sp_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":3240,"y":4700,"wires":[["e9546181.4f315"],[]]},{"id":"f6fb29d0.686478","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2180,"wires":[["ab5ac5ba.4d83e8"]]},{"id":"188455e4.130efa","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2500,"wires":[["ed4e0f64.b3494"]]},{"id":"a6f6a943.898558","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2400,"wires":[["914e3236.3b6e6"]]},{"id":"3a516d09.0d4c02","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2280,"wires":[["8386aeaf.7dc71"]]},{"id":"cf278c56.af5c3","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2840,"wires":[["455169dd.9a4ff8"]]},{"id":"ae432b7e.acb728","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2720,"wires":[["fd310d88.d9b5"]]},{"id":"55166269.90d54c","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2620,"wires":[["3a76cfcb.9553a"]]},{"id":"c96fad4e.fa79","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3160,"wires":[["5922d946.0f5538"]]},{"id":"ec49ad2c.c4c8a","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3060,"wires":[["a722a059.f3fda"]]},{"id":"67076884.dbed28","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":2940,"wires":[["dddd804f.5a37c"]]},{"id":"ac0f8032.0f78e","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3500,"wires":[["30ab1882.ce3a58"]]},{"id":"145148f6.3fa317","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3380,"wires":[["6e129fa8.89081"]]},{"id":"963b785d.359de8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3280,"wires":[["78ef6828.bfb228"]]},{"id":"4bc8d0c1.1eed9","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3820,"wires":[["72e77bd3.a4f994"]]},{"id":"989f200.05eeae","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3720,"wires":[["d255527.8ca55b"]]},{"id":"50579e24.dce4d","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3600,"wires":[["ffe6ad6a.e4433"]]},{"id":"14ba38b8.257cd7","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4160,"wires":[["ea4b62b4.f4cfc"]]},{"id":"3d4ed46d.cb988c","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4040,"wires":[["8f83e34b.78b7e"]]},{"id":"858e0159.7064e","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":3940,"wires":[["6e6da8a.2ac5e58"]]},{"id":"ec1a5ea9.c9955","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4480,"wires":[["4dc6d4d4.6b702c"]]},{"id":"581c4e63.b82e7","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4380,"wires":[["7e21269a.acaba8"]]},{"id":"9201c64c.7d1758","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4260,"wires":[["7609563.39d53a8"]]},{"id":"bb3edb69.071f48","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4900,"wires":[["134327ba.966f48"]]},{"id":"e4509170.5e711","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4820,"wires":[["6a8e3383.bd266c"]]},{"id":"b6775dd2.7bf92","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4700,"wires":[["9fa4d1e8.3285c"]]},{"id":"2a3627f.de7e3d8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":4760,"y":4600,"wires":[["4517a792.76e488"]]},{"id":"7f1acdbf.c838d4","type":"debug","z":"c1e03843.9d14a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":730,"y":100,"wires":[]},{"id":"9365826d.2f247","type":"function","z":"c1e03843.9d14a8","name":"ILOCK's","func":"// Interlock PPM Auto \"write\" dersom: \n// PPM Auto er AV, noen tidsmoduser er aktive eller Komfyravtrekk er aktiv.\n\nvar ppm_mode = flow.get (\"vtr300_ppm_mode_state\",\"default\");              // PPM Auto switch state (On/Off).\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\");  // Main mode status register, omgjort til string.\nvar tidsmodus_sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\"); // Gjelder alle moduser som timer ut på tid (Boost/Party/Ildsted/Borte/Ferie).\nvar freecool_state = flow.get (\"vtr300_freecool_states\",\"default\");       // Frikjøling/Nattkjøling (Av/Standby/Kjøler)\n\nvar active;\n\n// Ved \"NaN\", tidlig \"exit\" (returner).\n  if (isNaN(tidsmodus_sec)) {\n    return;\n  }\n\n// PPM Auto write active:\nif ((ppm_mode === 'on') && (tidsmodus_sec === 0) && (main_mode_state != 'Komfyravtrekk') && (freecool_state != 'Kjøler')) { \n  active = 'PPM_Auto_active';\n}\n// PPM Auto interlock/block write:\nelse {\n  return null;  \n}\n\n\nvar msg0 = {payload:active};\n\nreturn [msg0];","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":3160,"wires":[["a34a6d01.ef062"]],"outputLabels":["PPM_Auto_active"]},{"id":"e90c02e6.676eb","type":"poll-state","z":"c1e03843.9d14a8","name":"PPM Auto enabled?","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"switch.vtr300_ppm_mode_auto_enable","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":110,"y":3160,"wires":[["e01b607a.dec6b"]]},{"id":"86223ac6.8f0d88","type":"function","z":"c1e03843.9d14a8","name":"ppm sensor error?","func":"// Recover to Auto Schedule if both ppm sensors fail.\n\nvar ppm_sensor_active = flow.get (\"ppm_sensor_active\",\"default\"); \n\nmsg.payload = ppm_sensor_active;\n\nif (ppm_sensor_active === 'ppm sensorer feiler') {\n    return [null, msg]\n} else {\n    return [msg, null]\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":150,"y":3420,"wires":[["d95e2b7f.209e48"],["2d79b8a7.4fbbd8"]],"outputLabels":["ppm sensor error","ppm sensor ok"]},{"id":"47847ed.5a5f98","type":"comment","z":"c1e03843.9d14a8","name":"PPM Auto - Fan speed selection based on ppm, moist (extract air) and presence detection-------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":670,"y":3120,"wires":[]},{"id":"4349ac3.6895154","type":"function","z":"c1e03843.9d14a8","name":"Man mode ILOCK's","func":"// Xxxxxxx:\n\nvar mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\");\nvar ppm_auto = flow.get (\"vtr300_ppm_mode_state\",\"default\");\nvar tidsmodus_sec = flow.get (\"vtr300_nedtelling_modus_tid_s\",\"default\"); // Gjelder alle moduser som timer ut på tid (Boost/Party/Ildsted/Borte/Ferie).\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\");  // Main mode status register, omgjort til string.\nvar freecool_state = flow.get (\"vtr300_freecool_states\",\"default\");       // Frikjøling/Nattkjøling (Av/Standby/Kjøler)\n\n// Ved \"NaN\", tidlig \"exit\" (returner).\n  if (isNaN(tidsmodus_sec)) {\n    return;\n  }\n\nif (mode_state === 'Manuell') { \n    return null;\n}\nelse if (tidsmodus_sec != 0) { \n    return null;\n}\nelse if (ppm_auto === 'on') { \n    return null;\n}\nelse if (main_mode_state === 'Komfyravtrekk') { \n    return null;\n}\nelse if (freecool_state === 'Kjøler') { \n    return null;\n}\nelse {\n    out = main_mode_state;\n}\n\nmsg.payload = out;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":130,"y":2480,"wires":[["45e29d30.855fc4","eaa7cf8b.a34de"]],"outputLabels":["Normal operation","Man mode interlocked"]},{"id":"45e29d30.855fc4","type":"switch","z":"c1e03843.9d14a8","name":"man mode","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Set_man_mode","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":2480,"wires":[["860c7670.14a608"]]},{"id":"ae1926c1.c422a8","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Fan override on/off (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":400,"y":4240,"wires":[[],["8616ff88.1a258"]]},{"id":"e002f38e.eb14a","type":"function","z":"c1e03843.9d14a8","name":"Read","func":"var fc=3;\nvar sa=13600;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":4240,"wires":[["ae1926c1.c422a8"]]},{"id":"3ee8cd99.fc5e52","type":"modbus-flex-getter","z":"c1e03843.9d14a8","name":"Fan override [%] (r)","showStatusActivities":false,"showErrors":true,"logIOActivities":false,"server":"86a33495.600fd8","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"x":390,"y":4460,"wires":[[],["913908f6.cbbe38"]]},{"id":"d4ffcbf0.ece958","type":"function","z":"c1e03843.9d14a8","name":"Read","func":"var fc=3;\nvar sa=13800;\nvar addresses=2;\nvar slave_ip=msg.payload.slave_ip;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={value: msg.payload, 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":4460,"wires":[["3ee8cd99.fc5e52"]]},{"id":"913908f6.cbbe38","type":"function","z":"c1e03843.9d14a8","name":"0-100[%]","func":"var msg0 = {payload:msg.payload.data[0]};\nvar msg1 = {payload:msg.payload.data[1]};\n\nreturn [msg0,msg1];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":560,"y":4460,"wires":[["4252d62f.9de148"],["ae7ca30.1abdd6"]]},{"id":"8616ff88.1a258","type":"function","z":"c1e03843.9d14a8","name":"0-->1","func":"var msg0 = {payload:msg.payload.data[0]};\nvar msg1 = {payload:msg.payload.data[1]};\n\nreturn [msg0,msg1];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":570,"y":4240,"wires":[["8fe57732.053268"],["2a19b428.f2218c"]]},{"id":"8fe57732.053268","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Auto","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Overstyrer","tot":"str"},{"t":"set","p":"vtr300_fan_supply_man_override_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":4240,"wires":[["15af2c39.a39174"]]},{"id":"15af2c39.a39174","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":920,"y":4240,"wires":[["b5a65260.22e29"]]},{"id":"b5a65260.22e29","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set SAF override","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_fan_supply_man_override","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1090,"y":4240,"wires":[[]]},{"id":"6047d381.3db3bc","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set EAF override","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.vtr300_fan_extract_man_override","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1090,"y":4280,"wires":[[]]},{"id":"5e506518.04cbdc","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":920,"y":4280,"wires":[["6047d381.3db3bc"]]},{"id":"2a19b428.f2218c","type":"change","z":"c1e03843.9d14a8","name":"INT-->Str. + Set flow ","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"Auto","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"Overstyrer","tot":"str"},{"t":"set","p":"vtr300_fan_extract_man_override_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":4280,"wires":[["5e506518.04cbdc"]]},{"id":"5e660a55.015c74","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"17","topic":"","payload":"","payloadType":"date","x":100,"y":4240,"wires":[["e002f38e.eb14a"]]},{"id":"b44ecff.6b8c63","type":"inject","z":"c1e03843.9d14a8","name":"Poll(30s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":true,"onceDelay":"17","topic":"","payload":"","payloadType":"date","x":100,"y":4460,"wires":[["d4ffcbf0.ece958"]]},{"id":"4252d62f.9de148","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_fan_supply_man_override_spd_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":4460,"wires":[["315864f1.6b9d0c"]]},{"id":"315864f1.6b9d0c","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":4460,"wires":[["2c2d72bf.23c65e"]]},{"id":"2c2d72bf.23c65e","type":"api-call-service","z":"c1e03843.9d14a8","name":"SAF Man.pådrag","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_fan_supply_man_override_spd","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1010,"y":4460,"wires":[[]]},{"id":"ae7ca30.1abdd6","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_fan_extract_man_override_spd_response","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":4500,"wires":[["3318842c.71472c"]]},{"id":"3318842c.71472c","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":4500,"wires":[["7bcf8284.e5d15c"]]},{"id":"7bcf8284.e5d15c","type":"api-call-service","z":"c1e03843.9d14a8","name":"EAF Man.pådrag","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.vtr300_fan_extract_man_override_spd","data":"{\"value\":msg.payload}","dataType":"jsonata","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1010,"y":4500,"wires":[[]]},{"id":"8e7a5b8d.cc7848","type":"comment","z":"c1e03843.9d14a8","name":"Fan manual override -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":680,"y":4120,"wires":[]},{"id":"29e4fdb9.78d792","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"SAF override(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":680,"y":4160,"wires":[["8b1d4c67.526ba"],[]]},{"id":"148db167.11fb6f","type":"function","z":"c1e03843.9d14a8","name":"Auto/Overstyrer","func":"var fc=6;\nvar sa=13600;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":4160,"wires":[["29e4fdb9.78d792"]],"info":"# 0  Deaktiverer Eco drift\n# 1  Aktiverer Eco"},{"id":"9244255e.c8aa38","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Auto","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Overstyrer","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":4160,"wires":[["148db167.11fb6f"]]},{"id":"bc31be76.34a05","type":"poll-state","z":"c1e03843.9d14a8","name":"SAF override on/off trigger","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"40","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_fan_supply_man_override","state_type":"str","halt_if":"vtr300_fan_supply_man_override_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":150,"y":4160,"wires":[["9244255e.c8aa38"],[]]},{"id":"8b1d4c67.526ba","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":890,"y":4160,"wires":[]},{"id":"64a585d8.91234c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"EAF override(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":680,"y":4200,"wires":[["a6389552.4b47b8"],[]]},{"id":"8f8b3cf.7722bc","type":"function","z":"c1e03843.9d14a8","name":"Auto/Overstyrer","func":"var fc=6;\nvar sa=13601;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":4200,"wires":[["64a585d8.91234c"]],"info":"# 0  Deaktiverer Eco drift\n# 1  Aktiverer Eco"},{"id":"1a5b72ec.f28a3d","type":"change","z":"c1e03843.9d14a8","name":"Str.-->INT","rules":[{"t":"change","p":"payload","pt":"msg","from":"Auto","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"Overstyrer","fromt":"str","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":4200,"wires":[["8f8b3cf.7722bc"]]},{"id":"8d38435.d7c4fc","type":"poll-state","z":"c1e03843.9d14a8","name":"EAF override on/off trigger","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"40","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_select.vtr300_fan_extract_man_override","state_type":"str","halt_if":"vtr300_fan_extract_man_override_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":150,"y":4200,"wires":[["1a5b72ec.f28a3d"],[]]},{"id":"a6389552.4b47b8","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":890,"y":4200,"wires":[]},{"id":"252b945.f10146c","type":"poll-state","z":"c1e03843.9d14a8","name":"Ønsket SAF override","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"40","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_fan_supply_man_override_spd","state_type":"num","halt_if":"vtr300_fan_supply_man_override_spd_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":130,"y":4340,"wires":[["23818b10.b468c4"],[]]},{"id":"23818b10.b468c4","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":290,"y":4340,"wires":[["19136672.67764a"]],"info":"Videresender siste verdi etter 5 sek. for ç� unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"19136672.67764a","type":"function","z":"c1e03843.9d14a8","name":"0-100[%]","func":"var msg0 = msg.payload;\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":4340,"wires":[["921ea151.86842"]],"info":"# Engineering range: 12°C -> 30°C"},{"id":"921ea151.86842","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=13800;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":4340,"wires":[["597823a5.91ca1c"]]},{"id":"597823a5.91ca1c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"SAF override [%] (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":760,"y":4340,"wires":[["49e2e3a3.3e461c"],[]]},{"id":"fc8ed988.b93338","type":"poll-state","z":"c1e03843.9d14a8","name":"Ønsket EAF override","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"40","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_fan_extract_man_override_spd","state_type":"num","halt_if":"vtr300_fan_extract_man_override_spd_response","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":130,"y":4380,"wires":[["d206569e.778778"],[]]},{"id":"d206569e.778778","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.5s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":290,"y":4380,"wires":[["4116ecdf.fbd284"]],"info":"Videresender siste verdi etter 5 sek. for å unngå å jamme ned modbus slave, om ikke går ikke settpunkt gjennom."},{"id":"4116ecdf.fbd284","type":"function","z":"c1e03843.9d14a8","name":"0-100[%]","func":"var msg0 = msg.payload;\n\nmsg.payload = msg0;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":4380,"wires":[["b1666a45.3bccc8"]],"info":"# Engineering range: 12°C -> 30°C"},{"id":"b1666a45.3bccc8","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=13801;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":4380,"wires":[["7f71fd1e.829524"]]},{"id":"7f71fd1e.829524","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"EAF override [%] (w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":760,"y":4380,"wires":[["95aeb277.a0d26"],[]]},{"id":"49e2e3a3.3e461c","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":970,"y":4340,"wires":[]},{"id":"95aeb277.a0d26","type":"modbus-response","z":"c1e03843.9d14a8","name":"","registerShowMax":20,"x":970,"y":4380,"wires":[]},{"id":"eaa7cf8b.a34de","type":"debug","z":"c1e03843.9d14a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":290,"y":2440,"wires":[]},{"id":"86bedd6.cbc552","type":"function","z":"c1e03843.9d14a8","name":"PPM/Man On - Other modes off","func":" \nmsg.payload =\n{\n   \"data\": {\n     \"entity_id\": \"switch.vtr300_auto_modus, switch.vtr300_party_modus, switch.vtr300_boost_modus, switch.vtr300_ildsted_modus, switch.vtr300_borte_modus, switch.vtr300_ferie_modus\"\n   }\n}\n\nreturn msg;    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":2480,"wires":[["74565103.5bfb4"]],"outputLabels":["Daily, weekly, monthly & yearly"]},{"id":"2432b020.e46eb","type":"switch","z":"c1e03843.9d14a8","name":"!= manuell status","property":"vtr300_main_mode_state_str","propertyType":"flow","rules":[{"t":"neq","v":"Manuell","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":2640,"wires":[["4dc5c0cb.62c46"]]},{"id":"3d60abc8.cd3da4","type":"switch","z":"c1e03843.9d14a8","name":"Wait for Man.mode ","property":"vtr300_main_mode_state_str","propertyType":"flow","rules":[{"t":"eq","v":"Manuell","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":790,"y":2900,"wires":[["e4eb9b30.dd0088","bfb99f98.5c281"]]},{"id":"fef741d.d8b5cc","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1350,"y":2420,"wires":[]},{"id":"208bed5c.8c18b2","type":"change","z":"c1e03843.9d14a8","name":"Moist mode on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"},{"t":"set","p":"vtr300_ppm_moist_mode_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":3260,"wires":[[]]},{"id":"f075cc6f.464e8","type":"change","z":"c1e03843.9d14a8","name":"Moist mode off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"},{"t":"set","p":"vtr300_ppm_moist_mode_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":3280,"wires":[[]]},{"id":"aa087797.818ef8","type":"switch","z":"c1e03843.9d14a8","name":"Wrn.","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Fuktoverstyring - Høy","vt":"str"},{"t":"eq","v":"Tilluftsvifte overstyres!","vt":"str"},{"t":"eq","v":"Avtrekksvifte overstyres!","vt":"str"},{"t":"eq","v":"Viftehastighet overstyres!","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":670,"y":1320,"wires":[["b29b9798.096a88"],["b29b9798.096a88"],["b29b9798.096a88"],["b29b9798.096a88"]]},{"id":"5c89c290.07c35c","type":"function","z":"c1e03843.9d14a8","name":"Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Modus: \" + msg.payload + \" er aktivert!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":1320,"wires":[["60d3c9e4.e89688"]]},{"id":"60d3c9e4.e89688","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1080,"y":1320,"wires":[[]]},{"id":"bbde4c0d.b2dc3","type":"comment","z":"c1e03843.9d14a8","name":"NB! SWITCHER kalles etter Vifte overstyring ble implementert..., SJEKKES!!!","info":"","x":1270,"y":2800,"wires":[]},{"id":"cd2fb013.90126","type":"function","z":"c1e03843.9d14a8","name":"ILOCK's","func":"// Interlocks preventing calling functions when not supposed to \n\nvar main_mode_state = flow.get (\"vtr300_main_mode_state_str\",\"default\");   // Main mode status register, omgjort til string.\nvar saf_override_state = flow.get (\"vtr300_fan_supply_man_override_response\",\"default\");  // Supply fan override state\nvar eaf_override_state = flow.get (\"vtr300_fan_extract_man_override_response\",\"default\"); // Extract fan override state\nvar freecool_state = flow.get (\"vtr300_freecool_states\",\"default\");                       // Frikjøling/Nattkjøling (Av/Standby/Kjøler)\n\n// Dersom udefinert & \"isNotNumber\", tidlig \"exit\" (prøv igjen).\n  if ((typeof main_mode_state === \"undefined\") || (typeof saf_override_state === \"undefined\") || (typeof eaf_override_state === \"undefined\")) {\n    return;\n  }\n\nvar out;\n  \nif (main_mode_state === 'Komfyravtrekk') { \n    return null;\n}\nelse if (saf_override_state === 'Overstyrer') { \n    return null;\n}\nelse if (eaf_override_state === 'Overstyrer') { \n    return null;\n}\nelse if ((saf_override_state === 'Auto') && (eaf_override_state === 'Overstyrer')) { \n    return null;\n}\nelse if ((saf_override_state === 'Overstyrer') && (eaf_override_state === 'Auto')) { \n    return null;\n}\nelse if ((saf_override_state === 'Overstyrer') && (eaf_override_state === 'Overstyrer')) { \n    return null;\n}\nelse if (freecool_state === 'Kjøler') { \n    return null;\n}\nelse {\n    out = main_mode_state;\n}\n\nmsg.payload = out;\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":120,"y":2760,"wires":[["9a2cde4.3b4f82","eb9ae1f0.e16a1"]]},{"id":"b29b9798.096a88","type":"switch","z":"c1e03843.9d14a8","name":"!=","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":790,"y":1320,"wires":[["5c89c290.07c35c"]]},{"id":"eb9ae1f0.e16a1","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":360,"y":2700,"wires":[]},{"id":"da25847e.38dfe8","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":310,"y":2760,"wires":[]},{"id":"dcf0d347.7ce4c","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":310,"y":2240,"wires":[]},{"id":"2a696d9c.f5f0b2","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_ferie_modus_varighet_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":120,"wires":[["ccfe8e7a.96e53"]]},{"id":"ccfe8e7a.96e53","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":3100,"y":120,"wires":[["409c5351.1f468c"]]},{"id":"e1fbba0e.f65968","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_borte_modus_varighet_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":160,"wires":[["98f7fd6c.4cc74"]]},{"id":"98f7fd6c.4cc74","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":3100,"y":160,"wires":[["7fb0a201.4d983c"]]},{"id":"57217d7f.fd4734","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_ildsted_modus_varighet_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":200,"wires":[["8aa37b5c.730798"]]},{"id":"8aa37b5c.730798","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":3100,"y":200,"wires":[["d9b9b816.eac7e8"]]},{"id":"45697b4.a5a8484","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_boost_modus_varighet_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":240,"wires":[["3267b779.f1d218"]]},{"id":"3267b779.f1d218","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":3100,"y":240,"wires":[["8db2ccb7.81eb6"]]},{"id":"b0c9590e.3ffc48","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_party_modus_varighet_state","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":280,"wires":[["7f6839fc.0dc5a8"]]},{"id":"7f6839fc.0dc5a8","type":"switch","z":"c1e03843.9d14a8","name":"Send if != ","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":3100,"y":280,"wires":[["4078b04e.8a81d"]]},{"id":"607e78b6.c56f28","type":"poll-state","z":"c1e03843.9d14a8","name":"Ferie varighet [1-365d]","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_ferie_modus_varighet_sp","state_type":"num","halt_if":"vtr300_ferie_modus_varighet_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":1480,"y":120,"wires":[["cd948d07.70bdf"],[]]},{"id":"4e6e709c.ce406","type":"poll-state","z":"c1e03843.9d14a8","name":"Borte varighet [1-72t]","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_borte_modus_varighet_sp","state_type":"num","halt_if":"vtr300_borte_modus_varighet_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":1480,"y":160,"wires":[["d692e1cd.96998"],[]]},{"id":"e019c19c.f3d8c","type":"poll-state","z":"c1e03843.9d14a8","name":"Ildsted varighet [1-60min]","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_ildsted_modus_varighet_sp","state_type":"num","halt_if":"vtr300_ildsted_modus_varighet_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":1490,"y":200,"wires":[["e5794fc2.0a76b"],[]]},{"id":"c5d0b0d7.88dcf","type":"poll-state","z":"c1e03843.9d14a8","name":"Boost varighet [1-240min]","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_boost_modus_varighet_sp","state_type":"num","halt_if":"vtr300_boost_modus_varighet_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":1490,"y":240,"wires":[["53d0de6b.379f5"],[]]},{"id":"e7567d85.56e5b","type":"poll-state","z":"c1e03843.9d14a8","name":"Party varighet [1-8t]","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":false,"outputonchanged":true,"entity_id":"input_number.vtr300_party_modus_varighet_sp","state_type":"num","halt_if":"vtr300_party_modus_varighet_state","halt_if_type":"flow","halt_if_compare":"is_not","outputs":2,"x":1470,"y":280,"wires":[["114aa8ba.346257"],[]]},{"id":"2d9f369c.c1f15a","type":"comment","z":"c1e03843.9d14a8","name":"BUG Ferie modus 2dager gjengir 11.5t...","info":"","x":1120,"y":1840,"wires":[]},{"id":"132eb0cc.72ed1f","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2740,"y":3960,"wires":[]},{"id":"a4e5f79a.1a2068","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2770,"y":3920,"wires":[]},{"id":"25ac3c03.d7e744","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2730,"y":3800,"wires":[]},{"id":"d63f5dab.fc9a1","type":"comment","z":"c1e03843.9d14a8","name":"Main Mode slection -------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":450,"y":2040,"wires":[]},{"id":"57046314.ebd1ac","type":"function","z":"c1e03843.9d14a8","name":"Modbus write error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Auto Sch. Prd Enable - Modbus write error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":660,"wires":[["e8bba260.fa72b"]]},{"id":"e8bba260.fa72b","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":660,"wires":[[]]},{"id":"ead7b2aa.e580c","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":660,"wires":[[]]},{"id":"c11e9d73.faded","type":"function","z":"c1e03843.9d14a8","name":"Modbus read error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Auto Sch. Prd Enable - Modbus read error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":700,"wires":[["94ebf797.987dc8"]]},{"id":"9e63f19b.34ed","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":700,"wires":[[]]},{"id":"94ebf797.987dc8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":700,"wires":[[]]},{"id":"1b79edad.af9462","type":"catch","z":"c1e03843.9d14a8","name":"Auto Sch. Prd. Enable write error","scope":["9c623a43.3e5fb8","e3754b48.029c78","cb786807.b3bfd8","58534928.81a2b8","aecbb55e.16a7a8","96e5a5e5.b51fc8","f09bdd09.dc2fc","f0820d3.44eb3f","478804df.a7755c","35780aa2.44e366","16021e31.9462f2","7adbc76c.aafc88","90154fca.877a3","468df9c4.27e968","be955daa.cd8ee","ecf11daa.07635","1ec835d3.015d0a","ec052046.11627","ffef335d.bacb8","7515c9d0.d11128"],"uncaught":false,"x":4270,"y":660,"wires":[["ead7b2aa.e580c","3dc2a0a7.04d1"]]},{"id":"5b9ac57c.a2617c","type":"catch","z":"c1e03843.9d14a8","name":"Auto Sch. Prd. Enable read error","scope":["48923478.d5f6bc"],"uncaught":false,"x":4270,"y":700,"wires":[["9e63f19b.34ed","3dc2a0a7.04d1"]]},{"id":"feb84230.3cc4c","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2390,"y":1400,"wires":[]},{"id":"73c85fd0.791af","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2390,"y":1440,"wires":[]},{"id":"a3e69b25.62fdf8","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":100,"wires":[[]]},{"id":"28b099e3.e54b96","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Intern ur - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":100,"wires":[["6cb841d0.6f551"]]},{"id":"6cb841d0.6f551","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":100,"wires":[[]]},{"id":"a261b2bf.f020b","type":"catch","z":"c1e03843.9d14a8","name":"Intern ur r/w error","scope":["88f130e1.c406f","e118072d.1ba628","132ac12e.cbb88f","4ece098d.8a0968"],"uncaught":false,"x":4220,"y":100,"wires":[["a3e69b25.62fdf8","3dc2a0a7.04d1"]]},{"id":"e3e0e226.0b546","type":"catch","z":"c1e03843.9d14a8","name":"Tilluft_sp r/w error","scope":["83de003b.19515","30649048.acff4"],"uncaught":false,"x":4230,"y":140,"wires":[["51729c23.25e9e4","3dc2a0a7.04d1"]]},{"id":"51729c23.25e9e4","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":140,"wires":[[]]},{"id":"f527168f.753c88","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Tilluft_sp - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":140,"wires":[["ebbcb56.cd6c048"]]},{"id":"ebbcb56.cd6c048","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":140,"wires":[[]]},{"id":"b11e7e95.549e8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":180,"wires":[[]]},{"id":"3237a71b.f26298","type":"function","z":"c1e03843.9d14a8","name":"Modbus read error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Sensorer - Modbus read error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":180,"wires":[["b11e7e95.549e8"]]},{"id":"e6327aca.519338","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":180,"wires":[[]]},{"id":"398e2ddb.dda632","type":"catch","z":"c1e03843.9d14a8","name":"Sensor read error","scope":["84937855.5af778","79fc3ca2.89c304","8d6ef3f4.328dc","c6d50893.ed54c8","b57a685.8871a98","28f35935.b68ff6","e727d79.15bb628","e4e246c7.fe1258","cd6cd6d7.57df58","cbebd298.be8d5","b7c1c168.6d653","d4504d74.a0eaa","1b9a07ad.a69778","7f03b584.16fa5c","d4cff05.b4b781","fcb4d913.54dfb8","2dc9837f.dcdd1c","8e9b950a.72ecf8","97d18c08.010be","9fe24a60.d7b178","b37cf163.09dd3","e42dcd04.cdec5","f7af1f2d.d9943","23587151.ebc64e","8213e8ac.8c9468"],"uncaught":false,"x":4220,"y":180,"wires":[["e6327aca.519338","3dc2a0a7.04d1"]]},{"id":"e5571953.f1b8c8","type":"modbus-queue-info","z":"c1e03843.9d14a8","name":"","topic":"","unitid":1,"queueReadIntervalTime":"1000","lowLowLevel":"25","lowLevel":75,"highLevel":150,"highHighLevel":"300","server":"86a33495.600fd8","errorOnHighLevel":false,"showStatusActivities":true,"updateOnAllQueueChanges":true,"updateOnAllUnitQueues":false,"x":3810,"y":160,"wires":[["6488c934.f4d708","d1c406d34c4e0171"]]},{"id":"9e2a6d8d.a1bb3","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":220,"wires":[[]]},{"id":"dcbdd92f.712f08","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Main mode - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":220,"wires":[["bd261dff.a5ea2"]]},{"id":"bd261dff.a5ea2","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":220,"wires":[[]]},{"id":"dda04578.99c248","type":"catch","z":"c1e03843.9d14a8","name":"Main mode r/w error","scope":["3558a8e4.fb9248","db2734ad.c40af8"],"uncaught":false,"x":4230,"y":220,"wires":[["9e2a6d8d.a1bb3","3dc2a0a7.04d1"]]},{"id":"922925e5.cc70f8","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":260,"wires":[[]]},{"id":"212300de.336c4","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Man mode - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":260,"wires":[["10d1bb48.a6be25"]]},{"id":"10d1bb48.a6be25","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":260,"wires":[[]]},{"id":"efdecdbc.68fee","type":"catch","z":"c1e03843.9d14a8","name":"Man mode r/w error","scope":["d4cff05.b4b781","ca1fe674.19be48"],"uncaught":false,"x":4230,"y":260,"wires":[["922925e5.cc70f8","3dc2a0a7.04d1"]]},{"id":"3e93900d.78899","type":"catch","z":"c1e03843.9d14a8","name":"Eco. mode r/w error","scope":["3146fba0.9df104","76166588.d9864c","7a377eb1.d69ba","15be4d9f.00e182"],"uncaught":false,"x":4230,"y":300,"wires":[["cfdab2b1.1901","3dc2a0a7.04d1"]]},{"id":"cfdab2b1.1901","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":300,"wires":[[]]},{"id":"a9a65f8.9be54a","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Eco. mode - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":300,"wires":[["df39d235.1395d"]]},{"id":"df39d235.1395d","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":300,"wires":[[]]},{"id":"cc2d3633.51a8e8","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":340,"wires":[[]]},{"id":"1ea9e81c.5b6158","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Reg. metode - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":340,"wires":[["cc2d3633.51a8e8"]]},{"id":"efabfb9.ed16e08","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":340,"wires":[[]]},{"id":"a5b8676c.30b958","type":"catch","z":"c1e03843.9d14a8","name":"Regmetode r/w error","scope":["76cf3a2c.69d7c4","97efde47.d54c2"],"uncaught":false,"x":4230,"y":340,"wires":[["efabfb9.ed16e08","3dc2a0a7.04d1"]]},{"id":"b42ec41a.a0dcc8","type":"catch","z":"c1e03843.9d14a8","name":"Kjølegjenv. r/w error","scope":["b9c2274e.8e70d8","589d3891.7a8848","4f495e26.a963a","92e16b21.e94ee8"],"uncaught":false,"x":4230,"y":380,"wires":[["f96e9dff.f252d","3dc2a0a7.04d1"]]},{"id":"f96e9dff.f252d","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":380,"wires":[[]]},{"id":"ec131742.babd58","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Kjølegjenvinning - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":380,"wires":[["2eade478.721aac"]]},{"id":"2eade478.721aac","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":380,"wires":[[]]},{"id":"a51e9092.410df","type":"catch","z":"c1e03843.9d14a8","name":"Overstyring r/w error","scope":["3ee8cd99.fc5e52","29e4fdb9.78d792","64a585d8.91234c","597823a5.91ca1c","7f71fd1e.829524","ae1926c1.c422a8"],"uncaught":false,"x":4230,"y":420,"wires":[["cb3b08ad.30ed08","3dc2a0a7.04d1"]]},{"id":"cb3b08ad.30ed08","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":420,"wires":[[]]},{"id":"ec7f4b04.c948e8","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Overstyring vifter - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":420,"wires":[["a8bc0520.47ee48"]]},{"id":"a8bc0520.47ee48","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":420,"wires":[[]]},{"id":"bd4709f3.4b8438","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":820,"wires":[[]]},{"id":"16245808.a89818","type":"function","z":"c1e03843.9d14a8","name":"Modbus read error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Alarmer - Modbus read error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":820,"wires":[["bd4709f3.4b8438"]]},{"id":"d1ce24f5.887338","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":820,"wires":[[]]},{"id":"2457e9c8.5795f6","type":"catch","z":"c1e03843.9d14a8","name":"ALM read error","scope":["37ca7530.bf5a3a","f72157a.2edcea8","f5e1b9fd.f6dbf8","2cffb7f4.e0df08"],"uncaught":false,"x":4220,"y":820,"wires":[["d1ce24f5.887338","3dc2a0a7.04d1"]]},{"id":"b81e780c.d9d768","type":"catch","z":"c1e03843.9d14a8","name":"Modus varighet r/w error","scope":["ceea66b3.92cde8","5b175866.aa4288","103a6cd9.603883","21bffb02.b380a4","70b68356.aafa7c","9aa0ea55.521f88","8c478e30.67845","d32b2e41.f4233","711bf35.69cf30c","c609efd2.51f3a"],"uncaught":false,"x":4250,"y":460,"wires":[["865ed1d8.3b5ac","3dc2a0a7.04d1"]]},{"id":"865ed1d8.3b5ac","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":460,"wires":[[]]},{"id":"15bbc7f.34b9838","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Modus varighet - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":460,"wires":[["5f2c506.e9e38b"]]},{"id":"5f2c506.e9e38b","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":460,"wires":[[]]},{"id":"aea8c155.23744","type":"catch","z":"c1e03843.9d14a8","name":"Utekomp. viftehast. r/w error","scope":["1176949f.9065db","4fb3d39e.9758dc","7afb1ee1.cf7fd","29d69919.1297d6","1bddc250.7cd2de","fdf54208.13fa","a017b19f.0688f","fd3229d.91707d8","54f480bc.67d43","c665c6e0.eff698","74ad7ee9.36709","9bf08111.d38d3"],"uncaught":false,"x":4260,"y":500,"wires":[["e612e513.641c78","3dc2a0a7.04d1"]]},{"id":"e612e513.641c78","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":500,"wires":[[]]},{"id":"f3388d77.11e21","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Utekomp. viftehast. - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":500,"wires":[["62561aef.969a24"]]},{"id":"62561aef.969a24","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":500,"wires":[[]]},{"id":"dfd4e49d.94a268","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":780,"wires":[[]]},{"id":"d7e31ed4.eb998","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Auto Sch. vifte hast. - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":780,"wires":[["dfd4e49d.94a268"]]},{"id":"ddf0c1ab.b08ed","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":780,"wires":[[]]},{"id":"c52d539e.b7e66","type":"catch","z":"c1e03843.9d14a8","name":"Auto Sch. fan spd r/w error","scope":["1083419e.b47fae","71480dc.48369f4","2658c9af.281946"],"uncaught":false,"x":4250,"y":780,"wires":[["ddf0c1ab.b08ed","3dc2a0a7.04d1"]]},{"id":"a20235e6.9dfb68","type":"catch","z":"c1e03843.9d14a8","name":"Auto Sch. temp offset r/w error","scope":["860f00e.584be","95871272.eef75","f8113cb6.9323b","3935d35c.7612ac"],"uncaught":false,"x":4260,"y":740,"wires":[["aad42216.1da5b","3dc2a0a7.04d1"]]},{"id":"aad42216.1da5b","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":740,"wires":[[]]},{"id":"a7a0f95f.4634d8","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Auto Sch. temp. offset - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":740,"wires":[["637be2dc.bb021c"]]},{"id":"637be2dc.bb021c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":740,"wires":[[]]},{"id":"749bbe06.c300e","type":"comment","z":"c1e03843.9d14a8","name":"VTR300 ------------- JUSTERKLOKKE-------------------------------------------------------------------------------------------------","info":"","x":2190,"y":4780,"wires":[]},{"id":"3ce64a56.f14ce6","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Clock Hr (w)","showStatusActivities":true,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2490,"y":4860,"wires":[[],[]]},{"id":"16a9693.2d23497","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=6003;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2330,"y":4860,"wires":[["3ce64a56.f14ce6"]]},{"id":"a5134f31.9a071","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Clock min (w)","showStatusActivities":true,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":2500,"y":4900,"wires":[[],[]]},{"id":"be408434.b3de78","type":"function","z":"c1e03843.9d14a8","name":"Modbus write","func":"var fc=6;\nvar sa=6004;\nvar addresses=1;\nvar value=msg.payload;\n\nmsg.slave_ip=\"192.168.1.30\";\nmsg.payload={\"value\":value , 'fc': fc, 'unitid': 1, 'address': sa , 'quantity': addresses };\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2330,"y":4900,"wires":[["a5134f31.9a071"]]},{"id":"26b4347c.a931bc","type":"function","z":"c1e03843.9d14a8","name":"Get glob. syst.time","func":"var system_hour = global.get (\"TimeNow_Hour\");\nvar system_min = global.get (\"TimeNow_Min\");\n\n\nvar msg1 = {payload:system_hour};\nvar msg2 = {payload:system_min};\n\nreturn [msg1,msg2];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":2150,"y":4860,"wires":[["16a9693.2d23497"],["be408434.b3de78"]]},{"id":"f1abc8d2.ccbe08","type":"server-state-changed","z":"c1e03843.9d14a8","name":"Set system time","server":"2c4e313e.d0fc5e","version":3,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.vtr300_set_system_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"2","forType":"num","forUnits":"seconds","ignorePrevStateNull":true,"ignorePrevStateUnknown":true,"ignorePrevStateUnavailable":true,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1940,"y":4860,"wires":[["47dc6661.031b28","26b4347c.a931bc"],[]]},{"id":"8652eea3.14a08","type":"api-call-service","z":"c1e03843.9d14a8","name":"Set Sync. switch Off","server":"868599a7.b14688","version":3,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.vtr300_set_system_time","data":"","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2360,"y":4940,"wires":[[]]},{"id":"47dc6661.031b28","type":"trigger","z":"c1e03843.9d14a8","name":"10s","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2110,"y":4940,"wires":[["8652eea3.14a08","1d5e23ba.84392c"]]},{"id":"1d5e23ba.84392c","type":"change","z":"c1e03843.9d14a8","name":"Delete ABS value - flow","rules":[{"t":"delete","p":"vtr300_intern_ur_abs_value_min","pt":"flow"},{"t":"delete","p":"vtr300_intern_ur_abs_value_hour","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":2370,"y":4980,"wires":[[]]},{"id":"ef8bbb6a.241c28","type":"inject","z":"c1e03843.9d14a8","name":"Poll(5m)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"300","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":1920,"y":4820,"wires":[["fd13ee1f.8f0b4"]]},{"id":"fd13ee1f.8f0b4","type":"function","z":"c1e03843.9d14a8","name":"Allow clock adj. from HA","func":"// Polles etter delay for \"time off\" delay. \n\nvar intern_ur_abs_value_hour = flow.get (\"vtr300_intern_ur_abs_value_hour\",\"default\");  // Absolutt verdi time, intern ur vs HA ur.\nvar intern_ur_abs_value_min = flow.get (\"vtr300_intern_ur_abs_value_min\",\"default\");   // Absolutt verdi min., intern ur vs HA ur.\n\n//Initilialiser verdi dersom udefinert\nif (typeof intern_ur_abs_value_hour == \"undefined\")\nintern_ur_abs_value_hour = 0;\nif (typeof intern_ur_abs_value_min == \"undefined\")\nintern_ur_abs_value_min = 0;\n\nvar allow_clk_adj; // Brukes i HA for å tillate klokke just. fra \"Sync\" switch.\n\n// Tillat justering dersom time absolutt verdi er >=1 i 10 min. (ref. delay).\nif (intern_ur_abs_value_hour >= 1) {\n  allow_clk_adj = 'true';  \n}\n// Tillat justering dersom min. absolutt verdi er >= 5 i min. (ref. delay).\nelse if (intern_ur_abs_value_min >= 5) {\n  allow_clk_adj = 'true';\n}\n//\nelse {\n    allow_clk_adj = 'false'\n}\n\nmsg.payload = allow_clk_adj;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2130,"y":4820,"wires":[["1ae9bc11.c8d664"]]},{"id":"1ae9bc11.c8d664","type":"ha-entity","z":"c1e03843.9d14a8","name":"Allow clock adj.","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_intern_ur_allow_clk_adj"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:clock-alert"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2340,"y":4820,"wires":[[]]},{"id":"4e25e344.8d1e5c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":540,"wires":[[]]},{"id":"a919e2a9.def53","type":"function","z":"c1e03843.9d14a8","name":"Modbus r/w error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Frikjøling - Modbus r/w error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":540,"wires":[["4e25e344.8d1e5c"]]},{"id":"f060bc2e.c93c2","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":540,"wires":[[]]},{"id":"9524ed99.261a4","type":"catch","z":"c1e03843.9d14a8","name":"Frikjøling r/w error","scope":["70df5046.11825","b884a521.777968","6b33e6cb.9fcb28","521c10ae.7b355","2f33884b.e33088","ad17d341.dcad5","6d8fbd8a.0ea1f4","9a6067fe.a2d478","4ca595a0.d3d86c","b0f9a29a.ffa2b","83ed139f.782ca","1914abce.594d64","1b8067aa.6d5cf8","9f8d2ce0.179b8","4ab3f927.0deb98","4b0c8f41.b7051","418f49e9.b80058","86532da.144ffd","a9be4121.73bf8","14bdf54e.8d71cb","5f4961b6.576ba"],"uncaught":false,"x":4230,"y":540,"wires":[["f060bc2e.c93c2","3dc2a0a7.04d1"]]},{"id":"6655139.ec417ec","type":"catch","z":"c1e03843.9d14a8","name":"Auto Sch. Hr & Min write error","scope":["2d3fdce.f93d524","4055cea4.4ee","66ae848.7a8307c","50c4be55.bf02a","f4554cfc.5a3bc","4e0b8a5.cf69d74","592b7785.6b1218","cd6887a.ff6f578","99d0c143.4866c","c3d5c4c.3592438","6e986069.4990a","b7f51229.b4856","a2ebd4ac.7f8a58","303070a1.bfe84","6b448d94.171494","39e4b6ca.e764aa","9c34ed.cf935b1","d239c73a.6bbed8","b10b8ac8.54bcf8","2e38e0d.5e3d72","e8e89d0e.bbe64","c5f1019c.6b352","ed3f65f2.b00448","c914e3e8.5c82","b67be7c9.6a8cf8","21837085.bfb37","7fc10f7b.9e2f4","e107be.8e56384","ca2c1d50.fdc48","8e21bd75.c5b8e","f0e2b2f8.62bb4","6b6f1134.8d36c","a2dffa7c.28f028","cf629f3f.84057","68fbc5fd.fbd11c","34774ea1.7feb12","b04d6e3c.2520e","56f905d5.bbda2c","f1c939c.a7e28c8","430f87f8.89a4a8","c2a39846.ccd3e8","92b580c0.b96d4","37b0b19d.4bcf9e","4f10ae83.3a4d3","4fbb2801.1f7028","730c336.5d952cc","b5d89608.1130f8","6d5943b5.56a6fc","c94869c6.38f638","d180cfba.a1c24","d03953d9.3d969","9bffa906.082b78","d5883df0.43436","f3e86fc7.a5f53","a1e7fc5b.fbcdd","62aed387.ee42ec"],"uncaught":false,"x":4260,"y":580,"wires":[["3de93e08.cd88d2","3dc2a0a7.04d1"]]},{"id":"3de93e08.cd88d2","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":580,"wires":[[]]},{"id":"a3c88130.e61f1","type":"function","z":"c1e03843.9d14a8","name":"Modbus write error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Auto Sch. Hr & Min - Modbus write error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":580,"wires":[["fd822ac7.4a3358"]]},{"id":"fd822ac7.4a3358","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":580,"wires":[[]]},{"id":"e09a4146.95993","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":620,"wires":[[]]},{"id":"b193c3de.a468b","type":"function","z":"c1e03843.9d14a8","name":"Modbus read error - Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Auto Sch. Hr & Min - Modbus read error!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4650,"y":620,"wires":[["e09a4146.95993"]]},{"id":"a7a679ed.b80138","type":"trigger","z":"c1e03843.9d14a8","name":"Tr.10s","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4470,"y":620,"wires":[[]]},{"id":"ff5793d2.c4ee1","type":"catch","z":"c1e03843.9d14a8","name":"Auto Sch. Hr & Min read error","scope":["cb543c1e.92be1","1b92569c.f15999","9f3d2fea.08fbc","bcc210ca.94ac7","b3f56001.b353c","d1f1e4e6.7d6458","93b1887.4156578","9030121a.01037","28fe9ecf.6505c2","922e140f.2e6df8","aeebdad0.2cf4f8","7ffbb37a.cd609c","73d9bcc3.e4df54","203d4f95.92054","682ffb65.87c8f4","c1caed7b.9d185","5e11eb8e.5473a4","ccf2442d.21d918","edb724e2.b08bd8","e507c854.9284c8","4f12cd19.3acf24","bd0bdc3.07df32","37f0d3b9.4cc4fc","9f65f98b.816158","ad85298b.844dc8","f04108f3.6dffe8","4d1551fc.0de4f","178f1484.fd48fb"],"uncaught":false,"x":4260,"y":620,"wires":[["a7a679ed.b80138","3dc2a0a7.04d1"]]},{"id":"f83dff0e.46374","type":"comment","z":"c1e03843.9d14a8","name":"--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":4470,"y":20,"wires":[]},{"id":"88a081eb.ffd27","type":"comment","z":"c1e03843.9d14a8","name":"Modbus read/write notifications","info":"","x":4050,"y":20,"wires":[]},{"id":"8e21bd75.c5b8e","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2040,"wires":[[],[]]},{"id":"66ae848.7a8307c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2080,"wires":[[],[]]},{"id":"f0e2b2f8.62bb4","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2160,"wires":[[],[]]},{"id":"50c4be55.bf02a","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2200,"wires":[[],[]]},{"id":"6b6f1134.8d36c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2260,"wires":[[],[]]},{"id":"f4554cfc.5a3bc","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2300,"wires":[[],[]]},{"id":"a2dffa7c.28f028","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2380,"wires":[[],[]]},{"id":"4e0b8a5.cf69d74","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2420,"wires":[[],[]]},{"id":"cf629f3f.84057","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2480,"wires":[[],[]]},{"id":"592b7785.6b1218","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2520,"wires":[[],[]]},{"id":"68fbc5fd.fbd11c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2600,"wires":[[],[]]},{"id":"cd6887a.ff6f578","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2640,"wires":[[],[]]},{"id":"34774ea1.7feb12","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2700,"wires":[[],[]]},{"id":"99d0c143.4866c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2740,"wires":[[],[]]},{"id":"b04d6e3c.2520e","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2820,"wires":[[],[]]},{"id":"c3d5c4c.3592438","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2860,"wires":[[],[]]},{"id":"56f905d5.bbda2c","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":2920,"wires":[[],[]]},{"id":"6e986069.4990a","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":2960,"wires":[[],[]]},{"id":"f1c939c.a7e28c8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3040,"wires":[[],[]]},{"id":"b7f51229.b4856","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3080,"wires":[[],[]]},{"id":"430f87f8.89a4a8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3140,"wires":[[],[]]},{"id":"a2ebd4ac.7f8a58","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3180,"wires":[[],[]]},{"id":"c2a39846.ccd3e8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3260,"wires":[[],[]]},{"id":"303070a1.bfe84","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3300,"wires":[[],[]]},{"id":"92b580c0.b96d4","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3360,"wires":[[],[]]},{"id":"6b448d94.171494","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3400,"wires":[[],[]]},{"id":"37b0b19d.4bcf9e","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3480,"wires":[[],[]]},{"id":"39e4b6ca.e764aa","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3520,"wires":[[],[]]},{"id":"4f10ae83.3a4d3","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3580,"wires":[[],[]]},{"id":"9c34ed.cf935b1","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3620,"wires":[[],[]]},{"id":"4fbb2801.1f7028","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3700,"wires":[[],[]]},{"id":"d239c73a.6bbed8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3740,"wires":[[],[]]},{"id":"730c336.5d952cc","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3800,"wires":[[],[]]},{"id":"b10b8ac8.54bcf8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3840,"wires":[[],[]]},{"id":"b5d89608.1130f8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":3920,"wires":[[],[]]},{"id":"2e38e0d.5e3d72","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":3960,"wires":[[],[]]},{"id":"6d5943b5.56a6fc","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4020,"wires":[[],[]]},{"id":"e8e89d0e.bbe64","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4060,"wires":[[],[]]},{"id":"c94869c6.38f638","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4140,"wires":[[],[]]},{"id":"c5f1019c.6b352","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4180,"wires":[[],[]]},{"id":"d180cfba.a1c24","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4240,"wires":[[],[]]},{"id":"ed3f65f2.b00448","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4280,"wires":[[],[]]},{"id":"d03953d9.3d969","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4360,"wires":[[],[]]},{"id":"c914e3e8.5c82","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4400,"wires":[[],[]]},{"id":"9bffa906.082b78","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4460,"wires":[[],[]]},{"id":"b67be7c9.6a8cf8","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4500,"wires":[[],[]]},{"id":"d5883df0.43436","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4580,"wires":[[],[]]},{"id":"21837085.bfb37","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4620,"wires":[[],[]]},{"id":"f3e86fc7.a5f53","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4680,"wires":[[],[]]},{"id":"7fc10f7b.9e2f4","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4720,"wires":[[],[]]},{"id":"a1e7fc5b.fbcdd","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4800,"wires":[[],[]]},{"id":"e107be.8e56384","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4840,"wires":[[],[]]},{"id":"62aed387.ee42ec","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch Hr(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3860,"y":4900,"wires":[[],[]]},{"id":"ca2c1d50.fdc48","type":"modbus-flex-write","z":"c1e03843.9d14a8","name":"Sch min(w)","showStatusActivities":false,"showErrors":true,"server":"86a33495.600fd8","emptyMsgOnFail":false,"keepMsgProperties":false,"x":3870,"y":4940,"wires":[[],[]]},{"id":"8182cb37.de66b8","type":"catch","z":"c1e03843.9d14a8","name":"","scope":null,"uncaught":false,"x":3660,"y":80,"wires":[["351fad8d.9dd592","487ef5b1.3ae6cc"]]},{"id":"351fad8d.9dd592","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3650,"y":40,"wires":[]},{"id":"20d68679.72e28a","type":"function","z":"c1e03843.9d14a8","name":"reset on High","func":"if(\"high level reached\" === msg.state) {\n    msg.resetQueue = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":3990,"y":80,"wires":[[]]},{"id":"eef4a10.637486","type":"function","z":"c1e03843.9d14a8","name":"reset on HighHigh","func":"if(\"high high level reached\" === msg.state) {\n    msg.resetQueue = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":4010,"y":120,"wires":[["e5571953.f1b8c8"]]},{"id":"487ef5b1.3ae6cc","type":"switch","z":"c1e03843.9d14a8","name":"Modbus Server","property":"modbusClientName","propertyType":"msg","rules":[{"t":"eq","v":"VTR300","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":3820,"y":80,"wires":[["20d68679.72e28a","eef4a10.637486"]]},{"id":"3dc2a0a7.04d1","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"complete":"false","statusVal":"","statusType":"auto","x":4550,"y":60,"wires":[]},{"id":"a246b9ea.600988","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":790,"y":1360,"wires":[]},{"id":"6488c934.f4d708","type":"ha-entity","z":"c1e03843.9d14a8","name":"Modbus queue info","server":"2c4e313e.d0fc5e","version":1,"debugenabled":true,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_modbus_client_queue_info"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:speedometer-slow"},{"property":"unit_of_measurement","value":""}],"state":"state","stateType":"msg","attributes":[{"property":"Modbus client","value":"modbusClientName","valueType":"msg"},{"property":"Client adr.","value":"unitid","valueType":"msg"},{"property":"Queue items at level trigger","value":"bufferCommandListLength","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":4010,"y":160,"wires":[["1bb662c.6fa9d9d"]]},{"id":"1bb662c.6fa9d9d","type":"switch","z":"c1e03843.9d14a8","name":"!=","property":"state","propertyType":"msg","rules":[{"t":"neq","v":"low level reached","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":3710,"y":220,"wires":[["c18db184.26d0b"]]},{"id":"c18db184.26d0b","type":"function","z":"c1e03843.9d14a8","name":"Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Modbus: \" + msg.payload + \" sjekk kommunikasjon!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3830,"y":220,"wires":[["a6417ccd.49551"]]},{"id":"a6417ccd.49551","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4000,"y":220,"wires":[[]]},{"id":"eb08dcdd.31664","type":"comment","z":"c1e03843.9d14a8","name":"TILLATE HASTIGHER FOR FRIKJØLING! om ikke kalles switch off!(Glemt?)","info":"","x":370,"y":2900,"wires":[]},{"id":"faba9786.74c368","type":"debug","z":"c1e03843.9d14a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1200,"y":2860,"wires":[]},{"id":"6dff6144.090fc","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_freecool_states","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2440,"y":2500,"wires":[["d223bfd5.eebc7"]]},{"id":"7845d64a.a3a2f8","type":"change","z":"c1e03843.9d14a8","name":"Set flow ","rules":[{"t":"set","p":"vtr300_cool_recovery_states","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":280,"wires":[["f8f82165.a34c4"]]},{"id":"35b801ea.bead8e","type":"fixed-for","z":"c1e03843.9d14a8","name":"Fixed 5m","casesensitive":false,"for":"5","units":"min","continuous":false,"ondeploy":false,"x":640,"y":540,"wires":[["496c3ea9.f00d3"],[]]},{"id":"496c3ea9.f00d3","type":"function","z":"c1e03843.9d14a8","name":"Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"Modbus data sist lest: \" + msg.payload + \" sjekk modbus!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":540,"wires":[["7b4e7459.4af48c"]]},{"id":"7b4e7459.4af48c","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":940,"y":540,"wires":[[]]},{"id":"d899691f.057348","type":"function","z":"c1e03843.9d14a8","name":"Mrg. Hr:Min:Sec","func":"var Hour = msg.payload.data[0];\nvar Min = msg.payload.data[1];\n//var Sec = msg.payload.data[2];\n\n// Concatenate to correct format\nvar HourMinSec = ('0' +Hour).slice(-2)+':'+('0' +Min).slice(-2);\n//var HourMinSec = ('0' +Hour).slice(-2)+':'+('0' +Min).slice(-2)+':'+('0' +Sec).slice(-2);\n\nmsg.payload = HourMinSec;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":500,"wires":[["5ed4d952.b444d8","35b801ea.bead8e"]]},{"id":"4ebefd89.d69164","type":"function","z":"c1e03843.9d14a8","name":"","func":"var d = new Date(); \nmsg.time =  ('0' +d.getFullYear()).slice(-4) + '-' + ('0' + (d.getMonth()+1)).slice(-2) + '-' + d.getDate() + ' ' + ('0' + (d.getHours())).slice(-2) + ':' + ('0' + (d.getMinutes())).slice(-2) + ':' + ('0' + (d.getSeconds())).slice(-2);\n\n\n//var YearMdDay = ('0' +Year).slice(-4)+'.'+('0' +Md).slice(-2)+'.'+('0' +Day).slice(-2);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":400,"wires":[["74291066.b54e3"]]},{"id":"43d4489d.23c0c8","type":"inject","z":"c1e03843.9d14a8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":420,"wires":[["4ebefd89.d69164"]]},{"id":"74291066.b54e3","type":"debug","z":"c1e03843.9d14a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":460,"y":420,"wires":[]},{"id":"8fec6370.d72db","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":790,"y":1400,"wires":[]},{"id":"6e810f3d.8472d","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":790,"y":1440,"wires":[]},{"id":"b6b0ae4a.1d6a2","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":940,"wires":[]},{"id":"7d3c00aa.6dcf1","type":"inject","z":"c1e03843.9d14a8","name":"Startup poll","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":170,"y":3280,"wires":[["f075cc6f.464e8"]]},{"id":"9d7ec1ab.91bbf","type":"ha-entity","z":"c1e03843.9d14a8","name":"Forbruk total [kWt]","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"vtr300_forbruk_kwh_total"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:counter"},{"property":"unit_of_measurement","value":"kWt"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":2250,"y":4260,"wires":[[]]},{"id":"263c47fc.4d2ef8","type":"function","z":"c1e03843.9d14a8","name":"Move & reset daily [kWt] & [Kr]","func":"//  Get System time ***************************************************************************************************************************|\nvar rst_time = global.get (\"TimeNow_YearDateHour\",\"default\");                                        // Systemtid.\n\n//  Get day - kWt *****************************************************************************************************************************|\nvar kWh_forbruk_daily = flow.get (\"vtr300_forbruk_kWh_daily\",\"default\");                             // Forbruk daglig estimert [kWt].\nvar kWh_tilfort_daily = flow.get (\"vtr300_tilfort_kWh_daily\",\"default\");                             // Tilfort daglig estimert [kWt].\nvar kWh_fakt_tilfort_daily = flow.get (\"vtr300_fakt_tilfort_kWh_daily\",\"default\");                   // Faktisk tilfort daglig estimert [kWt].\n\n//  Get day - Kr ******************************************************************************************************************************|\nvar kr_forbruk_daily = flow.get (\"vtr300_forbruk_kWh_daily_Kr\",\"default\");                          // Forbruk daglig estimert [kWt].\nvar kr_tilfort_daily = flow.get (\"vtr300_tilfort_kWh_daily_Kr\",\"default\");                          // Tilfort daglig estimert [kWt].\nvar kr_fakt_tilfort_daily = flow.get (\"vtr300_fakt_tilfort_kr_daily\",\"default\");                    // Faktisk tilfort daglig estimert [kWt].\n\n//  Set Pday - kWt ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_pday\", (kWh_forbruk_daily).toFixed(2) +' kWt',\"storeInFile\");           // Sett energiforbruk forrige dag.\nflow.set(\"vtr300_tilfort_kWh_pday\", (kWh_tilfort_daily).toFixed(2) +' kWt',\"storeInFile\");           // Sett energi tilfort forrige dag.\nflow.set(\"vtr300_fakt_tilfort_kWh_pday\", (kWh_fakt_tilfort_daily).toFixed(2) +' kWt',\"storeInFile\"); // Sett energi faktisk tilfort forrige dag.\n\n//  Set Pday - Kr *****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kr_pday\", (kr_forbruk_daily).toFixed(2) +' Kr',\"storeInFile\");              // Sett energiforbruk forrige dag.\nflow.set(\"vtr300_tilfort_kr_pday\", (kr_tilfort_daily).toFixed(2) +' Kr',\"storeInFile\");              // Sett energi tilfort forrige dag.\nflow.set(\"vtr300_fakt_tilfort_kr_pday\", (kr_fakt_tilfort_daily).toFixed(2) +' Kr',\"storeInFile\");    // Sett energi faktisk tilfort forrige dag.\n\n//  Reset day - kWt ***************************************************************************************************************************|\nvar reset = 0; // Reset value, set at midnight every day.\n\nflow.set(\"vtr300_forbruk_kWh_daily\", reset, \"default\");      // Reset energiforbruk i dag.\nflow.set(\"vtr300_tilfort_kWh_daily\", reset, \"default\");      // Reset energi tilfort i dag.\nflow.set(\"vtr300_fakt_tilfort_kWh_daily\", reset, \"default\"); // Reset energi faktisk tilfort i dag.\n\n//  Reset day - Kr ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_daily_Kr\", reset, \"default\");   // Reset energiforbruk i dag.\nflow.set(\"vtr300_tilfort_kWh_daily_Kr\", reset, \"default\");   // Reset energi tilfort i dag.\nflow.set(\"vtr300_fakt_tilfort_kr_daily\", reset, \"default\");  // Reset energi faktisk tilfort i dag.\n\n//  Set time of reset - Day  ******************************************************************************************************************|\nflow.set(\"vtr300_daily_rst_time\", rst_time, \"storeInFile\");      // Tid daily ble resatt\n","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2250,"y":4320,"wires":[],"inputLabels":["Watt - Forbruk fra TP link"],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"bfb99f98.5c281","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":2940,"wires":[]},{"id":"c2559265.93e92","type":"comment","z":"c1e03843.9d14a8","name":"Modbus write **Testes mot lokal modus endring","info":"","x":840,"y":2580,"wires":[]},{"id":"bab332ac.0320a","type":"function","z":"c1e03843.9d14a8","name":"Move & reset weekly [kWt] & [Kr]","func":"//  Get System time ***************************************************************************************************************************|\nvar rst_time = global.get (\"TimeNow_YearDateHour\",\"default\");                                          // Systemtid.\n\n//  Get day - kWt *****************************************************************************************************************************|\nvar kWh_forbruk_weekly = flow.get (\"vtr300_forbruk_kWh_weekly\",\"default\");                             // Forbruk ukentlig estimert [kWt].\nvar kWh_tilfort_weekly = flow.get (\"vtr300_tilfort_kWh_weekly\",\"default\");                             // Tilfort ukentlig estimert [kWt].\nvar kWh_fakt_tilfort_weekly = flow.get (\"vtr300_fakt_tilfort_kWh_weekly\",\"default\");                   // Faktisk tilfort ukentlig estimert [kWt].\n\n//  Get day - Kr ******************************************************************************************************************************|\nvar kr_forbruk_weekly = flow.get (\"vtr300_forbruk_kWh_weekly_Kr\",\"default\");                          // Forbruk ukentlig estimert [kWt].\nvar kr_tilfort_weekly = flow.get (\"vtr300_tilfort_kWh_weekly_Kr\",\"default\");                          // Tilfort ukentlig estimert [kWt].\nvar kr_fakt_tilfort_weekly = flow.get (\"vtr300_fakt_tilfort_kr_weekly\",\"default\");                    // Faktisk tilfort ukentlig estimert [kWt].\n\n//  Set Pday - kWt ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_pweek\", (kWh_forbruk_weekly).toFixed(2) +' kWt',\"storeInFile\");           // Sett energiforbruk forrige uke.\nflow.set(\"vtr300_tilfort_kWh_pweek\", (kWh_tilfort_weekly).toFixed(2) +' kWt',\"storeInFile\");           // Sett energi tilfort forrige uke.\nflow.set(\"vtr300_fakt_tilfort_kWh_pweek\", (kWh_fakt_tilfort_weekly).toFixed(2) +' kWt',\"storeInFile\"); // Sett energi faktisk tilfort forrige uke.\n\n//  Set Pday - Kr *****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kr_pweek\", (kr_forbruk_weekly).toFixed(2) +' Kr',\"storeInFile\");              // Sett energiforbruk forrige uke.\nflow.set(\"vtr300_tilfort_kr_pweek\", (kr_tilfort_weekly).toFixed(2) +' Kr',\"storeInFile\");              // Sett energi tilfort forrige uke.\nflow.set(\"vtr300_fakt_tilfort_kr_pweek\", (kr_fakt_tilfort_weekly).toFixed(2) +' Kr',\"storeInFile\");    // Sett energi faktisk tilfort forrige uke.\n\n//  Reset day - kWt ***************************************************************************************************************************|\nvar reset = 0; // Reset value, set at midnight every day.\n\nflow.set(\"vtr300_forbruk_kWh_weekly\", reset, \"default\");      // Reset energiforbruk denne uke.\nflow.set(\"vtr300_tilfort_kWh_weekly\", reset, \"default\");      // Reset energi tilfort denne uke.\nflow.set(\"vtr300_fakt_tilfort_kWh_weekly\", reset, \"default\"); // Reset energi faktisk tilfort denne uke.\n\n//  Reset day - Kr ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_weekly_Kr\", reset, \"default\");   // Reset energiforbruk denne uke.\nflow.set(\"vtr300_tilfort_kWh_weekly_Kr\", reset, \"default\");   // Reset energi tilfort denne uke.\nflow.set(\"vtr300_fakt_tilfort_kr_weekly\", reset, \"default\");  // Reset energi faktisk tilfort denne uke.\n\n//  Set time of reset - Day  ******************************************************************************************************************|\nflow.set(\"vtr300_weekly_rst_time\", rst_time, \"storeInFile\");  // Tid weekly ble resatt\n","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2250,"y":4360,"wires":[],"inputLabels":["Watt - Forbruk fra TP link"],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"ab083f45.48425","type":"inject","z":"c1e03843.9d14a8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1850,"y":4480,"wires":[["bab332ac.0320a"]]},{"id":"932e3af7.dbd2e8","type":"function","z":"c1e03843.9d14a8","name":"Move & reset Md. [kWt] & [Kr]","func":"//  Get System time ***************************************************************************************************************************|\nvar rst_time = global.get (\"TimeNow_YearDateHour\",\"default\");                                            // Systemtid.\n\n//  Get month - kWt *****************************************************************************************************************************|\nvar kWh_forbruk_monthly = flow.get (\"vtr300_forbruk_kWh_monthly\",\"default\");                             // Forbruk md estimert [kWt].\nvar kWh_tilfort_monthly = flow.get (\"vtr300_tilfort_kWh_monthly\",\"default\");                             // Tilfort md estimert [kWt].\nvar kWh_fakt_tilfort_monthly = flow.get (\"vtr300_fakt_tilfort_kWh_monthly\",\"default\");                   // Faktisk tilfort md estimert [kWt].\n\n//  Get month - Kr ******************************************************************************************************************************|\nvar kr_forbruk_monthly = flow.get (\"vtr300_forbruk_kWh_monthly_Kr\",\"default\");                           // Forbruk md estimert [kWt].\nvar kr_tilfort_monthly = flow.get (\"vtr300_tilfort_kWh_monthly_Kr\",\"default\");                           // Tilfort md estimert [kWt].\nvar kr_fakt_tilfort_monthly = flow.get (\"vtr300_fakt_tilfort_kr_monthly\",\"default\");                     // Faktisk tilfort md estimert [kWt].\n\n//  Set Pmonth - kWt ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_pmonth\", (kWh_forbruk_monthly).toFixed(2) +' kWt',\"storeInFile\");           // Sett energiforbruk forrige md.\nflow.set(\"vtr300_tilfort_kWh_pmonth\", (kWh_tilfort_monthly).toFixed(2) +' kWt',\"storeInFile\");           // Sett energi tilfort forrige md.\nflow.set(\"vtr300_fakt_tilfort_kWh_pmonth\", (kWh_fakt_tilfort_monthly).toFixed(2) +' kWt',\"storeInFile\"); // Sett energi faktisk tilfort forrige md.\n\n//  Set Pmonth - Kr *****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kr_pmonth\", (kr_forbruk_monthly).toFixed(2) +' Kr',\"storeInFile\");              // Sett energiforbruk forrige md.\nflow.set(\"vtr300_tilfort_kr_pmonth\", (kr_tilfort_monthly).toFixed(2) +' Kr',\"storeInFile\");              // Sett energi tilfort forrige md.\nflow.set(\"vtr300_fakt_tilfort_kr_pmonth\", (kr_fakt_tilfort_monthly).toFixed(2) +' Kr',\"storeInFile\");    // Sett energi faktisk tilfort forrige md.\n\n//  Reset month - kWt ***************************************************************************************************************************|\nvar reset = 0; // Reset value, set at midnight every day.\n\nflow.set(\"vtr300_forbruk_kWh_monthly\", reset, \"default\");      // Reset energiforbruk denne md.\nflow.set(\"vtr300_tilfort_kWh_monthly\", reset, \"default\");      // Reset energi tilfort denne md.\nflow.set(\"vtr300_fakt_tilfort_kWh_monthly\", reset, \"default\"); // Reset energi faktisk tilfort denne md.\n\n//  Reset month - Kr ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_monthly_Kr\", reset, \"default\");   // Reset energiforbruk denne md.\nflow.set(\"vtr300_tilfort_kWh_monthly_Kr\", reset, \"default\");   // Reset energi tilfort denne md.\nflow.set(\"vtr300_fakt_tilfort_kr_monthly\", reset, \"default\");  // Reset energi faktisk tilfort denne md.\n\n//  Set time of reset - Month  ******************************************************************************************************************|\nflow.set(\"vtr300_monthly_rst_time\", rst_time, \"storeInFile\");  // Tid md ble resatt\n","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2250,"y":4400,"wires":[],"inputLabels":["Watt - Forbruk fra TP link"],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"86bcd183c012ac47","type":"function","z":"c1e03843.9d14a8","name":"Move & reset Yearly [kWt] & [Kr]","func":"//  Get System time ***************************************************************************************************************************|\nvar rst_time = global.get (\"TimeNow_YearDateHour\",\"default\");                                          // Systemtid.\n\n//  Get year - kWt *****************************************************************************************************************************|\nvar kWh_forbruk_yearly = flow.get (\"vtr300_forbruk_kWh_yearly\",\"default\");                             // Forbruk year estimert [kWt].\nvar kWh_tilfort_yearly = flow.get (\"vtr300_tilfort_kWh_yearly\",\"default\");                             // Tilfort year estimert [kWt].\nvar kWh_fakt_tilfort_yearly = flow.get (\"vtr300_fakt_tilfort_kWh_yearly\",\"default\");                   // Faktisk tilfort year estimert [kWt].\n\n//  Get year - Kr ******************************************************************************************************************************|\nvar kr_forbruk_yearly = flow.get (\"vtr300_forbruk_kWh_yearly_Kr\",\"default\");                           // Forbruk year estimert [kWt].\nvar kr_tilfort_yearly = flow.get (\"vtr300_tilfort_kWh_yearly_Kr\",\"default\");                           // Tilfort year estimert [kWt].\nvar kr_fakt_tilfort_yearly = flow.get (\"vtr300_fakt_tilfort_kr_yearly\",\"default\");                     // Faktisk tilfort year estimert [kWt].\n\n//  Set Pyear - kWt ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_pyear\", (kWh_forbruk_yearly).toFixed(2) +' kWt',\"storeInFile\");           // Sett energiforbruk forrige year.\nflow.set(\"vtr300_tilfort_kWh_pyear\", (kWh_tilfort_yearly).toFixed(2) +' kWt',\"storeInFile\");           // Sett energi tilfort forrige year.\nflow.set(\"vtr300_fakt_tilfort_kWh_pyear\", (kWh_fakt_tilfort_yearly).toFixed(2) +' kWt',\"storeInFile\"); // Sett energi faktisk tilfort forrige year.\n\n//  Set Pyear - Kr *****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kr_pyear\", (kr_forbruk_yearly).toFixed(2) +' Kr',\"storeInFile\");              // Sett energiforbruk forrige year.\nflow.set(\"vtr300_tilfort_kr_pyear\", (kr_tilfort_yearly).toFixed(2) +' Kr',\"storeInFile\");              // Sett energi tilfort forrige year.\nflow.set(\"vtr300_fakt_tilfort_kr_pyear\", (kr_fakt_tilfort_yearly).toFixed(2) +' Kr',\"storeInFile\");    // Sett energi faktisk tilfort forrige year.\n\n//  Reset year - kWt ***************************************************************************************************************************|\nvar reset = 0; // Reset value, set at midnight every day.\n\nflow.set(\"vtr300_forbruk_kWh_yearly\", reset, \"default\");      // Reset energiforbruk denne year.\nflow.set(\"vtr300_tilfort_kWh_yearly\", reset, \"default\");      // Reset energi tilfort denne year.\nflow.set(\"vtr300_fakt_tilfort_kWh_yearly\", reset, \"default\"); // Reset energi faktisk tilfort denne year.\n\n//  Reset year - Kr ****************************************************************************************************************************|\nflow.set(\"vtr300_forbruk_kWh_yearly_Kr\", reset, \"default\");   // Reset energiforbruk denne year.\nflow.set(\"vtr300_tilfort_kWh_yearly_Kr\", reset, \"default\");   // Reset energi tilfort denne year.\nflow.set(\"vtr300_fakt_tilfort_kr_yearly\", reset, \"default\");  // Reset energi faktisk tilfort denne year.\n\n//  Set time of reset - year  ******************************************************************************************************************|\nflow.set(\"vtr300_yearly_rst_time\", rst_time, \"storeInFile\");  // Tid year ble resatt","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2250,"y":4440,"wires":[],"inputLabels":["Watt - Forbruk fra TP link"],"info":"# Engineering range: -40°C -> 50°C\n"},{"id":"d1c406d34c4e0171","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":true,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":3930,"y":320,"wires":[]},{"id":"868981391a02be95","type":"inject","z":"c1e03843.9d14a8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3630,"y":300,"wires":[["487ef5b1.3ae6cc"]]},{"id":"3c0143145f2a9927","type":"change","z":"c1e03843.9d14a8","name":"Set flow","rules":[{"t":"set","p":"vtr300_elheater_padrag","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1060,"wires":[["e110a96c.1942f8"]]},{"id":"2c41bfc7866ce1ea","type":"function","z":"c1e03843.9d14a8","name":"Auto velg ppm sensor","func":"// 1. Ved sensor feil, velg ppm sensor med gyldig verdi.\n// 2. Velg sensor med høyeste ppm verdi for styring av viftehastighet i PPM Auto.\n\nvar ppm_sensor_1_state = flow.get (\"ppm_sensor_1\",\"default\"); \nvar ppm_sensor_2_state = flow.get (\"ppm_sensor_2\",\"default\"); \nvar ppm_sensor_selected;\nvar ppm_sensor_active;\n\n\n// Sensor 1 feiler, bruk sensor 2.\nif (isNaN(ppm_sensor_1_state)) {\n  ppm_sensor_selected = ppm_sensor_2_state;\n  ppm_sensor_active = 'ppm sensor 2';\n}\n\n// Sensor 2 feiler, bruk sensor 1.\nelse if (isNaN(ppm_sensor_2_state)) {\n  ppm_sensor_selected = ppm_sensor_1_state;\n  ppm_sensor_active = 'ppm sensor 1';\n}\n\n// Sensor 1 verdi > sensor 2, bruk sensor 1.\nelse if (ppm_sensor_1_state > ppm_sensor_2_state) {\n  ppm_sensor_selected = ppm_sensor_1_state;\n  ppm_sensor_active = 'ppm sensor 1';  \n}\n\n// Sensor 1 verdi <= sensor 2, bruk sensor 2.\nelse if (ppm_sensor_1_state <= ppm_sensor_2_state) {\n  ppm_sensor_selected = ppm_sensor_2_state;\n  ppm_sensor_active = 'ppm sensor 2';  \n}\n  \n// Sensor feil\nelse { \n  ppm_sensor_selected = 'ppm feil!';  \n  ppm_sensor_active = 'ppm sensorer feiler';  \n}\n\nflow.set(\"ppm_sensor_selected\", ppm_sensor_selected, \"default\"); // Lagres for gjenbruk å skrive ppm hastighet  \nflow.set(\"ppm_sensor_active\", ppm_sensor_active, \"default\");     // Lagres for sette recovery to Auto Schedule dersom ppm sensorer feiler.  \n\nvar msg1 = {payload:parseFloat(ppm_sensor_selected)}; // ppm verdi valgt sensor.\nvar msg2 = {payload:(ppm_sensor_active)};             // Valgt sensor.\n\nreturn [msg1,msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":3020,"wires":[["8e6630c285337519"],["c4f8effefb123c83","fe24d228fa9a196c"]],"outputLabels":["ppm verdi valgt  sensor","Aktive sensor"]},{"id":"d53ca16dcb5a9bf7","type":"inject","z":"c1e03843.9d14a8","name":"Poll 10s","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"20","crontab":"","once":true,"onceDelay":"5","topic":"","payloadType":"date","x":560,"y":3020,"wires":[["2c41bfc7866ce1ea"]]},{"id":"f7da21650babcfbc","type":"poll-state","z":"c1e03843.9d14a8","name":"Netatmo ppm","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.netatmo_netatmo_indoor_co2","state_type":"num","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":170,"y":3020,"wires":[["6c473aa974f3073c"]]},{"id":"6c473aa974f3073c","type":"change","z":"c1e03843.9d14a8","name":"Set flow ppm sensor 1","rules":[{"t":"set","p":"ppm_sensor_1","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":3020,"wires":[[]]},{"id":"7e822792fa8a8813","type":"poll-state","z":"c1e03843.9d14a8","name":"SCD30 ppm","server":"2c4e313e.d0fc5e","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"30","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.scd30_1_co2","state_type":"num","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":170,"y":3060,"wires":[["ed2a443845a5734e"]]},{"id":"ed2a443845a5734e","type":"change","z":"c1e03843.9d14a8","name":"Set flow ppm sensor 2","rules":[{"t":"set","p":"ppm_sensor_2","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":3060,"wires":[[]]},{"id":"8e6630c285337519","type":"ha-entity","z":"c1e03843.9d14a8","name":"ppm auto valgt sensor","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"ppm_sensor_selected"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:molecule-co2"},{"property":"unit_of_measurement","value":"ppm"}],"state":"payload","stateType":"msg","attributes":[{"property":"Aktiv sensor","value":"ppm_sensor_active","valueType":"flow"},{"property":"Stue - S1","value":"ppm_sensor_1","valueType":"flow"},{"property":"Soverom - S2","value":"ppm_sensor_2","valueType":"flow"}],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":980,"y":3000,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"d20f6064518860b2","type":"comment","z":"c1e03843.9d14a8","name":"Auto select ppm sensor ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","info":"","x":670,"y":2960,"wires":[]},{"id":"c4f8effefb123c83","type":"ha-entity","z":"c1e03843.9d14a8","name":"ppm sensor auto status","server":"2c4e313e.d0fc5e","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"ppm_sensor_selected_state"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:molecule-co2"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":false,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":990,"y":3040,"wires":[[]],"info":"# Utekompensert vifte kompensering:\n0% til 50% pådrags kompensering "},{"id":"379c14416f400a04","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":570,"y":3440,"wires":[]},{"id":"274466b38137c030","type":"debug","z":"c1e03843.9d14a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":390,"y":3440,"wires":[]},{"id":"fe24d228fa9a196c","type":"switch","z":"c1e03843.9d14a8","name":"Wrn.","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ppm sensorer feiler","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":930,"y":3100,"wires":[["c5237b388f98a1a8"]]},{"id":"c5237b388f98a1a8","type":"switch","z":"c1e03843.9d14a8","name":"!=","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"prev"}],"checkall":"true","repair":false,"outputs":1,"x":1050,"y":3100,"wires":[["532192632c531813"]]},{"id":"532192632c531813","type":"function","z":"c1e03843.9d14a8","name":"Msg.","func":"msg.payload =\n{\n  \"data\": {\n    \"message\": \"Ventilasjon VTR300\",\n    \"title\": \"PPM Auto: \" + msg.payload + \"!\"\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1170,"y":3100,"wires":[["16251576da08940d"]]},{"id":"16251576da08940d","type":"api-call-service","z":"c1e03843.9d14a8","name":"Persistent Notification","server":"2c4e313e.d0fc5e","version":3,"debugenabled":false,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{}","dataType":"json","mergecontext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1340,"y":3100,"wires":[[]]},{"id":"86a33495.600fd8","type":"modbus-client","name":"VTR300","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"tcpHost":"192.168.1.30","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"1","commandDelay":"75","clientTimeout":"20000","reconnectOnTimeout":true,"reconnectTimeout":"34000","parallelUnitIdsAllowed":false},{"id":"868599a7.b14688","type":"server","name":"Home Assistant","version":1,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"2c4e313e.d0fc5e","type":"server","name":"Home Assistant","version":1,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true}]